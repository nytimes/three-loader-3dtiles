(function(mt,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/loaders/DRACOLoader.js"),require("three/examples/jsm/loaders/KTX2Loader.js")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/loaders/DRACOLoader.js","three/examples/jsm/loaders/KTX2Loader.js"],g):(mt=typeof globalThis<"u"?globalThis:mt||self,g(mt.ThreeLoader3DTiles={},mt.THREE,mt.THREE,mt.THREE,mt.THREE))})(this,function(mt,g,fc,dc,mc){"use strict";async function me(e,t,n,s){return s._parse(e,t,n,s)}function U(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const We=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Rr=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Rr&&parseFloat(Rr[1]);function gc(e,t){return Mr(e||{},t)}function Mr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(n>3)return t;const s={...e};for(const[r,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=Mr(s[r]||{},t[r],n+1):s[r]=t[r];return s}const Ac="latest";function pc(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.1"),globalThis._loadersgl_.version}const Ir=pc();function Ot(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const gt=typeof process!="object"||String(process)!=="[object process]"||process.browser,jn=typeof importScripts=="function",yc=typeof window<"u"&&typeof window.orientation<"u",Sr=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Sr&&parseFloat(Sr[1]);class Bc{constructor(t,n){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=n,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}done(t){Ot(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ot(this.isRunning),this.isRunning=!1,this._reject(t)}}class kn{terminate(){}}const Kn=new Map;function Cc(e){Ot(e.source&&!e.url||!e.source&&e.url);let t=Kn.get(e.source||e.url);return t||(e.url&&(t=Ec(e.url),Kn.set(e.url,t)),e.source&&(t=xr(e.source),Kn.set(e.source,t))),Ot(t),t}function Ec(e){if(!e.startsWith("http"))return e;const t=Tc(e);return xr(t)}function xr(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Tc(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Or(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const s=n||new Set;if(e){if(Fr(e))s.add(e);else if(Fr(e.buffer))s.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const r in e)Or(e[r],t,s)}}return n===void 0?Array.from(s):[]}function Fr(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const zn=()=>{};class Wn{static isSupported(){return typeof Worker<"u"&&gt||typeof kn<"u"&&!gt}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:n,source:s,url:r}=t;Ot(s||r),this.name=n,this.source=s,this.url=r,this.onMessage=zn,this.onError=i=>console.log(i),this.worker=gt?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=zn,this.onError=zn,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,n){n=n||Or(t),this.worker.postMessage(t,n)}_getErrorFromErrorEvent(t){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,t.message&&(n+=`${t.message} in `),t.lineno&&(n+=`:${t.lineno}:${t.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=Cc({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},t.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},t.onmessageerror=n=>console.error(n),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new kn(s,{eval:!1})}else if(this.source)t=new kn(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",n=>{this.onMessage(n)}),t.on("error",n=>{this.onError(n)}),t.on("exit",n=>{}),t}}class bc{static isSupported(){return Wn.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(i,o,a)=>i.done(a),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(i,o)=>i.error(o);const r=new Promise(i=>(this.jobQueue.push({name:t,onMessage:n,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length});const s=new Bc(n.name,t);t.onMessage=r=>n.onMessage(s,r.type,r.payload),t.onError=r=>n.onError(s,r),n.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!gt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Wn({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return yc?this.maxMobileConcurrency:this.maxConcurrency}}const _c={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Ft{static isSupported(){return Wn.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Ft._workerFarm=Ft._workerFarm||new Ft({}),Ft._workerFarm.setProps(t),Ft._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={..._c},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:n,source:s,url:r}=t;let i=this.workerPools.get(n);return i||(i=new bc({name:n,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Ft._workerFarm=void 0;function wc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=t[e.id]||{},s=gt?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(gt?r=`modules/${e.module}/dist/${s}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let i=e.version;i==="latest"&&(i=Ac);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${s}`}return Ot(r),r}function Rc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ir;Ot(e,"no worker provided");const n=e.version;return!(!t||!n)}const Mc=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})),Xn={};async function Vt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return t&&(e=Ic(e,t,n,s)),Xn[e]=Xn[e]||Sc(e),await Xn[e]}function Ic(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!n.useLocalLibraries&&e.startsWith("http"))return e;s=s||e;const r=n.modules||{};return r[s]?r[s]:gt?n.CDN?(Ot(n.CDN.startsWith("http")),`${n.CDN}/${t}@${Ir}/dist/libs/${s}`):jn?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function Sc(e){if(e.endsWith("wasm"))return await Oc(e);if(!gt)try{return Mc&&void 0}catch(n){return console.error(n),null}if(jn)return importScripts(e);const t=await Fc(e);return xc(t,e)}function xc(e,t){if(!gt)return;if(jn)return eval.call(globalThis,e),null;const n=document.createElement("script");n.id=t;try{n.appendChild(document.createTextNode(e))}catch{n.text=e}return document.body.appendChild(n),null}async function Oc(e){return await(await fetch(e)).arrayBuffer()}async function Fc(e){return await(await fetch(e)).text()}function vc(e,t){return!Ft.isSupported()||!gt&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function Dc(e,t,n,s,r){const i=e.id,o=wc(e,n),c=Ft.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const u=await c.startJob("process-on-worker",Lc.bind(null,r));return u.postMessage("process",{input:t,options:n,context:s}),await(await u.result).result}async function Lc(e,t,n,s){switch(n){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const a=await e(i,o);t.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function Gc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?vr(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?vr(e,0,t):""}function vr(e,t,n){if(e.byteLength<=t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}function Pc(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${Gc(e)}"`)}}function Nc(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function Uc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Hc(t)}function Hc(e){const t=e.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),n=t.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(n);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s.buffer}function Qn(e,t,n){const s=n!==void 0?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(s).buffer}function ge(e,t){return U(e>=0),U(t>0),e+(t-1)&~(t-1)}function Jc(e,t,n){let s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else{const r=e.byteOffset,i=e.byteLength;s=new Uint8Array(e.buffer||e.arrayBuffer,r,i)}return t.set(s,n),n+ge(s.byteLength,4)}async function Vc(e){const t=[];for await(const n of e)t.push(n);return Uc(...t)}function Dr(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class Lr{constructor(t,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Dr(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Dr()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Gr{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const n of Object.values(this.stats))t(n)}getTable(){const t={};return this.forEach(n=>{t[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(t){const{name:n,type:s}=t;let r=this.stats[n];return r||(t instanceof Lr?r=t:r=new Lr(n,s),this.stats[n]=r),r}}const jc="Queued Requests",kc="Active Requests",Kc="Cancelled Requests",zc="Queued Requests Ever",Wc="Active Requests Ever",Xc={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class Qc{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.deferredUpdate=null,this.props={...Xc,...t},this.stats=new Gr({id:this.props.id}),this.stats.get(jc),this.stats.get(kc),this.stats.get(Kc),this.stats.get(zc),this.stats.get(Wc)}scheduleRequest(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:n},r=new Promise(i=>(s.resolve=i,s));return this.requestQueue.push(s),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:n,resolve:s}=t;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let n=0;n<t;++n){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const t=this.requestQueue;for(let n=0;n<t.length;++n){const s=t[n];this._updateRequest(s)||(t.splice(n,1),this.requestMap.delete(s.handle),n--)}t.sort((n,s)=>n.priority-s.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let qc="";const Pr={};function Yc(e){for(const t in Pr)if(e.startsWith(t)){const n=Pr[t];e=e.replace(t,n)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${qc}${e}`),e}function Ly(e){return e}function $c(e){return e&&typeof e=="object"&&e.isBuffer}function Nr(e){if($c(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Zc(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)===null||e===void 0?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function Ur(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function qn(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function tu(){const e=[];for(let r=0;r<arguments.length;r++)e[r]=r<0||arguments.length<=r?void 0:arguments[r];let t="",n=!1,s;for(let r=e.length-1;r>=-1&&!n;r--){let i;r>=0?i=e[r]:(s===void 0&&(s=Zc()),i=s),i.length!==0&&(t=`${i}/${t}`,n=i.charCodeAt(0)===Ae)}return t=eu(t,!n),n?`/${t}`:t.length>0?t:"."}const Ae=47,Yn=46;function eu(e,t){let n="",s=-1,r=0,i,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===Ae)break;i=Ae}if(i===Ae){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||!o||n.charCodeAt(n.length-1)!==Yn||n.charCodeAt(n.length-2)!==Yn){if(n.length>2){const c=n.length-1;let u=c;for(;u>=0&&n.charCodeAt(u)!==Ae;--u);if(u!==c){n=u===-1?"":n.slice(0,u),s=a,r=0,o=!1;continue}}else if(n.length===2||n.length===1){n="",s=a,r=0,o=!1;continue}}t&&(n.length>0?n+="/..":n="..",o=!0)}else{const c=e.slice(s+1,a);n.length>0?n+=`/${c}`:n=c,o=!1}s=a,r=0}else i===Yn&&r!==-1?++r:r=-1}return n}const nu=e=>typeof e=="boolean",pe=e=>typeof e=="function",ye=e=>e!==null&&typeof e=="object",Hr=e=>ye(e)&&e.constructor==={}.constructor,su=e=>!!e&&typeof e[Symbol.iterator]=="function",ru=e=>e&&typeof e[Symbol.asyncIterator]=="function",jt=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,kt=e=>typeof Blob<"u"&&e instanceof Blob,iu=e=>e&&typeof e=="object"&&e.isBuffer,ou=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||ye(e)&&pe(e.tee)&&pe(e.cancel)&&pe(e.getReader),au=e=>ye(e)&&pe(e.read)&&pe(e.pipe)&&nu(e.readable),Jr=e=>ou(e)||au(e),cu=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,uu=/^([-\w.]+\/[-\w.+]+)/;function lu(e){const t=uu.exec(e);return t?t[1]:e}function Vr(e){const t=cu.exec(e);return t?t[1]:""}const jr=/\?.*/;function hu(e){const t=e.match(jr);return t&&t[0]}function $n(e){return e.replace(jr,"")}function Xe(e){return jt(e)?e.url:kt(e)?e.name||"":typeof e=="string"?e:""}function Zn(e){if(jt(e)){const t=e,n=t.headers.get("content-type")||"",s=$n(t.url);return lu(n)||Vr(s)}return kt(e)?e.type||"":typeof e=="string"?Vr(e):""}function fu(e){return jt(e)?e.headers["content-length"]||-1:kt(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function kr(e){if(jt(e))return e;const t={},n=fu(e);n>=0&&(t["content-length"]=String(n));const s=Xe(e),r=Zn(e);r&&(t["content-type"]=r);const i=await gu(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function du(e){if(!e.ok){const t=await mu(e);throw new Error(t)}}async function mu(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const n=e.headers.get("Content-Type");let s=e.statusText;n!=null&&n.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function gu(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const n=e.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s(i==null||(o=i.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(e instanceof ArrayBuffer){const n=e.slice(0,5);return`data:base64,${Au(n)}`}return null}function Au(e){let t="";const n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}function pu(e){return!yu(e)&&!Bu(e)}function yu(e){return e.startsWith("http:")||e.startsWith("https:")}function Bu(e){return e.startsWith("data:")}async function Be(e,t){if(typeof e=="string"){const r=Yc(e);if(pu(r)){var n;if((n=globalThis.loaders)!==null&&n!==void 0&&n.fetchNode){var s;return(s=globalThis.loaders)===null||s===void 0?void 0:s.fetchNode(r,t)}}return await fetch(r,t)}return await kr(e)}function Cu(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function Ce(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Cu()}const Qe=globalThis.window||globalThis.self||globalThis.global,Ee=globalThis.process||{},Kr=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";Ce();function Eu(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}class Tu{constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Eu(s),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}function bu(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function _u(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function ts(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(n=Math.min(n,s/e.width));const i=e.width*n,o=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let qe;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(qe||(qe={}));const wu=10;function zr(e){return typeof e!="string"?e:(e=e.toUpperCase(),qe[e]||qe.WHITE)}function Ru(e,t,n){if(!Ce&&typeof e=="string"){if(t){const s=zr(t);e="\x1B[".concat(s,"m").concat(e,"\x1B[39m")}if(n){const s=zr(n);e="\x1B[".concat(s+wu,"m").concat(e,"\x1B[49m")}}return e}function Mu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(n),r=e;for(const i of s){const o=r[i];typeof o=="function"&&(t.find(a=>i===a)||(r[i]=o.bind(e)))}}function Ye(e,t){if(!e)throw new Error(t||"Assertion failed")}function te(){let e;if(Ce()&&Qe.performance){var t,n;e=Qe==null||(t=Qe.performance)===null||t===void 0||(n=t.now)===null||n===void 0?void 0:n.call(t)}else if("hrtime"in Ee){var s;const r=Ee==null||(s=Ee.hrtime)===null||s===void 0?void 0:s.call(Ee);e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}const ee={debug:Ce()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Iu={enabled:!0,level:0};function At(){}const Wr={},Xr={once:!0};class $e{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=Kr,this._startTs=te(),this._deltaTs=te(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Tu("__probe-".concat(this.id,"__"),Iu),this.timeStamp("".concat(this.id," started")),Mu(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((te()-this._startTs).toPrecision(10))}getDelta(){return Number((te()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){Ye(t,n)}warn(t){return this._getLogFunction(0,t,ee.warn,arguments,Xr)}error(t){return this._getLogFunction(0,t,ee.error,arguments)}deprecated(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}probe(t,n){return this._getLogFunction(t,n,ee.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,ee.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){return this._getLogFunction(t,n,ee.debug||ee.info,arguments,Xr)}table(t,n,s){return n?this._getLogFunction(t,n,console.table||At,s&&[s],{tag:Fu(n)}):At}image(t){let{logLevel:n,priority:s,image:r,message:i="",scale:o=1}=t;return this._shouldLog(n||s)?Ce()?Ou({image:r,message:i,scale:o}):xu():At}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||At)}group(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=qr({logLevel:t,message:n,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||At)}withGroup(t,n,s){this.group(t,n)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Qr(t)}_getLogFunction(t,n,s,r,i){if(this._shouldLog(t)){i=qr({logLevel:t,message:n,args:r,opts:i}),s=s||i.method,Ye(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=te();const o=i.tag||i.message;if(i.once&&o)if(!Wr[o])Wr[o]=te();else return At;return n=Su(this.id,i.message,i),s.bind(console,n,...i.args)}return At}}$e.VERSION=Kr;function Qr(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Ye(Number.isFinite(t)&&t>=0),t}function qr(e){const{logLevel:t,message:n}=e;e.logLevel=Qr(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&s.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return Ye(r==="string"||r==="object"),Object.assign(e,{args:s},e.opts)}function Su(e,t,n){if(typeof t=="string"){const s=n.time?_u(bu(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),t=Ru(t,n.color,n.background)}return t}function xu(e){return console.warn("removed"),At}function Ou(e){let{image:t,message:n="",scale:s=1}=e;if(typeof t=="string"){const i=new Image;return i.onload=()=>{const o=ts(i,n,s);console.log(...o)},i.src=t,At}const r=t.nodeName||"";if(r.toLowerCase()==="img")return console.log(...ts(t,n,s)),At;if(r.toLowerCase()==="canvas"){const i=new Image;return i.onload=()=>console.log(...ts(i,n,s)),i.src=t.toDataURL(),At}return At}function Fu(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const Yr=new $e({id:"@probe.gl/log"}),$r=new $e({id:"loaders.gl"});class vu{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Du{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.log.bind(this.console,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.info.bind(this.console,...n)}warn(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.warn.bind(this.console,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.error.bind(this.console,...n)}}const Zr={fetch:null,mimeType:void 0,nothrow:!1,log:new Du,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:We,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Lu={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function ti(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}function ei(){const e=ti();return e.globalOptions=e.globalOptions||{...Zr},e.globalOptions}function Gu(e,t,n,s){return n=n||[],n=Array.isArray(n)?n:[n],Pu(e,n),Uu(t,e,s)}function Pu(e,t){ni(e,null,Zr,Lu,t);for(const n of t){const s=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ni(s,n.id,r,i,t)}}function ni(e,t,n,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const c=!t&&ye(e[a]),u=a==="baseUri"&&!t,l=a==="workerUrl"&&t;if(!(a in n)&&!u&&!l){if(a in s)$r.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=Nu(a,r);$r.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function Nu(e,t){const n=e.toLowerCase();let s="";for(const r of t)for(const i in r.options){if(e===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function Uu(e,t,n){const r={...e.options||{}};return Hu(r,n),r.log===null&&(r.log=new vu),si(r,ei()),si(r,t),r}function si(e,t){for(const n in t)if(n in t){const s=t[n];Hr(s)&&Hr(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Hu(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function es(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function ri(e){var t,n;U(e,"null loader"),U(es(e),"invalid loader");let s;return Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(n=e)!==null&&n!==void 0&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Ju=()=>{const e=ti();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Vu(){return Ju()}const ju=new $e({id:"loaders.gl"}),ku=/\.([^.]+)$/;async function Ku(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!oi(e))return null;let r=ii(e,t,{...n,nothrow:!0},s);if(r)return r;if(kt(e)&&(e=await e.slice(0,10).arrayBuffer(),r=ii(e,t,n,s)),!r&&!(n!=null&&n.nothrow))throw new Error(ai(e));return r}function ii(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!oi(e))return null;if(t&&!Array.isArray(t))return ri(t);let r=[];t&&(r=r.concat(t)),n!=null&&n.ignoreRegisteredLoaders||r.push(...Vu()),Wu(r);const i=zu(e,r,n,s);if(!i&&!(n!=null&&n.nothrow))throw new Error(ai(e));return i}function zu(e,t,n,s){const r=Xe(e),i=Zn(e),o=$n(r)||(s==null?void 0:s.url);let a=null,c="";if(n!=null&&n.mimeType&&(a=ns(t,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||Xu(t,o),c=c||(a?`matched url ${o}`:""),a=a||ns(t,i),c=c||(a?`matched MIME type ${i}`:""),a=a||qu(t,e),c=c||(a?`matched initial data ${ui(e)}`:""),n!=null&&n.fallbackMimeType&&(a=a||ns(t,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c){var u;ju.log(1,`selectLoader selected ${(u=a)===null||u===void 0?void 0:u.name}: ${c}.`)}return a}function oi(e){return!(e instanceof Response&&e.status===204)}function ai(e){const t=Xe(e),n=Zn(e);let s="No valid loader found (";s+=t?`${Ur(t)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?ui(e):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function Wu(e){for(const t of e)ri(t)}function Xu(e,t){const n=t&&ku.exec(t),s=n&&n[1];return s?Qu(e,s):null}function Qu(e,t){t=t.toLowerCase();for(const n of e)for(const s of n.extensions)if(s.toLowerCase()===t)return n;return null}function ns(e,t){for(const n of e)if(n.mimeTypes&&n.mimeTypes.includes(t)||t===`application/x.${n.id}`)return n;return null}function qu(e,t){if(!t)return null;for(const n of e)if(typeof t=="string"){if(Yu(t,n))return n}else if(ArrayBuffer.isView(t)){if(ci(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&ci(t,0,n))return n;return null}function Yu(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>e.startsWith(s))}function ci(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>$u(e,t,n,r))}function $u(e,t,n,s){if(s instanceof ArrayBuffer)return Nc(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":const r=ss(e,t,s.length);return s===r;default:return!1}}function ui(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?ss(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ss(e,0,t):""}function ss(e,t,n){if(e.byteLength<t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const Zu=256*1024;function*tl(e,t){const n=(t==null?void 0:t.chunkSize)||Zu;let s=0;const r=new TextEncoder;for(;s<e.length;){const i=Math.min(e.length-s,n),o=e.slice(s,s+i);s+=i,yield r.encode(o)}}const el=256*1024;function nl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=el}=t;let s=0;for(;s<e.byteLength;){const r=Math.min(e.byteLength-s,n),i=new ArrayBuffer(r),o=new Uint8Array(e,s,r);new Uint8Array(i).set(o),s+=r,yield i}}()}const sl=1024*1024;async function*rl(e,t){const n=(t==null?void 0:t.chunkSize)||sl;let s=0;for(;s<e.size;){const r=s+n,i=await e.slice(s,r).arrayBuffer();s=r,yield i}}function li(e,t){return We?il(e,t):ol(e)}async function*il(e,t){const n=e.getReader();let s;try{for(;;){const r=s||n.read();t!=null&&t._streamReadAhead&&(s=n.read());const{done:i,value:o}=await r;if(i)return;yield Nr(o)}}catch{n.releaseLock()}}async function*ol(e,t){for await(const n of e)yield Nr(n)}function al(e,t){if(typeof e=="string")return tl(e,t);if(e instanceof ArrayBuffer)return nl(e,t);if(kt(e))return rl(e,t);if(Jr(e))return li(e,t);if(jt(e))return li(e.body,t);throw new Error("makeIterator")}const hi="Cannot convert supplied data type";function cl(e,t,n){if(t.text&&typeof e=="string")return e;if(iu(e)&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(e.byteOffset,e.byteOffset+r)),s}throw new Error(hi)}async function ul(e,t,n){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||s)return cl(e,t);if(kt(e)&&(e=await kr(e)),jt(e)){const r=e;return await du(r),t.binary?await r.arrayBuffer():await r.text()}if(Jr(e)&&(e=al(e,n)),su(e)||ru(e))return Vc(e);throw new Error(hi)}function fi(e,t){const n=ei(),s=e||n;return typeof s.fetch=="function"?s.fetch:ye(s.fetch)?r=>Be(r,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Be}function ll(e,t,n){if(n)return n;const s={fetch:fi(t,e),...e};if(s.url){const r=$n(s.url);s.baseUrl=r,s.queryString=hu(s.url),s.filename=Ur(r),s.baseUrl=qn(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function hl(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...s]:s}return n&&n.length?n:void 0}async function Ze(e,t,n,s){t&&!Array.isArray(t)&&!es(t)&&(s=void 0,n=t,t=void 0),e=await e,n=n||{};const r=Xe(e),o=hl(t,s),a=await Ku(e,o,n);return a?(n=Gu(n,a,o,r),s=ll({url:r,_parse:Ze,loaders:o},n,s||null),await fl(a,e,n,s)):null}async function fl(e,t,n,s){if(Rc(e),n=gc(e.options,n),jt(t)){const i=t,{ok:o,redirected:a,status:c,statusText:u,type:l,url:h}=i,f=Object.fromEntries(i.headers.entries());s.response={headers:f,ok:o,redirected:a,status:c,statusText:u,type:l,url:h}}t=await ul(t,e,n);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,n,s);if(vc(e,n))return await Dc(e,t,n,s,Ze);if(r.parseText&&typeof t=="string")return await r.parseText(t,n,s);if(r.parse)return await r.parse(t,n,s);throw Ot(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function dl(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function ml(e){let t=1/0,n=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let u=0;u<c;u+=3){const l=a[u],h=a[u+1],f=a[u+2];t=l<t?l:t,n=h<n?h:n,s=f<s?f:s,r=l>r?l:r,i=h>i?h:i,o=f>o?f:o}return[[t,n,s],[r,i,o]]}function gl(e,t,n){const s=dl(t.value),r=n||Al(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function Al(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function ne(e,t,n,s){let r,i;!Array.isArray(t)&&!es(t)?(r=[],i=t):(r=t,i=n);const o=fi(i);let a=e;return typeof e=="string"&&(a=await o(e)),kt(e)&&(a=await o(e)),Array.isArray(r)?await Ze(a,r,i):await Ze(a,r,i)}const pl=1/Math.PI*180,yl=1/180*Math.PI,Bl={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Bl}};const $=globalThis.mathgl.config;function Cl(e,{precision:t=$.precision}={}){return e=wl(e),"".concat(parseFloat(e.toPrecision(t)))}function Kt(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function El(e){return bl(e)}function Tl(e){return Et(e)}function bl(e,t){return rs(e,n=>n*yl,t)}function Et(e,t){return rs(e,n=>n*pl,t)}function _l(e,t,n){return rs(e,s=>Math.max(t,Math.min(n,s)))}function Pt(e,t,n){const s=$.EPSILON;n&&($.EPSILON=n);try{if(e===t)return!0;if(Kt(e)&&Kt(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!Pt(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=$.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{$.EPSILON=s}}function wl(e){return Math.round(e/$.EPSILON)*$.EPSILON}function Rl(e){return e.clone?e.clone():new Array(e.length)}function rs(e,t,n){if(Kt(e)){const s=e;n=n||Rl(s);for(let r=0;r<n.length&&r<s.length;++r){const i=typeof e=="number"?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}function Ml(e){function t(){var n=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class is extends Ml(Array){clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+n];return this.check()}toArray(t=[],n=0){for(let s=0;s<this.ELEMENTS;++s)t[n+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Kt(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString($)}formatString(t){let n="";for(let s=0;s<this.ELEMENTS;++s)n+=(s>0?", ":"")+Cl(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Pt(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,s){if(s===void 0)return this.lerp(this,t,n);for(let r=0;r<this.ELEMENTS;++r){const i=t[r],o=typeof n=="number"?n:n[r];this[r]=i+s*(o-i)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),n[s]);return this.check()}add(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if($.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),n);return this.check()}get elements(){return this}}function Il(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function N(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function Te(e,t,n=""){if($.debug&&!Il(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function j(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}class os extends is{get x(){return this[0]}set x(t){this[0]=N(t)}get y(){return this[1]}set y(t){this[1]=N(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];n+=r*r}return N(n)}dot(t){let n=0;for(let s=0;s<this.ELEMENTS;++s)n+=this[s]*t[s];return N(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return j(t>=0&&t<this.ELEMENTS,"index is out of range"),N(this[t])}setComponent(t,n){return j(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}}const be=1e-6;let Tt=typeof Float32Array<"u"?Float32Array:Array;function Sl(){const e=new Tt(2);return Tt!=Float32Array&&(e[0]=0,e[1]=0),e}function xl(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e}function Ol(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r+n[4],e[1]=n[1]*s+n[3]*r+n[5],e}function di(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[3]*r+n[6],e[1]=n[1]*s+n[4]*r+n[7],e}function mi(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[4]*r+n[12],e[1]=n[1]*s+n[5]*r+n[13],e}(function(){const e=Sl();return function(t,n,s,r,i,o){let a,c;for(n||(n=2),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function gi(e,t,n){const s=t[0],r=t[1],i=n[3]*s+n[7]*r||1;return e[0]=(n[0]*s+n[4]*r)/i,e[1]=(n[1]*s+n[5]*r)/i,e}function Ai(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[3]*s+n[7]*r+n[11]*i||1;return e[0]=(n[0]*s+n[4]*r+n[8]*i)/o,e[1]=(n[1]*s+n[5]*r+n[9]*i)/o,e[2]=(n[2]*s+n[6]*r+n[10]*i)/o,e}function Fl(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e}function vl(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e[3]=t[3],e}function pi(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=n[0]*s+n[3]*r+n[6]*i,e[1]=n[1]*s+n[4]*r+n[7]*i,e[2]=n[2]*s+n[5]*r+n[8]*i,e[3]=t[3],e}class tn extends os{constructor(t=0,n=0){super(2),Kt(t)&&arguments.length===1?this.copy(t):($.debug&&(N(t),N(n)),this[0]=t,this[1]=n)}set(t,n){return this[0]=t,this[1]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return $.debug&&(N(t.x),N(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return mi(this,this,t),this.check()}transformAsVector(t){return gi(this,this,t),this.check()}transformByMatrix3(t){return di(this,this,t),this.check()}transformByMatrix2x3(t){return Ol(this,this,t),this.check()}transformByMatrix2(t){return xl(this,this,t),this.check()}}function yi(){const e=new Tt(3);return Tt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Bi(e){const t=e[0],n=e[1],s=e[2];return Math.sqrt(t*t+n*n+s*s)}function Ci(e,t,n){const s=new Tt(3);return s[0]=e,s[1]=t,s[2]=n,s}function Dl(e,t){const n=t[0],s=t[1],r=t[2];let i=n*n+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function as(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function en(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2];return e[0]=r*c-i*a,e[1]=i*o-s*c,e[2]=s*a-r*o,e}function cs(e,t,n){const s=t[0],r=t[1],i=t[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,e[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,e[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,e}function Ei(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=s*n[0]+r*n[3]+i*n[6],e[1]=s*n[1]+r*n[4]+i*n[7],e[2]=s*n[2]+r*n[5]+i*n[8],e}function Ti(e,t,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=t[0],c=t[1],u=t[2];let l=r*u-i*c,h=i*a-s*u,f=s*c-r*a,d=r*f-i*h,m=i*l-s*f,A=s*h-r*l;const y=o*2;return l*=y,h*=y,f*=y,d*=2,m*=2,A*=2,e[0]=a+l+d,e[1]=c+h+m,e[2]=u+f+A,e}function Ll(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Gl(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Pl(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Nl(e,t){const n=e[0],s=e[1],r=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),u=c&&as(e,t)/c;return Math.acos(Math.min(Math.max(u,-1),1))}const Ul=Bi;(function(){const e=yi();return function(t,n,s,r,i,o){let a,c;for(n||(n=3),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const us=[0,0,0];let nn;class p extends os{static get ZERO(){return nn||(nn=new p(0,0,0),Object.freeze(nn)),nn}constructor(t=0,n=0,s=0){super(-0,-0,-0),arguments.length===1&&Kt(t)?this.copy(t):($.debug&&(N(t),N(n),N(s)),this[0]=t,this[1]=n,this[2]=s)}set(t,n,s){return this[0]=t,this[1]=n,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return $.debug&&(N(t.x),N(t.y),N(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=N(t)}angle(t){return Nl(this,t)}cross(t){return en(this,this,t),this.check()}rotateX({radians:t,origin:n=us}){return Ll(this,this,n,t),this.check()}rotateY({radians:t,origin:n=us}){return Gl(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=us}){return Pl(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return cs(this,this,t),this.check()}transformAsVector(t){return Ai(this,this,t),this.check()}transformByMatrix3(t){return Ei(this,this,t),this.check()}transformByMatrix2(t){return Fl(this,this,t),this.check()}transformByQuaternion(t){return Ti(this,this,t),this.check()}}let sn;class ls extends os{static get ZERO(){return sn||(sn=new ls(0,0,0,0),Object.freeze(sn)),sn}constructor(t=0,n=0,s=0,r=0){super(-0,-0,-0,-0),Kt(t)&&arguments.length===1?this.copy(t):($.debug&&(N(t),N(n),N(s),N(r)),this[0]=t,this[1]=n,this[2]=s,this[3]=r)}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return $.debug&&(N(t.x),N(t.y),N(t.z),N(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=N(t)}get w(){return this[3]}set w(t){this[3]=N(t)}transform(t){return cs(this,this,t),this.check()}transformByMatrix3(t){return pi(this,this,t),this.check()}transformByMatrix2(t){return vl(this,this,t),this.check()}transformByQuaternion(t){return Ti(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class bi extends is{toString(){let t="[";if($.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+n])}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,s){return this[n*this.RANK+t]=N(s),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[s+r];return n}setColumn(t,n){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=n[r];return this}}function Hl(){const e=new Tt(9);return Tt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Jl(e,t){if(e===t){const n=t[1],s=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=s,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Vl(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*o-a*u,f=-l*i+a*c,d=u*i-o*c;let m=n*h+s*f+r*d;return m?(m=1/m,e[0]=h*m,e[1]=(-l*s+r*u)*m,e[2]=(a*s-r*o)*m,e[3]=f*m,e[4]=(l*n-r*c)*m,e[5]=(-a*n+r*i)*m,e[6]=d*m,e[7]=(-u*n+s*c)*m,e[8]=(o*n-s*i)*m,e):null}function jl(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],u=e[8];return t*(u*i-o*c)+n*(-u*r+o*a)+s*(c*r-i*a)}function _i(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],f=n[0],d=n[1],m=n[2],A=n[3],y=n[4],E=n[5],w=n[6],B=n[7],C=n[8];return e[0]=f*s+d*o+m*u,e[1]=f*r+d*a+m*l,e[2]=f*i+d*c+m*h,e[3]=A*s+y*o+E*u,e[4]=A*r+y*a+E*l,e[5]=A*i+y*c+E*h,e[6]=w*s+B*o+C*u,e[7]=w*r+B*a+C*l,e[8]=w*i+B*c+C*h,e}function kl(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],f=n[0],d=n[1];return e[0]=s,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=f*s+d*o+u,e[7]=f*r+d*a+l,e[8]=f*i+d*c+h,e}function Kl(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*s+f*o,e[1]=d*r+f*a,e[2]=d*i+f*c,e[3]=d*o-f*s,e[4]=d*a-f*r,e[5]=d*c-f*i,e[6]=u,e[7]=l,e[8]=h,e}function wi(e,t,n){const s=n[0],r=n[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function zl(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,u=n*o,l=s*o,h=s*a,f=r*o,d=r*a,m=r*c,A=i*o,y=i*a,E=i*c;return e[0]=1-h-m,e[3]=l-E,e[6]=f+y,e[1]=l+E,e[4]=1-u-m,e[7]=d-A,e[2]=f-y,e[5]=d+A,e[8]=1-u-h,e}var hs;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(hs||(hs={}));const Wl=Object.freeze([1,0,0,0,1,0,0,0,1]);class z extends bi{static get IDENTITY(){return Ql()}static get ZERO(){return Xl()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return hs}constructor(t,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Wl)}fromObject(t){return this.check()}fromQuaternion(t){return zl(this,t),this.check()}set(t,n,s,r,i,o,a,c,u){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=u,this.check()}setRowMajor(t,n,s,r,i,o,a,c,u){return this[0]=t,this[1]=r,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=s,this[7]=o,this[8]=u,this.check()}determinant(){return jl(this)}transpose(){return Jl(this,this),this.check()}invert(){return Vl(this,this),this.check()}multiplyLeft(t){return _i(this,t,this),this.check()}multiplyRight(t){return _i(this,this,t),this.check()}rotate(t){return Kl(this,this,t),this.check()}scale(t){return Array.isArray(t)?wi(this,this,t):wi(this,this,[t,t]),this.check()}translate(t){return kl(this,this,t),this.check()}transform(t,n){let s;switch(t.length){case 2:s=di(n||[-0,-0],t,this);break;case 3:s=Ei(n||[-0,-0,-0],t,this);break;case 4:s=pi(n||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(s,t.length),s}transformVector(t,n){return this.transform(t,n)}transformVector2(t,n){return this.transform(t,n)}transformVector3(t,n){return this.transform(t,n)}}let rn,on=null;function Xl(){return rn||(rn=new z([0,0,0,0,0,0,0,0,0]),Object.freeze(rn)),rn}function Ql(){return on||(on=new z,Object.freeze(on)),on}function ql(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Yl(e,t){if(e===t){const n=t[1],s=t[2],r=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=i,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function $l(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=t[9],f=t[10],d=t[11],m=t[12],A=t[13],y=t[14],E=t[15],w=n*a-s*o,B=n*c-r*o,C=n*u-i*o,R=s*c-r*a,T=s*u-i*a,O=r*u-i*c,F=l*A-h*m,x=l*y-f*m,v=l*E-d*m,k=h*y-f*A,Q=h*E-d*A,q=f*E-d*y;let D=w*q-B*Q+C*k+R*v-T*x+O*F;return D?(D=1/D,e[0]=(a*q-c*Q+u*k)*D,e[1]=(r*Q-s*q-i*k)*D,e[2]=(A*O-y*T+E*R)*D,e[3]=(f*T-h*O-d*R)*D,e[4]=(c*v-o*q-u*x)*D,e[5]=(n*q-r*v+i*x)*D,e[6]=(y*C-m*O-E*B)*D,e[7]=(l*O-f*C+d*B)*D,e[8]=(o*Q-a*v+u*F)*D,e[9]=(s*v-n*Q-i*F)*D,e[10]=(m*T-A*C+E*w)*D,e[11]=(h*C-l*T-d*w)*D,e[12]=(a*x-o*k-c*F)*D,e[13]=(n*k-s*x+r*F)*D,e[14]=(A*B-m*R-y*w)*D,e[15]=(l*R-h*B+f*w)*D,e):null}function Zl(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],u=e[8],l=e[9],h=e[10],f=e[11],d=e[12],m=e[13],A=e[14],y=e[15],E=t*o-n*i,w=t*a-s*i,B=n*a-s*o,C=u*m-l*d,R=u*A-h*d,T=l*A-h*m,O=t*T-n*R+s*C,F=i*T-o*R+a*C,x=u*B-l*w+h*E,v=d*B-m*w+A*E;return c*O-r*F+y*x-f*v}function Ri(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],f=t[9],d=t[10],m=t[11],A=t[12],y=t[13],E=t[14],w=t[15];let B=n[0],C=n[1],R=n[2],T=n[3];return e[0]=B*s+C*a+R*h+T*A,e[1]=B*r+C*c+R*f+T*y,e[2]=B*i+C*u+R*d+T*E,e[3]=B*o+C*l+R*m+T*w,B=n[4],C=n[5],R=n[6],T=n[7],e[4]=B*s+C*a+R*h+T*A,e[5]=B*r+C*c+R*f+T*y,e[6]=B*i+C*u+R*d+T*E,e[7]=B*o+C*l+R*m+T*w,B=n[8],C=n[9],R=n[10],T=n[11],e[8]=B*s+C*a+R*h+T*A,e[9]=B*r+C*c+R*f+T*y,e[10]=B*i+C*u+R*d+T*E,e[11]=B*o+C*l+R*m+T*w,B=n[12],C=n[13],R=n[14],T=n[15],e[12]=B*s+C*a+R*h+T*A,e[13]=B*r+C*c+R*f+T*y,e[14]=B*i+C*u+R*d+T*E,e[15]=B*o+C*l+R*m+T*w,e}function th(e,t,n){const s=n[0],r=n[1],i=n[2];let o,a,c,u,l,h,f,d,m,A,y,E;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*i+t[12],e[13]=t[1]*s+t[5]*r+t[9]*i+t[13],e[14]=t[2]*s+t[6]*r+t[10]*i+t[14],e[15]=t[3]*s+t[7]*r+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],u=t[3],l=t[4],h=t[5],f=t[6],d=t[7],m=t[8],A=t[9],y=t[10],E=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=u,e[4]=l,e[5]=h,e[6]=f,e[7]=d,e[8]=m,e[9]=A,e[10]=y,e[11]=E,e[12]=o*s+l*r+m*i+t[12],e[13]=a*s+h*r+A*i+t[13],e[14]=c*s+f*r+y*i+t[14],e[15]=u*s+d*r+E*i+t[15]),e}function eh(e,t,n){const s=n[0],r=n[1],i=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function nh(e,t,n,s){let r=s[0],i=s[1],o=s[2],a=Math.sqrt(r*r+i*i+o*o),c,u,l,h,f,d,m,A,y,E,w,B,C,R,T,O,F,x,v,k,Q,q,D,it;return a<be?null:(a=1/a,r*=a,i*=a,o*=a,u=Math.sin(n),c=Math.cos(n),l=1-c,h=t[0],f=t[1],d=t[2],m=t[3],A=t[4],y=t[5],E=t[6],w=t[7],B=t[8],C=t[9],R=t[10],T=t[11],O=r*r*l+c,F=i*r*l+o*u,x=o*r*l-i*u,v=r*i*l-o*u,k=i*i*l+c,Q=o*i*l+r*u,q=r*o*l+i*u,D=i*o*l-r*u,it=o*o*l+c,e[0]=h*O+A*F+B*x,e[1]=f*O+y*F+C*x,e[2]=d*O+E*F+R*x,e[3]=m*O+w*F+T*x,e[4]=h*v+A*k+B*Q,e[5]=f*v+y*k+C*Q,e[6]=d*v+E*k+R*Q,e[7]=m*v+w*k+T*Q,e[8]=h*q+A*D+B*it,e[9]=f*q+y*D+C*it,e[10]=d*q+E*D+R*it,e[11]=m*q+w*D+T*it,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function sh(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[4],o=t[5],a=t[6],c=t[7],u=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+u*s,e[5]=o*r+l*s,e[6]=a*r+h*s,e[7]=c*r+f*s,e[8]=u*r-i*s,e[9]=l*r-o*s,e[10]=h*r-a*s,e[11]=f*r-c*s,e}function rh(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],u=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-u*s,e[1]=o*r-l*s,e[2]=a*r-h*s,e[3]=c*r-f*s,e[8]=i*s+u*r,e[9]=o*s+l*r,e[10]=a*s+h*r,e[11]=c*s+f*r,e}function ih(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],u=t[4],l=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+u*s,e[1]=o*r+l*s,e[2]=a*r+h*s,e[3]=c*r+f*s,e[4]=u*r-i*s,e[5]=l*r-o*s,e[6]=h*r-a*s,e[7]=f*r-c*s,e}function oh(e,t){const n=t[0],s=t[1],r=t[2],i=t[4],o=t[5],a=t[6],c=t[8],u=t[9],l=t[10];return e[0]=Math.sqrt(n*n+s*s+r*r),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+u*u+l*l),e}function ah(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,u=n*o,l=s*o,h=s*a,f=r*o,d=r*a,m=r*c,A=i*o,y=i*a,E=i*c;return e[0]=1-h-m,e[1]=l+E,e[2]=f-y,e[3]=0,e[4]=l-E,e[5]=1-u-m,e[6]=d+A,e[7]=0,e[8]=f+y,e[9]=d-A,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ch(e,t,n,s,r,i,o){const a=1/(n-t),c=1/(r-s),u=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+s)*c,e[10]=(o+i)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*u,e[15]=0,e}function uh(e,t,n,s,r){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(s-r);e[10]=(r+s)*o,e[14]=2*r*s*o}else e[10]=-1,e[14]=-2*s;return e}const lh=uh;function hh(e,t,n,s,r,i,o){const a=1/(t-n),c=1/(s-r),u=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*a,e[13]=(r+s)*c,e[14]=(o+i)*u,e[15]=1,e}const fh=hh;function dh(e,t,n,s){let r,i,o,a,c,u,l,h,f,d;const m=t[0],A=t[1],y=t[2],E=s[0],w=s[1],B=s[2],C=n[0],R=n[1],T=n[2];return Math.abs(m-C)<be&&Math.abs(A-R)<be&&Math.abs(y-T)<be?ql(e):(h=m-C,f=A-R,d=y-T,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,i=w*d-B*f,o=B*h-E*d,a=E*f-w*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),c=f*a-d*o,u=d*i-h*a,l=h*o-f*i,r=Math.sqrt(c*c+u*u+l*l),r?(r=1/r,c*=r,u*=r,l*=r):(c=0,u=0,l=0),e[0]=i,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=u,e[6]=f,e[7]=0,e[8]=a,e[9]=l,e[10]=d,e[11]=0,e[12]=-(i*m+o*A+a*y),e[13]=-(c*m+u*A+l*y),e[14]=-(h*m+f*A+d*y),e[15]=1,e)}function mh(){const e=new Tt(4);return Tt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function gh(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Ah(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ph(e){const t=e[0],n=e[1],s=e[2],r=e[3];return Math.sqrt(t*t+n*n+s*s+r*r)}function yh(e){const t=e[0],n=e[1],s=e[2],r=e[3];return t*t+n*n+s*s+r*r}function Bh(e,t){const n=t[0],s=t[1],r=t[2],i=t[3];let o=n*n+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=r*o,e[3]=i*o,e}function Ch(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Eh(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e[2]=o+s*(n[2]-o),e[3]=a+s*(n[3]-a),e}function Th(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3];return e[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,e[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,e[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,e[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,e}function bh(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2],u=n[3],l=u*s+a*i-c*r,h=u*r+c*s-o*i,f=u*i+o*r-a*s,d=-o*s-a*r-c*i;return e[0]=l*u+d*-o+h*-c-f*-a,e[1]=h*u+d*-a+f*-o-l*-c,e[2]=f*u+d*-c+l*-a-h*-o,e[3]=t[3],e}(function(){const e=mh();return function(t,n,s,r,i,o){let a,c;for(n||(n=4),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var fs;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(fs||(fs={}));const _h=45*Math.PI/180,wh=1,ds=.1,ms=500,Rh=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class V extends bi{static get IDENTITY(){return Ih()}static get ZERO(){return Mh()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return fs}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,s,r,i,o,a,c,u,l,h,f,d,m,A,y){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=u,this[9]=l,this[10]=h,this[11]=f,this[12]=d,this[13]=m,this[14]=A,this[15]=y,this.check()}setRowMajor(t,n,s,r,i,o,a,c,u,l,h,f,d,m,A,y){return this[0]=t,this[1]=i,this[2]=u,this[3]=d,this[4]=n,this[5]=o,this[6]=l,this[7]=m,this[8]=s,this[9]=a,this[10]=h,this[11]=A,this[12]=r,this[13]=c,this[14]=f,this[15]=y,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Rh)}fromObject(t){return this.check()}fromQuaternion(t){return ah(this,t),this.check()}frustum(t){const{left:n,right:s,bottom:r,top:i,near:o=ds,far:a=ms}=t;return a===1/0?Sh(this,n,s,r,i,o):ch(this,n,s,r,i,o,a),this.check()}lookAt(t){const{eye:n,center:s=[0,0,0],up:r=[0,1,0]}=t;return dh(this,n,s,r),this.check()}ortho(t){const{left:n,right:s,bottom:r,top:i,near:o=ds,far:a=ms}=t;return fh(this,n,s,r,i,o,a),this.check()}orthographic(t){const{fovy:n=_h,aspect:s=wh,focalDistance:r=1,near:i=ds,far:o=ms}=t;Mi(n);const a=n/2,c=r*Math.tan(a),u=c*s;return this.ortho({left:-u,right:u,bottom:-c,top:c,near:i,far:o})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=t;return Mi(n),lh(this,n,s,r,i),this.check()}determinant(){return Zl(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return Yl(this,this),this.check()}invert(){return $l(this,this),this.check()}multiplyLeft(t){return Ri(this,t,this),this.check()}multiplyRight(t){return Ri(this,this,t),this.check()}rotateX(t){return sh(this,this,t),this.check()}rotateY(t){return rh(this,this,t),this.check()}rotateZ(t){return ih(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return nh(this,this,t,n),this.check()}scale(t){return eh(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return th(this,this,t),this.check()}transform(t,n){return t.length===4?(n=Th(n||[-0,-0,-0,-0],t,this),Te(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:s}=t;let r;switch(s){case 2:r=mi(n||[-0,-0],t,this);break;case 3:r=cs(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(r,t.length),r}transformAsVector(t,n){let s;switch(t.length){case 2:s=gi(n||[-0,-0],t,this);break;case 3:s=Ai(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Te(s,t.length),s}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,s){return this.identity().translate([t,n,s])}}let an,cn;function Mh(){return an||(an=new V([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(an)),an}function Ih(){return cn||(cn=new V,Object.freeze(cn)),cn}function Mi(e){if(e>Math.PI*2)throw Error("expected radians")}function Sh(e,t,n,s,r,i){const o=2*i/(n-t),a=2*i/(r-s),c=(n+t)/(n-t),u=(r+s)/(r-s),l=-1,h=-1,f=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=u,e[10]=l,e[11]=h,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}function Ii(){const e=new Tt(4);return Tt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function xh(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Si(e,t,n){n=n*.5;const s=Math.sin(n);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(n),e}function xi(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=n[0],c=n[1],u=n[2],l=n[3];return e[0]=s*l+o*a+r*u-i*c,e[1]=r*l+o*c+i*a-s*u,e[2]=i*l+o*u+s*c-r*a,e[3]=o*l-s*a-r*c-i*u,e}function Oh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+o*a,e[1]=r*c+i*a,e[2]=i*c-r*a,e[3]=o*c-s*a,e}function Fh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c-i*a,e[1]=r*c+o*a,e[2]=i*c+s*a,e[3]=o*c-r*a,e}function vh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+r*a,e[1]=r*c-s*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function Dh(e,t){const n=t[0],s=t[1],r=t[2];return e[0]=n,e[1]=s,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-s*s-r*r)),e}function un(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];let c=n[0],u=n[1],l=n[2],h=n[3],f,d,m,A,y;return f=r*c+i*u+o*l+a*h,f<0&&(f=-f,c=-c,u=-u,l=-l,h=-h),1-f>be?(d=Math.acos(f),y=Math.sin(d),m=Math.sin((1-s)*d)/y,A=Math.sin(s*d)/y):(m=1-s,A=s),e[0]=m*r+A*c,e[1]=m*i+A*u,e[2]=m*o+A*l,e[3]=m*a+A*h,e}function Lh(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n*n+s*s+r*r+i*i,a=o?1/o:0;return e[0]=-n*a,e[1]=-s*a,e[2]=-r*a,e[3]=i*a,e}function Gh(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Oi(e,t){const n=t[0]+t[4]+t[8];let s;if(n>0)s=Math.sqrt(n+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(t[r*3+r]-t[i*3+i]-t[o*3+o]+1),e[r]=.5*s,s=.5/s,e[3]=(t[i*3+o]-t[o*3+i])*s,e[i]=(t[i*3+r]+t[r*3+i])*s,e[o]=(t[o*3+r]+t[r*3+o])*s}return e}const Ph=gh,Nh=Ah,Uh=Ch,Hh=Eh,Jh=ph,Vh=yh,Fi=Bh,jh=function(){const e=yi(),t=Ci(1,0,0),n=Ci(0,1,0);return function(s,r,i){const o=as(r,i);return o<-.999999?(en(e,t,r),Ul(e)<1e-6&&en(e,n,r),Dl(e,e),Si(s,e,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(en(e,r,i),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+o,Fi(s,s))}}();(function(){const e=Ii(),t=Ii();return function(n,s,r,i,o,a){return un(e,s,o,a),un(t,r,i,a),un(n,e,t,2*a*(1-a)),n}})(),function(){const e=Hl();return function(t,n,s,r){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Fi(t,Oi(t,e))}}();const kh=[0,0,0,1];class ln extends is{constructor(t=0,n=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,n,s,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Oi(this,t),this.check()}fromAxisRotation(t,n){return Si(this,t,n),this.check()}identity(){return xh(this),this.check()}setAxisAngle(t,n){return this.fromAxisRotation(t,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=N(t)}get y(){return this[1]}set y(t){this[1]=N(t)}get z(){return this[2]}set z(t){this[2]=N(t)}get w(){return this[3]}set w(t){this[3]=N(t)}len(){return Jh(this)}lengthSquared(){return Vh(this)}dot(t){return Uh(this,t)}rotationTo(t,n){return jh(this,t,n),this.check()}add(t){return Ph(this,this,t),this.check()}calculateW(){return Dh(this,this),this.check()}conjugate(){return Gh(this,this),this.check()}invert(){return Lh(this,this),this.check()}lerp(t,n,s){return s===void 0?this.lerp(this,t,n):(Hh(this,t,n,s),this.check())}multiplyRight(t){return xi(this,this,t),this.check()}multiplyLeft(t){return xi(this,t,this),this.check()}normalize(){const t=this.len(),n=t>0?1/t:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,t===0&&(this[3]=1),this.check()}rotateX(t){return Oh(this,this,t),this.check()}rotateY(t){return Fh(this,this,t),this.check()}rotateZ(t){return vh(this,this,t),this.check()}scale(t){return Nh(this,this,t),this.check()}slerp(t,n,s){let r,i,o;switch(arguments.length){case 1:({start:r=kh,target:i,ratio:o}=t);break;case 2:r=this,i=t,o=n;break;default:r=t,i=n,o=s}return un(this,r,i,o),this.check()}transformVector4(t,n=new ls){return bh(n,t,this),Te(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,n){return this.setAxisAngle(t,n)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}function _e(e){"@babel/helpers - typeof";return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(e)}function Kh(e,t){if(_e(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(_e(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function zh(e){var t=Kh(e,"string");return _e(t)=="symbol"?t:String(t)}function S(e,t,n){return t=zh(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Wh=.1,Xh=1e-12,vi=1e-15,Qh=1e-20,qh=6378137,Yh=6378137,$h=6356752314245179e-9;function hn(e){return e}new p;function Zh(e,t=[],n=hn){return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function tf(e,t=[]){return Zh(e,t,$._cartographicRadians?hn:El)}function ef(e,t,n=hn){return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function nf(e,t){return ef(e,t,$._cartographicRadians?hn:Tl)}const Di=1e-14,sf=new p,Li={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},gs={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},we={east:new p,north:new p,up:new p,west:new p,south:new p,down:new p},rf=new p,of=new p,af=new p;function Gi(e,t,n,s,r,i){const o=Li[t]&&Li[t][n];j(o&&(!s||s===o));let a,c,u;const l=sf.copy(r);if(Pt(l.x,0,Di)&&Pt(l.y,0,Di)){const f=Math.sign(l.z);a=rf.fromArray(gs[t]),t!=="east"&&t!=="west"&&a.scale(f),c=of.fromArray(gs[n]),n!=="east"&&n!=="west"&&c.scale(f),u=af.fromArray(gs[s]),s!=="east"&&s!=="west"&&u.scale(f)}else{const{up:f,east:d,north:m}=we;d.set(-l.y,l.x,0).normalize(),e.geodeticSurfaceNormal(l,f),m.copy(f).cross(d);const{down:A,west:y,south:E}=we;A.copy(f).scale(-1),y.copy(d).scale(-1),E.copy(m).scale(-1),a=we[t],c=we[n],u=we[s]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=u.x,i[9]=u.y,i[10]=u.z,i[11]=0,i[12]=l.x,i[13]=l.y,i[14]=l.z,i[15]=1,i}const se=new p,cf=new p,uf=new p;function lf(e,t,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=t;se.from(e);const o=se.x,a=se.y,c=se.z,u=s.x,l=s.y,h=s.z,f=o*o*u*u,d=a*a*l*l,m=c*c*h*h,A=f+d+m,y=Math.sqrt(1/A);if(!Number.isFinite(y))return;const E=cf;if(E.copy(e).scale(y),A<i)return E.to(n);const w=r.x,B=r.y,C=r.z,R=uf;R.set(E.x*w*2,E.y*B*2,E.z*C*2);let T=(1-y)*se.len()/(.5*R.len()),O=0,F,x,v,k;do{T-=O,F=1/(1+T*w),x=1/(1+T*B),v=1/(1+T*C);const Q=F*F,q=x*x,D=v*v,it=Q*F,fe=q*x,de=D*v;k=f*Q+d*q+m*D-1;const Jt=-2*(f*it*w+d*fe*B+m*de*C);O=k/Jt}while(Math.abs(k)>Xh);return se.scale([F,x,v]).to(n)}const fn=new p,Pi=new p,hf=new p,bt=new p,ff=new p,dn=new p;class J{constructor(t=0,n=0,s=0){S(this,"radii",void 0),S(this,"radiiSquared",void 0),S(this,"radiiToTheFourth",void 0),S(this,"oneOverRadii",void 0),S(this,"oneOverRadiiSquared",void 0),S(this,"minimumRadius",void 0),S(this,"maximumRadius",void 0),S(this,"centerToleranceSquared",Wh),S(this,"squaredXOverSquaredZ",void 0),j(t>=0),j(n>=0),j(s>=0),this.radii=new p(t,n,s),this.radiiSquared=new p(t*t,n*n,s*s),this.radiiToTheFourth=new p(t*t*t*t,n*n*n*n,s*s*s*s),this.oneOverRadii=new p(t===0?0:1/t,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new p(t===0?0:1/(t*t),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(t,n,s),this.maximumRadius=Math.max(t,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,n=[0,0,0]){const s=Pi,r=hf,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(n)}cartesianToCartographic(t,n=[0,0,0]){dn.from(t);const s=this.scaleToGeodeticSurface(dn,bt);if(!s)return;const r=this.geodeticSurfaceNormal(s,Pi),i=ff;i.copy(dn).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(as(i,dn))*Bi(i);return nf([o,a,c],n)}eastNorthUpToFixedFrame(t,n=new V){return Gi(this,"east","north","up",t,n)}localFrameToFixedFrame(t,n,s,r,i=new V){return Gi(this,t,n,s,r,i)}geocentricSurfaceNormal(t,n=[0,0,0]){return fn.from(t).normalize().to(n)}geodeticSurfaceNormalCartographic(t,n=[0,0,0]){const s=tf(t),r=s[0],i=s[1],o=Math.cos(i);return fn.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),fn.to(n)}geodeticSurfaceNormal(t,n=[0,0,0]){return fn.from(t).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(t,n){return lf(t,this,n)}scaleToGeocentricSurface(t,n=[0,0,0]){bt.from(t);const s=bt.x,r=bt.y,i=bt.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return bt.multiplyScalar(a).to(n)}transformPositionToScaledSpace(t,n=[0,0,0]){return bt.from(t).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(t,n=[0,0,0]){return bt.from(t).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(t,n=0,s=[0,0,0]){j(Pt(this.radii.x,this.radii.y,vi)),j(this.radii.z>0),bt.from(t);const r=bt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return bt.set(0,0,r).to(s)}}S(J,"WGS84",new J(qh,Yh,$h));class df{constructor(t,n,s){this.item=void 0,this.previous=void 0,this.next=void 0,this.item=t,this.previous=n,this.next=s}}class mf{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const n=new df(t,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,n){t!==n&&(this.remove(n),this._insert(t,n))}_insert(t,n){const s=t.next;t.next=n,this.tail===t?this.tail=n:s.previous=n,n.next=s,n.previous=t,++this._length}}class gf{constructor(){this._list=void 0,this._sentinel=void 0,this._trimTiles=void 0,this._list=new mf,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const n=t._cacheNode;n&&this._list.splice(this._sentinel,n)}add(t,n,s){n._cacheNode||(n._cacheNode=this._list.add(n),s&&s(t,n))}unloadTile(t,n,s){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,s&&s(t,n))}unloadTiles(t,n){const s=this._trimTiles;this._trimTiles=!1;const r=this._list,i=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>i||s);){const c=a.item;a=a.next,this.unloadTile(t,c,n)}}trim(){this._trimTiles=!0}}function Af(e,t){U(e),U(t);const{rtcCenter:n,gltfUpAxis:s}=t,{computedTransform:r,boundingVolume:{center:i}}=e;let o=new V(r);switch(n&&o.translate(n),s){case"Z":break;case"Y":const h=new V().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new V().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new p(i);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const c=J.WGS84.cartesianToCartographic(a,new p),l=J.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=l.multiplyRight(o),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const ht={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new p,new p;const Re=new p,Ni=new p;class Me{constructor(t=[0,0,0],n=0){S(this,"center",void 0),S(this,"radius",void 0),this.radius=-0,this.center=new p,this.fromCenterRadius(t,n)}fromCenterRadius(t,n){return this.center.from(t),this.radius=n,this}fromCornerPoints(t,n){return n=Re.from(n),this.center=new p().from(t).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Me(this.center,this.radius)}union(t){const n=this.center,s=this.radius,r=t.center,i=t.radius,o=Re.copy(r).subtract(n),a=o.magnitude();if(s>=a+i)return this.clone();if(i>=a+s)return t.clone();const c=(s+a+i)*.5;return Ni.copy(o).scale((-s+c)/a).add(n),this.center.copy(Ni),this.radius=c,this}expand(t){const s=Re.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const n=oh(Re,t);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(t){const n=this.distanceTo(t);return n*n}distanceTo(t){const s=Re.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const n=this.center,s=this.radius,i=t.normal.dot(n)+t.distance;return i<-s?ht.OUTSIDE:i<s?ht.INTERSECTING:ht.INSIDE}}const pf=new p,yf=new p,mn=new p,gn=new p,An=new p,Bf=new p,Cf=new p,vt={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class Ie{constructor(t=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){S(this,"center",void 0),S(this,"halfAxes",void 0),this.center=new p().from(t),this.halfAxes=new z(n)}get halfSize(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new p(t).len(),new p(n).len(),new p(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new p(t).normalize(),i=new p(n).normalize(),o=new p(s).normalize();return new ln().fromMatrix3(new z([...r,...i,...o]))}fromCenterHalfSizeQuaternion(t,n,s){const r=new ln(s),i=new z().fromQuaternion(r);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new p().from(t),this.halfAxes=i,this}clone(){return new Ie(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Me){const n=this.halfAxes,s=n.getColumn(0,mn),r=n.getColumn(1,gn),i=n.getColumn(2,An),o=pf.copy(s).add(r).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const n=this.center,s=t.normal,r=this.halfAxes,i=s.x,o=s.y,a=s.z,c=Math.abs(i*r[vt.COLUMN0ROW0]+o*r[vt.COLUMN0ROW1]+a*r[vt.COLUMN0ROW2])+Math.abs(i*r[vt.COLUMN1ROW0]+o*r[vt.COLUMN1ROW1]+a*r[vt.COLUMN1ROW2])+Math.abs(i*r[vt.COLUMN2ROW0]+o*r[vt.COLUMN2ROW1]+a*r[vt.COLUMN2ROW2]),u=s.dot(n)+t.distance;return u<=-c?ht.OUTSIDE:u>=c?ht.INSIDE:ht.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=yf.from(t).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,mn),i=s.getColumn(1,gn),o=s.getColumn(2,An),a=r.magnitude(),c=i.magnitude(),u=o.magnitude();r.normalize(),i.normalize(),o.normalize();let l=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(l+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(l+=h*h),h=Math.abs(n.dot(o))-u,h>0&&(l+=h*h),l}computePlaneDistances(t,n,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,mn),u=a.getColumn(1,gn),l=a.getColumn(2,An),h=Bf.copy(c).add(u).add(l).add(o),f=Cf.copy(h).subtract(t);let d=n.dot(f);return r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).add(u).subtract(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(u).add(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(u).subtract(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(u).add(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(u).subtract(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(u).add(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(u).subtract(l),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),s[0]=r,s[1]=i,s}transform(t){this.center.transformAsPoint(t);const n=this.halfAxes.getColumn(0,mn);n.transformAsPoint(t);const s=this.halfAxes.getColumn(1,gn);s.transformAsPoint(t);const r=this.halfAxes.getColumn(2,An);return r.transformAsPoint(t),this.halfAxes=new z([...n,...s,...r]),this}getTransform(){throw new Error("not implemented")}}const Ui=new p,Hi=new p;class tt{constructor(t=[0,0,1],n=0){S(this,"normal",void 0),S(this,"distance",void 0),this.normal=new p,this.distance=-0,this.fromNormalDistance(t,n)}fromNormalDistance(t,n){return j(Number.isFinite(n)),this.normal.from(t).normalize(),this.distance=n,this}fromPointNormal(t,n){t=Ui.from(t),this.normal.from(n).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,n,s,r){return this.normal.set(t,n,s),j(Pt(this.normal.len(),1)),this.distance=r,this}clone(){return new tt(this.normal,this.distance)}equals(t){return Pt(this.distance,t.distance)&&Pt(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const n=Hi.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,n)}projectPointOntoPlane(t,n=[0,0,0]){const s=Ui.from(t),r=this.getPointDistance(s),i=Hi.copy(this.normal).scale(r);return s.subtract(i).to(n)}}const Ji=[new p([1,0,0]),new p([0,1,0]),new p([0,0,1])],Vi=new p,Ef=new p;class ot{constructor(t=[]){S(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Ji.length;const n=t.center,s=t.radius;let r=0;for(const i of Ji){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new tt),a||(a=this.planes[r+1]=new tt);const c=Vi.copy(i).scale(-s).add(n);o.fromPointNormal(c,i);const u=Vi.copy(i).scale(s).add(n),l=Ef.copy(i).negate();a.fromPointNormal(u,l),r+=2}return this}computeVisibility(t){let n=ht.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case ht.OUTSIDE:return ht.OUTSIDE;case ht.INTERSECTING:n=ht.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(t,n){if(j(Number.isFinite(n),"parentPlaneMask is required."),n===ot.MASK_OUTSIDE||n===ot.MASK_INSIDE)return n;let s=ot.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=r[i],c=t.intersectPlane(a);if(c===ht.OUTSIDE)return ot.MASK_OUTSIDE;c===ht.INTERSECTING&&(s|=o)}return s}}S(ot,"MASK_OUTSIDE",4294967295),S(ot,"MASK_INSIDE",0),S(ot,"MASK_INDETERMINATE",2147483647);const Tf=new p,bf=new p,_f=new p,wf=new p,Rf=new p;class pn{constructor(t={}){S(this,"left",void 0),S(this,"_left",void 0),S(this,"right",void 0),S(this,"_right",void 0),S(this,"top",void 0),S(this,"_top",void 0),S(this,"bottom",void 0),S(this,"_bottom",void 0),S(this,"near",void 0),S(this,"_near",void 0),S(this,"far",void 0),S(this,"_far",void 0),S(this,"_cullingVolume",new ot([new tt,new tt,new tt,new tt,new tt,new tt])),S(this,"_perspectiveMatrix",new V),S(this,"_infinitePerspective",new V);const{near:n=1,far:s=5e8}=t;this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=n,this._near=n,this.far=s,this._far=s}clone(){return new pn({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof pn&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return this._update(),this._perspectiveMatrix}get infiniteProjectionMatrix(){return this._update(),this._infinitePerspective}computeCullingVolume(t,n,s){j(t,"position is required."),j(n,"direction is required."),j(s,"up is required.");const r=this._cullingVolume.planes;s=Tf.copy(s).normalize();const i=bf.copy(n).cross(s).normalize(),o=_f.copy(n).multiplyByScalar(this.near).add(t),a=wf.copy(n).multiplyByScalar(this.far).add(t);let c=Rf;return c.copy(i).multiplyByScalar(this.left).add(o).subtract(t).cross(s),r[0].fromPointNormal(t,c),c.copy(i).multiplyByScalar(this.right).add(o).subtract(t).cross(s).negate(),r[1].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.bottom).add(o).subtract(t).cross(i).negate(),r[2].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.top).add(o).subtract(t).cross(i),r[3].fromPointNormal(t,c),c=new p().copy(n),r[4].fromPointNormal(o,c),c.negate(),r[5].fromPointNormal(a,c),this._cullingVolume}getPixelDimensions(t,n,s,r){this._update(),j(Number.isFinite(t)&&Number.isFinite(n)),j(t>0),j(n>0),j(s>0),j(r);const i=1/this.near;let o=this.top*i;const a=2*s*o/n;o=this.right*i;const c=2*s*o/t;return r.x=c,r.y=a,r}_update(){j(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const{top:t,bottom:n,right:s,left:r,near:i,far:o}=this;(t!==this._top||n!==this._bottom||r!==this._left||s!==this._right||i!==this._near||o!==this._far)&&(j(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=r,this._right=s,this._top=t,this._bottom=n,this._near=i,this._far=o,this._perspectiveMatrix=new V().frustum({left:r,right:s,bottom:n,top:t,near:i,far:o}),this._infinitePerspective=new V().frustum({left:r,right:s,bottom:n,top:t,near:i,far:1/0}))}}const Mf=e=>e!==null&&typeof e<"u";class yn{constructor(t={}){S(this,"_offCenterFrustum",new pn),S(this,"fov",void 0),S(this,"_fov",void 0),S(this,"_fovy",void 0),S(this,"_sseDenominator",void 0),S(this,"aspectRatio",void 0),S(this,"_aspectRatio",void 0),S(this,"near",void 0),S(this,"_near",void 0),S(this,"far",void 0),S(this,"_far",void 0),S(this,"xOffset",void 0),S(this,"_xOffset",void 0),S(this,"yOffset",void 0),S(this,"_yOffset",void 0);const{fov:n,aspectRatio:s,near:r=1,far:i=5e8,xOffset:o=0,yOffset:a=0}=t;this.fov=n,this.aspectRatio=s,this.near=r,this.far=i,this.xOffset=o,this.yOffset=a}clone(){return new yn({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return!Mf(t)||!(t instanceof yn)?!1:(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return this._update(),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return this._update(),this._fovy}get sseDenominator(){return this._update(),this._sseDenominator}computeCullingVolume(t,n,s){return this._update(),this._offCenterFrustum.computeCullingVolume(t,n,s)}getPixelDimensions(t,n,s,r){return this._update(),this._offCenterFrustum.getPixelDimensions(t,n,s,r||new tn)}_update(){j(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const t=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(j(this.fov>=0&&this.fov<Math.PI),j(this.aspectRatio>0),j(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,t.top=this.near*Math.tan(.5*this._fovy),t.bottom=-t.top,t.right=this.aspectRatio*t.top,t.left=-t.right,t.near=this.near,t.far=this.far,t.right+=this.xOffset,t.left+=this.xOffset,t.top+=this.yOffset,t.bottom+=this.yOffset)}}new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p;const Mt=new z,If=new z,Sf=new z,Bn=new z,ji=new z;function xf(e,t={}){const n=Qh,s=10;let r=0,i=0;const o=If,a=Sf;o.identity(),a.copy(e);const c=n*Of(a);for(;i<s&&Ff(a)>c;)vf(a,Bn),ji.copy(Bn).transpose(),a.multiplyRight(Bn),a.multiplyLeft(ji),o.multiplyRight(Bn),++r>2&&(++i,r=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function Of(e){let t=0;for(let n=0;n<9;++n){const s=e[n];t+=s*s}return Math.sqrt(t)}const As=[1,0,0],ps=[2,2,1];function Ff(e){let t=0;for(let n=0;n<3;++n){const s=e[Mt.getElementIndex(ps[n],As[n])];t+=2*s*s}return Math.sqrt(t)}function vf(e,t){const n=vi;let s=0,r=1;for(let u=0;u<3;++u){const l=Math.abs(e[Mt.getElementIndex(ps[u],As[u])]);l>s&&(r=u,s=l)}const i=As[r],o=ps[r];let a=1,c=0;if(Math.abs(e[Mt.getElementIndex(o,i)])>n){const u=e[Mt.getElementIndex(o,o)],l=e[Mt.getElementIndex(i,i)],h=e[Mt.getElementIndex(o,i)],f=(u-l)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return z.IDENTITY.to(t),t[Mt.getElementIndex(i,i)]=t[Mt.getElementIndex(o,o)]=a,t[Mt.getElementIndex(o,i)]=c,t[Mt.getElementIndex(i,o)]=-c,t}const Nt=new p,Df=new p,Lf=new p,Gf=new p,Pf=new p,Nf=new z,Uf={diagonal:new z,unitary:new z};function Hf(e,t=new Ie){if(!e||e.length===0)return t.halfAxes=new z([0,0,0,0,0,0,0,0,0]),t.center=new p,t;const n=e.length,s=new p(0,0,0);for(const x of e)s.add(x);const r=1/n;s.multiplyByScalar(r);let i=0,o=0,a=0,c=0,u=0,l=0;for(const x of e){const v=Nt.copy(x).subtract(s);i+=v.x*v.x,o+=v.x*v.y,a+=v.x*v.z,c+=v.y*v.y,u+=v.y*v.z,l+=v.z*v.z}i*=r,o*=r,a*=r,c*=r,u*=r,l*=r;const h=Nf;h[0]=i,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=u,h[6]=a,h[7]=u,h[8]=l;const{unitary:f}=xf(h,Uf),d=t.halfAxes.copy(f);let m=d.getColumn(0,Lf),A=d.getColumn(1,Gf),y=d.getColumn(2,Pf),E=-Number.MAX_VALUE,w=-Number.MAX_VALUE,B=-Number.MAX_VALUE,C=Number.MAX_VALUE,R=Number.MAX_VALUE,T=Number.MAX_VALUE;for(const x of e)Nt.copy(x),E=Math.max(Nt.dot(m),E),w=Math.max(Nt.dot(A),w),B=Math.max(Nt.dot(y),B),C=Math.min(Nt.dot(m),C),R=Math.min(Nt.dot(A),R),T=Math.min(Nt.dot(y),T);m=m.multiplyByScalar(.5*(C+E)),A=A.multiplyByScalar(.5*(R+w)),y=y.multiplyByScalar(.5*(T+B)),t.center.copy(m).add(A).add(y);const O=Df.set(E-C,w-R,B-T).multiplyByScalar(.5),F=new z([O[0],0,0,0,O[1],0,0,0,O[2]]);return t.halfAxes.multiplyRight(F),t}const ki=new p,ys=new p,Bs=new ot([new tt,new tt,new tt,new tt,new tt,new tt]);function Jf(e,t){const{cameraDirection:n,cameraUp:s,height:r}=e,{metersPerUnit:i}=e.distanceScales,o=Cn(e,e.center),a=J.WGS84.eastNorthUpToFixedFrame(o),c=e.unprojectPosition(e.cameraPosition),u=J.WGS84.cartographicToCartesian(c,new p),l=new p(a.transformAsVector(new p(n).scale(i))).normalize(),h=new p(a.transformAsVector(new p(s).scale(i))).normalize();jf(e);const f=e.constructor,{longitude:d,latitude:m,width:A,bearing:y,zoom:E}=e,w=new f({longitude:d,latitude:m,height:r,width:A,bearing:y,zoom:E,pitch:0});return{camera:{position:u,direction:l,up:h},viewport:e,topDownViewport:w,height:r,cullingVolume:Bs,frameNumber:t,sseDenominator:1.15}}function Vf(e,t,n){if(n===0||e.length<=n)return[e,[]];const s=[],{longitude:r,latitude:i}=t.viewport;for(const[u,l]of e.entries()){const[h,f]=l.header.mbs,d=Math.abs(r-h),m=Math.abs(i-f),A=Math.sqrt(m*m+d*d);s.push([u,A])}const o=s.sort((u,l)=>u[1]-l[1]),a=[];for(let u=0;u<n;u++)a.push(e[o[u][0]]);const c=[];for(let u=n;u<o.length;u++)c.push(e[o[u][0]]);return[a,c]}function jf(e){const t=e.getFrustumPlanes(),n=Ki(t.near,e.cameraPosition),s=Cn(e,n),r=Cn(e,e.cameraPosition,ys);let i=0;Bs.planes[i++].fromPointNormal(s,ki.copy(s).subtract(r));for(const o in t){if(o==="near")continue;const a=t[o],c=Ki(a,n,ys),u=Cn(e,c,ys);Bs.planes[i++].fromPointNormal(u,ki.copy(s).subtract(u))}}function Ki(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=e.normal.dot(t);return n.copy(e.normal).scale(e.distance-s).add(t),n}function Cn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=e.unprojectPosition(t);return J.WGS84.cartographicToCartesian(s,n)}const kf=6378137,Kf=6378137,Cs=6356752314245179e-9,re=new p;function zf(e,t){if(e instanceof Ie){const{halfAxes:n}=e,s=Xf(n);return Math.log2(Cs/(s+t[2]))}else if(e instanceof Me){const{radius:n}=e;return Math.log2(Cs/(n+t[2]))}else if(e.width&&e.height){const{width:n,height:s}=e,r=Math.log2(kf/n),i=Math.log2(Kf/s);return(r+i)/2}return 1}function zi(e,t,n){J.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],re);const s=Math.sqrt(Math.pow(re[0]-n[0],2)+Math.pow(re[1]-n[1],2)+Math.pow(re[2]-n[2],2));return Math.log2(Cs/(s+t[2]))}function Wf(e,t,n){const[s,r,i,o]=e;return zi({xmin:s,xmax:i,ymin:r,ymax:o,zmin:0,zmax:0},t,n)}function Xf(e){e.getColumn(0,re);const t=e.getColumn(1),n=e.getColumn(2);return re.add(t).add(n).len()}const at={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};let Dt=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),zt=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),pt=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({}),En=function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e}({});const Qf={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Wi(e){return e!=null}const nt=new p,Tn=new p,qf=new p,Yf=new p,Wt=new p,Xi=new p,Qi=new p,qi=new p;function Es(e,t,n){if(U(e,"3D Tile: boundingVolume must be defined"),e.box)return Yi(e.box,t,n);if(e.region)return td(e.region);if(e.sphere)return Zf(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function $f(e,t){if(e.box)return ed(t);if(e.region){const[n,s,r,i,o,a]=e.region;return[[Et(n),Et(s),o],[Et(r),Et(i),a]]}if(e.sphere)return nd(t);throw new Error("Unkown boundingVolume type")}function Yi(e,t,n){const s=new p(e[0],e[1],e[2]);t.transform(s,s);let r=[];if(e.length===10){const u=e.slice(3,6),l=new ln;l.fromArray(e,6);const h=new p([1,0,0]),f=new p([0,1,0]),d=new p([0,0,1]);h.transformByQuaternion(l),h.scale(u[0]),f.transformByQuaternion(l),f.scale(u[1]),d.transformByQuaternion(l),d.scale(u[2]),r=[...h.toArray(),...f.toArray(),...d.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const i=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),a=t.transformAsVector(r.slice(6,9)),c=new z([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Wi(n)?(n.center=s,n.halfAxes=c,n):new Ie(s,c)}function Zf(e,t,n){const s=new p(e[0],e[1],e[2]);t.transform(s,s);const r=t.getScale(Tn),i=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*i;return Wi(n)?(n.center=s,n.radius=o,n):new Me(s,o)}function td(e){const[t,n,s,r,i,o]=e,a=J.WGS84.cartographicToCartesian([Et(t),Et(r),i],qf),c=J.WGS84.cartographicToCartesian([Et(s),Et(n),o],Yf),u=new p().addVectors(a,c).multiplyByScalar(.5);return J.WGS84.cartesianToCartographic(u,Wt),J.WGS84.cartographicToCartesian([Et(s),Wt[1],Wt[2]],Xi),J.WGS84.cartographicToCartesian([Wt[0],Et(r),Wt[2]],Qi),J.WGS84.cartographicToCartesian([Wt[0],Wt[1],o],qi),Yi([...u,...Xi.subtract(u),...Qi.subtract(u),...qi.subtract(u)],new V)}function ed(e){const t=$i(),{halfAxes:n}=e,s=new p(n.getColumn(0)),r=new p(n.getColumn(1)),i=new p(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)nt.copy(e.center),nt.add(s),nt.add(r),nt.add(i),Zi(t,nt),i.negate();r.negate()}s.negate()}return t}function nd(e){const t=$i(),{center:n,radius:s}=e,r=J.WGS84.scaleToGeodeticSurface(n,nt);let i;r?i=J.WGS84.geodeticSurfaceNormal(r):i=new p(0,0,1);let o=new p(i[2],-i[1],0);o.len()>0?o.normalize():o=new p(0,1,0);const a=o.clone().cross(i);for(const c of[o,a,i]){Tn.copy(c).scale(s);for(let u=0;u<2;u++)nt.copy(n),nt.add(Tn),Zi(t,nt),Tn.negate()}return t}function $i(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function Zi(e,t){J.WGS84.cartesianToCartographic(t,nt),e[0][0]=Math.min(e[0][0],nt[0]),e[0][1]=Math.min(e[0][1],nt[1]),e[0][2]=Math.min(e[0][2],nt[2]),e[1][0]=Math.max(e[1][0],nt[0]),e[1][1]=Math.max(e[1][1],nt[1]),e[1][2]=Math.max(e[1][2],nt[2])}new p,new p,new V,new p,new p,new p;function sd(e,t){const n=e*t;return 1-Math.exp(-(n*n))}function rd(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const n=e.dynamicScreenSpaceErrorComputedDensity,s=e.dynamicScreenSpaceErrorFactor;return sd(t,n)*s}return 0}function id(e,t,n){const s=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=n?r:e.lodMetricValue;if(i===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:u}=s.options;let l=i*a*(u||1)/(o*c);return l-=rd(s,o),l}const Ts=new p,to=new p,Ut=new p,eo=new p,od=new p,bs=new V,no=new V;function ad(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const n=2*so(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function so(e,t){const{topDownViewport:n}=t,s=e.header.mbs[1],r=e.header.mbs[0],i=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);J.WGS84.cartographicToCartesian(c,Ts),to.copy(Ts).subtract(a).normalize(),J.WGS84.eastNorthUpToFixedFrame(a,bs),no.copy(bs).invert(),Ut.copy(Ts).transform(no);const u=Math.sqrt(Ut[0]*Ut[0]+Ut[1]*Ut[1]),l=u*u/Ut[2];eo.copy([Ut[0],Ut[1],l]);const f=eo.transform(bs).subtract(a).normalize(),m=to.cross(f).normalize().scale(o).add(a),A=J.WGS84.cartesianToCartographic(m),y=n.project([r,s,i]),E=n.project(A);return od.copy(y).subtract(E).magnitude()}function cd(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class ro{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._map=new Map,this._array=void 0,this._length=void 0,this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return U(t<this._array.length),this._array[t]}set(t,n){U(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=n,this._map.set(n,t)}delete(t){const n=this._map.get(t);n>=0&&(this._array.splice(n,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const n=this.length++;this._array[n]=t,this._map.set(t,n)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){U(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){U(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const ud={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class bn{traversalFinished(t){return!0}constructor(t){this.options=void 0,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.lastUpdate=new Date().getTime(),this.updateDebounceTime=1e3,this._traversalStack=new ro,this._emptyTraversalStack=new ro,this._frameNumber=null,this.options={...ud,...t}}traverse(t,n,s){this.root=t,this.options={...this.options,...s},this.reset(),this.updateTile(t,n),this._frameNumber=n.frameNumber,this.executeTraversal(t,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,n){const s=this._traversalStack;for(t._selectionDepth=1,s.push(t);s.length>0;){const i=s.pop();let o=!1;this.canTraverse(i,n)&&(this.updateChildTiles(i,n),o=this.updateAndPushChildren(i,n,s,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const a=i.parent,c=!!(!a||a._shouldRefine),u=!o;i.hasRenderContent?i.refine===Dt.ADD?(this.loadTile(i,n),this.selectTile(i,n)):i.refine===Dt.REPLACE&&(this.loadTile(i,n),u&&this.selectTile(i,n)):(this.emptyTiles[i.id]=i,this.loadTile(i,n),u&&this.selectTile(i,n)),this.touchTile(i,n),i._shouldRefine=o&&c}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(t,n){const s=t.children;for(const r of s)this.updateTile(r,n)}updateAndPushChildren(t,n,s,r){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const c=t.refine===Dt.REPLACE&&t.hasRenderContent&&!o;let u=!1,l=!0;for(const h of a)if(h._selectionDepth=r,h.isVisibleAndInRequestVolume?(s.find(h)&&s.delete(h),s.push(h),u=!0):(c||i)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,l=l&&f,!l)return!1}return u||(l=!1),l}updateTile(t,n){this.updateTileVisibility(t,n)}selectTile(t,n){this.shouldSelectTile(t)&&(t._selectedFrame=n.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,n){this.shouldLoadTile(t)&&(t._requestedFrame=n.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,n){t.tileset._cache.touch(t),t._touchedFrame=n.frameNumber}canTraverse(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!r&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,n,s):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=t._screenSpaceError;return s&&(r=t.getScreenSpaceError(n,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,n){const s=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&s.push(r);else s.push(n.viewport.id);t.updateVisibility(n,s)}compareDistanceToCamera(t,n){return t._distanceToCamera-n._distanceToCamera}anyChildrenVisible(t,n){let s=!1;for(const r of t.children)r.updateVisibility(n),s=s||r.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(t,n){let s=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const i=r.pop(),o=!i.hasRenderContent&&this.canTraverse(i,n,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(s=!1),this.updateTile(i,n),i.isVisibleAndInRequestVolume||(this.loadTile(i,n),this.touchTile(i,n)),o){const c=i.children;for(const u of c)r.push(u)}}return s}}const io=new p;function ld(e){return e!=null}class _s{constructor(t,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";this.tileset=void 0,this.header=void 0,this.id=void 0,this.url=void 0,this.parent=void 0,this.refine=void 0,this.type=void 0,this.contentUrl=void 0,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=at.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this.transform=new V,this.extensions=null,this.implicitTiling=null,this.userData={},this.computedTransform=void 0,this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.traverser=new bn({}),this._cacheNode=null,this._frameNumber=null,this._expireDate=null,this._expiredContent=null,this._boundingBox=void 0,this._distanceToCamera=0,this._screenSpaceError=0,this._visibilityPlaneMask=void 0,this._visible=void 0,this._contentBoundingVolume=void 0,this._viewerRequestVolume=void 0,this._initialTransform=new V,this._priority=0,this._selectedFrame=0,this._requestedFrame=0,this._selectionDepth=0,this._touchedFrame=0,this._centerZDepth=0,this._shouldRefine=!1,this._stackLength=0,this._visitedFrame=0,this._inRequestVolume=!1,this._lodJudge=null,this.header=n,this.tileset=t,this.id=r||n.id,this.url=n.url,this.parent=s,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===at.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===at.UNLOADED}get contentExpired(){return this.contentState===at.EXPIRED}get contentFailed(){return this.contentState===at.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=$f(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,n){switch(this.tileset.type){case pt.I3S:return so(this,t);case pt.TILES3D:return id(this,t,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:n}=t.options,s=this.refine===Dt.ADD||n;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===at.UNLOADED)return-1;const r=this.parent,o=r&&(!s||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=at.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=at.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,i={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await ne(s,r,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=at.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=at.FAILED,s}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=at.UNLOADED,!0}updateVisibility(t,n){if(this._frameNumber===t.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:ot.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==ot.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=n}visibility(t,n){const{cullingVolume:s}=t,{boundingVolume:r}=this;return s.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(t){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:n}=t;const s=this.boundingVolume;return io.subVectors(s.center,n.position),n.direction.dot(io)}insideViewerRequestVolume(t){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(ld(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=at.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new V(t.transform):new V;const n=this.parent,s=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new V(r).multiplyRight(this.transform);const i=n&&n._initialTransform?n._initialTransform.clone():new V;this._initialTransform=new V(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=at.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ot.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Dt.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Es(t.boundingVolume,this.computedTransform,this.boundingVolume);const n=t.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=Es(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Es(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new V).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return cd(this.tileset.tileset)}}}class hd extends bn{compareDistanceToCamera(t,n){return n._distanceToCamera===0&&t._distanceToCamera===0?n._centerZDepth-t._centerZDepth:n._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,n){if(super.updateTileVisibility(t,n),!t.isVisibleAndInRequestVolume)return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const o=t.children[0];this.updateTileVisibility(o,n),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,n)){t._visible=!1;return}const r=t.refine===Dt.REPLACE,i=t._optimChildrenWithinParent===Qf.USE_OPTIMIZATION;if(r&&i&&s&&!this.anyChildrenVisible(t,n)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,n){const{parent:s}=t;return!s||s.hasTilesetContent||s.refine!==Dt.ADD?!1:!this.shouldRefine(t,n,!0)}}class fd{constructor(){this.frameNumberMap=new Map}register(t,n){const s=this.frameNumberMap.get(t)||new Map,r=s.get(n)||0;s.set(n,r+1),this.frameNumberMap.set(t,s)}deregister(t,n){const s=this.frameNumberMap.get(t);if(!s)return;const r=s.get(n)||1;s.set(n,r-1)}isZero(t,n){var s;return(((s=this.frameNumberMap.get(t))===null||s===void 0?void 0:s.get(n))||0)===0}}const ws={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class dd{constructor(){this._statusMap=void 0,this.pendingTilesRegister=new fd,this._statusMap={}}add(t,n,s,r){if(!this._statusMap[n]){const{frameNumber:i,viewport:{id:o}}=r;this._statusMap[n]={request:t,callback:s,key:n,frameState:r,status:ws.REQUESTED},this.pendingTilesRegister.register(o,i),t().then(a=>{this._statusMap[n].status=ws.COMPLETED;const{frameNumber:c,viewport:{id:u}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(u,c),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=ws.ERROR;const{frameNumber:c,viewport:{id:u}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(u,c),s(a)})}}update(t,n){if(this._statusMap[t]){const{frameNumber:s,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,s);const{frameNumber:i,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,i),this._statusMap[t].frameState=n}}find(t){return this._statusMap[t]}hasPendingTiles(t,n){return!this.pendingTilesRegister.isZero(t,n)}}class md extends bn{constructor(t){super(t),this._tileManager=void 0,this._tileManager=new dd}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=ad(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const s=t.header.children||[],r=t.children,i=t.tileset;for(const o of s){const a=`${o.id}-${n.viewport.id}`,c=r&&r.find(u=>u.id===a);if(c)c&&this.updateTile(c,n);else{let u=()=>this._loadTile(o.id,i);this._tileManager.find(a)?this._tileManager.update(a,n):(i.tileset.nodePages&&(u=()=>i.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(u,a,h=>this._onTileLoad(h,t,a),n))}}return!1}async _loadTile(t,n){const{loader:s}=n,r=n.getTileUrl(`${n.url}/nodes/${t}`),i={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await ne(r,s,i)}_onTileLoad(t,n,s){const r=new _s(n.tileset,t,n,s);n.children.push(r);const i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,i)}}const gd={description:"",ellipsoid:J.WGS84,modelMatrix:new V,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},_n="Tiles In Tileset(s)",Rs="Tiles In Memory",oo="Tiles In View",ao="Tiles To Render",co="Tiles Loaded",Ms="Tiles Loading",uo="Tiles Unloaded",lo="Failed Tile Loads",ho="Points/Vertices",Is="Tile Memory Use",fo="Maximum Screen Space Error";class Ad{constructor(t,n){this.options=void 0,this.loadOptions=void 0,this.type=void 0,this.tileset=void 0,this.loader=void 0,this.url=void 0,this.basePath=void 0,this.modelMatrix=void 0,this.ellipsoid=void 0,this.lodMetricType=void 0,this.lodMetricValue=void 0,this.refine=void 0,this.root=null,this.roots={},this.asset={},this.description="",this.properties=void 0,this.extras=null,this.attributions={},this.credits={},this.stats=void 0,this.contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.dynamicScreenSpaceErrorComputedDensity=0,this.maximumMemoryUsage=32,this.gpuMemoryUsageInBytes=0,this.memoryAdjustedScreenSpaceError=0,this._cacheBytes=0,this._cacheOverflowBytes=0,this._frameNumber=0,this._queryParams={},this._extensionsUsed=[],this._tiles={},this._pendingCount=0,this.selectedTiles=[],this.traverseCounter=0,this.geometricError=0,this.lastUpdatedVieports=null,this._requestedTiles=[],this._emptyTiles=[],this.frameStateData={},this._traverser=void 0,this._cache=new gf,this._requestScheduler=void 0,this.updatePromise=null,this.tilesetInitializationPromise=void 0,this.options={...gd,...n},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||qn(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Qc({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Gr({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let s=t;return this.queryParams.length&&(s=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const s=[];for(const r of n){const i=r.id;this._needTraverse(i)?s.push(i):this.traverseCounter--}for(const r of n){const i=r.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!s.includes(i))continue;const o=Jf(r,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(t){let n=t;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[t]),n===t}_onTraversalEnd(t){const n=t.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[i,o]=Vf(r,t,this.options.maximumTilesSelected);s.selectedTiles=i;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const n=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,n){if(t.length!==n.length)return!0;const s=new Set(t.map(o=>o.id)),r=new Set(n.map(o=>o.id));let i=t.filter(o=>!r.has(o.id)).length>0;return i=i||n.filter(o=>!s.has(o.id)).length>0,i}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,n)=>t._unloadTile(n))}_updateStats(){let t=0,n=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(t++,s.content.pointCount?n+=s.content.pointCount:n+=s.content.vertexCount);this.stats.get(oo).count=this.selectedTiles.length,this.stats.get(ao).count=t,this.stats.get(ho).count=n,this.stats.get(fo).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===pt.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===pt.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===pt.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:i,ymin:o,ymax:a,zmin:c,zmax:u}=n;this.cartographicCenter=new p(r+(i-r)/2,o+(a-o)/2,c+(u-c)/2),this.cartesianCenter=new p,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=zi(n,this.cartographicCenter,this.cartesianCenter);return}const s=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(s){const[r,i,o,a]=s;this.cartographicCenter=new p(r+(o-r)/2,i+(a-i)/2,0),this.cartesianCenter=new p,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=Wf(s,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new p,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:n}=t.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new p,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?(this.cartographicCenter=new p,J.WGS84.cartesianToCartographic(n,this.cartographicCenter)):this.cartographicCenter=new p(0,0,-J.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=zf(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(_n),this.stats.get(Ms),this.stats.get(Rs),this.stats.get(oo),this.stats.get(ao),this.stats.get(co),this.stats.get(uo),this.stats.get(lo),this.stats.get(ho),this.stats.get(Is,"memory"),this.stats.get(fo)}_initializeTileHeaders(t,n){const s=new _s(this,t.root,n);if(n&&(n.children.push(s),s.depth=n.depth+1),this.type===pt.TILES3D){const i=[];for(i.push(s);i.length>0;){const o=i.pop();this.stats.get(_n).incrementCount();const a=o.header.children||[];for(const c of a){var r;const u=new _s(this,c,o);if((r=u.contentUrl)!==null&&r!==void 0&&r.includes("?session=")){const h=new URL(u.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(u),u.depth=o.depth+1,i.push(u)}}}return s}_initializeTraverser(){let t;switch(this.type){case pt.TILES3D:t=hd;break;case pt.I3S:t=md;break;default:t=bn}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let n;try{this._onStartTileLoading(),n=await t.loadContent()}catch(s){this._onTileLoadError(t,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,n)}}_onTileLoadError(t,n){this.stats.get(lo).incrementCount();const s=n.message||n.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${s}`),this.options.onTileError(t,s,r)}_onTileLoad(t,n){if(n){if(this.type===pt.I3S){var s,r;const i=((s=this.tileset)===null||s===void 0||(r=s.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(_n).reset(),this.stats.get(_n).addCount(i)}t&&t.content&&Af(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===pt.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===pt.TILES3D){var n;const{extensionsRemoved:s=[]}=((n=t.content)===null||n===void 0?void 0:n.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Ms).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Ms).decrementCount()}_addTileToCache(t){this._cache.add(this,t,n=>n._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(co).incrementCount(),this.stats.get(Rs).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Is).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Rs).decrementCount(),this.stats.get(uo).incrementCount(),this.stats.get(Is).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const n=t.pop();for(const s of n.children)t.push(s);this._destroyTile(n)}this.root=null}_destroySubtree(t){const n=t,s=[];for(s.push(n);s.length>0;){t=s.pop();for(const r of t.children)s.push(r);t!==n&&this._destroyTile(t)}n.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const n=new URLSearchParams(t.queryString),s=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const mo="4.1.1",Se={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function go(e,t,n){U(e instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(e,t,n);return s.decode(r)}function pd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(e);return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}const yd={name:"Draco",id:"draco",module:"draco",version:"4.1.1",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Bd(e,t,n){const s=po(t.metadata),r=[],i=Cd(t.attributes);for(const o in e){const a=e[o],c=Ao(o,a,i[o]);r.push(c)}if(n){const o=Ao("indices",n);r.push(o)}return{fields:r,metadata:s}}function Cd(e){const t={};for(const n in e){const s=e[n];t[s.name||"undefined"]=s}return t}function Ao(e,t,n){const s=n?po(n.metadata):void 0;return gl(e,t,s)}function po(e){Object.entries(e);const t={};for(const n in e)t[`${n}.string`]=JSON.stringify(e[n]);return t}const yo={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Ed={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Td=4;class bd{constructor(t){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const f=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(f)}const a=this._getDracoLoaderData(i,r,n),c=this._getMeshData(i,a,n),u=ml(c.attributes),l=Bd(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:u},...c,schema:l}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,n,s){const r=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,s);return{geometry_type:n,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(t,n){const s={};for(let r=0;r<t.num_attributes();r++){const i=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(i,n);a&&(s[i.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(i,n);c&&(s[i.unique_id()].octahedron_transform=c)}return s}_getMeshData(t,n,s){const r=this._getMeshAttributes(n,t,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,n,s){const r={};for(const i of Object.values(t.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const{value:a,size:c}=this._getAttributeValues(n,i);r[o]={value:a,size:c,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return r}_getTriangleListIndices(t){const s=t.num_faces()*3,r=s*Td,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,n),Rd(n)}finally{this.draco.destroy(n)}}_getAttributeValues(t,n){const s=Ed[n.data_type],r=n.num_components,o=t.num_points()*r,a=o*s.BYTES_PER_ELEMENT,c=_d(this.draco,s);let u;const l=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(t,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,h,c,a,l),u=new s(this.draco.HEAPF32.buffer,l,o).slice()}finally{this.draco._free(l)}return{value:u,size:r}}_deduceAttributeName(t,n){const s=t.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===s)return o;const r=t.attribute_type;for(const o in yo)if(this.draco[o]===r)return yo[o];const i=n.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(t){const n=this.decoder.GetMetadata(t);return this._getDracoMetadata(n)}_getAttributeMetadata(t,n){const s=this.decoder.GetAttributeMetadata(t,n);return this._getDracoMetadata(s)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const n={},s=this.metadataQuerier.NumEntries(t);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(t,r);n[i]=this._getDracoMetadataField(t,i)}return n}_getDracoMetadataField(t,n){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,n,s);const r=wd(s);return{int:this.metadataQuerier.GetIntEntry(t,n),string:this.metadataQuerier.GetStringEntry(t,n),double:this.metadataQuerier.GetDoubleEntry(t,n),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(t){const{quantizedAttributes:n=[],octahedronAttributes:s=[]}=t,r=[...n,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,n){const{quantizedAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,n){const{octahedronAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function _d(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function wd(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}function Rd(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}const Md="1.5.6",Id="1.4.1",Ss=`https://www.gstatic.com/draco/versioned/decoders/${Md}`,ct={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},xs={[ct.DECODER]:`${Ss}/${ct.DECODER}`,[ct.DECODER_WASM]:`${Ss}/${ct.DECODER_WASM}`,[ct.FALLBACK_DECODER]:`${Ss}/${ct.FALLBACK_DECODER}`,[ct.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Id}/javascript/${ct.ENCODER}`};let xe;async function Sd(e){const t=e.modules||{};return t.draco3d?xe=xe||t.draco3d.createDecoderModule({}).then(n=>({draco:n})):xe=xe||xd(e),await xe}async function xd(e){let t,n;switch(e.draco&&e.draco.decoderType){case"js":t=await Vt(xs[ct.FALLBACK_DECODER],"draco",e,ct.FALLBACK_DECODER);break;case"wasm":default:[t,n]=await Promise.all([await Vt(xs[ct.DECODER],"draco",e,ct.DECODER),await Vt(xs[ct.DECODER_WASM],"draco",e,ct.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Od(t,n)}function Od(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e({...n,onModuleLoaded:r=>s({draco:r})})})}const Bo={...yd,parse:Fd};async function Fd(e,t){const{draco:n}=await Sd(t),s=new bd(n);try{return s.parseSync(e,t==null?void 0:t.draco)}finally{s.destroy()}}const vd={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},X={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},G={...vd,...X},Os={[X.DOUBLE]:Float64Array,[X.FLOAT]:Float32Array,[X.UNSIGNED_SHORT]:Uint16Array,[X.UNSIGNED_INT]:Uint32Array,[X.UNSIGNED_BYTE]:Uint8Array,[X.BYTE]:Int8Array,[X.SHORT]:Int16Array,[X.INT]:Int32Array},Dd={DOUBLE:X.DOUBLE,FLOAT:X.FLOAT,UNSIGNED_SHORT:X.UNSIGNED_SHORT,UNSIGNED_INT:X.UNSIGNED_INT,UNSIGNED_BYTE:X.UNSIGNED_BYTE,BYTE:X.BYTE,SHORT:X.SHORT,INT:X.INT},Fs="Failed to convert GL type";class It{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const n in Os)if(Os[n]===t)return n;throw new Error(Fs)}static fromName(t){const n=Dd[t];if(!n)throw new Error(Fs);return n}static getArrayType(t){switch(t){case X.UNSIGNED_SHORT_5_6_5:case X.UNSIGNED_SHORT_4_4_4_4:case X.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Os[t];if(!n)throw new Error(Fs);return n}}static getByteSize(t){return It.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!It.getArrayType(t)}static createTypedArray(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(n.byteLength-s)/It.getByteSize(t));const i=It.getArrayType(t);return new i(n,s,r)}}function Ld(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function Gd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=e>>11&31,s=e>>5&63,r=e&31;return t[0]=n<<3,t[1]=s<<2,t[2]=r<<3,t}new tn,new p,new tn,new tn;function Co(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return _l(e,0,t)/t*2-1}function Eo(e){return e<0?-1:1}function Pd(e,t,n,s){if(Ld(s),e<0||e>n||t<0||t>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(s.x=Co(e,n),s.y=Co(t,n),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*Eo(r),s.y=(1-Math.abs(r))*Eo(s.y)}return s.normalize()}function Nd(e,t,n){return Pd(e,t,255,n)}class vs{constructor(t,n){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=t,this.buffer=n}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:G.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,n,s,1,r.byteOffset):r}getPropertyArray(t,n,s){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=It.fromName(r.componentType)),this._getTypedArrayFromBinary(t,n,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,n,r)}getProperty(t,n,s,r,i){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,n,s);if(s===1)return a[r];for(let c=0;c<s;++c)i[c]=a[s*r+c];return i}_getTypedArrayFromBinary(t,n,s,r,i){const o=this._cachedTypedArrays;let a=o[t];return a||(a=It.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[t]=a),a}_getTypedArrayFromArray(t,n,s){const r=this._cachedTypedArrays;let i=r[t];return i||(i=It.createTypedArray(n,s),r[t]=i),i}}const Ud={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Hd={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Jd={SCALAR:(e,t,n)=>{t[n]=e},VEC2:(e,t,n)=>{t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:(e,t,n)=>{t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:(e,t,n)=>{t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:(e,t,n)=>{t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};function Vd(e,t,n,s){const{componentType:r}=e;U(e.componentType);const i=typeof r=="string"?It.fromName(r):r,o=Ud[e.type],a=Hd[e.type],c=Jd[e.type];return n+=e.byteOffset,{values:It.createTypedArray(i,t,n,o*s),type:i,size:o,unpacker:a,packer:c}}const St=e=>e!==void 0;function jd(e,t,n){if(!t)return null;let s=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?kd(s,n):null}function kd(e,t){let n,s,r;const i=e.instancesLength,o=e.classes;let a=e.classIds,c=e.parentCounts,u=e.parentIds,l=i;St(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,i));let h;if(St(c))for(St(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),l=0,n=0;n<i;++n)h[n]=l,l+=c[n];St(u)&&St(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,r=getBinaryAccessor(u),u=r.createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,l));const f=o.length;for(n=0;n<f;++n){const y=o[n].length,E=o[n].instances,w=getBinaryProperties(y,E,t);o[n].instances=combine(w,E)}const d=new Array(f).fill(0),m=new Uint16Array(i);for(n=0;n<i;++n)s=a[n],m[n]=d[s],++d[s];const A={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:h,parentIds:u};return Wd(A),A}function Oe(e,t,n){if(!e)return;const s=e.parentCounts;return e.parentIds?n(e,t):s>0?Kd(e,t,n):zd(e,t,n)}function Kd(e,t,n){const s=e.classIds,r=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const u=++marker,l=scratchStack;for(l.length=0,l.push(t);l.length>0;){if(t=l.pop(),c[t]===u)continue;c[t]=u;const h=n(e,t);if(St(h))return h;const f=r[t],d=o[t];for(let m=0;m<f;++m){const A=i[d+m];A!==t&&l.push(A)}}return null}function zd(e,t,n){let s=!0;for(;s;){const r=n(e,t);if(St(r))return r;const i=e.parentIds[t];s=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}function Wd(e){const n=e.classIds.length;for(let s=0;s<n;++s)To(e,s,stack)}function To(e,t,n){const s=e.parentCounts,r=e.parentIds,i=e.parentIndexes,a=e.classIds.length;if(!St(r))return;assert(t<a,`Parent index ${t} exceeds the total number of instances: ${a}`),assert(n.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(t);const c=St(s)?s[t]:1,u=St(s)?i[t]:t;for(let l=0;l<c;++l){const h=r[u+l];h!==t&&To(e,h,n)}n.pop(t)}function ut(e){return e!=null}const wn=(e,t)=>e,Xd={HIERARCHY:!0,extensions:!0,extras:!0};class bo{constructor(t,n,s){var r;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,U(s>=0),this.json=t||{},this.binary=n,this.featureCount=s,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const o in this.json)Xd[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=jd(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,n){if(this._checkBatchId(t),U(typeof n=="string",n),this._hierarchy){const s=Oe(this._hierarchy,t,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===n});return ut(s)}return!1}isExactClass(t,n){return U(typeof n=="string",n),this.getExactClassName(t)===n}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const n=this._hierarchy.classIds[t];return this._hierarchy.classes[n].name}}hasProperty(t,n){return this._checkBatchId(t),U(typeof n=="string",n),ut(this._properties[n])||this._hasPropertyInHierarchy(t,n)}getPropertyNames(t,n){this._checkBatchId(t),n=ut(n)?n:[],n.length=0;const s=Object.keys(this._properties);return n.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(t,n),n}getProperty(t,n){if(this._checkBatchId(t),U(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(ut(r))return this._getBinaryProperty(r,t)}const s=this._properties[n];if(ut(s))return wn(s[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,n);if(ut(r))return r}}setProperty(t,n,s){const r=this.featureCount;if(this._checkBatchId(t),U(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,t,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,n,s))return;let i=this._properties[n];ut(i)||(this._properties[n]=new Array(r),i=this._properties[n]),i[t]=wn(s)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,n){return t.unpack(t.typedArray,n)}_setBinaryProperty(t,n,s){t.pack(s,t.typedArray,n)}_initializeBinaryProperties(){let t=null;for(const n in this._properties){const s=this._properties[n],r=this._initializeBinaryProperty(n,s);r&&(t=t||{},t[n]=r)}return t}_initializeBinaryProperty(t,n){if("byteOffset"in n){const s=n;U(this.binary,`Property ${t} requires a batch table binary.`),U(s.type,`Property ${t} requires a type.`);const r=Vd(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,n){if(!this._hierarchy)return!1;const s=Oe(this._hierarchy,t,(r,i)=>{const o=r.classIds[i],a=r.classes[o].instances;return ut(a[n])});return ut(s)}_getPropertyNamesInHierarchy(t,n){Oe(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(t,n){return Oe(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i],a=s.classIndexes[r],c=o.instances[n];return ut(c)?ut(c.typedArray)?this._getBinaryProperty(c,a):wn(c[a]):null})}_setHierarchyProperty(t,n,s,r){const i=Oe(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],u=o.classes[c],l=o.classIndexes[a],h=u.instances[s];return ut(h)?(U(a===n,`Inherited property "${s}" is read-only.`),ut(h.typedArray)?this._setBinaryProperty(h,l,r):h[l]=wn(r),!0):!1});return ut(i)}}const Ds=4;function Rn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t);if(e.magic=s.getUint32(n,!0),n+=Ds,e.version=s.getUint32(n,!0),n+=Ds,e.byteLength=s.getUint32(n,!0),n+=Ds,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return n}const ie=4,_o="b3dm tile in legacy format.";function Ls(e,t,n){const s=new DataView(t);let r;e.header=e.header||{};let i=s.getUint32(n,!0);n+=ie;let o=s.getUint32(n,!0);n+=ie;let a=s.getUint32(n,!0);n+=ie;let c=s.getUint32(n,!0);return n+=ie,a>=570425344?(n-=ie*2,r=i,a=o,c=0,i=0,o=0,console.warn(_o)):c>=570425344&&(n-=ie,r=a,a=i,c=o,i=0,o=0,console.warn(_o)),e.header.featureTableJsonByteLength=i,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=c,e.header.batchLength=r,n}function Gs(e,t,n,s){return n=Qd(e,t,n),n=qd(e,t,n),n}function Qd(e,t,n,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const a=go(t,n,r);e.featureTableJson=JSON.parse(a)}return n+=r||0,e.featureTableBinary=new Uint8Array(t,n,i),n+=i||0,n}function qd(e,t,n,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=e.header||{};if(r&&r>0){const o=go(t,n,r);e.batchTableJson=JSON.parse(o),n+=r,i&&i>0&&(e.batchTableBinary=new Uint8Array(t,n,i),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=i)}return n}function wo(e,t,n){if(!t&&(!e||!e.batchIds||!n))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=e;if(s&&n){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=s[a],l=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=l[0],o[a*3+1]=l[1],o[a*3+2]=l[2]}return{type:G.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&r){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=Gd(t[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:G.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===i*3?{type:G.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:G.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const Ro=new p;function Yd(e,t){if(!t)return null;if(e.isOctEncoded16P){const n=new Float32Array((e.pointsLength||0)*3);for(let s=0;s<(e.pointsLength||0);s++)Nd(t[s*2],t[s*2+1],Ro),Ro.toArray(n,s*3);return{type:G.FLOAT,size:2,value:n}}return{type:G.FLOAT,size:2,value:t}}function $d(e,t,n){return e.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,Zd(e,t)):{type:G.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Zd(e,t){const n=new p,s=new Float32Array(e.pointCount*3);for(let r=0;r<e.pointCount;r++)n.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(s,r*3);return s}async function tm(e,t,n,s,r){n=Rn(e,t,n),n=Ls(e,t,n),n=Gs(e,t,n),em(e);const{featureTable:i,batchTable:o}=nm(e);return await am(e,i,o,s,r),sm(e,i,s),rm(e,i,o),im(e,i),n}function em(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function nm(e){const t=new vs(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",G.FLOAT,3);const s=om(e,t);return{featureTable:t,batchTable:s}}function sm(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",G.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const s=t.getPropertyArray("POSITION_QUANTIZED",G.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",G.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",G.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=$d(e,s,n)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function rm(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",G.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",G.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",G.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=wo(e,s,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",G.UNSIGNED_BYTE,4))}function im(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",G.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",G.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=Yd(e,n)}}function om(e,t){let n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",G.UNSIGNED_SHORT,1),e.batchIds)){const s=t.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=e;n=new bo(r,i,s)}return n}async function am(e,t,n,s,r){let i,o,a;const c=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const u=t.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;const h=u.byteOffset,f=u.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(e.featureTableBinary||[]).slice(h,h+f),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const l={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await cm(e,l,s,r)}async function cm(e,t,n,s){if(!s)return;const r={...n,draco:{...n==null?void 0:n.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const i=await me(t.buffer,Bo,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,u=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,l=o&&i.attributes.POSITION.value.quantization,h=c&&i.attributes.NORMAL.value.quantization;if(l){const d=i.POSITION.data.quantization,m=d.range;e.quantizedVolumeScale=new p(m,m,m),e.quantizedVolumeOffset=new p(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0}h&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const f={};if(t.batchTableProperties)for(const d of Object.keys(t.batchTableProperties))i.attributes[d]&&i.attributes[d].value&&(f[d.toLowerCase()]=i.attributes[d].value);e.attributes={positions:o,colors:wo(e,a,void 0),normals:c,batchIds:u,...f}}const um="4.1.1";var Ps;const lm=(Ps=globalThis.loaders)===null||Ps===void 0?void 0:Ps.parseImageNode,Ns=typeof Image<"u",Us=typeof ImageBitmap<"u",Hs=We?!0:!!lm;function hm(e){switch(e){case"auto":return Us||Ns||Hs;case"imagebitmap":return Us;case"image":return Ns;case"data":return Hs;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function fm(){if(Us)return"imagebitmap";if(Ns)return"image";if(Hs)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function dm(e){const t=mm(e);if(!t)throw new Error("Not an image");return t}function Mo(e){switch(dm(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function mm(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const gm=/^data:image\/svg\+xml/,Am=/\.svg((\?|#).*)?$/;function Js(e){return e&&(gm.test(e)||Am.test(e))}function pm(e,t){if(Js(t)){let s=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return Io(e,t)}function Io(e,t){if(Js(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function So(e,t,n){const s=pm(e,n),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await ym(i||s,t)}finally{i&&r.revokeObjectURL(i)}}async function ym(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((s,r)=>{try{n.onload=()=>s(n),n.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const Bm={};let xo=!0;async function Cm(e,t,n){let s;Js(n)?s=await So(e,t,n):s=Io(e,n);const r=t&&t.imagebitmap;return await Em(s,r)}async function Em(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((Tm(t)||!xo)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),xo=!1}return await createImageBitmap(e)}function Tm(e){for(const t in e||Bm)return!1;return!0}function bm(e){return!Mm(e,"ftyp",4)||!(e[8]&96)?null:_m(e)}function _m(e){switch(wm(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function wm(e,t,n){return String.fromCharCode(...e.slice(t,n))}function Rm(e){return[...e].map(t=>t.charCodeAt(0))}function Mm(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=Rm(t);for(let r=0;r<s.length;++r)if(s[r]!==e[r+n])return!1;return!0}const xt=!1,Fe=!0;function Vs(e){const t=ve(e);return Sm(t)||Fm(t)||xm(t)||Om(t)||Im(t)}function Im(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=bm(t);return n?{mimeType:n.mimeType,width:0,height:0}:null}function Sm(e){const t=ve(e);return t.byteLength>=24&&t.getUint32(0,xt)===2303741511?{mimeType:"image/png",width:t.getUint32(16,xt),height:t.getUint32(20,xt)}:null}function xm(e){const t=ve(e);return t.byteLength>=10&&t.getUint32(0,xt)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Fe),height:t.getUint16(8,Fe)}:null}function Om(e){const t=ve(e);return t.byteLength>=14&&t.getUint16(0,xt)===16973&&t.getUint32(2,Fe)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Fe),height:t.getUint32(22,Fe)}:null}function Fm(e){const t=ve(e);if(!(t.byteLength>=3&&t.getUint16(0,xt)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=vm();let i=2;for(;i+9<t.byteLength;){const o=t.getUint16(i,xt);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,xt),width:t.getUint16(i+7,xt)};if(!s.has(o))return null;i+=2,i+=t.getUint16(i,xt)}return null}function vm(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function ve(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Dm(e,t){var n;const{mimeType:s}=Vs(e)||{},r=(n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode;return U(r),await r(e,s)}async function Lm(e,t,n){t=t||{};const r=(t.image||{}).type||"auto",{url:i}=n||{},o=Gm(r);let a;switch(o){case"imagebitmap":a=await Cm(e,t,i);break;case"image":a=await So(e,t,i);break;case"data":a=await Dm(e);break;default:U(!1)}return r==="data"&&(a=Mo(a)),a}function Gm(e){switch(e){case"auto":case"data":return fm();default:return hm(e),e}}const Pm={id:"image",module:"images",name:"Images",version:um,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:Lm,tests:[e=>!!Vs(new DataView(e))],options:{image:{type:"auto",decode:!0}}},js={};function Nm(e){if(js[e]===void 0){const t=We?Hm(e):Um(e);js[e]=t}return js[e]}function Um(e){var t,n;const s=["image/png","image/jpeg","image/gif"],r=((t=globalThis.loaders)===null||t===void 0?void 0:t.imageFormatsNode)||s;return!!((n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode)&&r.includes(e)}function Hm(e){switch(e){case"image/avif":case"image/webp":return Jm(e);default:return!0}}function Jm(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}function ft(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const Oo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Fo={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Vm=1.33,vo=["SCALAR","VEC2","VEC3","VEC4"],jm=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],km=new Map(jm),Km={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Wm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Do(e){return vo[e-1]||vo[0]}function ks(e){const t=km.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Ks(e,t){const n=Wm[e.componentType],s=Km[e.type],r=zm[e.componentType],i=e.count*s,o=e.count*s*r;ft(o>=0&&o<=t.byteLength);const a=Fo[e.componentType],c=Oo[e.type];return{ArrayType:n,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function Lo(e){let{images:t,bufferViews:n}=e;t=t||[],n=n||[];const s=t.map(o=>o.bufferView);n=n.filter(o=>!s.includes(o));const r=n.reduce((o,a)=>o+a.byteLength,0),i=t.reduce((o,a)=>{const{width:c,height:u}=a.image;return o+c*u},0);return r+Math.ceil(4*i*Vm)}function Xm(e,t,n){const s=e.bufferViews[n];ft(s);const r=s.buffer,i=t[r];ft(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function Qm(e,t,n){var s,r;const i=typeof n=="number"?(s=e.accessors)===null||s===void 0?void 0:s[n]:n;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const o=(r=e.bufferViews)===null||r===void 0?void 0:r[i.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:c}=t[o.buffer],u=(c||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:l,length:h,componentByteSize:f,numberOfComponentsInElement:d}=Ks(i,o),m=f*d,A=o.byteStride||m;if(typeof o.byteStride>"u"||o.byteStride===m)return new l(a,u,h);const y=new l(h);for(let E=0;E<i.count;E++){const w=new l(a,u+E*A,d);y.set(w,E*d)}return y}function qm(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class st{constructor(t){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(t==null?void 0:t.json)||qm(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.getRequiredExtensions().find(r=>r===t);return typeof n=="string"||typeof s=="string"}getExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.json.extensions||{};return n?s[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(s=>s===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,n){return(t.extensions||{})[n]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,n){if(typeof n=="object")return n;const s=this.json[t]&&this.json[t][n];if(!s)throw new Error(`glTF file error: Could not find ${t}[${n}]`);return s}getTypedArrayForBufferView(t){t=this.getBufferView(t);const n=t.buffer,s=this.gltf.buffers[n];ft(s);const r=(t.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const n=this.getAccessor(t);return Qm(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(t){t=this.getAccessor(t);const n=this.getBufferView(t.bufferView),r=this.getBuffer(n.buffer).data,i=n.byteOffset||0;return new Uint8Array(r,i,n.byteLength)}addApplicationData(t,n){return this.json[t]=n,this}addExtraData(t,n){return this.json.extras=this.json.extras||{},this.json.extras[t]=n,this}addObjectExtension(t,n,s){return t.extensions=t.extensions||{},t.extensions[n]=s,this.registerUsedExtension(n),this}setObjectExtension(t,n,s){const r=t.extensions||{};r[n]=s}removeObjectExtension(t,n){const s=(t==null?void 0:t.extensions)||{};if(s[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(n)||r.push(n)}delete s[n]}addExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ft(n),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=n,this.registerUsedExtension(t),n}addRequiredExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ft(n),this.addExtension(t,n),this.registerRequiredExtension(t),n}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var n;if((n=this.json.extensions)!==null&&n!==void 0&&n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:n}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(t){const{meshIndex:n,matrix:s}=t;this.json.nodes=this.json.nodes||[];const r={mesh:n};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:n,indices:s,material:r,mode:i=4}=t,a={primitives:[{attributes:this._addAttributes(n),mode:i}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){const s={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(t,n){const s=Vs(t),r=n||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const r=t.byteLength;ft(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:n,byteOffset:s,byteLength:r};return this.byteLength+=ge(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,n){const s={bufferView:t,type:Do(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(t);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,n.size));const i={size:n.size,componentType:ks(t),count:Math.round(t.length/n.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,n))}addTexture(t){const{imageIndex:n}=t,s={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,n;this.gltf.buffers=[];const s=this.byteLength,r=new ArrayBuffer(s),i=new Uint8Array(r);let o=0;for(const a of this.sourceBuffers||[])o=Jc(a,i,o);(t=this.json)!==null&&t!==void 0&&(n=t.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(t,n){let s=!0;for(;s;){const r=t.indexOf(n);r>-1?t.splice(r,1):s=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const s in t){const r=t[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);n[i]=o}return n}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,n){const s={min:null,max:null};if(t.length<n)return s;s.min=[],s.max=[];const r=t.subarray(0,n);for(const i of r)s.min.push(i),s.max.push(i);for(let i=n;i<t.length;i+=n)for(let o=0;o<n;o++)s.min[0+o]=Math.min(s.min[0+o],t[i+o]),s.max[0+o]=Math.max(s.max[0+o],t[i+o]);return s}}function Go(e){return(e%1+1)%1}const Po={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Ym={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},No={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function zs(e,t){return No[t]*Po[e]}function Mn(e,t,n,s){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),i=In(r,"SCALAR",n,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function In(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=Po[t],i=Ym[n],o=No[n],a=s*r,c=a*o;let u=e.buffer,l=e.byteOffset;return l%o!==0&&(u=new Uint8Array(u).slice(l,l+c).buffer,l=0),new i(u,l,a)}function Ws(e,t,n){var s,r;const i=`TEXCOORD_${t.texCoord||0}`,o=n.attributes[i],a=e.getTypedArrayForAccessor(o),c=e.gltf.json,u=t.index,l=(s=c.textures)===null||s===void 0||(r=s[u])===null||r===void 0?void 0:r.source;if(typeof l<"u"){var h,f,d;const m=(h=c.images)===null||h===void 0||(f=h[l])===null||f===void 0?void 0:f.mimeType,A=(d=e.gltf.images)===null||d===void 0?void 0:d[l];if(A&&typeof A.width<"u"){const y=[];for(let E=0;E<a.length;E+=2){const w=$m(A,m,a,E,t.channels);y.push(w)}return y}}return[]}function Uo(e,t,n,s,r){if(!(n!=null&&n.length))return;const i=[];for(const l of n){let h=s.findIndex(f=>f===l);h===-1&&(h=s.push(l)-1),i.push(h)}const o=new Uint32Array(i),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=e.addBufferView(o,a,0),u=e.addAccessor(c,{size:1,componentType:ks(o),count:o.length});r.attributes[t]=u}function $m(e,t,n,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[s],a=n[s+1];let c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);const u=Zm(o,a,e,c);let l=0;for(const h of r){const f=typeof h=="number"?Object.values(i)[h]:i[h],d=u+f.offset,m=Mo(e);if(m.data.length<=d)throw new Error(`${m.data.length} <= ${d}`);const A=m.data[d];l|=A<<f.shift}return l}function Zm(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=n.width,i=Go(e)*(r-1),o=Math.round(i),a=n.height,c=Go(t)*(a-1),u=Math.round(c),l=n.components?n.components:s;return(u*r+o)*l}function Ho(e,t,n,s,r){const i=[];for(let o=0;o<t;o++){const a=n[o],c=n[o+1]-n[o];if(c+a>s)break;const u=a/r,l=c/r;i.push(e.slice(u,u+l))}return i}function Jo(e,t,n){const s=[];for(let r=0;r<t;r++){const i=r*n;s.push(e.slice(i,i+n))}return s}function Vo(e,t,n,s){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let a=0;a<e;a++){const c=s[a+1]-s[a];if(c+o<=t.length){const u=t.subarray(o,c+o),l=i.decode(u);r.push(l),o+=c}}return r}return[]}const jo="EXT_mesh_features",tg=jo;async function eg(e,t){const n=new st(e);ng(n,t)}function ng(e,t){const n=e.gltf.json;if(n.meshes)for(const s of n.meshes)for(const r of s.primitives)sg(e,r,t)}function sg(e,t,n){var s,r;if(!(n!=null&&(s=n.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=(r=t.extensions)===null||r===void 0?void 0:r[jo],o=i==null?void 0:i.featureIds;if(o)for(const c of o){var a;let u;if(typeof c.attribute<"u"){const l=`_FEATURE_ID_${c.attribute}`,h=t.attributes[l];u=e.getTypedArrayForAccessor(h)}else typeof c.texture<"u"&&n!==null&&n!==void 0&&(a=n.gltf)!==null&&a!==void 0&&a.loadImages?u=Ws(e,c.texture,t):u=[];c.data=u}}const rg=Object.freeze(Object.defineProperty({__proto__:null,decode:eg,name:tg},Symbol.toStringTag,{value:"Module"})),Xs="EXT_structural_metadata",ig=Xs;async function og(e,t){const n=new st(e);ag(n,t)}function ag(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(Xs);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&cg(e,r),ug(e,r))}function cg(e,t){const n=t.propertyTextures,s=e.gltf.json;if(n&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)hg(e,n,i,t)}function ug(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.propertyTables;if(s&&r)for(const i in s){const o=lg(r,i);o&&dg(e,n,o)}}function lg(e,t){for(const n of e)if(n.class===t)return n;return null}function hg(e,t,n,s){var r;if(!t)return;const i=(r=n.extensions)===null||r===void 0?void 0:r[Xs],o=i==null?void 0:i.propertyTextures;if(o)for(const a of o){const c=t[a];fg(e,c,n,s)}}function fg(e,t,n,s){if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const o in t.properties){var i;const a=`${r}_${o}`,c=(i=t.properties)===null||i===void 0?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const u=c.data,l=Ws(e,c,n);l!==null&&(Uo(e,a,l,u,n),c.data=u,s.dataAttributeNames.push(a))}}function dg(e,t,n){var s;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],u=(o=n.properties)===null||o===void 0?void 0:o[a];if(u){const l=mg(e,t,c,i,u);u.data=l}}}function mg(e,t,n,s,r){let i=[];const o=r.values,a=e.getTypedArrayForBufferView(o),c=gg(e,n,r,s),u=Ag(e,r,s);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=pg(n,s,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{i=Vo(s,a,c,u);break}case"ENUM":{i=yg(t,n,s,a,c);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function gg(e,t,n,s){return t.array&&typeof t.count>"u"&&typeof n.arrayOffsets<"u"?Mn(e,n.arrayOffsets,n.arrayOffsetType||"UINT32",s):null}function Ag(e,t,n){return typeof t.stringOffsets<"u"?Mn(e,t.stringOffsets,t.stringOffsetType||"UINT32",n):null}function pg(e,t,n,s){const r=e.array,i=e.count,o=zs(e.type,e.componentType),a=n.byteLength/o;let c;return e.componentType?c=In(n,e.type,e.componentType,a):c=n,r?s?Ho(c,t,s,n.length,o):i?Jo(c,t,i):[]:c}function yg(e,t,n,s,r){var i;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(i=e.enums)===null||i===void 0?void 0:i[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=a.valueType||"UINT16",u=zs(t.type,c),l=s.byteLength/u;let h=In(s,t.type,c,l);if(h||(h=s),t.array){if(r)return Bg({valuesData:h,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:u,enumEntry:a});const f=t.count;return f?Cg(h,n,f,a):[]}return Qs(h,0,n,a)}function Bg(e){const{valuesData:t,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=e,a=[];for(let c=0;c<n;c++){const u=s[c],l=s[c+1]-s[c];if(l+u>r)break;const h=u/i,f=l/i,d=Qs(t,h,f,o);a.push(d)}return a}function Cg(e,t,n,s){const r=[];for(let i=0;i<t;i++){const o=n*i,a=Qs(e,o,n,s);r.push(a)}return r}function Qs(e,t,n,s){const r=[];for(let i=0;i<n;i++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+i],a=Eg(s,o);a?r.push(a.name):r.push("")}return r}function Eg(e,t){for(const n of e.values)if(n.value===t)return n;return null}const Tg=Object.freeze(Object.defineProperty({__proto__:null,decode:og,name:ig},Symbol.toStringTag,{value:"Module"})),ko="EXT_feature_metadata",bg=ko;async function _g(e,t){const n=new st(e);wg(n,t)}function wg(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(ko);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&Rg(e,r),Mg(e,r))}function Rg(e,t){const n=t.schema;if(!n)return;const s=n.classes,{featureTextures:r}=t;if(s&&r)for(const i in s){const o=s[i],a=Sg(r,i);a&&Og(e,a,o)}}function Mg(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.featureTables;if(s&&r)for(const i in s){const o=Ig(r,i);o&&xg(e,n,o)}}function Ig(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function Sg(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function xg(e,t,n){var s;if(!n.class)return;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],u=(o=n.properties)===null||o===void 0?void 0:o[a];if(u){const l=Fg(e,t,c,i,u);u.data=l}}}function Og(e,t,n){const s=t.class;for(const i in n.properties){var r;const o=t==null||(r=t.properties)===null||r===void 0?void 0:r[i];if(o){const a=Pg(e,o,s);o.data=a}}}function Fg(e,t,n,s,r){let i=[];const o=r.bufferView,a=e.getTypedArrayForBufferView(o),c=vg(e,n,r,s),u=Dg(e,n,r,s);return n.type==="STRING"||n.componentType==="STRING"?i=Vo(s,a,c,u):Lg(n)&&(i=Gg(n,s,a,c)),i}function vg(e,t,n,s){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?Mn(e,n.arrayOffsetBufferView,n.offsetType||"UINT32",s):null}function Dg(e,t,n,s){return typeof n.stringOffsetBufferView<"u"?Mn(e,n.stringOffsetBufferView,n.offsetType||"UINT32",s):null}function Lg(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function Gg(e,t,n,s){const r=e.type==="ARRAY",i=e.componentCount,o="SCALAR",a=e.componentType||e.type,c=zs(o,a),u=n.byteLength/c,l=In(n,o,a,u);return r?s?Ho(l,t,s,n.length,c):i?Jo(l,t,i):[]:l}function Pg(e,t,n){const s=e.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)Ng(e,n,t,r,o);return r}function Ng(e,t,n,s,r){const i={channels:n.channels,...n.texture},o=Ws(e,i,r);o&&Uo(e,t,o,s,r)}const Ug=Object.freeze(Object.defineProperty({__proto__:null,decode:_g,name:bg},Symbol.toStringTag,{value:"Module"})),Hg="4.1.1",Jg="4.1.1",Sn={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let qs;async function Ko(e){const t=e.modules||{};return t.basis?t.basis:(qs=qs||Vg(e),await qs)}async function Vg(e){let t=null,n=null;return[t,n]=await Promise.all([await Vt(Sn.TRANSCODER,"textures",e),await Vt(Sn.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await jg(t,n)}function jg(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let Ys;async function zo(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(Ys=Ys||kg(e),await Ys)}async function kg(e){let t=null,n=null;return[t,n]=await Promise.all([await Vt(Sn.ENCODER,"textures",e),await Vt(Sn.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await Kg(t,n)}function Kg(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=r;a(),s({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}const oe={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},zg=["","WEBKIT_","MOZ_"],Wo={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let xn=null;function Wg(e){if(!xn){e=e||Xg()||void 0,xn=new Set;for(const t of zg)for(const n in Wo)if(e&&e.getExtension(`${t}${n}`)){const s=Wo[n];xn.add(s)}}return xn}function Xg(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Xo,Qo,qo,Yo,$o,Zo,ta,ea;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(Xo||(Xo={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(Qo||(Qo={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(qo||(qo={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(Yo||(Yo={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}($o||($o={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Zo||(Zo={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(ta||(ta={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(ea||(ea={}));const dt=[171,75,84,88,32,50,48,187,13,10,26,10];function Qg(e){const t=new Uint8Array(e);return!(t.byteLength<dt.length||t[0]!==dt[0]||t[1]!==dt[1]||t[2]!==dt[2]||t[3]!==dt[3]||t[4]!==dt[4]||t[5]!==dt[5]||t[6]!==dt[6]||t[7]!==dt[7]||t[8]!==dt[8]||t[9]!==dt[9]||t[10]!==dt[10]||t[11]!==dt[11])}const qg={etc1:{basisFormat:0,compressed:!0,format:oe.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:oe.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:oe.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:oe.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:oe.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:oe.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function Yg(e,t){if(t.basis.containerFormat==="auto"){if(Qg(e)){const s=await zo(t);return na(s.KTX2File,e,t)}const{BasisFile:n}=await Ko(t);return $s(n,e,t)}switch(t.basis.module){case"encoder":const n=await zo(t);switch(t.basis.containerFormat){case"ktx2":return na(n.KTX2File,e,t);case"basis":default:return $s(n.BasisFile,e,t)}case"transcoder":default:const{BasisFile:s}=await Ko(t);return $s(s,e,t)}}function $s(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const a=s.getNumLevels(o),c=[];for(let u=0;u<a;u++)c.push($g(s,o,u,n));i.push(c)}return i}finally{s.close(),s.delete()}}function $g(e,t,n,s){const r=e.getImageWidth(t,n),i=e.getImageHeight(t,n),o=e.getHasAlpha(),{compressed:a,format:c,basisFormat:u}=sa(s,o),l=e.getImageTranscodedSizeInBytes(t,n,u),h=new Uint8Array(l);if(!e.transcodeImage(h,t,n,u,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:h,compressed:a,format:c,hasAlpha:o}}function na(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++){i.push(Zg(s,o,n));break}return[i]}finally{s.close(),s.delete()}}function Zg(e,t,n){const{alphaFlag:s,height:r,width:i}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=sa(n,s),u=e.getImageTranscodedSizeInBytes(t,0,0,c),l=new Uint8Array(u);if(!e.transcodeImage(l,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:l,compressed:o,levelSize:u,hasAlpha:s,format:a}}function sa(e,t){let n=e&&e.basis&&e.basis.format;return n==="auto"&&(n=ra()),typeof n=="object"&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),qg[n]}function ra(){const e=Wg();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const t0={...{name:"Basis",id:"basis",module:"textures",version:Jg,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:Yg},ae=!0,ia=1735152710,Zs=12,On=8,e0=1313821514,n0=5130562,s0=0,r0=0,i0=1;function o0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function a0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(e),{magic:r=ia}=n,i=s.getUint32(t,!1);return i===r||i===ia}function c0(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t),r=o0(s,n+0),i=s.getUint32(n+4,ae),o=s.getUint32(n+8,ae);switch(Object.assign(e,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:r,version:i,json:{},binChunks:[]}),n+=Zs,e.version){case 1:return u0(e,s,n);case 2:return l0(e,s,n,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function u0(e,t,n){U(e.header.byteLength>Zs+On);const s=t.getUint32(n+0,ae),r=t.getUint32(n+4,ae);return n+=On,U(r===s0),tr(e,t,n,s),n+=s,n+=er(e,t,n,e.header.byteLength),n}function l0(e,t,n,s){return U(e.header.byteLength>Zs+On),h0(e,t,n,s),n+e.header.byteLength}function h0(e,t,n,s){for(;n+8<=e.header.byteLength;){const r=t.getUint32(n+0,ae),i=t.getUint32(n+4,ae);switch(n+=On,i){case e0:tr(e,t,n,r);break;case n0:er(e,t,n,r);break;case r0:s.strict||tr(e,t,n,r);break;case i0:s.strict||er(e,t,n,r);break}n+=ge(r,4)}return n}function tr(e,t,n,s){const r=new Uint8Array(t.buffer,n,s),o=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(o),ge(s,4)}function er(e,t,n,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:s,arrayBuffer:t.buffer}),ge(s,4)}function oa(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return s.substr(0,s.lastIndexOf("/")+1)+e}const f0="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",d0="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",m0=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),g0=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),A0={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},p0={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function y0(e,t,n,s,r){let i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await B0();T0(o,o.exports[p0[r]],e,t,n,s,o.exports[A0[i||"NONE"]])}let nr;async function B0(){return nr||(nr=C0()),nr}async function C0(){let e=f0;WebAssembly.validate(m0)&&(e=d0,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(E0(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function E0(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s){const r=e.charCodeAt(s);t[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let s=0;s<e.length;++s)t[n++]=t[s]<60?g0[t[s]]:(t[s]-60)*64+t[++s];return t.buffer.slice(0,n)}function T0(e,t,n,s,r,i,o){const a=e.exports.sbrk,c=s+3&-4,u=a(c*r),l=a(i.length),h=new Uint8Array(e.exports.memory.buffer);h.set(i,l);const f=t(u,s,r,l,i.length);if(f===0&&o&&o(u,c,r),n.set(h.subarray(u,u+s*r)),a(u-a(0)),f!==0)throw new Error(`Malformed buffer data: ${f}`)}const Fn="EXT_meshopt_compression",b0=Fn;async function _0(e,t){var n,s;const r=new st(e);if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes)||!((s=t.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=[];for(const o of e.json.bufferViews||[])i.push(w0(r,o));await Promise.all(i),r.removeExtension(Fn)}async function w0(e,t){const n=e.getObjectExtension(t,Fn);if(n){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:u}=n,l=e.gltf.buffers[u],h=new Uint8Array(l.arrayBuffer,l.byteOffset+s,r),f=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await y0(f,o,i,h,a,c),e.removeObjectExtension(t,Fn)}}const R0=Object.freeze(Object.defineProperty({__proto__:null,decode:_0,name:b0},Symbol.toStringTag,{value:"Module"})),ce="EXT_texture_webp",M0=ce;function I0(e,t){const n=new st(e);if(!Nm("image/webp")){if(n.getRequiredExtensions().includes(ce))throw new Error(`gltf: Required extension ${ce} not supported by browser`);return}const{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,ce);i&&(r.source=i.source),n.removeObjectExtension(r,ce)}n.removeExtension(ce)}const S0=Object.freeze(Object.defineProperty({__proto__:null,name:M0,preprocess:I0},Symbol.toStringTag,{value:"Module"})),vn="KHR_texture_basisu",x0=vn;function O0(e,t){const n=new st(e),{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,vn);i&&(r.source=i.source,n.removeObjectExtension(r,vn))}n.removeExtension(vn)}const F0=Object.freeze(Object.defineProperty({__proto__:null,name:x0,preprocess:O0},Symbol.toStringTag,{value:"Module"}));function v0(e){const t={};for(const n in e){const s=e[n];if(n!=="indices"){const r=aa(s);t[n]=r}}return t}function aa(e){const{buffer:t,size:n,count:s}=D0(e);return{value:t,size:n,byteOffset:0,count:s,type:Do(n),componentType:ks(t)}}function D0(e){let t=e,n=1,s=0;return e&&e.value&&(t=e.value,n=e.size||1),t&&(ArrayBuffer.isView(t)||(t=L0(t,Float32Array)),s=t.length/n),{buffer:t,size:n,count:s}}function L0(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e?Array.isArray(e)?new t(e):n&&!(e instanceof t)?new t(e):e:null}const Ht="KHR_draco_mesh_compression",G0=Ht;function P0(e,t,n){const s=new st(e);for(const r of ca(s))s.getObjectExtension(r,Ht)}async function N0(e,t,n){var s;if(!(t!=null&&(s=t.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const r=new st(e),i=[];for(const o of ca(r))r.getObjectExtension(o,Ht)&&i.push(H0(r,o,t,n));await Promise.all(i),r.removeExtension(Ht)}function U0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new st(e);for(const s of n.json.meshes||[])J0(s,t),n.addRequiredExtension(Ht)}async function H0(e,t,n,s){const r=e.getObjectExtension(t,Ht);if(!r)return;const i=e.getTypedArrayForBufferView(r.bufferView),o=Qn(i.buffer,i.byteOffset),a={...n};delete a["3d-tiles"];const c=await me(o,Bo,a,s),u=v0(c.attributes);for(const[l,h]of Object.entries(u))if(l in t.attributes){const f=t.attributes[l],d=e.getAccessor(f);d!=null&&d.min&&d!==null&&d!==void 0&&d.max&&(h.min=d.min,h.max=d.max)}t.attributes=u,c.indices&&(t.indices=aa(c.indices)),e.removeObjectExtension(t,Ht),V0(t)}function J0(e,t){var n;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:e}),a=i==null||(n=i.parseSync)===null||n===void 0?void 0:n.call(i,{attributes:e}),c=r._addFauxAttributes(a.attributes),u=r.addBufferView(o);return{primitives:[{attributes:c,mode:s,extensions:{[Ht]:{bufferView:u,attributes:c}}}]}}function V0(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*ca(e){for(const t of e.json.meshes||[])for(const n of t.primitives)yield n}const j0=Object.freeze(Object.defineProperty({__proto__:null,decode:N0,encode:U0,name:G0,preprocess:P0},Symbol.toStringTag,{value:"Module"})),sr="KHR_texture_transform",k0=sr,Dn=new p,K0=new z,z0=new z;async function W0(e,t){var n;if(!new st(e).hasExtension(sr)||!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const i=e.json.materials||[];for(let o=0;o<i.length;o++)X0(o,e)}function X0(e,t){var n,s,r;const i=[],o=(n=t.json.materials)===null||n===void 0?void 0:n[e],a=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;a&&De(t,e,a,i);const c=o==null?void 0:o.emissiveTexture;c&&De(t,e,c,i);const u=o==null?void 0:o.normalTexture;u&&De(t,e,u,i);const l=o==null?void 0:o.occlusionTexture;l&&De(t,e,l,i);const h=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;h&&De(t,e,h,i)}function De(e,t,n,s){const r=Q0(n,s);if(!r)return;const i=e.json.meshes||[];for(const o of i)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&t===c&&q0(e,a,r)}}function Q0(e,t){var n;const s=(n=e.extensions)===null||n===void 0?void 0:n[sr],{texCoord:r=0}=e,{texCoord:i=r}=s;if(!(t.findIndex(a=>{let[c,u]=a;return c===r&&u===i})!==-1)){const a=Z0(s);return r!==i&&(e.texCoord=i),t.push([r,i]),{originalTexCoord:r,texCoord:i,matrix:a}}return null}function q0(e,t,n){const{originalTexCoord:s,texCoord:r,matrix:i}=n,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){var a;const u=(a=e.json.accessors)===null||a===void 0?void 0:a[o];if(u&&u.bufferView){var c;const l=(c=e.json.bufferViews)===null||c===void 0?void 0:c[u.bufferView];if(l){const{arrayBuffer:h,byteOffset:f}=e.buffers[l.buffer],d=(f||0)+(u.byteOffset||0)+(l.byteOffset||0),{ArrayType:m,length:A}=Ks(u,l),y=Fo[u.componentType],E=Oo[u.type],w=l.byteStride||y*E,B=new Float32Array(A);for(let C=0;C<u.count;C++){const R=new m(h,d+C*w,2);Dn.set(R[0],R[1],1),Dn.transformByMatrix3(i),B.set([Dn[0],Dn[1]],C*E)}s===r?Y0(u,l,e.buffers,B):$0(r,u,t,e,B)}}}}function Y0(e,t,n,s){e.componentType=5126,n.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=s.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function $0(e,t,n,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes[`TEXCOORD_${e}`]=o.length-1)}function Z0(e){const{offset:t=[0,0],rotation:n=0,scale:s=[1,1]}=e,r=new z().set(1,0,0,0,1,0,t[0],t[1],1),i=K0.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=z0.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const tA=Object.freeze(Object.defineProperty({__proto__:null,decode:W0,name:k0},Symbol.toStringTag,{value:"Module"})),Xt="KHR_lights_punctual",eA=Xt;async function nA(e){const t=new st(e),{json:n}=t,s=t.getExtension(Xt);s&&(t.json.lights=s.lights,t.removeExtension(Xt));for(const r of n.nodes||[]){const i=t.getObjectExtension(r,Xt);i&&(r.light=i.light),t.removeObjectExtension(r,Xt)}}async function sA(e){const t=new st(e),{json:n}=t;if(n.lights){const s=t.addExtension(Xt);ft(!s.lights),s.lights=n.lights,delete n.lights}if(t.json.lights){for(const s of t.json.lights){const r=s.node;t.addObjectExtension(r,Xt,s)}delete t.json.lights}}const rA=Object.freeze(Object.defineProperty({__proto__:null,decode:nA,encode:sA,name:eA},Symbol.toStringTag,{value:"Module"})),Le="KHR_materials_unlit",iA=Le;async function oA(e){const t=new st(e),{json:n}=t;for(const s of n.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),t.removeObjectExtension(s,Le);t.removeExtension(Le)}function aA(e){const t=new st(e),{json:n}=t;if(t.materials)for(const s of n.materials||[])s.unlit&&(delete s.unlit,t.addObjectExtension(s,Le,{}),t.addExtension(Le))}const cA=Object.freeze(Object.defineProperty({__proto__:null,decode:oA,encode:aA,name:iA},Symbol.toStringTag,{value:"Module"})),Ge="KHR_techniques_webgl",uA=Ge;async function lA(e){const t=new st(e),{json:n}=t,s=t.getExtension(Ge);if(s){const r=fA(s,t);for(const i of n.materials||[]){const o=t.getObjectExtension(i,Ge);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=dA(i.technique,t)),t.removeObjectExtension(i,Ge)}t.removeExtension(Ge)}}async function hA(e,t){}function fA(e,t){const{programs:n=[],shaders:s=[],techniques:r=[]}=e,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function dA(e,t){const n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(s=>{e.uniforms[s].value&&!(s in n)&&(n[s]=e.uniforms[s].value)}),Object.keys(n).forEach(s=>{typeof n[s]=="object"&&n[s].index!==void 0&&(n[s].texture=t.getTexture(n[s].index))}),n}const ua=[Tg,rg,R0,S0,F0,j0,rA,cA,Object.freeze(Object.defineProperty({__proto__:null,decode:lA,encode:hA,name:uA},Symbol.toStringTag,{value:"Module"})),tA,Ug];function mA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=ua.filter(i=>la(i.name,t));for(const i of s){var r;(r=i.preprocess)===null||r===void 0||r.call(i,e,t,n)}}async function gA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=ua.filter(i=>la(i.name,t));for(const i of s){var r;await((r=i.decode)===null||r===void 0?void 0:r.call(i,e,t,n))}}function la(e,t){var n;const s=(t==null||(n=t.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(e in s&&!s[e])}const rr="KHR_binary_glTF";function AA(e){const t=new st(e),{json:n}=t;for(const s of n.images||[]){const r=t.getObjectExtension(s,rr);r&&Object.assign(s,r),t.removeObjectExtension(s,rr)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,t.removeExtension(rr)}const ha={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},pA={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class yA{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(t,n){this.json=t.json;const s=t.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),AA(t),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const n in ha)this._convertTopLevelObjectToArray(t,n)}_convertTopLevelObjectToArray(t,n){const s=t[n];if(!(!s||Array.isArray(s))){t[n]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=t[n].length;t[n].push(i),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const n in ha)this._convertIdsToIndices(t,n);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const n of t.textures)this._convertTextureIds(n);for(const n of t.meshes)this._convertMeshIds(n);for(const n of t.nodes)this._convertNodeIds(n);for(const n of t.scenes)this._convertSceneIds(n)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const n of t.primitives){const{attributes:s,indices:r,material:i}=n;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),i&&(n.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(n=>this._convertIdToIndex(n,"node"))),t.meshes&&(t.meshes=t.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(t,n){t[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),t[n]=[]);for(const s of t[n])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(t,n){const s=pA[n];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${n} with id ${t}`);return r}return t}_updateObjects(t){for(const n of this.json.buffers)delete n.type}_updateMaterial(t){for(const i of t.materials){var n,s,r;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=i.values)===null||n===void 0?void 0:n.tex)||((s=i.values)===null||s===void 0?void 0:s.texture2d_0)||((r=i.values)===null||r===void 0?void 0:r.diffuseTex),a=t.textures.findIndex(c=>c.id===o);a!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:a})}}}function BA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new yA().normalize(e,t)}async function CA(e,t){var n,s,r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return EA(e,t,i,o),BA(e,{normalize:o==null||(n=o.gltf)===null||n===void 0?void 0:n.normalize}),mA(e,o,a),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.loadBuffers&&e.json.buffers&&await TA(e,o,a),o!=null&&(r=o.gltf)!==null&&r!==void 0&&r.loadImages&&await bA(e,o,a),await gA(e,o,a),e}function EA(e,t,n,s){if(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!a0(t,n,s)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=Pc(t);else if(t instanceof ArrayBuffer){const o={};n=c0(o,t,n,s.glb),ft(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else ft(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}async function TA(e,t,n){const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){var r,i;const{fetch:c}=n;ft(c);const u=oa(a.uri,t),l=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,u)),h=await(l==null||(i=l.arrayBuffer)===null||i===void 0?void 0:i.call(l));e.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function bA(e,t,n){const s=_A(e),r=e.json.images||[],i=[];for(const o of s)i.push(wA(e,r[o],o,t,n));return await Promise.all(i)}function _A(e){const t=new Set,n=e.json.textures||[];for(const s of n)s.source!==void 0&&t.add(s.source);return Array.from(t).sort()}async function wA(e,t,n,s,r){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){const a=oa(t.uri,s),{fetch:c}=r;i=await(await c(a)).arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){const a=Xm(e.json,e.buffers,t.bufferView);i=Qn(a.buffer,a.byteOffset,a.byteLength)}ft(i,"glTF image has no data");let o=await me(i,[Pm,t0],{...s,mimeType:t.mimeType,basis:s.basis||{format:ra()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[n]=o}const Ln={name:"glTF",id:"gltf",module:"gltf",version:Hg,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:RA,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function RA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t={...Ln.options,...t},t.gltf={...Ln.options.gltf,...t.gltf};const{byteOffset:s=0}=t;return await CA({},e,s,t,n)}const MA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},IA={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},yt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},SA={magFilter:yt.TEXTURE_MAG_FILTER,minFilter:yt.TEXTURE_MIN_FILTER,wrapS:yt.TEXTURE_WRAP_S,wrapT:yt.TEXTURE_WRAP_T},xA={[yt.TEXTURE_MAG_FILTER]:yt.LINEAR,[yt.TEXTURE_MIN_FILTER]:yt.NEAREST_MIPMAP_LINEAR,[yt.TEXTURE_WRAP_S]:yt.REPEAT,[yt.TEXTURE_WRAP_T]:yt.REPEAT};function OA(){return{id:"default-sampler",parameters:xA}}function FA(e){return IA[e]}function vA(e){return MA[e]}class DA{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:r=[],images:i=[]}=t,{baseUri:o=""}=t;return ft(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(t.json,n),this.json}_resolveTree(t){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((s,r)=>this._resolveBufferView(s,r))),t.images&&(n.images=t.images.map((s,r)=>this._resolveImage(s,r))),t.samplers&&(n.samplers=t.samplers.map((s,r)=>this._resolveSampler(s,r))),t.textures&&(n.textures=t.textures.map((s,r)=>this._resolveTexture(s,r))),t.accessors&&(n.accessors=t.accessors.map((s,r)=>this._resolveAccessor(s,r))),t.materials&&(n.materials=t.materials.map((s,r)=>this._resolveMaterial(s,r))),t.meshes&&(n.meshes=t.meshes.map((s,r)=>this._resolveMesh(s,r))),t.nodes&&(n.nodes=t.nodes.map((s,r)=>this._resolveNode(s,r)),n.nodes=n.nodes.map((s,r)=>this._resolveNodeChildren(s))),t.skins&&(n.skins=t.skins.map((s,r)=>this._resolveSkin(s,r))),t.scenes&&(n.scenes=t.scenes.map((s,r)=>this._resolveScene(s,r))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,n){if(typeof n=="object")return n;const s=t&&t[n];return s||console.warn(`glTF file error: Could not find ${t}[${n}]`),s}_resolveScene(t,n){return{...t,id:t.id||`scene-${n}`,nodes:(t.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(t,n){const s={...t,id:(t==null?void 0:t.id)||`node-${n}`};return t.mesh!==void 0&&(s.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(s.camera=this.getCamera(t.camera)),t.skin!==void 0&&(s.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(s.mesh=t.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(n=>this.getNode(n))),t}_resolveSkin(t,n){const s=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${n}`,inverseBindMatrices:s}}_resolveMesh(t,n){const s={...t,id:t.id||`mesh-${n}`,primitives:[]};return t.primitives&&(s.primitives=t.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const a in o)i.attributes[a]=this.getAccessor(o[a]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(t,n){const s={...t,id:t.id||`material-${n}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(t,n){const s=FA(t.componentType),r=vA(t.type),i=s*r,o={...t,id:t.id||`accessor-${n}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:u}=Ks(o,o.bufferView),l=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let h=a.arrayBuffer.slice(l,l+u);o.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(a,l,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(h)}return o}_getValueFromInterleavedBuffer(t,n,s,r,i){const o=new Uint8Array(i*r);for(let a=0;a<i;a++){const c=n+a*s;o.set(new Uint8Array(t.arrayBuffer.slice(c,c+r)),a*r)}return o.buffer}_resolveTexture(t,n){return{...t,id:t.id||`texture-${n}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):OA(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,n){const s={id:t.id||`sampler-${n}`,...t,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(t){return SA[t]}_resolveImage(t,n){const s={...t,id:t.id||`image-${n}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[n];return r&&(s.image=r),s}_resolveBufferView(t,n){const s=t.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return t.byteOffset&&(i+=t.byteOffset),{id:`bufferView-${n}`,...t,buffer:this.buffers[s],data:new Uint8Array(r,i,t.byteLength)}}_resolveCamera(t,n){const s={...t,id:t.id||`camera-${n}`};return s.perspective,s.orthographic,s}}function fa(e,t){return new DA().postProcess(e,t)}const ir={URI:0,EMBEDDED:1};function da(e,t,n,s){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Qn(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,n%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function ma(e,t,n,s){const r=(n==null?void 0:n["3d-tiles"])||{};if(LA(e,t),r.loadGLTF){if(!s)return;if(e.gltfUrl){const{fetch:i}=s,o=await i(e.gltfUrl,n);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const i=await me(e.gltfArrayBuffer,Ln,n,s);e.gltf=fa(i),e.gpuMemoryUsageInBytes=Lo(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function LA(e,t,n){switch(t){case ir.URI:if(e.gltfArrayBuffer){const s=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=new TextDecoder().decode(s);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case ir.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function GA(e,t,n,s,r){var i;n=PA(e,t,n,s),await ma(e,ir.EMBEDDED,s,r);const o=e==null||(i=e.gltf)===null||i===void 0?void 0:i.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),n}function PA(e,t,n,s,r){n=Rn(e,t,n),n=Ls(e,t,n),n=Gs(e,t,n),n=da(e,t,n,s);const i=new vs(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",G.FLOAT,3),n}async function NA(e,t,n,s,r){return n=UA(e,t,n,s),await ma(e,e.gltfFormat||0,s,r),n}function UA(e,t,n,s,r){var i;if(n=Rn(e,t,n),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);n=Ls(e,t,n);const o=new DataView(t);if(e.gltfFormat=o.getUint32(n,!0),n+=4,n=Gs(e,t,n),n=da(e,t,n,s),!(e!=null&&(i=e.header)!==null&&i!==void 0&&i.featureTableJsonByteLength)||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new vs(e.featureTableJson,e.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=a.getGlobalProperty("RTC_CENTER",G.FLOAT,3);const u=new bo(e.batchTableJson,e.batchTableBinary,c);return HA(e,a,u,c),n}function HA(e,t,n,s){const r=new Array(s),i=new p;new p,new p,new p;const o=new z,a=new ln,c=new p,u={},l=new V,h=[],f=[],d=[],m=[];for(let A=0;A<s;A++){let y;if(t.hasProperty("POSITION"))y=t.getProperty("POSITION",G.FLOAT,3,A,i);else if(t.hasProperty("POSITION_QUANTIZED")){y=t.getProperty("POSITION_QUANTIZED",G.UNSIGNED_SHORT,3,A,i);const T=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",G.FLOAT,3);if(!T)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const O=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",G.FLOAT,3);if(!O)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const F=65535;for(let x=0;x<3;x++)y[x]=y[x]/F*O[x]+T[x]}if(!y)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(y),u.translation=i,e.normalUp=t.getProperty("NORMAL_UP",G.FLOAT,3,A,h),e.normalRight=t.getProperty("NORMAL_RIGHT",G.FLOAT,3,A,f),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",G.UNSIGNED_SHORT,2,A,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",G.UNSIGNED_SHORT,2,A,f),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(J.WGS84.eastNorthUpToFixedFrame(i,l),l.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),u.rotation=a,c.set(1,1,1);const E=t.getProperty("SCALE",G.FLOAT,1,A,d);Number.isFinite(E)&&c.multiplyByScalar(E);const w=t.getProperty("SCALE_NON_UNIFORM",G.FLOAT,3,A,h);w&&c.scale(w),u.scale=c;let B=t.getProperty("BATCH_ID",G.UNSIGNED_SHORT,1,A,m);B===void 0&&(B=A);const C=new V().fromQuaternion(u.rotation);l.identity(),l.translate(u.translation),l.multiplyRight(C),l.scale(u.scale);const R=l.clone();r[A]={modelMatrix:R,batchId:B}}e.instances=r}async function JA(e,t,n,s,r,i){n=Rn(e,t,n);const o=new DataView(t);for(e.tilesLength=o.getUint32(n,!0),n+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-n>12;){const a={shape:"tile3d"};e.tiles.push(a),n=await i(t,n,s,r,a)}return n}async function VA(e,t,n,s){var r,i;if(e.rotateYtoZ=!0,e.gltfUpAxis=n!=null&&(r=n["3d-tiles"])!==null&&r!==void 0&&r.assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",n!=null&&(i=n["3d-tiles"])!==null&&i!==void 0&&i.loadGLTF){if(!s)return t.byteLength;const o=await me(t,Ln,n,s);e.gltf=fa(o),e.gpuMemoryUsageInBytes=Lo(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function ga(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(r.byteOffset=t,r.type=pd(e,t),r.type){case Se.COMPOSITE:return await JA(r,e,t,n,s,ga);case Se.BATCHED_3D_MODEL:return await GA(r,e,t,n,s);case Se.GLTF:return await VA(r,e,n,s);case Se.INSTANCED_3D_MODEL:return await NA(r,e,t,n,s);case Se.POINT_CLOUD:return await tm(r,e,t,n,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const jA=1952609651,kA=1;async function KA(e,t,n){if(new Uint32Array(e.slice(0,4))[0]!==jA)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==kA)throw new Error("Wrong subtree file verson, must be 1");const i=Aa(e.slice(8,16)),o=new Uint8Array(e,24,i),c=new TextDecoder("utf8").decode(o),u=JSON.parse(c),l=Aa(e.slice(16,24));let h=new ArrayBuffer(0);if(l&&(h=e.slice(24+i)),await Gn(u,u.tileAvailability,h,n),Array.isArray(u.contentAvailability))for(const f of u.contentAvailability)await Gn(u,f,h,n);else await Gn(u,u.contentAvailability,h,n);return await Gn(u,u.childSubtreeAvailability,h,n),u}async function Gn(e,t,n,s){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const i=e.bufferViews[r],o=e.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,l=await(await s.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(l,i.byteOffset,i.byteLength);return}const a=e.buffers.slice(0,i.buffer).reduce((c,u)=>c+u.byteLength,0);t.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function Aa(e){const t=new DataView(e),n=t.getUint32(0,!0),s=t.getUint32(4,!0);return n+2**32*s}const pa={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:mo,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:KA,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Bt=null;try{Bt=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function H(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}H.prototype.__isLong__,Object.defineProperty(H.prototype,"__isLong__",{value:!0});function rt(e){return(e&&e.__isLong__)===!0}function ya(e){var t=Math.clz32(e&-e);return e?31-t:t}H.isLong=rt;var Ba={},Ca={};function Qt(e,t){var n,s,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(s=Ca[e],s)?s:(n=P(e,0,!0),r&&(Ca[e]=n),n)):(e|=0,(r=-128<=e&&e<128)&&(s=Ba[e],s)?s:(n=P(e,e<0?-1:0,!1),r&&(Ba[e]=n),n))}H.fromInt=Qt;function Ct(e,t){if(isNaN(e))return t?Lt:wt;if(t){if(e<0)return Lt;if(e>=Ta)return Ma}else{if(e<=-ba)return lt;if(e+1>=ba)return Ra}return e<0?Ct(-e,t).neg():P(e%ue|0,e/ue|0,t)}H.fromNumber=Ct;function P(e,t,n){return new H(e,t,n)}H.fromBits=P;var Pn=Math.pow;function or(e,t,n){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(n=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?Lt:wt;if(n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=e.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return or(e.substring(1),t,n).neg();for(var r=Ct(Pn(n,8)),i=wt,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),n);if(a<8){var u=Ct(Pn(n,a));i=i.mul(u).add(Ct(c))}else i=i.mul(r),i=i.add(Ct(c))}return i.unsigned=t,i}H.fromString=or;function _t(e,t){return typeof e=="number"?Ct(e,t):typeof e=="string"?or(e,t):P(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}H.fromValue=_t;var Ea=65536,zA=1<<24,ue=Ea*Ea,Ta=ue*ue,ba=Ta/2,_a=Qt(zA),wt=Qt(0);H.ZERO=wt;var Lt=Qt(0,!0);H.UZERO=Lt;var le=Qt(1);H.ONE=le;var wa=Qt(1,!0);H.UONE=wa;var ar=Qt(-1);H.NEG_ONE=ar;var Ra=P(-1,2147483647,!1);H.MAX_VALUE=Ra;var Ma=P(-1,-1,!0);H.MAX_UNSIGNED_VALUE=Ma;var lt=P(0,-2147483648,!1);H.MIN_VALUE=lt;var _=H.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*ue+(this.low>>>0):this.high*ue+(this.low>>>0)},_.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(lt)){var n=Ct(t),s=this.div(n),r=s.mul(n).sub(this);return s.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Ct(Pn(t,6),this.unsigned),o=this,a="";;){var c=o.div(i),u=o.sub(c.mul(i)).toInt()>>>0,l=u.toString(t);if(o=c,o.isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(lt)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1},_.isZero=function(){return this.high===0&&this.low===0},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(this.low&1)===1},_.isEven=function(){return(this.low&1)===0},_.equals=function(t){return rt(t)||(t=_t(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},_.eq=_.equals,_.notEquals=function(t){return!this.eq(t)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(t){return this.comp(t)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(t){return this.comp(t)<=0},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(t){return this.comp(t)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(t){return this.comp(t)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(t){if(rt(t)||(t=_t(t)),this.eq(t))return 0;var n=this.isNegative(),s=t.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(lt)?lt:this.not().add(le)},_.neg=_.negate,_.add=function(t){rt(t)||(t=_t(t));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,u=t.low&65535,l=0,h=0,f=0,d=0;return d+=i+u,f+=d>>>16,d&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,l+=h>>>16,h&=65535,l+=n+o,l&=65535,P(f<<16|d,l<<16|h,this.unsigned)},_.subtract=function(t){return rt(t)||(t=_t(t)),this.add(t.neg())},_.sub=_.subtract,_.multiply=function(t){if(this.isZero())return this;if(rt(t)||(t=_t(t)),Bt){var n=Bt.mul(this.low,this.high,t.low,t.high);return P(n,Bt.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Lt:wt;if(this.eq(lt))return t.isOdd()?lt:wt;if(t.eq(lt))return this.isOdd()?lt:wt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(_a)&&t.lt(_a))return Ct(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,u=t.low>>>16,l=t.low&65535,h=0,f=0,d=0,m=0;return m+=o*l,d+=m>>>16,m&=65535,d+=i*l,f+=d>>>16,d&=65535,d+=o*u,f+=d>>>16,d&=65535,f+=r*l,h+=f>>>16,f&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=s*l+r*u+i*c+o*a,h&=65535,P(d<<16|m,h<<16|f,this.unsigned)},_.mul=_.multiply,_.divide=function(t){if(rt(t)||(t=_t(t)),t.isZero())throw Error("division by zero");if(Bt){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?Bt.div_u:Bt.div_s)(this.low,this.high,t.low,t.high);return P(n,Bt.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Lt:wt;var s,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Lt;if(t.gt(this.shru(1)))return wa;i=Lt}else{if(this.eq(lt)){if(t.eq(le)||t.eq(ar))return lt;if(t.eq(lt))return le;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(wt)?t.isNegative()?le:ar:(r=this.sub(t.mul(s)),i=s.add(r.div(t)),i)}else if(t.eq(lt))return this.unsigned?Lt:wt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=wt}for(r=this;r.gte(t);){s=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Pn(2,a-48),u=Ct(s),l=u.mul(t);l.isNegative()||l.gt(r);)s-=c,u=Ct(s,this.unsigned),l=u.mul(t);u.isZero()&&(u=le),i=i.add(u),r=r.sub(l)}return i},_.div=_.divide,_.modulo=function(t){if(rt(t)||(t=_t(t)),Bt){var n=(this.unsigned?Bt.rem_u:Bt.rem_s)(this.low,this.high,t.low,t.high);return P(n,Bt.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return P(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?ya(this.low):ya(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(t){return rt(t)||(t=_t(t)),P(this.low&t.low,this.high&t.high,this.unsigned)},_.or=function(t){return rt(t)||(t=_t(t)),P(this.low|t.low,this.high|t.high,this.unsigned)},_.xor=function(t){return rt(t)||(t=_t(t)),P(this.low^t.low,this.high^t.high,this.unsigned)},_.shiftLeft=function(t){return rt(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):P(0,this.low<<t-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(t){return rt(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):P(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(t){return rt(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?P(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?P(this.high,0,this.unsigned):P(this.high>>>t-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(t){var n;return rt(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?P(this.high,this.low,this.unsigned):t<32?(n=32-t,P(this.low<<t|this.high>>>n,this.high<<t|this.low>>>n,this.unsigned)):(t-=32,n=32-t,P(this.high<<t|this.low>>>n,this.low<<t|this.high>>>n,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(t){var n;return rt(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?P(this.high,this.low,this.unsigned):t<32?(n=32-t,P(this.high<<n|this.low>>>t,this.low<<n|this.high>>>t,this.unsigned)):(t-=32,n=32-t,P(this.low<<n|this.high>>>t,this.high<<n|this.low>>>t,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?P(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:P(this.low,this.high,!0)},_.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},_.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]},H.fromBytes=function(t,n,s){return s?H.fromBytesLE(t,n):H.fromBytesBE(t,n)},H.fromBytesLE=function(t,n){return new H(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},H.fromBytesBE=function(t,n){return new H(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const WA=16;function Ia(e){e==="X"&&(e="");const t=e.padEnd(WA,"0");return H.fromString(t,!0,16)}function XA(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const n=t%4;t=(t-n)/4;const s=t;t*=4;const i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function QA(e,t){const n=qA(e).shiftRightUnsigned(2);return e.add(H.fromNumber(2*t+1-4).multiply(n))}function qA(e){return e.and(e.not().add(1))}const YA=3,$A=2*30+1,Sa=180/Math.PI;function ZA(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),n=parseInt(t[0],10),s=t[1],r=s.length;let i=0;const o=[0,0];for(let a=r-1;a>=0;a--){i=r-a;const c=s[a];let u=0,l=0;c==="1"?l=1:c==="2"?(u=1,l=1):c==="3"&&(u=1);const h=Math.pow(2,i-1);ep(h,o,u,l),o[0]+=h*u,o[1]+=h*l}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:i}}function tp(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<YA+$A;)t="0"+t;const n=t.lastIndexOf("1"),s=t.substring(0,3),r=t.substring(3,n),i=r.length/2,o=H.fromString(s,!0,2).toString(10);let a="";if(i!==0)for(a=H.fromString(r,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function xa(e,t,n){const s=1<<t;return[(e[0]+n[0])/s,(e[1]+n[1])/s]}function Oa(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Fa(e){return[Oa(e[0]),Oa(e[1])]}function va(e,t){let[n,s]=t;switch(e){case 0:return[1,n,s];case 1:return[-n,1,s];case 2:return[-n,-s,1];case 3:return[-1,-s,-n];case 4:return[s,-1,-n];case 5:return[s,n,-1];default:throw new Error("Invalid face")}}function Da(e){let[t,n,s]=e;const r=Math.atan2(s,Math.sqrt(t*t+n*n));return[Math.atan2(n,t)*Sa,r*Sa]}function ep(e,t,n,s){if(s===0){n===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function np(e){const t=xa(e.ij,e.level,[.5,.5]),n=Fa(t),s=va(e.face,n);return Da(s)}const sp=100;function La(e){const{face:t,ij:n,level:s}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(sp*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let u=0;u<4;u++){const l=r[u].slice(0),h=r[u+1],f=(h[0]-l[0])/i,d=(h[1]-l[1])/i;for(let m=0;m<i;m++){l[0]+=f,l[1]+=d;const A=xa(n,s,l),y=Fa(A),E=va(t,y),w=Da(E);Math.abs(w[1])>89.999&&(w[0]=c);const B=w[0]-c;w[0]+=B>180?-360:B<-180?360:0,o[a++]=w[0],o[a++]=w[1],c=w[0]}}return o[a++]=o[0],o[a++]=o[1],o}function cr(e){const t=rp(e);return ZA(t)}function rp(e){if(e.indexOf("/")>0)return e;const t=Ia(e);return tp(t)}function ip(e){const t=cr(e);return np(t)}function op(e){let t;if(e.face===2||e.face===5){let n=null,s=0;for(let r=0;r<4;r++){const i=`${e.face}/${r}`,o=cr(i),a=La(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,s),s+=a.length}t=Ga(n)}else{const n=La(e);t=Ga(n)}return t}function Ga(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],n=[];for(let s=0;s<e.length;s+=2)t.push(e[s]),n.push(e[s+1]);return t.sort((s,r)=>s-r),n.sort((s,r)=>s-r),{west:t[0],east:t[t.length-1],north:n[n.length-1],south:n[0]}}function ap(e,t){const n=(t==null?void 0:t.minimumHeight)||0,s=(t==null?void 0:t.maximumHeight)||0,r=cr(e),i=op(r),o=i.west,a=i.south,c=i.east,u=i.north,l=[];return l.push(new p(o,u,n)),l.push(new p(c,u,n)),l.push(new p(c,a,n)),l.push(new p(o,a,n)),l.push(new p(o,u,s)),l.push(new p(c,u,s)),l.push(new p(c,a,s)),l.push(new p(o,a,s)),l}function Pa(e){const t=e.token,n={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},s=ap(t,n),r=ip(t),i=r[0],o=r[1],a=J.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new p(a[0],a[1],a[2]);s.push(c);const u=Hf(s);return[...u.center,...u.halfAxes]}const cp={QUADTREE:4,OCTREE:8};function up(e,t,n){if(e!=null&&e.box){const s=Ia(e.s2VolumeInfo.token),r=QA(s,t),i=XA(r),o={...e.s2VolumeInfo};switch(o.token=i,n){case"OCTREE":const u=e.s2VolumeInfo,l=u.maximumHeight-u.minimumHeight,h=l/2,f=u.minimumHeight+l/2;u.minimumHeight=f-h,u.maximumHeight=f+h;break}return{box:Pa(o),s2VolumeInfo:o}}}async function Na(e){const{implicitOptions:t,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,s2VolumeBox:r,loaderOptions:i}=e;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=e;const{subdivisionScheme:u,subtreeLevels:l,maximumLevel:h,contentUrlTemplate:f,subtreesUriTemplate:d,basePath:m}=t,A={children:[],lodMetricValue:0,contentUrl:""};if(!h)return Yr.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${f} won't be loaded...`),A;const y=a+c.level;if(y>h)return A;const E=cp[u],w=Math.log2(E),B=s&1,C=s>>1&1,R=s>>2&1,T=(E**a-1)/(E-1);let O=qt(n.mortonIndex,s,w),F=T+O,x=qt(n.x,B,1),v=qt(n.y,C,1),k=qt(n.z,R,1),Q=!1;a>=l&&(Q=ur(o.childSubtreeAvailability,O));const q=qt(c.x,x,a),D=qt(c.y,v,a),it=qt(c.z,k,a);if(Q){const et=`${m}/${d}`,Gt=lr(et,y,q,D,it);o=await ne(Gt,pa,i),c={mortonIndex:O,x,y:v,z:k,level:a},O=0,F=0,x=0,v=0,k=0,a=0}if(!ur(o.tileAvailability,F))return A;ur(o.contentAvailability,F)&&(A.contentUrl=lr(f,y,q,D,it));const Ke=a+1,Jt={mortonIndex:O,x,y:v,z:k};for(let et=0;et<E;et++){const Gt=up(r,et,u),Zt=await Na({subtree:o,implicitOptions:t,loaderOptions:i,parentData:Jt,childIndex:et,level:Ke,globalData:{...c},s2VolumeBox:Gt});if(Zt.contentUrl||Zt.children.length){const ze=y+1,br=lp(Zt,ze,{childTileX:x,childTileY:v,childTileZ:k},t,r);A.children.push(br)}}return A}function ur(e,t){let n;return Array.isArray(e)?(n=e[0],e.length>1&&Yr.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=e,"constant"in n?!!n.constant:n.explicitBitstream?dp(t,n.explicitBitstream):!1}function lp(e,t,n,s,r){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:u,rootLodMetricValue:l,rootBoundingVolume:h}=s,f=e.contentUrl&&e.contentUrl.replace(`${i}/`,""),d=l/2**t,m=r!=null&&r.box?{box:r.box}:h,A=hp(t,m,n);return{children:e.children,contentUrl:e.contentUrl,content:{uri:f},id:e.contentUrl,refine:a(o),type:u(e),lodMetricType:c,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:A}}function hp(e,t,n){if(t.region){const{childTileX:s,childTileY:r,childTileZ:i}=n,[o,a,c,u,l,h]=t.region,f=2**e,d=(c-o)/f,m=(u-a)/f,A=(h-l)/f,[y,E]=[o+d*s,o+d*(s+1)],[w,B]=[a+m*r,a+m*(r+1)],[C,R]=[l+A*i,l+A*(i+1)];return{region:[y,w,E,B,C,R]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${t}`)}function qt(e,t,n){return(e<<n)+t}function lr(e,t,n,s,r){const i=fp({level:t,x:n,y:s,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function fp(e){const t={};for(const n in e)t[`{${n}}`]=e[n];return t}function dp(e,t){const n=Math.floor(e/8),s=e%8;return(t[n]>>s&1)===1}function hr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!t)return zt.EMPTY;const s=t.split("?")[0].split(".").pop();switch(s){case"pnts":return zt.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return zt.SCENEGRAPH;default:return s||zt.EMPTY}}function fr(e){switch(e){case"REPLACE":case"replace":return Dt.REPLACE;case"ADD":case"add":return Dt.ADD;default:return e}}function dr(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const s=new URL(e,`${t}/`);return decodeURI(s.toString())}else if(e.startsWith("/"))return e;return tu(t,e)}function Ua(e,t){if(!e)return null;let n;if(e.content){var s;const i=e.content.uri||((s=e.content)===null||s===void 0?void 0:s.url);typeof i<"u"&&(n=dr(i,t))}return{...e,id:n,contentUrl:n,lodMetricType:En.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:hr(e,n),refine:fr(e.refine)}}async function mp(e,t,n){let s=null;const r=Ja(e.root);r&&e.root?s=await Ha(e.root,e,t,r,n):s=Ua(e.root,t);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},a=o.children||[],c=[];for(const u of a){const l=Ja(u);let h;l?h=await Ha(u,e,t,l,n):h=Ua(u,t),h&&(c.push(h),i.push(h))}o.children=c}return s}async function Ha(e,t,n,s,r){var i,o,a;const{subdivisionScheme:c,maximumLevel:u,availableLevels:l,subtreeLevels:h,subtrees:{uri:f}}=s,d=lr(f,0,0,0,0),m=dr(d,n),A=await ne(m,pa,r),y=(i=e.content)===null||i===void 0?void 0:i.uri,E=y?dr(y,n):"",w=t==null||(o=t.root)===null||o===void 0?void 0:o.refine,B=e.geometricError,C=(a=e.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(C){const F={box:Pa(C),s2VolumeInfo:C};e.boundingVolume=F}const R=e.boundingVolume,T={contentUrlTemplate:E,subtreesUriTemplate:f,subdivisionScheme:c,subtreeLevels:h,maximumLevel:Number.isFinite(l)?l-1:u,refine:w,basePath:n,lodMetricType:En.GEOMETRIC_ERROR,rootLodMetricValue:B,rootBoundingVolume:R,getTileType:hr,getRefine:fr};return await gp(e,n,A,T,r)}async function gp(e,t,n,s,r){if(!e)return null;const{children:i,contentUrl:o}=await Na({subtree:n,implicitOptions:s,loaderOptions:r});let a,c=null;return o&&(a=o,c={uri:o.replace(`${t}/`,"")}),{...e,id:a,contentUrl:a,lodMetricType:En.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:hr(e,a),refine:fr(e.refine),content:c||e.content,children:i}}function Ja(e){var t;return(e==null||(t=e.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const Pe={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:mo,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:Ap,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function Ap(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=t["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(n==null?void 0:n.url)&&n.url.indexOf(".json")!==-1:r=s.isTileset,r?pp(e,t,n):yp(e,t,n)}async function pp(e,t,n){var s;const r=JSON.parse(new TextDecoder().decode(e)),i=(n==null?void 0:n.url)||"",o=Bp(i),a=await mp(r,o,t||{});return{...r,shape:"tileset3d",loader:Pe,url:i,queryString:(n==null?void 0:n.queryString)||"",basePath:o,root:a||r.root,type:pt.TILES3D,lodMetricType:En.GEOMETRIC_ERROR,lodMetricValue:((s=r.root)===null||s===void 0?void 0:s.geometricError)||0}}async function yp(e,t,n){const s={content:{shape:"tile3d",featureIds:null}};return await ga(e,0,t,n,s.content),s.content}function Bp(e){return qn(e)}const Va="https://api.cesium.com/v1/assets";async function Cp(e,t){if(!t){const i=await Ep(e);for(const o of i.items)o.type==="3DTILES"&&(t=o.id)}const n=await Tp(e,t),{type:s,url:r}=n;return U(s==="3DTILES"&&r),n.headers={Authorization:`Bearer ${n.accessToken}`},n}async function Ep(e){U(e);const t=Va,n={Authorization:`Bearer ${e}`},s=await Be(t,{headers:n});if(!s.ok)throw new Error(s.statusText);return await s.json()}async function Tp(e,t){U(e,t);const n={Authorization:`Bearer ${e}`},s=`${Va}/${t}`;let r=await Be(`${s}`,{headers:n});if(!r.ok)throw new Error(r.statusText);let i=await r.json();if(r=await Be(`${s}/endpoint`,{headers:n}),!r.ok)throw new Error(r.statusText);const o=await r.json();return i={...i,...o},i}async function bp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t["cesium-ion"]||{};const{accessToken:n}=t;let s=t.assetId;if(!Number.isFinite(s)){const r=e.match(/\/([0-9]+)\/tileset.json/);s=r&&r[1]}return Cp(n,s)}const ja={...Pe,id:"cesium-ion",name:"Cesium Ion",preload:bp,parse:async(e,t,n)=>(t={...t},t["3d-tiles"]=t["cesium-ion"],t.loader=ja,Pe.parse(e,t,n)),options:{"cesium-ion":{...Pe.options["3d-tiles"],accessToken:null}}},ka=100;class _p{constructor(t,n){if(this.schema=void 0,this.options=void 0,this.shape=void 0,this.length=0,this.rows=null,this.cursor=0,this._headers=[],this.options=n,this.schema=t,!Array.isArray(t)){this._headers=[];for(const s in t)this._headers[t[s].index]=t[s].name}}rowCount(){return this.length}addArrayRow(t,n){Number.isFinite(n)&&(this.cursor=n),this.shape="array-row-table",this.rows=this.rows||new Array(ka),this.rows[this.length]=t,this.length++}addObjectRow(t,n){Number.isFinite(n)&&(this.cursor=n),this.shape="object-row-table",this.rows=this.rows||new Array(ka),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function wp(e,t){if(!e)throw new Error("null row");const n={};if(t)for(let s=0;s<t.length;s++)n[t[s]]=e[s];else for(let s=0;s<e.length;s++){const r=`column-${s}`;n[r]=e[s]}return n}function Rp(e,t){if(!e)throw new Error("null row");if(t){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=e[t[s]];return n}return Object.values(e)}function Mp(e){const t=[];for(let n=0;n<e.length;n++){const s=`column-${n}`;t.push(s)}return t}function Ip(e){return Object.keys(e)}const Ka=100;class Sp{constructor(t,n){if(this.schema=void 0,this.options=void 0,this.length=0,this.objectRows=null,this.arrayRows=null,this.cursor=0,this._headers=null,this.options=n,this.schema=t,t){this._headers=[];for(const s in t)this._headers[t[s].index]=t[s].name}}rowCount(){return this.length}addArrayRow(t,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=Mp(t)),this.options.shape){case"object-row-table":const s=wp(t,this._headers);this.addObjectRow(s,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(Ka),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=Ip(t)),this.options.shape){case"array-row-table":const s=Rp(t,this._headers);this.addArrayRow(s,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(Ka),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const xp=100;class Op{constructor(t,n){this.schema=void 0,this.length=0,this.allocated=0,this.columns={},this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let n=0;for(const s in this.columns)this.columns[s][this.length]=t[n++];this.length++}addObjectRow(t){this._reallocateColumns();for(const n in t)this.columns[n][this.length]=t[n];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const s in this.schema){const r=this.schema[s];t[r.name]=this.columns[r.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:xp,this.columns={};for(const t in this.schema){const n=this.schema[t],s=n.type||Float32Array,r=this.columns[n.index];if(r&&ArrayBuffer.isView(r)){const i=new s(this.allocated);i.set(r),this.columns[n.index]=i}else r?(r.length=this.allocated,this.columns[n.index]=r):this.columns[n.index]=new s(this.allocated)}}}_pruneColumns(){for(const[t,n]of Object.entries(this.columns))this.columns[t]=n.slice(0,this.length)}}const Fp={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},vp="TableBatchBuilder";class Ne{constructor(t,n){this.schema=void 0,this.options=void 0,this.aggregator=null,this.batchCount=0,this.bytesUsed=0,this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),this.totalLength=0,this.totalBytes=0,this.rowBytes=0,this.schema=t,this.options={...Fp,...n}}limitReached(){var t,n;return!!(!((t=this.options)===null||t===void 0)&&t.limit&&this.totalLength>=this.options.limit||!((n=this.options)===null||n===void 0)&&n._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t!=null&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,t),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return Sp;case"columnar-table":return Op;case"arrow-table":if(!Ne.ArrowBatch)throw new Error(vp);return Ne.ArrowBatch;default:return _p}}}Ne.ArrowBatch=void 0;function Dp(e){try{let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return async function*(){const n=new TextDecoder(void 0,t);for await(const s of e)yield typeof s=="string"?s:n.decode(s,{stream:!0})}()}catch(t){return Promise.reject(t)}}const mr=Number.MAX_SAFE_INTEGER;var M=function(e){return e[e.BEGIN=0]="BEGIN",e[e.VALUE=1]="VALUE",e[e.OPEN_OBJECT=2]="OPEN_OBJECT",e[e.CLOSE_OBJECT=3]="CLOSE_OBJECT",e[e.OPEN_ARRAY=4]="OPEN_ARRAY",e[e.CLOSE_ARRAY=5]="CLOSE_ARRAY",e[e.TEXT_ESCAPE=6]="TEXT_ESCAPE",e[e.STRING=7]="STRING",e[e.BACKSLASH=8]="BACKSLASH",e[e.END=9]="END",e[e.OPEN_KEY=10]="OPEN_KEY",e[e.CLOSE_KEY=11]="CLOSE_KEY",e[e.TRUE=12]="TRUE",e[e.TRUE2=13]="TRUE2",e[e.TRUE3=14]="TRUE3",e[e.FALSE=15]="FALSE",e[e.FALSE2=16]="FALSE2",e[e.FALSE3=17]="FALSE3",e[e.FALSE4=18]="FALSE4",e[e.NULL=19]="NULL",e[e.NULL2=20]="NULL2",e[e.NULL3=21]="NULL3",e[e.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",e[e.NUMBER_DIGIT=23]="NUMBER_DIGIT",e}(M||{});const I={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125},za=/[\\"\n]/g,Wa={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class Lp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.options=Wa,this.bufferCheckPosition=mr,this.q="",this.c="",this.p="",this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.error=null,this.state=M.BEGIN,this.stack=[],this.position=0,this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,this.textNode=void 0,this.numberNode=void 0,this.options={...Wa,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return(this.state!==M.VALUE||this.depth!==0)&&this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,n){var s,r;(s=(r=this.options)[t])===null||s===void 0||s.call(r,n,this)}emitNode(t,n){this._closeValue(),this.emit(t,n)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(t===null)return this.end();let n=0,s=t.charCodeAt(0),r=this.p;for(;s&&(r=s,this.c=s=t.charCodeAt(n++),r!==s?this.p=r:r=this.p,!!s);)switch(this.position++,s===I.lineFeed?(this.line++,this.column=0):this.column++,this.state){case M.BEGIN:s===I.openBrace?this.state=M.OPEN_OBJECT:s===I.openBracket?this.state=M.OPEN_ARRAY:Ue(s)||this._error("Non-whitespace before {[.");continue;case M.OPEN_KEY:case M.OPEN_OBJECT:if(Ue(s))continue;if(this.state===M.OPEN_KEY)this.stack.push(M.CLOSE_KEY);else if(s===I.closeBrace){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||M.VALUE;continue}else this.stack.push(M.CLOSE_OBJECT);s===I.doubleQuote?this.state=M.STRING:this._error('Malformed object key should start with "');continue;case M.CLOSE_KEY:case M.CLOSE_OBJECT:if(Ue(s))continue;s===I.colon?(this.state===M.CLOSE_OBJECT?(this.stack.push(M.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=M.VALUE):s===I.closeBrace?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||M.VALUE):s===I.comma?(this.state===M.CLOSE_OBJECT&&this.stack.push(M.CLOSE_OBJECT),this._closeValue(),this.state=M.OPEN_KEY):this._error("Bad object");continue;case M.OPEN_ARRAY:case M.VALUE:if(Ue(s))continue;if(this.state===M.OPEN_ARRAY)if(this.emit("onopenarray"),this.depth++,this.state=M.VALUE,s===I.closeBracket){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||M.VALUE;continue}else this.stack.push(M.CLOSE_ARRAY);s===I.doubleQuote?this.state=M.STRING:s===I.openBrace?this.state=M.OPEN_OBJECT:s===I.openBracket?this.state=M.OPEN_ARRAY:s===I.t?this.state=M.TRUE:s===I.f?this.state=M.FALSE:s===I.n?this.state=M.NULL:s===I.minus?this.numberNode+="-":I._0<=s&&s<=I._9?(this.numberNode+=String.fromCharCode(s),this.state=M.NUMBER_DIGIT):this._error("Bad value");continue;case M.CLOSE_ARRAY:if(s===I.comma)this.stack.push(M.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=M.VALUE;else if(s===I.closeBracket)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||M.VALUE;else{if(Ue(s))continue;this._error("Bad array")}continue;case M.STRING:this.textNode===void 0&&(this.textNode="");let i=n-1,o=this.slashed,a=this.unicodeI;t:for(;;){for(;a>0;)if(this.unicodeS+=String.fromCharCode(s),s=t.charCodeAt(n++),this.position++,a===4?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),a=0,i=n-1):a++,!s)break t;if(s===I.doubleQuote&&!o){this.state=this.stack.pop()||M.VALUE,this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}if(s===I.backslash&&!o&&(o=!0,this.textNode+=t.substring(i,n-1),this.position+=n-1-i,s=t.charCodeAt(n++),this.position++,!s))break;if(o){if(o=!1,s===I.n?this.textNode+=`
`:s===I.r?this.textNode+="\r":s===I.t?this.textNode+="	":s===I.f?this.textNode+="\f":s===I.b?this.textNode+="\b":s===I.u?(a=1,this.unicodeS=""):this.textNode+=String.fromCharCode(s),s=t.charCodeAt(n++),this.position++,i=n-1,s)continue;break}za.lastIndex=n;const c=za.exec(t);if(c===null){n=t.length+1,this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}if(n=c.index+1,s=t.charCodeAt(c.index),!s){this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}}this.slashed=o,this.unicodeI=a;continue;case M.TRUE:s===I.r?this.state=M.TRUE2:this._error(`Invalid true started with t${s}`);continue;case M.TRUE2:s===I.u?this.state=M.TRUE3:this._error(`Invalid true started with tr${s}`);continue;case M.TRUE3:s===I.e?(this.emit("onvalue",!0),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid true started with tru${s}`);continue;case M.FALSE:s===I.a?this.state=M.FALSE2:this._error(`Invalid false started with f${s}`);continue;case M.FALSE2:s===I.l?this.state=M.FALSE3:this._error(`Invalid false started with fa${s}`);continue;case M.FALSE3:s===I.s?this.state=M.FALSE4:this._error(`Invalid false started with fal${s}`);continue;case M.FALSE4:s===I.e?(this.emit("onvalue",!1),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid false started with fals${s}`);continue;case M.NULL:s===I.u?this.state=M.NULL2:this._error(`Invalid null started with n${s}`);continue;case M.NULL2:s===I.l?this.state=M.NULL3:this._error(`Invalid null started with nu${s}`);continue;case M.NULL3:s===I.l?(this.emit("onvalue",null),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid null started with nul${s}`);continue;case M.NUMBER_DECIMAL_POINT:s===I.period?(this.numberNode+=".",this.state=M.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case M.NUMBER_DIGIT:I._0<=s&&s<=I._9?this.numberNode+=String.fromCharCode(s):s===I.period?(this.numberNode.indexOf(".")!==-1&&this._error("Invalid number has two dots"),this.numberNode+="."):s===I.e||s===I.E?((this.numberNode.indexOf("e")!==-1||this.numberNode.indexOf("E")!==-1)&&this._error("Invalid number has two exponential"),this.numberNode+="e"):s===I.plus||s===I.minus?(r===I.e||r===I.E||this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(s)):(this._closeNumber(),n--,this.state=this.stack.pop()||M.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&Gp(this),this.emit("onchunkparsed"),this}_closeValue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"onvalue";this.textNode!==void 0&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this._closeValue(),t+=`
Line: ${this.line}
Column: ${this.column}
Char: ${this.c}`;const n=new Error(t);this.error=n,this.emit("onerror",n)}}function Ue(e){return e===I.carriageReturn||e===I.lineFeed||e===I.space||e===I.tab}function Gp(e){const t=Math.max(mr,10);let n=0;for(const s of["textNode","numberNode"]){const r=e[s]===void 0?0:e[s].length;if(r>t)switch(s){case"text":break;default:e._error(`Max buffer length exceeded: ${s}`)}n=Math.max(n,r)}e.bufferCheckPosition=mr-n+e.position}class Yt{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(this.path=void 0,this.path=["$"],t instanceof Yt){this.path=[...t.path];return}if(Array.isArray(t)){this.path.push(...t);return}if(typeof t=="string"&&(this.path=t.split("."),this.path[0]!=="$"))throw new Error("JSONPaths must start with $")}clone(){return new Yt(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let n=0;n<this.path.length;++n)if(this.path[n]!==t.path[n])return!1;return!0}setFieldAtPath(t,n){const s=[...this.path];s.shift();const r=s.pop();for(const i of s)t=t[i];t[r]=n}getFieldAtPath(t){const n=[...this.path];n.shift();const s=n.pop();for(const r of n)t=t[r];return t[s]}}class Pp{constructor(t){this.parser=void 0,this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new Yt,this.reset(),this.parser=new Lp({onready:()=>{this.jsonpath=new Yt,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:n=>{this._openObject({}),typeof n<"u"&&this.parser.emit("onkey",n)},onkey:n=>{this.jsonpath.set(n),this.currentState.key=n},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:n=>{this._pushOrSet(n)},onerror:n=>{throw n},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new Yt}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:n,key:s}=this.currentState;s!==null?(n[s]=t,this.currentState.key=null):n.push(t)}_openArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}class Np extends Pp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath()){this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],this._openArray(this.streamingArray);return}this._openArray()},onopenobject:s=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),typeof s<"u"&&this.parser.emit("onkey",s)}}),this.jsonPaths=void 0,this.streamingJsonPath=null,this.streamingArray=null,this.topLevelObject=null;const n=t.jsonpaths||[];this.jsonPaths=n.map(s=>new Yt(s))}write(t){super.write(t);let n=[];return this.streamingArray&&(n=[...this.streamingArray],this.streamingArray.length=0),n}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(this.jsonPaths.length===0)return!0;for(const n of this.jsonPaths)if(n.equals(t))return!0;return!1}}async function*Up(e,t){const n=Dp(e),{metadata:s}=t,{jsonpaths:r}=t.json||{};let i=!0;const o=null,a=new Ne(o,t),c=new Np({jsonpaths:r});for await(const f of n){const d=c.write(f),m=d.length>0&&c.getStreamingJsonPathAsString();if(d.length>0&&i){if(s){var u;yield{shape:(t==null||(u=t.json)===null||u===void 0?void 0:u.shape)||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:c.getPartialResult(),jsonpath:m}}i=!1}for(const y of d){a.addRow(y);const E=a.getFullBatch({jsonpath:m});E&&(yield E)}a.chunkComplete(f);const A=a.getFullBatch({jsonpath:m});A&&(yield A)}const l=c.getStreamingJsonPathAsString(),h=a.getFinalBatch({jsonpath:l});h&&(yield h),s&&(yield{shape:"json",batchType:"final-result",container:c.getPartialResult(),jsonpath:c.getStreamingJsonPathAsString(),data:[],length:0})}const Nn={x:0,y:1,z:2};function Xa(e,t={}){const{start:n=0,end:s=e.length,plane:r="xy"}=t,i=t.size||2;let o=0;const a=Nn[r[0]],c=Nn[r[1]];for(let u=n,l=s-i;u<s;u+=i)o+=(e[u+a]-e[l+a])*(e[u+c]+e[l+c]),l=u;return o/2}function Hp(e,t,n=2,s,r="xy"){const i=t&&t.length,o=i?t[0]*n:e.length;let a=Qa(e,0,o,n,!0,s&&s[0],r);const c=[];if(!a||a.next===a.prev)return c;let u,l,h,f,d,m,A;if(i&&(a=Kp(e,t,a,n,s,r)),e.length>80*n){f=l=e[0],d=h=e[1];for(let y=n;y<o;y+=n)m=e[y],A=e[y+1],m<f&&(f=m),A<d&&(d=A),m>l&&(l=m),A>h&&(h=A);u=Math.max(l-f,h-d),u=u!==0?32767/u:0}return He(a,c,n,f,d,u,0),c}function Qa(e,t,n,s,r,i,o){let a,c;i===void 0&&(i=Xa(e,{start:t,end:n,size:s,plane:o}));let u=Nn[o[0]],l=Nn[o[1]];if(r===i<0)for(a=t;a<n;a+=s)c=$a(a,e[a+u],e[a+l],c);else for(a=n-s;a>=t;a-=s)c=$a(a,e[a+u],e[a+l],c);return c&&Un(c,c.next)&&(Ve(c),c=c.next),c}function $t(e,t){if(!e)return e;t||(t=e);let n=e,s;do if(s=!1,!n.steiner&&(Un(n,n.next)||K(n.prev,n,n.next)===0)){if(Ve(n),n=t=n.prev,n===n.next)break;s=!0}else n=n.next;while(s||n!==t);return t}function He(e,t,n,s,r,i,o){if(!e)return;!o&&i&&qp(e,s,r,i);let a=e,c,u;for(;e.prev!==e.next;){if(c=e.prev,u=e.next,i?Vp(e,s,r,i):Jp(e)){t.push(c.i/n|0),t.push(e.i/n|0),t.push(u.i/n|0),Ve(e),e=u.next,a=u.next;continue}if(e=u,e===a){o?o===1?(e=jp($t(e),t,n),He(e,t,n,s,r,i,2)):o===2&&kp(e,t,n,s,r,i):He($t(e),t,n,s,r,i,1);break}}}function Jp(e){const t=e.prev,n=e,s=e.next;if(K(t,n,s)>=0)return!1;const r=t.x,i=n.x,o=s.x,a=t.y,c=n.y,u=s.y,l=r<i?r<o?r:o:i<o?i:o,h=a<c?a<u?a:u:c<u?c:u,f=r>i?r>o?r:o:i>o?i:o,d=a>c?a>u?a:u:c>u?c:u;let m=s.next;for(;m!==t;){if(m.x>=l&&m.x<=f&&m.y>=h&&m.y<=d&&he(r,a,i,c,o,u,m.x,m.y)&&K(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Vp(e,t,n,s){const r=e.prev,i=e,o=e.next;if(K(r,i,o)>=0)return!1;const a=r.x,c=i.x,u=o.x,l=r.y,h=i.y,f=o.y,d=a<c?a<u?a:u:c<u?c:u,m=l<h?l<f?l:f:h<f?h:f,A=a>c?a>u?a:u:c>u?c:u,y=l>h?l>f?l:f:h>f?h:f,E=gr(d,m,t,n,s),w=gr(A,y,t,n,s);let B=e.prevZ,C=e.nextZ;for(;B&&B.z>=E&&C&&C.z<=w;){if(B.x>=d&&B.x<=A&&B.y>=m&&B.y<=y&&B!==r&&B!==o&&he(a,l,c,h,u,f,B.x,B.y)&&K(B.prev,B,B.next)>=0||(B=B.prevZ,C.x>=d&&C.x<=A&&C.y>=m&&C.y<=y&&C!==r&&C!==o&&he(a,l,c,h,u,f,C.x,C.y)&&K(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;B&&B.z>=E;){if(B.x>=d&&B.x<=A&&B.y>=m&&B.y<=y&&B!==r&&B!==o&&he(a,l,c,h,u,f,B.x,B.y)&&K(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;C&&C.z<=w;){if(C.x>=d&&C.x<=A&&C.y>=m&&C.y<=y&&C!==r&&C!==o&&he(a,l,c,h,u,f,C.x,C.y)&&K(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function jp(e,t,n){let s=e;do{const r=s.prev,i=s.next.next;!Un(r,i)&&qa(r,s,s.next,i)&&Je(r,i)&&Je(i,r)&&(t.push(r.i/n|0),t.push(s.i/n|0),t.push(i.i/n|0),Ve(s),Ve(s.next),s=e=i),s=s.next}while(s!==e);return $t(s)}function kp(e,t,n,s,r,i){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&Zp(o,a)){let c=Ya(o,a);o=$t(o,o.next),c=$t(c,c.next),He(o,t,n,s,r,i,0),He(c,t,n,s,r,i,0);return}a=a.next}o=o.next}while(o!==e)}function Kp(e,t,n,s,r,i){const o=[];let a,c,u,l,h;for(a=0,c=t.length;a<c;a++)u=t[a]*s,l=a<c-1?t[a+1]*s:e.length,h=Qa(e,u,l,s,!1,r&&r[a+1],i),h===h.next&&(h.steiner=!0),o.push($p(h));for(o.sort(zp),a=0;a<o.length;a++)n=Wp(o[a],n);return n}function zp(e,t){return e.x-t.x}function Wp(e,t){const n=Xp(e,t);if(!n)return t;const s=Ya(n,e);return $t(s,s.next),$t(n,n.next)}function Xp(e,t){let n=t;const s=e.x,r=e.y;let i=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const f=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=s&&f>i&&(i=f,o=n.x<n.next.x?n:n.next,f===s))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,c=o.x,u=o.y;let l=1/0,h;n=o;do s>=n.x&&n.x>=c&&s!==n.x&&he(r<u?s:i,r,c,u,r<u?i:s,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(s-n.x),Je(n,e)&&(h<l||h===l&&(n.x>o.x||n.x===o.x&&Qp(o,n)))&&(o=n,l=h)),n=n.next;while(n!==a);return o}function Qp(e,t){return K(e.prev,e,t.prev)<0&&K(t.next,e,e.next)<0}function qp(e,t,n,s){let r=e;do r.z===0&&(r.z=gr(r.x,r.y,t,n,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,Yp(r)}function Yp(e){let t,n,s=1,r,i,o,a,c,u;do{for(i=e,e=null,u=null,r=0;i;){for(r++,a=i,o=0,n=0;n<s&&(o++,a=a.nextZ,!!a);n++);for(c=s;o>0||c>0&&a;)o!==0&&(c===0||!a||i.z<=a.z)?(t=i,i=i.nextZ,o--):(t=a,a=a.nextZ,c--),u?u.nextZ=t:e=t,t.prevZ=u,u=t;i=a}u.nextZ=null,s*=2}while(r>1);return e}function gr(e,t,n,s,r){return e=(e-n)*r|0,t=(t-s)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function $p(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function he(e,t,n,s,r,i,o,a){return(r-o)*(t-a)>=(e-o)*(i-a)&&(e-o)*(s-a)>=(n-o)*(t-a)&&(n-o)*(i-a)>=(r-o)*(s-a)}function Zp(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!ty(e,t)&&(Je(e,t)&&Je(t,e)&&ey(e,t)&&(K(e.prev,e,t.prev)||K(e,t.prev,t))||Un(e,t)&&K(e.prev,e,e.next)>0&&K(t.prev,t,t.next)>0)}function K(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Un(e,t){return e.x===t.x&&e.y===t.y}function qa(e,t,n,s){const r=Jn(K(e,t,n)),i=Jn(K(e,t,s)),o=Jn(K(n,s,e)),a=Jn(K(n,s,t));return!!(r!==i&&o!==a||r===0&&Hn(e,n,t)||i===0&&Hn(e,s,t)||o===0&&Hn(n,e,s)||a===0&&Hn(n,t,s))}function Hn(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Jn(e){return e>0?1:e<0?-1:0}function ty(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&qa(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function Je(e,t){return K(e.prev,e,e.next)<0?K(e,t,e.next)>=0&&K(e,e.prev,t)>=0:K(e,t,e.prev)<0||K(e,e.next,t)<0}function ey(e,t){let n=e,s=!1;const r=(e.x+t.x)/2,i=(e.y+t.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&r<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==e);return s}function Ya(e,t){const n=new Ar(e.i,e.x,e.y),s=new Ar(t.i,t.x,t.y),r=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,s.next=n,n.prev=s,i.next=s,s.prev=i,s}function $a(e,t,n,s){const r=new Ar(e,t,n);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Ve(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}class Ar{constructor(t,n,s){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=n,this.y=s}}function ny(e,t,n){const s=sy(e),r=Object.keys(s).filter(i=>s[i]!==Array);return ry(e,{propArrayTypes:s,...t},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function sy(e){const t={};for(const n of e)if(n.properties)for(const s in n.properties){const r=n.properties[s];t[s]=ly(r,t[s])}return t}function ry(e,t,n){const{pointPositionsCount:s,pointFeaturesCount:r,linePositionsCount:i,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:u,polygonRingsCount:l,polygonFeaturesCount:h,propArrayTypes:f,coordLength:d}=t,{numericPropKeys:m=[],PositionDataType:A=Float32Array,triangulate:y=!0}=n,E=e[0]&&"id"in e[0],w=e.length>65535?Uint32Array:Uint16Array,B={type:"Point",positions:new A(s*d),globalFeatureIds:new w(s),featureIds:r>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},C={type:"LineString",pathIndices:i>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new A(i*d),globalFeatureIds:new w(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},R={type:"Polygon",polygonIndices:c>65535?new Uint32Array(u+1):new Uint16Array(u+1),primitivePolygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),positions:new A(c*d),globalFeatureIds:new w(c),featureIds:h>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[],fields:[]};y&&(R.triangles=[]);for(const O of[B,C,R])for(const F of m){const x=f[F];O.numericProps[F]=new x(O.positions.length/d)}C.pathIndices[o]=i,R.polygonIndices[u]=c,R.primitivePolygonIndices[l]=c;const T={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const O of e){const F=O.geometry,x=O.properties||{};switch(F.type){case"Point":iy(F,B,T,d,x),B.properties.push(Br(x,m)),E&&B.fields.push({id:O.id}),T.pointFeature++;break;case"LineString":oy(F,C,T,d,x),C.properties.push(Br(x,m)),E&&C.fields.push({id:O.id}),T.lineFeature++;break;case"Polygon":ay(F,R,T,d,x),R.properties.push(Br(x,m)),E&&R.fields.push({id:O.id}),T.polygonFeature++;break;default:throw new Error("Invalid geometry type")}T.feature++}return uy(B,C,R,d)}function iy(e,t,n,s,r){t.positions.set(e.data,n.pointPosition*s);const i=e.data.length/s;yr(t,r,n.pointPosition,i),t.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+i),t.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+i),n.pointPosition+=i}function oy(e,t,n,s,r){t.positions.set(e.data,n.linePosition*s);const i=e.data.length/s;yr(t,r,n.linePosition,i),t.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+i),t.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+i);for(let o=0,a=e.indices.length;o<a;++o){const c=e.indices[o],u=o===a-1?e.data.length:e.indices[o+1];t.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(u-c)/s}}function ay(e,t,n,s,r){t.positions.set(e.data,n.polygonPosition*s);const i=e.data.length/s;yr(t,r,n.polygonPosition,i),t.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+i),t.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+i);for(let o=0,a=e.indices.length;o<a;++o){const c=n.polygonPosition;t.polygonIndices[n.polygonObject++]=c;const u=e.areas[o],l=e.indices[o],h=e.indices[o+1];for(let d=0,m=l.length;d<m;++d){const A=l[d],y=d===m-1?h===void 0?e.data.length:h[0]:l[d+1];t.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(y-A)/s}const f=n.polygonPosition;cy(t,u,l,{startPosition:c,endPosition:f,coordLength:s})}}function cy(e,t,n,s){let{startPosition:r,endPosition:i,coordLength:o}=s;if(!e.triangles)return;const a=r*o,c=i*o,u=e.positions.subarray(a,c),l=n[0],h=n.slice(1).map(d=>(d-l)/o),f=Hp(u,h,o,t);for(let d=0,m=f.length;d<m;++d)e.triangles.push(r+f[d])}function pr(e,t){const n={};for(const s in e)n[s]={value:e[s],size:t};return n}function uy(e,t,n,s){const r={shape:"binary-feature-collection",points:{...e,positions:{value:e.positions,size:s},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:pr(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:s},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:pr(t.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:s},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:pr(n.numericProps,1)}};return r.polygons&&n.triangles&&(r.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),r}function yr(e,t,n,s){for(const r in e.numericProps)if(r in t){const i=t[r];e.numericProps[r].fill(i,n,n+s)}}function Br(e,t){const n={};for(const s in e)t.includes(s)||(n[s]=e[s]);return n}function ly(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function hy(e){let t=0,n=0,s=0,r=0,i=0,o=0,a=0,c=0,u=0;const l=new Set;for(const h of e){const f=h.geometry;switch(f.type){case"Point":n++,t++,l.add(f.coordinates.length);break;case"MultiPoint":n++,t+=f.coordinates.length;for(const m of f.coordinates)l.add(m.length);break;case"LineString":i++,s+=f.coordinates.length,r++;for(const m of f.coordinates)l.add(m.length);break;case"MultiLineString":i++;for(const m of f.coordinates){s+=m.length,r++;for(const A of m)l.add(A.length)}break;case"Polygon":u++,a++,c+=f.coordinates.length;const d=f.coordinates.flat();o+=d.length;for(const m of d)l.add(m.length);break;case"MultiPolygon":u++;for(const m of f.coordinates){a++,c+=m.length;const A=m.flat();o+=A.length;for(const y of A)l.add(y.length)}break;default:throw new Error(`Unsupported geometry type: ${f.type}`)}}return{coordLength:l.size>0?Math.max(...l):2,pointPositionsCount:t,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:r,lineFeaturesCount:i,polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:c,polygonFeaturesCount:u}}function fy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{coordLength:2,fixRingWinding:!0};return e.map(n=>dy(n,t))}function Za(e,t,n,s){n.push(t.length),t.push(...e);for(let r=e.length;r<s.coordLength;r++)t.push(0)}function Cr(e,t,n,s){n.push(t.length);for(const r of e){t.push(...r);for(let i=r.length;i<s.coordLength;i++)t.push(0)}}function tc(e,t,n,s,r){let i=0;const o=[],a=[];for(const c of e){const u=c.map(f=>f.slice(0,2));let l=Xa(u.flat());const h=l<0;r.fixRingWinding&&(i===0&&!h||i>0&&h)&&(c.reverse(),l=-l),o.push(l),Cr(c,t,a,r),i++}i>0&&(s.push(o),n.push(a))}function dy(e,t){const{geometry:n}=e;if(n.type==="GeometryCollection")throw new Error("GeometryCollection type not supported");const s=[],r=[];let i,o;switch(n.type){case"Point":o="Point",Za(n.coordinates,s,r,t);break;case"MultiPoint":o="Point",n.coordinates.map(a=>Za(a,s,r,t));break;case"LineString":o="LineString",Cr(n.coordinates,s,r,t);break;case"MultiLineString":o="LineString",n.coordinates.map(a=>Cr(a,s,r,t));break;case"Polygon":o="Polygon",i=[],tc(n.coordinates,s,r,i,t);break;case"MultiPolygon":o="Polygon",i=[],n.coordinates.map(a=>tc(a,s,r,i,t));break;default:throw new Error(`Unknown type: ${o}`)}return{...e,geometry:{type:o,indices:r,data:s,areas:i}}}function ec(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{fixRingWinding:!0,triangulate:!0};const n=hy(e),s=n.coordLength,{fixRingWinding:r}=t,i=fy(e,{coordLength:s,fixRingWinding:r});return ny(i,n,{numericPropKeys:t.numericPropKeys,PositionDataType:t.PositionDataType||Float32Array,triangulate:t.triangulate})}const je={...{name:"GeoJSON",id:"geojson",module:"geojson",version:"4.1.4",worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"object-row-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}}},parse:my,parseTextSync:nc,parseInBatches:gy};async function my(e,t){return nc(new TextDecoder().decode(e),t)}function nc(e,t){var n;t={...je.options,...t},t.geojson={...je.options.geojson,...t.geojson},t.gis=t.gis||{};let s;try{s=JSON.parse(e)}catch{s={}}const r={shape:"geojson-table",type:"FeatureCollection",features:((n=s)===null||n===void 0?void 0:n.features)||[]};switch(t.gis.format){case"binary":return ec(r.features);default:return r}}function gy(e,t){t={...je.options,...t},t.json={...je.options.geojson,...t.geojson};const n=Up(e,t);switch(t.gis.format){case"binary":return Ay(n);default:return n}}async function*Ay(e){for await(const t of e)t.data=ec(t.data),yield t}function py(e){let t=0;for(const s in e.attributes){const r=e.getAttribute(s);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function sc(e){const n=document.createElement("canvas");n.width=64,n.height=64;const s=n.getContext("2d");s.rect(0,0,64,64);const r=s.createLinearGradient(0,0,64,64);for(let o=0;o<e.length;o++){const a=e[o];r.addColorStop(a[0],"#"+a[1].getHexString())}s.fillStyle=r,s.fill();const i=new g.CanvasTexture(n);return i.needsUpdate=!0,i.minFilter=g.LinearFilter,i.wrapS=g.RepeatWrapping,i.wrapT=g.RepeatWrapping,i.repeat.set(2,2),i}function rc(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const t=new g.Frustum;return t.setFromProjectionMatrix(new g.Matrix4().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),t}function yy(e){const t=new g.Group,n=new g.PlaneGeometry(10,5),s=new g.Vector3(...e.projectPointOntoPlane([0,0,0])),r=new g.Vector3(e.normal.x,e.normal.y,e.normal.z),i=new g.Vector3().copy(s).add(r);n.lookAt(i),n.translate(s.x,s.y,s.z);const o=new g.MeshBasicMaterial({color:65535,side:g.DoubleSide}),a=new g.Mesh(n,o),c=new g.ArrowHelper(r,s,5,16776960);return t.add(c),t.add(a),t}function ic(e){const{boundingVolume:t}=e;let n=0;e.content&&(n=Math.min(e.content.byteLength/5e5,1));const s=new g.Color(n,1,0),r=new g.BoxGeometry(1,1,1),i=new g.Matrix4;t.halfAxes?i.copy(oc(t.halfAxes)):t.radius&&r.scale(t.radius*2,t.radius*2,t.radius*2),r.applyMatrix4(i);const o=new g.EdgesGeometry(r),a=new g.LineSegments(o,new g.LineBasicMaterial({color:s}));return a.position.copy(new g.Vector3(...t.center)),a}function oc(e){const t=e;return new g.Matrix4().fromArray([t[0]*2,t[1]*2,t[2]*2,0,t[3]*2,t[4]*2,t[5]*2,0,t[6]*2,t[7]*2,t[8]*2,0,0,0,0,1])}function By(e,t){const r=2*Math.PI*6378137/2,i=t*r/180;let o=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return o=o*r/180,new g.Vector2(i,o)}function Cy(e){let t=0;if(e.userData.mimeType=="image/ktx2"&&e.mipmaps){for(let n=0;n<e.mipmaps.length;n++)t+=e.mipmaps[n].data.byteLength;return t}else if(e.image){const{image:n}=e,s=4;let r=[n.width,n.height];for(;r[0]>1||r[1]>1;)t+=r[0]*r[1]*s,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return t+=1*1*s,t}else return}function ac(e){return py(e)}const cc={SPECTRAL:[[0,new g.Color(.3686,.3098,.6353)],[.1,new g.Color(.1961,.5333,.7412)],[.2,new g.Color(.4,.7608,.6471)],[.3,new g.Color(.6706,.8667,.6431)],[.4,new g.Color(.902,.9608,.5961)],[.5,new g.Color(1,1,.749)],[.6,new g.Color(.9961,.8784,.5451)],[.7,new g.Color(.9922,.6824,.3804)],[.8,new g.Color(.9569,.4275,.2627)],[.9,new g.Color(.8353,.2431,.3098)],[1,new g.Color(.6196,.0039,.2588)]],PLASMA:[[0,new g.Color(.241,.015,.61)],[.1,new g.Color(.387,.001,.654)],[.2,new g.Color(.524,.025,.653)],[.3,new g.Color(.651,.125,.596)],[.4,new g.Color(.752,.227,.513)],[.5,new g.Color(.837,.329,.431)],[.6,new g.Color(.907,.435,.353)],[.7,new g.Color(.963,.554,.272)],[.8,new g.Color(.992,.681,.195)],[.9,new g.Color(.987,.822,.144)],[1,new g.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new g.Color(.1647,.2824,.3451)],[.1,new g.Color(.1338,.3555,.4227)],[.2,new g.Color(.061,.4319,.4864)],[.3,new g.Color(0,.5099,.5319)],[.4,new g.Color(0,.5881,.5569)],[.5,new g.Color(.137,.665,.5614)],[.6,new g.Color(.2906,.7395,.5477)],[.7,new g.Color(.4453,.8099,.5201)],[.8,new g.Color(.6102,.8748,.485)],[.9,new g.Color(.7883,.9323,.4514)],[1,new g.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new g.Color(.267,.005,.329)],[.1,new g.Color(.283,.141,.458)],[.2,new g.Color(.254,.265,.53)],[.3,new g.Color(.207,.372,.553)],[.4,new g.Color(.164,.471,.558)],[.5,new g.Color(.128,.567,.551)],[.6,new g.Color(.135,.659,.518)],[.7,new g.Color(.267,.749,.441)],[.8,new g.Color(.478,.821,.318)],[.9,new g.Color(.741,.873,.15)],[1,new g.Color(.993,.906,.144)]],INFERNO:[[0,new g.Color(.077,.042,.206)],[.1,new g.Color(.225,.036,.388)],[.2,new g.Color(.373,.074,.432)],[.3,new g.Color(.522,.128,.42)],[.4,new g.Color(.665,.182,.37)],[.5,new g.Color(.797,.255,.287)],[.6,new g.Color(.902,.364,.184)],[.7,new g.Color(.969,.516,.063)],[.8,new g.Color(.988,.683,.072)],[.9,new g.Color(.961,.859,.298)],[1,new g.Color(.988,.998,.645)]],GRAYSCALE:[[0,new g.Color(0,0,0)],[1,new g.Color(1,1,1)]],TURBO:[[0,new g.Color(.18995,.07176,.23217)],[.07,new g.Color(.25107,.25237,.63374)],[.13,new g.Color(.27628,.42118,.89123)],[.2,new g.Color(.25862,.57958,.99876)],[.27,new g.Color(.15844,.73551,.92305)],[.33,new g.Color(.09267,.86554,.7623)],[.4,new g.Color(.19659,.94901,.59466)],[.47,new g.Color(.42778,.99419,.38575)],[.53,new g.Color(.64362,.98999,.23356)],[.6,new g.Color(.80473,.92452,.20459)],[.67,new g.Color(.93301,.81236,.22667)],[.73,new g.Color(.99314,.67408,.20348)],[.8,new g.Color(.9836,.49291,.12849)],[.87,new g.Color(.92105,.31489,.05475)],[.93,new g.Color(.81608,.18462,.01809)],[1,new g.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new g.Color(.278,0,.714)],[1/6,new g.Color(0,0,1)],[2/6,new g.Color(0,1,1)],[3/6,new g.Color(0,1,0)],[4/6,new g.Color(1,1,0)],[5/6,new g.Color(1,.64,0)],[1,new g.Color(1,0,0)]],CONTOUR:[[0,new g.Color(0,0,0)],[.03,new g.Color(0,0,0)],[.04,new g.Color(1,1,1)],[1,new g.Color(1,1,1)]]},Ey=`
  varying vec3 vColor;
  uniform float alpha;

  void main() {
    if (vColor == vec3(0.0, 0.0, 0.0)) {
      discard;
    } else {
      gl_FragColor = vec4( vColor, alpha);
    }
  }
`,Ty=`
  varying vec3 vColor;
  uniform sampler2D gradient;
  uniform sampler2D grayscale;
  attribute float intensity;
  attribute float classification;
  uniform vec3 rootCenter;
  uniform vec3 rootNormal;
  uniform vec2 elevationRange;
  uniform int coloring;
  uniform bool hideGround;
  uniform float maxIntensity;
  uniform float intensityContrast;
  uniform float pointSize;

  #ifdef USE_COLOR
  vec3 getRGB() {
      vec3 rgb = color;
      return rgb;
  }
  #endif

  vec3 getElevation(){
    vec4 world = modelMatrix * vec4( position, 1.0 );
    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));
    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);
    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;

    return cElevation;
  }

  vec3 getIntensity(){
    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs
    float intmod = pow(intensity, intensityContrast);
    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;
    return cIntensity;
  }

  vec3 getClassification(){
    float classNormalized = classification / 255.0;
    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;
    return cClassification;
  }

  vec3 getColor(){
      vec3 color;
      if (hideGround && classification == 2.0) {
         return vec3(0.0, 0.0, 0.0);               
      }

      if (coloring == 1) {
        color = getIntensity();
      }
      else if (coloring == 2) {
        color = getClassification();
      } else if (coloring == 3) {
        color = getElevation();
      } 
      #ifdef USE_COLOR
      else if (coloring == 4) {
        color = getRGB();
      }
      #endif
      else {
        color = vec3(1.0, 1.0, 1.0);
      }
      return color;
  }

  void main() {
      vColor = getColor();

      gl_PointSize = pointSize;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
`;var Er=(e=>(e[e.Intensity=1]="Intensity",e[e.Classification=2]="Classification",e[e.Elevation=3]="Elevation",e[e.RGB=4]="RGB",e[e.White=5]="White",e))(Er||{}),ke=(e=>(e[e.FlatTexture=1]="FlatTexture",e[e.ShadedTexture=2]="ShadedTexture",e[e.ShadedNoTexture=3]="ShadedNoTexture",e))(ke||{});const by=cc.RAINBOW,_y=typeof document<"u"?sc(by):null,wy=cc.GRAYSCALE,Ry=typeof document<"u"?sc(wy):null,My={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,memoryAdjustedScreenSpaceError:!0,maximumMemoryUsage:400,memoryCacheOverflow:128,viewDistanceScale:1,skipLevelOfDetail:!1,resetTransform:!1,updateTransforms:!0,shading:ke.FlatTexture,transparent:!1,pointCloudColoring:Er.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,gltfLoader:null,basisTranscoderPath:null,dracoDecoderPath:null,material:null,contentPostProcess:void 0,preloadTilesCount:null,collectAttributions:!1};class Iy{static async load(t){const n={...My,...t.options},{url:s}=t,r=n.updateInterval,i=5,o={};if(n.cesiumIONToken){o["cesium-ion"]={accessToken:n.cesiumIONToken};const b=await ja.preload(s,o);o.fetch={headers:b.headers}}n.googleApiKey&&(o.fetch={headers:{"X-GOOG-API-KEY":n.googleApiKey}},t.options.hasOwnProperty("collectAttributions")||(n.collectAttributions=!0)),t.loadingManager&&t.loadingManager.itemStart(s);const a=await ne(s,Pe,{...o}),c={},u={},l=[],h=new g.Group,f=new g.Group;n.debug||(f.visible=!1);const d={pointSize:{type:"f",value:n.pointSize},gradient:{type:"t",value:_y},grayscale:{type:"t",value:Ry},rootCenter:{type:"vec3",value:new g.Vector3},rootNormal:{type:"vec3",value:new g.Vector3},coloring:{type:"i",value:n.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new g.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},m=new g.ShaderMaterial({uniforms:d,vertexShader:Ty,fragmentShader:Ey,transparent:n.transparent,vertexColors:!0});let A=null,y=new g.Vector2,E,w,B;n.gltfLoader?E=n.gltfLoader:(E=new fc.GLTFLoader,n.basisTranscoderPath&&(w=new mc.KTX2Loader,w.detectSupport(t.renderer),w.setTranscoderPath(n.basisTranscoderPath+"/"),w.setWorkerLimit(1),E.setKTX2Loader(w)),n.dracoDecoderPath&&(B=new dc.DRACOLoader,B.setDecoderPath(n.dracoDecoderPath+"/"),B.setWorkerLimit(n.maxConcurrency),E.setDRACOLoader(B)));const C=new g.MeshBasicMaterial({transparent:n.transparent}),R={maximumMemoryUsage:n.maximumMemoryUsage,maximumScreenSpaceError:n.maximumScreenSpaceError,memoryAdjustedScreenSpaceError:n.memoryAdjustedScreenSpaceError,memoryCacheOverflow:n.memoryCacheOverflow,viewDistanceScale:n.viewDistanceScale,skipLevelOfDetail:n.skipLevelOfDetail,updateTransforms:n.updateTransforms,throttleRequests:n.throttleRequests,maxRequests:n.maxRequests,contentLoader:async b=>{let L=null;switch(b.type){case zt.POINTCLOUD:{L=xy(b,m,n,Gt);break}case zt.SCENEGRAPH:case zt.MESH:{L=await Sy(E,b,C,n,Gt);break}}if(L&&(L.visible=!1,c[b.id]=L,h.add(c[b.id]),n.debug)){const W=ic(b);f.add(W),u[b.id]=W}},onTileLoad:async b=>{T&&(n.resetTransform&&!v&&(b==null?void 0:b.depth)<=i&&Zt(b),de=!0)},onTileUnload:b=>{l.push(b)},onTileError:(b,L)=>{console.error("Tile error",b.id,L)},onTraversalComplete(b){return n.collectAttributions&&(k=Fy(b)),b}},T=new Ad(a,{...R,loadOptions:{...o,maxConcurrency:n.maxConcurrency,worker:n.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}}}),O=new g.Matrix4,F=new g.Matrix4,x=new g.Vector3;let v=!1,k="";if(T.root.boundingVolume?(T.root.header.boundingVolume.region&&console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."),F.setPosition(T.root.boundingVolume.center[0],T.root.boundingVolume.center[1],T.root.boundingVolume.center[2])):console.warn("Bounding volume not found, no transformations applied"),n.debug){const b=ic(T.root);f.add(b),u[T.root.id]=b}let Q=!1,q=!1;d.rootCenter.value.copy(x),d.rootNormal.value.copy(new g.Vector3(0,0,1).normalize()),T.stats.get("Loader concurrency").count=n.maxConcurrency,T.stats.get("Maximum mem usage").count=n.maximumMemoryUsage;let D=0,it=null,fe=null,de=!1;const Ke=new g.Vector3(1/0,1/0,1/0);let Jt=null;h.updateMatrixWorld(!0);const et=new g.Matrix4().copy(h.matrixWorld),Gt=new g.Matrix4().copy(et).invert();n.resetTransform&&Zt(T.root),n.debug&&(u[T.root.id].applyMatrix4(O),f.matrixWorld.copy(h.matrixWorld));function Zt(b){if(!b.boundingVolume.halfAxes)return;const L=b.boundingVolume.halfAxes,W=new g.Matrix4().extractRotation(oc(L)).premultiply(new g.Matrix4().extractRotation(Gt));if(!new g.Euler().setFromRotationMatrix(W).equals(new g.Euler)){v=!0;const Rt=new g.Vector3(F.elements[12],F.elements[13],F.elements[14]);F.extractRotation(W),F.setPosition(Rt)}ze()}function ze(){O.copy(et),n.resetTransform&&O.multiply(new g.Matrix4().copy(F).invert()),T.modelMatrix=new V(O.toArray())}function Vn(b,L,W,Z){if(Q||!Z)return;(!Jt||Z.aspect!=fe)&&(Jt=new yn({fov:Z.fov/180*Math.PI,aspectRatio:Z.aspect,near:Z.near,far:Z.far}).sseDenominator,fe=Z.aspect,n.debug&&console.log("Updated sse denonimator:",Jt));const _r=rc(Z).planes.map(Y=>new tt(Y.normal.toArray(),Y.constant)),vy=new ot(_r),lc={camera:{position:Ke.toArray()},height:W,frameNumber:b._frameNumber,sseDenominator:Jt,cullingVolume:vy,viewport:{id:0}};b._cache.reset(),b._traverser.traverse(b.root,lc,b.options);for(const Y of b.tiles)Y.selected?L[Y.id]?L[Y.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",Y.id):L[Y.id]&&(L[Y.id].visible=!1);for(;l.length>0;){const Y=l.pop();L[Y.id]&&Y.contentState==at.UNLOADED&&(h.remove(L[Y.id]),Tr(L[Y.id]),delete L[Y.id]),u[Y.id]&&(Tr(u[Y.id]),f.remove(u[Y.id]),delete u[Y.id])}const wr=b.stats.get("Tiles Loaded").count,hc=b.stats.get("Tiles Loading").count;return t.onProgress&&t.onProgress(wr,wr+hc),t.loadingManager&&!q&&hc==0&&(n.preloadTilesCount==null||wr>=n.preloadTilesCount)&&(q=!0,t.loadingManager.itemEnd(t.url)),lc}function br(b){const L=new g.Vector3,W=new g.Quaternion,Z=new g.Vector3;b.decompose(L,W,Z),h.position.copy(L),h.quaternion.copy(W),h.scale.copy(Z),h.updateMatrix(),h.updateMatrixWorld(!0),et.copy(h.matrixWorld),Gt.copy(et).invert(),ze()}return{model:h,runtime:{getTileset:()=>T,getStats:()=>T.stats,getDataAttributions:()=>k,showTiles:b=>{f.visible=b},setWireframe:b=>{n.wireframe=b,h.traverse(L=>{L instanceof g.Mesh&&(L.material.wireframe=b)})},setDebug:b=>{n.debug=b,f.visible=b},setShading:b=>{n.shading=b},getTileBoxes:()=>f,setViewDistanceScale:b=>{T.options.viewDistanceScale=b,T._frameNumber++,Vn(T,c,y.y,A)},setMaximumScreenSpaceError:b=>{T.options.maximumScreenSpaceError=b,T._frameNumber++,Vn(T,c,y.y,A)},setHideGround:b=>{d.hideGround.value=b},setPointCloudColoring:b=>{d.coloring.value=b},setElevationRange:b=>{d.elevationRange.value.set(b[0],b[1])},setMaxIntensity:b=>{d.maxIntensity.value=b},setIntensityContrast:b=>{d.intensityContrast.value=b},setPointAlpha:b=>{d.alpha.value=b},getLatLongHeightFromPosition:b=>{const L=T.ellipsoid.cartesianToCartographic(new g.Vector3().copy(b).applyMatrix4(new g.Matrix4().copy(O).invert()).toArray());return{lat:L[1],long:L[0],height:L[2]}},getPositionFromLatLongHeight:b=>{const L=T.ellipsoid.cartographicToCartesian([b.long,b.lat,b.height]);return new g.Vector3(...L).applyMatrix4(O)},orientToGeocoord:b=>{const L=[b.long,b.lat,b.height],W=T.ellipsoid.cartographicToCartesian(L),Z=new g.Matrix4().fromArray(T.ellipsoid.eastNorthUpToFixedFrame(W)),Rt=new g.Matrix4().makeRotationFromEuler(new g.Euler(Math.PI/2,Math.PI/2,0)),_r=new g.Matrix4().copy(Z).multiply(Rt).invert();br(_r)},getWebMercatorCoord:b=>By(b.lat,b.long),getCameraFrustum:b=>{const W=rc(b).planes.map(Rt=>new tt(Rt.normal.toArray(),Rt.constant)).map(Rt=>yy(Rt)),Z=new g.Group;for(const Rt of W)Z.add(Rt);return Z},overlayGeoJSON:b=>(b.applyMatrix4(O),b.updateMatrixWorld(),b),update:function(b,L,W){if(A=W,y.copy(L),D+=b,T&&D>=r){if(!et.equals(h.matrixWorld)){D=0,et.copy(h.matrixWorld),n.updateTransforms&&ze();const Z=new g.Vector3().setFromMatrixPosition(et);d.rootCenter.value.copy(Z),d.rootNormal.value.copy(new g.Vector3(0,0,1).applyMatrix4(et).normalize()),Gt.copy(et).invert(),n.debug&&(u[T.root.id].matrixWorld.copy(O),u[T.root.id].applyMatrix4(et))}it==null?it=new g.Matrix4().copy(W.matrixWorld):(de||Oy(W,it,fe))&&(D=0,de=!1,T._frameNumber++,W.getWorldPosition(Ke),it.copy(W.matrixWorld),Vn(T,c,y.y,W))}},dispose:function(){for(Q=!0,T._destroy();h.children.length>0;){const b=h.children[0];Tr(b),h.remove(b)}for(;f.children.length>0;){const b=f.children[0];f.remove(b),b.geometry.dispose(),b.material.dispose()}w&&w.dispose(),B&&B.dispose()}}}}static async loadGeoJSON(t){const{url:n,height:s,featureToColor:r}=t;return ne(n,je,{worker:!1,gis:{format:"binary"}}).then(i=>{const o=i,a=new g.BufferGeometry,c=o.polygons.positions.value.reduce((h,f,d,m)=>{if(d%2==0){const A=[f,m[d+1],s],y=J.WGS84.cartographicToCartesian(A);h.push(...y)}return h},[]);if(r){const h=o.polygons.numericProps[r.feature].value.reduce((f,d,m,A)=>{const y=r.colorMap(d);return f[m*3]=y.r,f[m*3+1]=y.g,f[m*3+2]=y.b,f},[]);a.setAttribute("color",new g.Float32BufferAttribute(h,3))}a.setAttribute("position",new g.Float32BufferAttribute(c,3)),a.setIndex(new g.BufferAttribute(o.polygons.triangles.value,1));const u=new g.MeshBasicMaterial({transparent:!0});return u.vertexColors=!0,new g.Mesh(a,u)})}}async function Sy(e,t,n,s,r){return new Promise((i,o)=>{const a=new g.Matrix4().makeRotationAxis(new g.Vector3(1,0,0),Math.PI/2),c=t.content.gltfUpAxis!=="Z",u=new g.Matrix4().fromArray(t.computedTransform).premultiply(r);c&&u.multiply(a),t.content.byteLength||(t.content.byteLength=t.content.gltfArrayBuffer.byteLength),e.parse(t.content.gltfArrayBuffer,t.contentUrl?t.contentUrl.substr(0,t.contentUrl.lastIndexOf("/")+1):"",l=>{t.userData.asset=l.asset;const h=l.scenes[0];h.applyMatrix4(u),t.content.texturesByteLength=0,t.content.geometriesByteLength=0,h.traverse(f=>{if(f.type=="Mesh"){const d=f;t.content.geometriesByteLength+=ac(d.geometry);const m=d.material,A=m.map,y=Cy(A);y&&(t.content.texturesByteLength+=y),s.material?(d.material=s.material.clone(),m.dispose()):s.shading==ke.FlatTexture&&d.material.type!=="MeshBasicMaterial"&&(d.material=n.clone(),m.dispose()),s.shading!=ke.ShadedNoTexture?d.material.type=="ShaderMaterial"?d.material.uniforms.map={value:A}:d.material.map=A:(A&&A.dispose(),d.material.map=null),d.material.wireframe=s.wireframe,s.contentPostProcess&&s.contentPostProcess(d)}}),t.content.gpuMemoryUsageInBytes=t.content.texturesByteLength+t.content.geometriesByteLength,i(h)},l=>{o(new Error(`error parsing gltf in tile ${t.id}: ${l}`))})})}function xy(e,t,n,s){const r={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:i}=e.content.attributes;i&&i.size===3&&(r.rgb=i.value),i&&i.size===4&&(r.rgba=i.value);const o=new g.BufferGeometry;o.setAttribute("position",new g.Float32BufferAttribute(r.points,3));const a=new g.Matrix4().fromArray(e.computedTransform).premultiply(s);r.rgba?o.setAttribute("color",new g.Float32BufferAttribute(r.rgba,4)):r.rgb&&o.setAttribute("color",new g.Uint8BufferAttribute(r.rgb,3,!0)),r.intensities&&o.setAttribute("intensity",new g.BufferAttribute(r.intensities,1,!0)),r.classifications&&o.setAttribute("classification",new g.Uint8BufferAttribute(r.classifications,1,!1)),e.content.geometriesByteLength=ac(o),e.content.gpuMemoryUsageInBytes=e.content.geometriesByteLength;const c=new g.Points(o,n.material||t);if(r.rtc_center){const u=r.rtc_center;a.multiply(new g.Matrix4().makeTranslation(u[0],u[1],u[2]))}return c.applyMatrix4(a),n.contentPostProcess&&n.contentPostProcess(c),c}function uc(e){var t,n,s,r;(t=e==null?void 0:e.uniforms)!=null&&t.map?(s=(n=e==null?void 0:e.uniforms)==null?void 0:n.map.value)==null||s.dispose():e.map&&((r=e.map)==null||r.dispose()),e.dispose()}function Tr(e){e.traverse(t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)uc(t.material);else for(const n of t.material)uc(n)});for(let t=e.children.length-1;t>=0;t--){const n=e.children[t];e.remove(n)}}function Oy(e,t,n){return!e.matrixWorld.equals(t)||e.aspect!=n}function Fy(e){const t=new Map;return e.forEach(r=>{var o,a;const i=(a=(o=r==null?void 0:r.userData)==null?void 0:o.asset)==null?void 0:a.copyright;i&&i.split(/;/g).map(u=>u.trim()).forEach(u=>{u&&t.set(u,(t.get(u)||0)+1)})}),Array.from(t).sort((r,i)=>i[1]-r[1]).map(([r])=>r).join("; ")}mt.Loader3DTiles=Iy,mt.PointCloudColoring=Er,mt.Shading=ke,Object.defineProperty(mt,Symbol.toStringTag,{value:"Module"})});
