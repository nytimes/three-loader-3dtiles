(function(gt,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("three"),require("three/examples/jsm/loaders/GLTFLoader.js"),require("three/examples/jsm/loaders/DRACOLoader.js"),require("three/examples/jsm/loaders/KTX2Loader.js")):typeof define=="function"&&define.amd?define(["exports","three","three/examples/jsm/loaders/GLTFLoader.js","three/examples/jsm/loaders/DRACOLoader.js","three/examples/jsm/loaders/KTX2Loader.js"],g):(gt=typeof globalThis<"u"?globalThis:gt||self,g(gt.ThreeLoader3DTiles={},gt.THREE,gt.THREE,gt.THREE,gt.THREE))})(this,function(gt,g,Bc,Cc,Ec){"use strict";async function pe(e,t,n,s){return s._parse(e,t,n,s)}function U(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const qe=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Or=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Or&&parseFloat(Or[1]);function Tc(e,t){return Fr(e||{},t)}function Fr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(n>3)return t;const s={...e};for(const[r,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=Fr(s[r]||{},t[r],n+1):s[r]=t[r];return s}const bc="latest";function _c(){var e;return(e=globalThis._loadersgl_)!==null&&e!==void 0&&e.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.1"),globalThis._loadersgl_.version}const Dr=_c();function Ft(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const At=typeof process!="object"||String(process)!=="[object process]"||process.browser,Qn=typeof importScripts=="function",wc=typeof window<"u"&&typeof window.orientation<"u",Lr=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Lr&&parseFloat(Lr[1]);class Rc{constructor(t,n){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=t,this.workerThread=n,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}done(t){Ft(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ft(this.isRunning),this.isRunning=!1,this._reject(t)}}class qn{terminate(){}}const Yn=new Map;function Mc(e){Ft(e.source&&!e.url||!e.source&&e.url);let t=Yn.get(e.source||e.url);return t||(e.url&&(t=Sc(e.url),Yn.set(e.url,t)),e.source&&(t=Pr(e.source),Yn.set(e.source,t))),Ft(t),t}function Sc(e){if(!e.startsWith("http"))return e;const t=Ic(e);return Pr(t)}function Pr(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Ic(e){return`try {
  importScripts('${e}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Gr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const s=n||new Set;if(e){if(Nr(e))s.add(e);else if(Nr(e.buffer))s.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(const r in e)Gr(e[r],t,s)}}return n===void 0?Array.from(s):[]}function Nr(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}const $n=()=>{};class Zn{static isSupported(){return typeof Worker<"u"&&At||typeof qn<"u"&&!At}constructor(t){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:n,source:s,url:r}=t;Ft(s||r),this.name=n,this.source=s,this.url=r,this.onMessage=$n,this.onError=i=>console.log(i),this.worker=At?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=$n,this.onError=$n,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,n){n=n||Gr(t),this.worker.postMessage(t,n)}_getErrorFromErrorEvent(t){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,t.message&&(n+=`${t.message} in `),t.lineno&&(n+=`:${t.lineno}:${t.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=Mc({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},t.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},t.onmessageerror=n=>console.error(n),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new qn(s,{eval:!1})}else if(this.source)t=new qn(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",n=>{this.onMessage(n)}),t.on("error",n=>{this.onError(n)}),t.on("exit",n=>{}),t}}class xc{static isSupported(){return Zn.isSupported()}constructor(t){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(i,o,a)=>i.done(a),s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(i,o)=>i.error(o);const r=new Promise(i=>(this.jobQueue.push({name:t,onMessage:n,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length});const s=new Rc(n.name,t);t.onMessage=r=>n.onMessage(s,r.type,r.payload),t.onError=r=>n.onError(s,r),n.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!At||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Zn({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return wc?this.maxMobileConcurrency:this.maxConcurrency}}const vc={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Dt{static isSupported(){return Zn.isSupported()}static getWorkerFarm(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Dt._workerFarm=Dt._workerFarm||new Dt({}),Dt._workerFarm.setProps(t),Dt._workerFarm}constructor(t){this.props=void 0,this.workerPools=new Map,this.props={...vc},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:n,source:s,url:r}=t;let i=this.workerPools.get(n);return i||(i=new xc({name:n,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Dt._workerFarm=void 0;function Oc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=t[e.id]||{},s=At?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=n.workerUrl;if(!r&&e.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(At?r=`modules/${e.module}/dist/${s}`:r=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let i=e.version;i==="latest"&&(i=bc);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${s}`}return Ft(r),r}function Fc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Dr;Ft(e,"no worker provided");const n=e.version;return!(!t||!n)}const Dc=Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})),ts={};async function Kt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return t&&(e=Lc(e,t,n,s)),ts[e]=ts[e]||Pc(e),await ts[e]}function Lc(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(!n.useLocalLibraries&&e.startsWith("http"))return e;s=s||e;const r=n.modules||{};return r[s]?r[s]:At?n.CDN?(Ft(n.CDN.startsWith("http")),`${n.CDN}/${t}@${Dr}/dist/libs/${s}`):Qn?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function Pc(e){if(e.endsWith("wasm"))return await Nc(e);if(!At)try{return Dc&&void 0}catch(n){return console.error(n),null}if(Qn)return importScripts(e);const t=await Uc(e);return Gc(t,e)}function Gc(e,t){if(!At)return;if(Qn)return eval.call(globalThis,e),null;const n=document.createElement("script");n.id=t;try{n.appendChild(document.createTextNode(e))}catch{n.text=e}return document.body.appendChild(n),null}async function Nc(e){return await(await fetch(e)).arrayBuffer()}async function Uc(e){return await(await fetch(e)).text()}function Hc(e,t){return!Dt.isSupported()||!At&&!(t!=null&&t._nodeWorkers)?!1:e.worker&&(t==null?void 0:t.worker)}async function Jc(e,t,n,s,r){const i=e.id,o=Oc(e,n),c=Dt.getWorkerFarm(n).getWorkerPool({name:i,url:o});n=JSON.parse(JSON.stringify(n)),s=JSON.parse(JSON.stringify(s||{}));const l=await c.startJob("process-on-worker",Vc.bind(null,r));return l.postMessage("process",{input:t,options:n,context:s}),await(await l.result).result}async function Vc(e,t,n,s){switch(n){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const a=await e(i,o);t.postMessage("done",{id:r,result:a})}catch(a){const c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:r,error:c})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function jc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?Ur(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?Ur(e,0,t):""}function Ur(e,t,n){if(e.byteLength<=t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}function kc(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${jc(e)}"`)}}function Kc(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;const s=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function zc(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Wc(t)}function Wc(e){const t=e.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),n=t.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(n);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s.buffer}function es(e,t,n){const s=n!==void 0?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(s).buffer}function ye(e,t){return U(e>=0),U(t>0),e+(t-1)&~(t-1)}function Xc(e,t,n){let s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else{const r=e.byteOffset,i=e.byteLength;s=new Uint8Array(e.buffer||e.arrayBuffer,r,i)}return t.set(s,n),n+ye(s.byteLength,4)}async function Qc(e){const t=[];for await(const n of e)t.push(n);return zc(...t)}function Hr(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){const t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}class Jr{constructor(t,n){this.name=void 0,this.type=void 0,this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Hr(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Hr()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Vr{constructor(t){this.id=void 0,this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:t,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const t of Object.values(this.stats))t.reset();return this}forEach(t){for(const n of Object.values(this.stats))t(n)}getTable(){const t={};return this.forEach(n=>{t[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),t}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(t){const{name:n,type:s}=t;let r=this.stats[n];return r||(t instanceof Jr?r=t:r=new Jr(n,s),this.stats[n]=r),r}}const qc="Queued Requests",Yc="Active Requests",$c="Cancelled Requests",Zc="Queued Requests Ever",tl="Active Requests Ever",el={id:"request-scheduler",throttleRequests:!0,maxRequests:6};class nl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.props=void 0,this.stats=void 0,this.activeRequestCount=0,this.requestQueue=[],this.requestMap=new Map,this.deferredUpdate=null,this.props={...el,...t},this.stats=new Vr({id:this.props.id}),this.stats.get(qc),this.stats.get(Yc),this.stats.get($c),this.stats.get(Zc),this.stats.get(tl)}scheduleRequest(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:()=>0;if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);const s={handle:t,priority:0,getPriority:n},r=new Promise(i=>(s.resolve=i,s));return this.requestQueue.push(s),this.requestMap.set(t,r),this._issueNewRequests(),r}_issueRequest(t){const{handle:n,resolve:s}=t;let r=!1;const i=()=>{r||(r=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,s?s({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.deferredUpdate||(this.deferredUpdate=setTimeout(()=>this._issueNewRequestsAsync(),0))}_issueNewRequestsAsync(){this.deferredUpdate=null;const t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let n=0;n<t;++n){const s=this.requestQueue.shift();s&&this._issueRequest(s)}}}_updateAllRequests(){const t=this.requestQueue;for(let n=0;n<t.length;++n){const s=t[n];this._updateRequest(s)||(t.splice(n,1),this.requestMap.delete(s.handle),n--)}t.sort((n,s)=>n.priority-s.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}}let sl="";const jr={};function rl(e){for(const t in jr)if(e.startsWith(t)){const n=jr[t];e=e.replace(t,n)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${sl}${e}`),e}function Xy(e){return e}function il(e){return e&&typeof e=="object"&&e.isBuffer}function kr(e){if(il(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){const t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function ol(){var e;if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();const t=(e=window.location)===null||e===void 0?void 0:e.pathname;return(t==null?void 0:t.slice(0,t.lastIndexOf("/")+1))||""}function Kr(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function ns(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function al(){const e=[];for(let r=0;r<arguments.length;r++)e[r]=r<0||arguments.length<=r?void 0:arguments[r];let t="",n=!1,s;for(let r=e.length-1;r>=-1&&!n;r--){let i;r>=0?i=e[r]:(s===void 0&&(s=ol()),i=s),i.length!==0&&(t=`${i}/${t}`,n=i.charCodeAt(0)===Be)}return t=cl(t,!n),n?`/${t}`:t.length>0?t:"."}const Be=47,ss=46;function cl(e,t){let n="",s=-1,r=0,i,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===Be)break;i=Be}if(i===Be){if(!(s===a-1||r===1))if(s!==a-1&&r===2){if(n.length<2||!o||n.charCodeAt(n.length-1)!==ss||n.charCodeAt(n.length-2)!==ss){if(n.length>2){const c=n.length-1;let l=c;for(;l>=0&&n.charCodeAt(l)!==Be;--l);if(l!==c){n=l===-1?"":n.slice(0,l),s=a,r=0,o=!1;continue}}else if(n.length===2||n.length===1){n="",s=a,r=0,o=!1;continue}}t&&(n.length>0?n+="/..":n="..",o=!0)}else{const c=e.slice(s+1,a);n.length>0?n+=`/${c}`:n=c,o=!1}s=a,r=0}else i===ss&&r!==-1?++r:r=-1}return n}const ll=e=>typeof e=="boolean",Ce=e=>typeof e=="function",Ee=e=>e!==null&&typeof e=="object",zr=e=>Ee(e)&&e.constructor==={}.constructor,ul=e=>!!e&&typeof e[Symbol.iterator]=="function",hl=e=>e&&typeof e[Symbol.asyncIterator]=="function",zt=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Wt=e=>typeof Blob<"u"&&e instanceof Blob,fl=e=>e&&typeof e=="object"&&e.isBuffer,dl=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Ee(e)&&Ce(e.tee)&&Ce(e.cancel)&&Ce(e.getReader),ml=e=>Ee(e)&&Ce(e.read)&&Ce(e.pipe)&&ll(e.readable),Wr=e=>dl(e)||ml(e),gl=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Al=/^([-\w.]+\/[-\w.+]+)/;function pl(e){const t=Al.exec(e);return t?t[1]:e}function Xr(e){const t=gl.exec(e);return t?t[1]:""}const Qr=/\?.*/;function yl(e){const t=e.match(Qr);return t&&t[0]}function rs(e){return e.replace(Qr,"")}function Ye(e){return zt(e)?e.url:Wt(e)?e.name||"":typeof e=="string"?e:""}function is(e){if(zt(e)){const t=e,n=t.headers.get("content-type")||"",s=rs(t.url);return pl(n)||Xr(s)}return Wt(e)?e.type||"":typeof e=="string"?Xr(e):""}function Bl(e){return zt(e)?e.headers["content-length"]||-1:Wt(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function qr(e){if(zt(e))return e;const t={},n=Bl(e);n>=0&&(t["content-length"]=String(n));const s=Ye(e),r=is(e);r&&(t["content-type"]=r);const i=await Tl(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));const o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function Cl(e){if(!e.ok){const t=await El(e);throw new Error(t)}}async function El(e){let t=`Failed to fetch resource ${e.url} (${e.status}): `;try{const n=e.headers.get("Content-Type");let s=e.statusText;n!=null&&n.includes("application/json")&&(s+=` ${await e.text()}`),t+=s,t=t.length>60?`${t.slice(0,60)}...`:t}catch{}return t}async function Tl(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){const n=e.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s(i==null||(o=i.target)===null||o===void 0?void 0:o.result)},r.readAsDataURL(n)})}if(e instanceof ArrayBuffer){const n=e.slice(0,5);return`data:base64,${bl(n)}`}return null}function bl(e){let t="";const n=new Uint8Array(e);for(let s=0;s<n.byteLength;s++)t+=String.fromCharCode(n[s]);return btoa(t)}function _l(e){return!wl(e)&&!Rl(e)}function wl(e){return e.startsWith("http:")||e.startsWith("https:")}function Rl(e){return e.startsWith("data:")}async function Te(e,t){if(typeof e=="string"){const r=rl(e);if(_l(r)){var n;if((n=globalThis.loaders)!==null&&n!==void 0&&n.fetchNode){var s;return(s=globalThis.loaders)===null||s===void 0?void 0:s.fetchNode(r,t)}}return await fetch(r,t)}return await qr(e)}function Ml(e){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const t=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,n=e||t;return!!(n&&n.indexOf("Electron")>=0)}function be(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||Ml()}const $e=globalThis.window||globalThis.self||globalThis.global,_e=globalThis.process||{},Yr=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";be();function Sl(e){try{const t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch{return null}}class Il{constructor(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";this.storage=void 0,this.id=void 0,this.config=void 0,this.storage=Sl(s),this.id=t,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let t={};if(this.storage){const n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}function xl(e){let t;return e<10?t="".concat(e.toFixed(2),"ms"):e<100?t="".concat(e.toFixed(1),"ms"):e<1e3?t="".concat(e.toFixed(0),"ms"):t="".concat((e/1e3).toFixed(2),"s"),t}function vl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}function os(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(n=Math.min(n,s/e.width));const i=e.width*n,o=e.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(i/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(i,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Ze;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Ze||(Ze={}));const Ol=10;function $r(e){return typeof e!="string"?e:(e=e.toUpperCase(),Ze[e]||Ze.WHITE)}function Fl(e,t,n){if(!be&&typeof e=="string"){if(t){const s=$r(t);e="\x1B[".concat(s,"m").concat(e,"\x1B[39m")}if(n){const s=$r(n);e="\x1B[".concat(s+Ol,"m").concat(e,"\x1B[49m")}}return e}function Dl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(e),s=Object.getOwnPropertyNames(n),r=e;for(const i of s){const o=r[i];typeof o=="function"&&(t.find(a=>i===a)||(r[i]=o.bind(e)))}}function tn(e,t){if(!e)throw new Error(t||"Assertion failed")}function re(){let e;if(be()&&$e.performance){var t,n;e=$e==null||(t=$e.performance)===null||t===void 0||(n=t.now)===null||n===void 0?void 0:n.call(t)}else if("hrtime"in _e){var s;const r=_e==null||(s=_e.hrtime)===null||s===void 0?void 0:s.call(_e);e=r[0]*1e3+r[1]/1e6}else e=Date.now();return e}const ie={debug:be()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ll={enabled:!0,level:0};function pt(){}const Zr={},ti={once:!0};class en{constructor(){let{id:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};this.id=void 0,this.VERSION=Yr,this._startTs=re(),this._deltaTs=re(),this._storage=void 0,this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new Il("__probe-".concat(this.id,"__"),Ll),this.timeStamp("".concat(this.id," started")),Dl(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((re()-this._startTs).toPrecision(10))}getDelta(){return Number((re()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,n){this._storage.setConfiguration({[t]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,n){tn(t,n)}warn(t){return this._getLogFunction(0,t,ie.warn,arguments,ti)}error(t){return this._getLogFunction(0,t,ie.error,arguments)}deprecated(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}probe(t,n){return this._getLogFunction(t,n,ie.log,arguments,{time:!0,once:!0})}log(t,n){return this._getLogFunction(t,n,ie.debug,arguments)}info(t,n){return this._getLogFunction(t,n,console.info,arguments)}once(t,n){return this._getLogFunction(t,n,ie.debug||ie.info,arguments,ti)}table(t,n,s){return n?this._getLogFunction(t,n,console.table||pt,s&&[s],{tag:Ul(n)}):pt}image(t){let{logLevel:n,priority:s,image:r,message:i="",scale:o=1}=t;return this._shouldLog(n||s)?be()?Nl({image:r,message:i,scale:o}):Gl():pt}time(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}timeEnd(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,n){return this._getLogFunction(t,n,console.timeStamp||pt)}group(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const r=ni({logLevel:t,message:n,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||pt)}withGroup(t,n,s){this.group(t,n)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=ei(t)}_getLogFunction(t,n,s,r,i){if(this._shouldLog(t)){i=ni({logLevel:t,message:n,args:r,opts:i}),s=s||i.method,tn(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=re();const o=i.tag||i.message;if(i.once&&o)if(!Zr[o])Zr[o]=re();else return pt;return n=Pl(this.id,i.message,i),s.bind(console,n,...i.args)}return pt}}en.VERSION=Yr;function ei(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return tn(Number.isFinite(t)&&t>=0),t}function ni(e){const{logLevel:t,message:n}=e;e.logLevel=ei(t);const s=e.args?Array.from(e.args):[];for(;s.length&&s.shift()!==n;);switch(typeof t){case"string":case"function":n!==void 0&&s.unshift(n),e.message=t;break;case"object":Object.assign(e,t);break}typeof e.message=="function"&&(e.message=e.message());const r=typeof e.message;return tn(r==="string"||r==="object"),Object.assign(e,{args:s},e.opts)}function Pl(e,t,n){if(typeof t=="string"){const s=n.time?vl(xl(n.total)):"";t=n.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),t=Fl(t,n.color,n.background)}return t}function Gl(e){return console.warn("removed"),pt}function Nl(e){let{image:t,message:n="",scale:s=1}=e;if(typeof t=="string"){const i=new Image;return i.onload=()=>{const o=os(i,n,s);console.log(...o)},i.src=t,pt}const r=t.nodeName||"";if(r.toLowerCase()==="img")return console.log(...os(t,n,s)),pt;if(r.toLowerCase()==="canvas"){const i=new Image;return i.onload=()=>console.log(...os(i,n,s)),i.src=t.toDataURL(),pt}return pt}function Ul(e){for(const t in e)for(const n in e[t])return n||"untitled";return"empty"}const si=new en({id:"@probe.gl/log"}),ri=new en({id:"loaders.gl"});class Hl{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Jl{constructor(){this.console=void 0,this.console=console}log(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.log.bind(this.console,...n)}info(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.info.bind(this.console,...n)}warn(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.warn.bind(this.console,...n)}error(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return this.console.error.bind(this.console,...n)}}const ii={fetch:null,mimeType:void 0,nothrow:!1,log:new Jl,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:qe,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Vl={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function oi(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}function ai(){const e=oi();return e.globalOptions=e.globalOptions||{...ii},e.globalOptions}function jl(e,t,n,s){return n=n||[],n=Array.isArray(n)?n:[n],kl(e,n),zl(t,e,s)}function kl(e,t){ci(e,null,ii,Vl,t);for(const n of t){const s=e&&e[n.id]||{},r=n.options&&n.options[n.id]||{},i=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ci(s,n.id,r,i,t)}}function ci(e,t,n,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const a in e){const c=!t&&Ee(e[a]),l=a==="baseUri"&&!t,u=a==="workerUrl"&&t;if(!(a in n)&&!l&&!u){if(a in s)ri.warn(`${i} loader option '${o}${a}' no longer supported, use '${s[a]}'`)();else if(!c){const h=Kl(a,r);ri.warn(`${i} loader option '${o}${a}' not recognized. ${h}`)()}}}}function Kl(e,t){const n=e.toLowerCase();let s="";for(const r of t)for(const i in r.options){if(e===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function zl(e,t,n){const r={...e.options||{}};return Wl(r,n),r.log===null&&(r.log=new Hl),li(r,ai()),li(r,t),r}function li(e,t){for(const n in t)if(n in t){const s=t[n];zr(s)&&zr(e[n])?e[n]={...e[n],...t[n]}:e[n]=t[n]}}function Wl(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function as(e){var t;return e?(Array.isArray(e)&&(e=e[0]),Array.isArray((t=e)===null||t===void 0?void 0:t.extensions)):!1}function ui(e){var t,n;U(e,"null loader"),U(as(e),"invalid loader");let s;return Array.isArray(e)&&(s=e[1],e=e[0],e={...e,options:{...e.options,...s}}),((t=e)!==null&&t!==void 0&&t.parseTextSync||(n=e)!==null&&n!==void 0&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}const Xl=()=>{const e=oi();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function Ql(){return Xl()}const ql=new en({id:"loaders.gl"}),Yl=/\.([^.]+)$/;async function $l(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!fi(e))return null;let r=hi(e,t,{...n,nothrow:!0},s);if(r)return r;if(Wt(e)&&(e=await e.slice(0,10).arrayBuffer(),r=hi(e,t,n,s)),!r&&!(n!=null&&n.nothrow))throw new Error(di(e));return r}function hi(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!fi(e))return null;if(t&&!Array.isArray(t))return ui(t);let r=[];t&&(r=r.concat(t)),n!=null&&n.ignoreRegisteredLoaders||r.push(...Ql()),tu(r);const i=Zl(e,r,n,s);if(!i&&!(n!=null&&n.nothrow))throw new Error(di(e));return i}function Zl(e,t,n,s){const r=Ye(e),i=is(e),o=rs(r)||(s==null?void 0:s.url);let a=null,c="";if(n!=null&&n.mimeType&&(a=cs(t,n==null?void 0:n.mimeType),c=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||eu(t,o),c=c||(a?`matched url ${o}`:""),a=a||cs(t,i),c=c||(a?`matched MIME type ${i}`:""),a=a||su(t,e),c=c||(a?`matched initial data ${gi(e)}`:""),n!=null&&n.fallbackMimeType&&(a=a||cs(t,n==null?void 0:n.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c){var l;ql.log(1,`selectLoader selected ${(l=a)===null||l===void 0?void 0:l.name}: ${c}.`)}return a}function fi(e){return!(e instanceof Response&&e.status===204)}function di(e){const t=Ye(e),n=is(e);let s="No valid loader found (";s+=t?`${Kr(t)}, `:"no url provided, ",s+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const r=e?gi(e):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function tu(e){for(const t of e)ui(t)}function eu(e,t){const n=t&&Yl.exec(t),s=n&&n[1];return s?nu(e,s):null}function nu(e,t){t=t.toLowerCase();for(const n of e)for(const s of n.extensions)if(s.toLowerCase()===t)return n;return null}function cs(e,t){for(const n of e)if(n.mimeTypes&&n.mimeTypes.includes(t)||t===`application/x.${n.id}`)return n;return null}function su(e,t){if(!t)return null;for(const n of e)if(typeof t=="string"){if(ru(t,n))return n}else if(ArrayBuffer.isView(t)){if(mi(t.buffer,t.byteOffset,n))return n}else if(t instanceof ArrayBuffer&&mi(t,0,n))return n;return null}function ru(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>e.startsWith(s))}function mi(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(r=>iu(e,t,n,r))}function iu(e,t,n,s){if(s instanceof ArrayBuffer)return Kc(s,e,s.byteLength);switch(typeof s){case"function":return s(e);case"string":const r=ls(e,t,s.length);return s===r;default:return!1}}function gi(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?ls(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ls(e,0,t):""}function ls(e,t,n){if(e.byteLength<t+n)return"";const s=new DataView(e);let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const ou=256*1024;function*au(e,t){const n=(t==null?void 0:t.chunkSize)||ou;let s=0;const r=new TextEncoder;for(;s<e.length;){const i=Math.min(e.length-s,n),o=e.slice(s,s+i);s+=i,yield r.encode(o)}}const cu=256*1024;function lu(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=cu}=t;let s=0;for(;s<e.byteLength;){const r=Math.min(e.byteLength-s,n),i=new ArrayBuffer(r),o=new Uint8Array(e,s,r);new Uint8Array(i).set(o),s+=r,yield i}}()}const uu=1024*1024;async function*hu(e,t){const n=(t==null?void 0:t.chunkSize)||uu;let s=0;for(;s<e.size;){const r=s+n,i=await e.slice(s,r).arrayBuffer();s=r,yield i}}function Ai(e,t){return qe?fu(e,t):du(e)}async function*fu(e,t){const n=e.getReader();let s;try{for(;;){const r=s||n.read();t!=null&&t._streamReadAhead&&(s=n.read());const{done:i,value:o}=await r;if(i)return;yield kr(o)}}catch{n.releaseLock()}}async function*du(e,t){for await(const n of e)yield kr(n)}function mu(e,t){if(typeof e=="string")return au(e,t);if(e instanceof ArrayBuffer)return lu(e,t);if(Wt(e))return hu(e,t);if(Wr(e))return Ai(e,t);if(zt(e))return Ai(e.body,t);throw new Error("makeIterator")}const pi="Cannot convert supplied data type";function gu(e,t,n){if(t.text&&typeof e=="string")return e;if(fl(e)&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const r=e.byteLength||e.length;return(e.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(e.byteOffset,e.byteOffset+r)),s}throw new Error(pi)}async function Au(e,t,n){const s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||s)return gu(e,t);if(Wt(e)&&(e=await qr(e)),zt(e)){const r=e;return await Cl(r),t.binary?await r.arrayBuffer():await r.text()}if(Wr(e)&&(e=mu(e,n)),ul(e)||hl(e))return Qc(e);throw new Error(pi)}function yi(e,t){const n=ai(),s=e||n;return typeof s.fetch=="function"?s.fetch:Ee(s.fetch)?r=>Te(r,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Te}function pu(e,t,n){if(n)return n;const s={fetch:yi(t,e),...e};if(s.url){const r=rs(s.url);s.baseUrl=r,s.queryString=yl(s.url),s.filename=Kr(r),s.baseUrl=ns(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function yu(e,t){if(e&&!Array.isArray(e))return e;let n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[...n,...s]:s}return n&&n.length?n:void 0}async function nn(e,t,n,s){t&&!Array.isArray(t)&&!as(t)&&(s=void 0,n=t,t=void 0),e=await e,n=n||{};const r=Ye(e),o=yu(t,s),a=await $l(e,o,n);return a?(n=jl(n,a,o,r),s=pu({url:r,_parse:nn,loaders:o},n,s||null),await Bu(a,e,n,s)):null}async function Bu(e,t,n,s){if(Fc(e),n=Tc(e.options,n),zt(t)){const i=t,{ok:o,redirected:a,status:c,statusText:l,type:u,url:h}=i,f=Object.fromEntries(i.headers.entries());s.response={headers:f,ok:o,redirected:a,status:c,statusText:l,type:u,url:h}}t=await Au(t,e,n);const r=e;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,n,s);if(Hc(e,n))return await Jc(e,t,n,s,nn);if(r.parseText&&typeof t=="string")return await r.parseText(t,n,s);if(r.parse)return await r.parse(t,n,s);throw Ft(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function Cu(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Eu(e){let t=1/0,n=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){const u=a[l],h=a[l+1],f=a[l+2];t=u<t?u:t,n=h<n?h:n,s=f<s?f:s,r=u>r?u:r,i=h>i?h:i,o=f>o?f:o}return[[t,n,s],[r,i,o]]}function Tu(e,t,n){const s=Cu(t.value),r=n||bu(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function bu(e){const t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function oe(e,t,n,s){let r,i;!Array.isArray(t)&&!as(t)?(r=[],i=t):(r=t,i=n);const o=yi(i);let a=e;return typeof e=="string"&&(a=await o(e)),Wt(e)&&(a=await o(e)),Array.isArray(r)?await nn(a,r,i):await nn(a,r,i)}const _u=1/Math.PI*180,wu=1/180*Math.PI,Ru={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Ru}};const Y=globalThis.mathgl.config;function Mu(e,{precision:t=Y.precision}={}){return e=Ou(e),"".concat(parseFloat(e.toPrecision(t)))}function Xt(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Su(e){return xu(e)}function Iu(e){return Tt(e)}function xu(e,t){return us(e,n=>n*wu,t)}function Tt(e,t){return us(e,n=>n*_u,t)}function vu(e,t,n){return us(e,s=>Math.max(t,Math.min(n,s)))}function Ht(e,t,n){const s=Y.EPSILON;n&&(Y.EPSILON=n);try{if(e===t)return!0;if(Xt(e)&&Xt(t)){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!Ht(e[r],t[r]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Y.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Y.EPSILON=s}}function Ou(e){return Math.round(e/Y.EPSILON)*Y.EPSILON}function Fu(e){return e.clone?e.clone():new Array(e.length)}function us(e,t,n){if(Xt(e)){const s=e;n=n||Fu(s);for(let r=0;r<n.length&&r<s.length;++r){const i=typeof e=="number"?e:e[r];n[r]=t(i,r,n)}return n}return t(e)}function Du(e){function t(){var n=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}class hs extends Du(Array){clone(){return new this.constructor().copy(this)}fromArray(t,n=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+n];return this.check()}toArray(t=[],n=0){for(let s=0;s<this.ELEMENTS;++s)t[n+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Xt(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Y)}formatString(t){let n="";for(let s=0;s<this.ELEMENTS;++s)n+=(s>0?", ":"")+Mu(this[s],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Ht(this[n],t[n]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==t[n])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,n,s){if(s===void 0)return this.lerp(this,t,n);for(let r=0;r<this.ELEMENTS;++r){const i=t[r],o=typeof n=="number"?n:n[r];this[r]=i+s*(o-i)}return this.check()}min(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(t[n],this[n]);return this.check()}max(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(t[n],this[n]);return this.check()}clamp(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),n[s]);return this.check()}add(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=n[s];return this.check()}subtract(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=n[s];return this.check()}scale(t){if(typeof t=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;else for(let n=0;n<this.ELEMENTS&&n<t.length;++n)this[n]*=t[n];return this.check()}multiplyByScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}check(){if(Y.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)t=t&&Number.isFinite(this[n]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]=t;return this.check()}addScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let n=0;n<this.ELEMENTS;++n)this[n]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,n){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),n);return this.check()}get elements(){return this}}function Lu(e,t){if(e.length!==t)return!1;for(let n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function N(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function we(e,t,n=""){if(Y.debug&&!Lu(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return e}function j(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}class fs extends hs{get x(){return this[0]}set x(t){this[0]=N(t)}get y(){return this[1]}set y(t){this[1]=N(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let n=0;n<this.ELEMENTS;++n)t+=this[n]*this[n];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let n=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];n+=r*r}return N(n)}dot(t){let n=0;for(let s=0;s<this.ELEMENTS;++s)n+=this[s]*t[s];return N(n)}normalize(){const t=this.magnitude();if(t!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=t;return this.check()}multiply(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=n[s];return this.check()}divide(...t){for(const n of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=n[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return j(t>=0&&t<this.ELEMENTS,"index is out of range"),N(this[t])}setComponent(t,n){return j(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=n,this.check()}addVectors(t,n){return this.copy(t).add(n)}subVectors(t,n){return this.copy(t).subtract(n)}multiplyVectors(t,n){return this.copy(t).multiply(n)}addScaledVector(t,n){return this.add(new this.constructor(t).multiplyScalar(n))}}const Re=1e-6;let bt=typeof Float32Array<"u"?Float32Array:Array;function Pu(){const e=new bt(2);return bt!=Float32Array&&(e[0]=0,e[1]=0),e}function Gu(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e}function Nu(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r+n[4],e[1]=n[1]*s+n[3]*r+n[5],e}function Bi(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[3]*r+n[6],e[1]=n[1]*s+n[4]*r+n[7],e}function Ci(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[4]*r+n[12],e[1]=n[1]*s+n[5]*r+n[13],e}(function(){const e=Pu();return function(t,n,s,r,i,o){let a,c;for(n||(n=2),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}})();function Ei(e,t,n){const s=t[0],r=t[1],i=n[3]*s+n[7]*r||1;return e[0]=(n[0]*s+n[4]*r)/i,e[1]=(n[1]*s+n[5]*r)/i,e}function Ti(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[3]*s+n[7]*r+n[11]*i||1;return e[0]=(n[0]*s+n[4]*r+n[8]*i)/o,e[1]=(n[1]*s+n[5]*r+n[9]*i)/o,e[2]=(n[2]*s+n[6]*r+n[10]*i)/o,e}function Uu(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e}function Hu(e,t,n){const s=t[0],r=t[1];return e[0]=n[0]*s+n[2]*r,e[1]=n[1]*s+n[3]*r,e[2]=t[2],e[3]=t[3],e}function bi(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=n[0]*s+n[3]*r+n[6]*i,e[1]=n[1]*s+n[4]*r+n[7]*i,e[2]=n[2]*s+n[5]*r+n[8]*i,e[3]=t[3],e}class sn extends fs{constructor(t=0,n=0){super(2),Xt(t)&&arguments.length===1?this.copy(t):(Y.debug&&(N(t),N(n)),this[0]=t,this[1]=n)}set(t,n){return this[0]=t,this[1]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Y.debug&&(N(t.x),N(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Ci(this,this,t),this.check()}transformAsVector(t){return Ei(this,this,t),this.check()}transformByMatrix3(t){return Bi(this,this,t),this.check()}transformByMatrix2x3(t){return Nu(this,this,t),this.check()}transformByMatrix2(t){return Gu(this,this,t),this.check()}}function _i(){const e=new bt(3);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function wi(e){const t=e[0],n=e[1],s=e[2];return Math.sqrt(t*t+n*n+s*s)}function Ri(e,t,n){const s=new bt(3);return s[0]=e,s[1]=t,s[2]=n,s}function Ju(e,t){const n=t[0],s=t[1],r=t[2];let i=n*n+s*s+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function ds(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rn(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2];return e[0]=r*c-i*a,e[1]=i*o-s*c,e[2]=s*a-r*o,e}function ms(e,t,n){const s=t[0],r=t[1],i=t[2];let o=n[3]*s+n[7]*r+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*s+n[4]*r+n[8]*i+n[12])/o,e[1]=(n[1]*s+n[5]*r+n[9]*i+n[13])/o,e[2]=(n[2]*s+n[6]*r+n[10]*i+n[14])/o,e}function Mi(e,t,n){const s=t[0],r=t[1],i=t[2];return e[0]=s*n[0]+r*n[3]+i*n[6],e[1]=s*n[1]+r*n[4]+i*n[7],e[2]=s*n[2]+r*n[5]+i*n[8],e}function Si(e,t,n){const s=n[0],r=n[1],i=n[2],o=n[3],a=t[0],c=t[1],l=t[2];let u=r*l-i*c,h=i*a-s*l,f=s*c-r*a,d=r*f-i*h,m=i*u-s*f,A=s*h-r*u;const y=o*2;return u*=y,h*=y,f*=y,d*=2,m*=2,A*=2,e[0]=a+u+d,e[1]=c+h+m,e[2]=l+f+A,e}function Vu(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function ju(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function ku(e,t,n,s){const r=[],i=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Ku(e,t){const n=e[0],s=e[1],r=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((n*n+s*s+r*r)*(i*i+o*o+a*a)),l=c&&ds(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}const zu=wi;(function(){const e=_i();return function(t,n,s,r,i,o){let a,c;for(n||(n=3),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}})();const gs=[0,0,0];let on;class p extends fs{static get ZERO(){return on||(on=new p(0,0,0),Object.freeze(on)),on}constructor(t=0,n=0,s=0){super(-0,-0,-0),arguments.length===1&&Xt(t)?this.copy(t):(Y.debug&&(N(t),N(n),N(s)),this[0]=t,this[1]=n,this[2]=s)}set(t,n,s){return this[0]=t,this[1]=n,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Y.debug&&(N(t.x),N(t.y),N(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=N(t)}angle(t){return Ku(this,t)}cross(t){return rn(this,this,t),this.check()}rotateX({radians:t,origin:n=gs}){return Vu(this,this,n,t),this.check()}rotateY({radians:t,origin:n=gs}){return ju(this,this,n,t),this.check()}rotateZ({radians:t,origin:n=gs}){return ku(this,this,n,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ms(this,this,t),this.check()}transformAsVector(t){return Ti(this,this,t),this.check()}transformByMatrix3(t){return Mi(this,this,t),this.check()}transformByMatrix2(t){return Uu(this,this,t),this.check()}transformByQuaternion(t){return Si(this,this,t),this.check()}}let an;class As extends fs{static get ZERO(){return an||(an=new As(0,0,0,0),Object.freeze(an)),an}constructor(t=0,n=0,s=0,r=0){super(-0,-0,-0,-0),Xt(t)&&arguments.length===1?this.copy(t):(Y.debug&&(N(t),N(n),N(s),N(r)),this[0]=t,this[1]=n,this[2]=s,this[3]=r)}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Y.debug&&(N(t.x),N(t.y),N(t.z),N(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=N(t)}get w(){return this[3]}set w(t){this[3]=N(t)}transform(t){return ms(this,this,t),this.check()}transformByMatrix3(t){return bi(this,this,t),this.check()}transformByMatrix2(t){return Hu(this,this,t),this.check()}transformByQuaternion(t){return Si(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class Ii extends hs{toString(){let t="[";if(Y.printRowMajor){t+="row-major:";for(let n=0;n<this.RANK;++n)for(let s=0;s<this.RANK;++s)t+=" ".concat(this[s*this.RANK+n])}else{t+="column-major:";for(let n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]",t}getElementIndex(t,n){return n*this.RANK+t}getElement(t,n){return this[n*this.RANK+t]}setElement(t,n,s){return this[n*this.RANK+t]=N(s),this}getColumn(t,n=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)n[r]=this[s+r];return n}setColumn(t,n){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=n[r];return this}}function Wu(){const e=new bt(9);return bt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Xu(e,t){if(e===t){const n=t[1],s=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=s,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function Qu(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=u*o-a*l,f=-u*i+a*c,d=l*i-o*c;let m=n*h+s*f+r*d;return m?(m=1/m,e[0]=h*m,e[1]=(-u*s+r*l)*m,e[2]=(a*s-r*o)*m,e[3]=f*m,e[4]=(u*n-r*c)*m,e[5]=(-a*n+r*i)*m,e[6]=d*m,e[7]=(-l*n+s*c)*m,e[8]=(o*n-s*i)*m,e):null}function qu(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+n*(-l*r+o*a)+s*(c*r-i*a)}function xi(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1],m=n[2],A=n[3],y=n[4],E=n[5],w=n[6],B=n[7],C=n[8];return e[0]=f*s+d*o+m*l,e[1]=f*r+d*a+m*u,e[2]=f*i+d*c+m*h,e[3]=A*s+y*o+E*l,e[4]=A*r+y*a+E*u,e[5]=A*i+y*c+E*h,e[6]=w*s+B*o+C*l,e[7]=w*r+B*a+C*u,e[8]=w*i+B*c+C*h,e}function Yu(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=n[0],d=n[1];return e[0]=s,e[1]=r,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=f*s+d*o+l,e[7]=f*r+d*a+u,e[8]=f*i+d*c+h,e}function $u(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=Math.sin(n),d=Math.cos(n);return e[0]=d*s+f*o,e[1]=d*r+f*a,e[2]=d*i+f*c,e[3]=d*o-f*s,e[4]=d*a-f*r,e[5]=d*c-f*i,e[6]=l,e[7]=u,e[8]=h,e}function vi(e,t,n){const s=n[0],r=n[1];return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Zu(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,A=i*o,y=i*a,E=i*c;return e[0]=1-h-m,e[3]=u-E,e[6]=f+y,e[1]=u+E,e[4]=1-l-m,e[7]=d-A,e[2]=f-y,e[5]=d+A,e[8]=1-l-h,e}var ps;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(ps||(ps={}));const th=Object.freeze([1,0,0,0,1,0,0,0,1]);class z extends Ii{static get IDENTITY(){return nh()}static get ZERO(){return eh()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return ps}constructor(t,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):n.length>0?this.copy([t,...n]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(th)}fromObject(t){return this.check()}fromQuaternion(t){return Zu(this,t),this.check()}set(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=a,this[3]=n,this[4]=i,this[5]=c,this[6]=s,this[7]=o,this[8]=l,this.check()}determinant(){return qu(this)}transpose(){return Xu(this,this),this.check()}invert(){return Qu(this,this),this.check()}multiplyLeft(t){return xi(this,t,this),this.check()}multiplyRight(t){return xi(this,this,t),this.check()}rotate(t){return $u(this,this,t),this.check()}scale(t){return Array.isArray(t)?vi(this,this,t):vi(this,this,[t,t]),this.check()}translate(t){return Yu(this,this,t),this.check()}transform(t,n){let s;switch(t.length){case 2:s=Bi(n||[-0,-0],t,this);break;case 3:s=Mi(n||[-0,-0,-0],t,this);break;case 4:s=bi(n||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return we(s,t.length),s}transformVector(t,n){return this.transform(t,n)}transformVector2(t,n){return this.transform(t,n)}transformVector3(t,n){return this.transform(t,n)}}let cn,ln=null;function eh(){return cn||(cn=new z([0,0,0,0,0,0,0,0,0]),Object.freeze(cn)),cn}function nh(){return ln||(ln=new z,Object.freeze(ln)),ln}function sh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function rh(e,t){if(e===t){const n=t[1],s=t[2],r=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=i,e[11]=t[14],e[12]=r,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function ih(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],h=t[9],f=t[10],d=t[11],m=t[12],A=t[13],y=t[14],E=t[15],w=n*a-s*o,B=n*c-r*o,C=n*l-i*o,R=s*c-r*a,b=s*l-i*a,v=r*l-i*c,O=u*A-h*m,x=u*y-f*m,D=u*E-d*m,k=h*y-f*A,X=h*E-d*A,Q=f*E-d*y;let L=w*Q-B*X+C*k+R*D-b*x+v*O;return L?(L=1/L,e[0]=(a*Q-c*X+l*k)*L,e[1]=(r*X-s*Q-i*k)*L,e[2]=(A*v-y*b+E*R)*L,e[3]=(f*b-h*v-d*R)*L,e[4]=(c*D-o*Q-l*x)*L,e[5]=(n*Q-r*D+i*x)*L,e[6]=(y*C-m*v-E*B)*L,e[7]=(u*v-f*C+d*B)*L,e[8]=(o*X-a*D+l*O)*L,e[9]=(s*D-n*X-i*O)*L,e[10]=(m*b-A*C+E*w)*L,e[11]=(h*C-u*b-d*w)*L,e[12]=(a*x-o*k-c*O)*L,e[13]=(n*k-s*x+r*O)*L,e[14]=(A*B-m*R-y*w)*L,e[15]=(u*R-h*B+f*w)*L,e):null}function oh(e){const t=e[0],n=e[1],s=e[2],r=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11],d=e[12],m=e[13],A=e[14],y=e[15],E=t*o-n*i,w=t*a-s*i,B=n*a-s*o,C=l*m-u*d,R=l*A-h*d,b=u*A-h*m,v=t*b-n*R+s*C,O=i*b-o*R+a*C,x=l*B-u*w+h*E,D=d*B-m*w+A*E;return c*v-r*O+y*x-f*D}function Oi(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],u=t[7],h=t[8],f=t[9],d=t[10],m=t[11],A=t[12],y=t[13],E=t[14],w=t[15];let B=n[0],C=n[1],R=n[2],b=n[3];return e[0]=B*s+C*a+R*h+b*A,e[1]=B*r+C*c+R*f+b*y,e[2]=B*i+C*l+R*d+b*E,e[3]=B*o+C*u+R*m+b*w,B=n[4],C=n[5],R=n[6],b=n[7],e[4]=B*s+C*a+R*h+b*A,e[5]=B*r+C*c+R*f+b*y,e[6]=B*i+C*l+R*d+b*E,e[7]=B*o+C*u+R*m+b*w,B=n[8],C=n[9],R=n[10],b=n[11],e[8]=B*s+C*a+R*h+b*A,e[9]=B*r+C*c+R*f+b*y,e[10]=B*i+C*l+R*d+b*E,e[11]=B*o+C*u+R*m+b*w,B=n[12],C=n[13],R=n[14],b=n[15],e[12]=B*s+C*a+R*h+b*A,e[13]=B*r+C*c+R*f+b*y,e[14]=B*i+C*l+R*d+b*E,e[15]=B*o+C*u+R*m+b*w,e}function ah(e,t,n){const s=n[0],r=n[1],i=n[2];let o,a,c,l,u,h,f,d,m,A,y,E;return t===e?(e[12]=t[0]*s+t[4]*r+t[8]*i+t[12],e[13]=t[1]*s+t[5]*r+t[9]*i+t[13],e[14]=t[2]*s+t[6]*r+t[10]*i+t[14],e[15]=t[3]*s+t[7]*r+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],u=t[4],h=t[5],f=t[6],d=t[7],m=t[8],A=t[9],y=t[10],E=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=u,e[5]=h,e[6]=f,e[7]=d,e[8]=m,e[9]=A,e[10]=y,e[11]=E,e[12]=o*s+u*r+m*i+t[12],e[13]=a*s+h*r+A*i+t[13],e[14]=c*s+f*r+y*i+t[14],e[15]=l*s+d*r+E*i+t[15]),e}function ch(e,t,n){const s=n[0],r=n[1],i=n[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function lh(e,t,n,s){let r=s[0],i=s[1],o=s[2],a=Math.sqrt(r*r+i*i+o*o),c,l,u,h,f,d,m,A,y,E,w,B,C,R,b,v,O,x,D,k,X,Q,L,rt;return a<Re?null:(a=1/a,r*=a,i*=a,o*=a,l=Math.sin(n),c=Math.cos(n),u=1-c,h=t[0],f=t[1],d=t[2],m=t[3],A=t[4],y=t[5],E=t[6],w=t[7],B=t[8],C=t[9],R=t[10],b=t[11],v=r*r*u+c,O=i*r*u+o*l,x=o*r*u-i*l,D=r*i*u-o*l,k=i*i*u+c,X=o*i*u+r*l,Q=r*o*u+i*l,L=i*o*u-r*l,rt=o*o*u+c,e[0]=h*v+A*O+B*x,e[1]=f*v+y*O+C*x,e[2]=d*v+E*O+R*x,e[3]=m*v+w*O+b*x,e[4]=h*D+A*k+B*X,e[5]=f*D+y*k+C*X,e[6]=d*D+E*k+R*X,e[7]=m*D+w*k+b*X,e[8]=h*Q+A*L+B*rt,e[9]=f*Q+y*L+C*rt,e[10]=d*Q+E*L+R*rt,e[11]=m*Q+w*L+b*rt,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function uh(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*s,e[5]=o*r+u*s,e[6]=a*r+h*s,e[7]=c*r+f*s,e[8]=l*r-i*s,e[9]=u*r-o*s,e[10]=h*r-a*s,e[11]=f*r-c*s,e}function hh(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],u=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*s,e[1]=o*r-u*s,e[2]=a*r-h*s,e[3]=c*r-f*s,e[8]=i*s+l*r,e[9]=o*s+u*r,e[10]=a*s+h*r,e[11]=c*s+f*r,e}function fh(e,t,n){const s=Math.sin(n),r=Math.cos(n),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],u=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*s,e[1]=o*r+u*s,e[2]=a*r+h*s,e[3]=c*r+f*s,e[4]=l*r-i*s,e[5]=u*r-o*s,e[6]=h*r-a*s,e[7]=f*r-c*s,e}function dh(e,t){const n=t[0],s=t[1],r=t[2],i=t[4],o=t[5],a=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(n*n+s*s+r*r),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+l*l+u*u),e}function mh(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n+n,a=s+s,c=r+r,l=n*o,u=s*o,h=s*a,f=r*o,d=r*a,m=r*c,A=i*o,y=i*a,E=i*c;return e[0]=1-h-m,e[1]=u+E,e[2]=f-y,e[3]=0,e[4]=u-E,e[5]=1-l-m,e[6]=d+A,e[7]=0,e[8]=f+y,e[9]=d-A,e[10]=1-l-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gh(e,t,n,s,r,i,o){const a=1/(n-t),c=1/(r-s),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+s)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function Ah(e,t,n,s,r){const i=1/Math.tan(t/2);if(e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0){const o=1/(s-r);e[10]=(r+s)*o,e[14]=2*r*s*o}else e[10]=-1,e[14]=-2*s;return e}const ph=Ah;function yh(e,t,n,s,r,i,o){const a=1/(t-n),c=1/(s-r),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*a,e[13]=(r+s)*c,e[14]=(o+i)*l,e[15]=1,e}const Bh=yh;function Ch(e,t,n,s){let r,i,o,a,c,l,u,h,f,d;const m=t[0],A=t[1],y=t[2],E=s[0],w=s[1],B=s[2],C=n[0],R=n[1],b=n[2];return Math.abs(m-C)<Re&&Math.abs(A-R)<Re&&Math.abs(y-b)<Re?sh(e):(h=m-C,f=A-R,d=y-b,r=1/Math.sqrt(h*h+f*f+d*d),h*=r,f*=r,d*=r,i=w*d-B*f,o=B*h-E*d,a=E*f-w*h,r=Math.sqrt(i*i+o*o+a*a),r?(r=1/r,i*=r,o*=r,a*=r):(i=0,o=0,a=0),c=f*a-d*o,l=d*i-h*a,u=h*o-f*i,r=Math.sqrt(c*c+l*l+u*u),r?(r=1/r,c*=r,l*=r,u*=r):(c=0,l=0,u=0),e[0]=i,e[1]=c,e[2]=h,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=a,e[9]=u,e[10]=d,e[11]=0,e[12]=-(i*m+o*A+a*y),e[13]=-(c*m+l*A+u*y),e[14]=-(h*m+f*A+d*y),e[15]=1,e)}function Eh(){const e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Th(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function bh(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function _h(e){const t=e[0],n=e[1],s=e[2],r=e[3];return Math.sqrt(t*t+n*n+s*s+r*r)}function wh(e){const t=e[0],n=e[1],s=e[2],r=e[3];return t*t+n*n+s*s+r*r}function Rh(e,t){const n=t[0],s=t[1],r=t[2],i=t[3];let o=n*n+s*s+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=s*o,e[2]=r*o,e[3]=i*o,e}function Mh(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Sh(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r+s*(n[0]-r),e[1]=i+s*(n[1]-i),e[2]=o+s*(n[2]-o),e[3]=a+s*(n[3]-a),e}function Ih(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3];return e[0]=n[0]*s+n[4]*r+n[8]*i+n[12]*o,e[1]=n[1]*s+n[5]*r+n[9]*i+n[13]*o,e[2]=n[2]*s+n[6]*r+n[10]*i+n[14]*o,e[3]=n[3]*s+n[7]*r+n[11]*i+n[15]*o,e}function xh(e,t,n){const s=t[0],r=t[1],i=t[2],o=n[0],a=n[1],c=n[2],l=n[3],u=l*s+a*i-c*r,h=l*r+c*s-o*i,f=l*i+o*r-a*s,d=-o*s-a*r-c*i;return e[0]=u*l+d*-o+h*-c-f*-a,e[1]=h*l+d*-a+f*-o-u*-c,e[2]=f*l+d*-c+u*-a-h*-o,e[3]=t[3],e}(function(){const e=Eh();return function(t,n,s,r,i,o){let a,c;for(n||(n=4),s||(s=0),r?c=Math.min(r*n+s,t.length):c=t.length,a=s;a<c;a+=n)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}})();var ys;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(ys||(ys={}));const vh=45*Math.PI/180,Oh=1,Bs=.1,Cs=500,Fh=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class V extends Ii{static get IDENTITY(){return Lh()}static get ZERO(){return Dh()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return ys}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,n,s,r,i,o,a,c,l,u,h,f,d,m,A,y){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=m,this[14]=A,this[15]=y,this.check()}setRowMajor(t,n,s,r,i,o,a,c,l,u,h,f,d,m,A,y){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=m,this[8]=s,this[9]=a,this[10]=h,this[11]=A,this[12]=r,this[13]=c,this[14]=f,this[15]=y,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Fh)}fromObject(t){return this.check()}fromQuaternion(t){return mh(this,t),this.check()}frustum(t){const{left:n,right:s,bottom:r,top:i,near:o=Bs,far:a=Cs}=t;return a===1/0?Ph(this,n,s,r,i,o):gh(this,n,s,r,i,o,a),this.check()}lookAt(t){const{eye:n,center:s=[0,0,0],up:r=[0,1,0]}=t;return Ch(this,n,s,r),this.check()}ortho(t){const{left:n,right:s,bottom:r,top:i,near:o=Bs,far:a=Cs}=t;return Bh(this,n,s,r,i,o,a),this.check()}orthographic(t){const{fovy:n=vh,aspect:s=Oh,focalDistance:r=1,near:i=Bs,far:o=Cs}=t;Fi(n);const a=n/2,c=r*Math.tan(a),l=c*s;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){const{fovy:n=45*Math.PI/180,aspect:s=1,near:r=.1,far:i=500}=t;return Fi(n),ph(this,n,s,r,i),this.check()}determinant(){return oh(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,n){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const s=this.getScale(n),r=1/s[0],i=1/s[1],o=1/s[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return rh(this,this),this.check()}invert(){return ih(this,this),this.check()}multiplyLeft(t){return Oi(this,t,this),this.check()}multiplyRight(t){return Oi(this,this,t),this.check()}rotateX(t){return uh(this,this,t),this.check()}rotateY(t){return hh(this,this,t),this.check()}rotateZ(t){return fh(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,n){return lh(this,this,t,n),this.check()}scale(t){return ch(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return ah(this,this,t),this.check()}transform(t,n){return t.length===4?(n=Ih(n||[-0,-0,-0,-0],t,this),we(n,4),n):this.transformAsPoint(t,n)}transformAsPoint(t,n){const{length:s}=t;let r;switch(s){case 2:r=Ci(n||[-0,-0],t,this);break;case 3:r=ms(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return we(r,t.length),r}transformAsVector(t,n){let s;switch(t.length){case 2:s=Ei(n||[-0,-0],t,this);break;case 3:s=Ti(n||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return we(s,t.length),s}transformPoint(t,n){return this.transformAsPoint(t,n)}transformVector(t,n){return this.transformAsPoint(t,n)}transformDirection(t,n){return this.transformAsVector(t,n)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,n,s){return this.identity().translate([t,n,s])}}let un,hn;function Dh(){return un||(un=new V([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(un)),un}function Lh(){return hn||(hn=new V,Object.freeze(hn)),hn}function Fi(e){if(e>Math.PI*2)throw Error("expected radians")}function Ph(e,t,n,s,r,i){const o=2*i/(n-t),a=2*i/(r-s),c=(n+t)/(n-t),l=(r+s)/(r-s),u=-1,h=-1,f=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=u,e[11]=h,e[12]=0,e[13]=0,e[14]=f,e[15]=0,e}function Di(){const e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Gh(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Li(e,t,n){n=n*.5;const s=Math.sin(n);return e[0]=s*t[0],e[1]=s*t[1],e[2]=s*t[2],e[3]=Math.cos(n),e}function Pi(e,t,n){const s=t[0],r=t[1],i=t[2],o=t[3],a=n[0],c=n[1],l=n[2],u=n[3];return e[0]=s*u+o*a+r*l-i*c,e[1]=r*u+o*c+i*a-s*l,e[2]=i*u+o*l+s*c-r*a,e[3]=o*u-s*a-r*c-i*l,e}function Nh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+o*a,e[1]=r*c+i*a,e[2]=i*c-r*a,e[3]=o*c-s*a,e}function Uh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c-i*a,e[1]=r*c+o*a,e[2]=i*c+s*a,e[3]=o*c-r*a,e}function Hh(e,t,n){n*=.5;const s=t[0],r=t[1],i=t[2],o=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=s*c+r*a,e[1]=r*c-s*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function Jh(e,t){const n=t[0],s=t[1],r=t[2];return e[0]=n,e[1]=s,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-s*s-r*r)),e}function fn(e,t,n,s){const r=t[0],i=t[1],o=t[2],a=t[3];let c=n[0],l=n[1],u=n[2],h=n[3],f,d,m,A,y;return f=r*c+i*l+o*u+a*h,f<0&&(f=-f,c=-c,l=-l,u=-u,h=-h),1-f>Re?(d=Math.acos(f),y=Math.sin(d),m=Math.sin((1-s)*d)/y,A=Math.sin(s*d)/y):(m=1-s,A=s),e[0]=m*r+A*c,e[1]=m*i+A*l,e[2]=m*o+A*u,e[3]=m*a+A*h,e}function Vh(e,t){const n=t[0],s=t[1],r=t[2],i=t[3],o=n*n+s*s+r*r+i*i,a=o?1/o:0;return e[0]=-n*a,e[1]=-s*a,e[2]=-r*a,e[3]=i*a,e}function jh(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function Gi(e,t){const n=t[0]+t[4]+t[8];let s;if(n>0)s=Math.sqrt(n+1),e[3]=.5*s,s=.5/s,e[0]=(t[5]-t[7])*s,e[1]=(t[6]-t[2])*s,e[2]=(t[1]-t[3])*s;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;s=Math.sqrt(t[r*3+r]-t[i*3+i]-t[o*3+o]+1),e[r]=.5*s,s=.5/s,e[3]=(t[i*3+o]-t[o*3+i])*s,e[i]=(t[i*3+r]+t[r*3+i])*s,e[o]=(t[o*3+r]+t[r*3+o])*s}return e}const kh=Th,Kh=bh,zh=Mh,Wh=Sh,Xh=_h,Qh=wh,Ni=Rh,qh=function(){const e=_i(),t=Ri(1,0,0),n=Ri(0,1,0);return function(s,r,i){const o=ds(r,i);return o<-.999999?(rn(e,t,r),zu(e)<1e-6&&rn(e,n,r),Ju(e,e),Li(s,e,Math.PI),s):o>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(rn(e,r,i),s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=1+o,Ni(s,s))}}();(function(){const e=Di(),t=Di();return function(n,s,r,i,o,a){return fn(e,s,o,a),fn(t,r,i,a),fn(n,e,t,2*a*(1-a)),n}})(),function(){const e=Wu();return function(t,n,s,r){return e[0]=s[0],e[3]=s[1],e[6]=s[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Ni(t,Gi(t,e))}}();const Yh=[0,0,0,1];class dn extends hs{constructor(t=0,n=0,s=0,r=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,n,s,r)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,n,s,r){return this[0]=t,this[1]=n,this[2]=s,this[3]=r,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return Gi(this,t),this.check()}fromAxisRotation(t,n){return Li(this,t,n),this.check()}identity(){return Gh(this),this.check()}setAxisAngle(t,n){return this.fromAxisRotation(t,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=N(t)}get y(){return this[1]}set y(t){this[1]=N(t)}get z(){return this[2]}set z(t){this[2]=N(t)}get w(){return this[3]}set w(t){this[3]=N(t)}len(){return Xh(this)}lengthSquared(){return Qh(this)}dot(t){return zh(this,t)}rotationTo(t,n){return qh(this,t,n),this.check()}add(t){return kh(this,this,t),this.check()}calculateW(){return Jh(this,this),this.check()}conjugate(){return jh(this,this),this.check()}invert(){return Vh(this,this),this.check()}lerp(t,n,s){return s===void 0?this.lerp(this,t,n):(Wh(this,t,n,s),this.check())}multiplyRight(t){return Pi(this,this,t),this.check()}multiplyLeft(t){return Pi(this,t,this),this.check()}normalize(){const t=this.len(),n=t>0?1/t:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,t===0&&(this[3]=1),this.check()}rotateX(t){return Nh(this,this,t),this.check()}rotateY(t){return Uh(this,this,t),this.check()}rotateZ(t){return Hh(this,this,t),this.check()}scale(t){return Kh(this,this,t),this.check()}slerp(t,n,s){let r,i,o;switch(arguments.length){case 1:({start:r=Yh,target:i,ratio:o}=t);break;case 2:r=this,i=t,o=n;break;default:r=t,i=n,o=s}return fn(this,r,i,o),this.check()}transformVector4(t,n=new As){return xh(n,t,this),we(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,n){return this.setAxisAngle(t,n)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}}function Me(e){"@babel/helpers - typeof";return Me=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Me(e)}function $h(e,t){if(Me(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(Me(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Zh(e){var t=$h(e,"string");return Me(t)=="symbol"?t:String(t)}function I(e,t,n){return t=Zh(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const tf=.1,ef=1e-12,Ui=1e-15,nf=1e-20,sf=6378137,rf=6378137,of=6356752314245179e-9;function mn(e){return e}new p;function af(e,t=[],n=mn){return"longitude"in e?(t[0]=n(e.longitude),t[1]=n(e.latitude),t[2]=e.height):"x"in e?(t[0]=n(e.x),t[1]=n(e.y),t[2]=e.z):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function cf(e,t=[]){return af(e,t,Y._cartographicRadians?mn:Su)}function lf(e,t,n=mn){return"longitude"in t?(t.longitude=n(e[0]),t.latitude=n(e[1]),t.height=e[2]):"x"in t?(t.x=n(e[0]),t.y=n(e[1]),t.z=e[2]):(t[0]=n(e[0]),t[1]=n(e[1]),t[2]=e[2]),t}function uf(e,t){return lf(e,t,Y._cartographicRadians?mn:Iu)}const Hi=1e-14,hf=new p,Ji={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Es={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Se={east:new p,north:new p,up:new p,west:new p,south:new p,down:new p},ff=new p,df=new p,mf=new p;function Vi(e,t,n,s,r,i){const o=Ji[t]&&Ji[t][n];j(o&&(!s||s===o));let a,c,l;const u=hf.copy(r);if(Ht(u.x,0,Hi)&&Ht(u.y,0,Hi)){const f=Math.sign(u.z);a=ff.fromArray(Es[t]),t!=="east"&&t!=="west"&&a.scale(f),c=df.fromArray(Es[n]),n!=="east"&&n!=="west"&&c.scale(f),l=mf.fromArray(Es[s]),s!=="east"&&s!=="west"&&l.scale(f)}else{const{up:f,east:d,north:m}=Se;d.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,f),m.copy(f).cross(d);const{down:A,west:y,south:E}=Se;A.copy(f).scale(-1),y.copy(d).scale(-1),E.copy(m).scale(-1),a=Se[t],c=Se[n],l=Se[s]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=u.x,i[13]=u.y,i[14]=u.z,i[15]=1,i}const ae=new p,gf=new p,Af=new p;function pf(e,t,n=[]){const{oneOverRadii:s,oneOverRadiiSquared:r,centerToleranceSquared:i}=t;ae.from(e);const o=ae.x,a=ae.y,c=ae.z,l=s.x,u=s.y,h=s.z,f=o*o*l*l,d=a*a*u*u,m=c*c*h*h,A=f+d+m,y=Math.sqrt(1/A);if(!Number.isFinite(y))return;const E=gf;if(E.copy(e).scale(y),A<i)return E.to(n);const w=r.x,B=r.y,C=r.z,R=Af;R.set(E.x*w*2,E.y*B*2,E.z*C*2);let b=(1-y)*ae.len()/(.5*R.len()),v=0,O,x,D,k;do{b-=v,O=1/(1+b*w),x=1/(1+b*B),D=1/(1+b*C);const X=O*O,Q=x*x,L=D*D,rt=X*O,ne=Q*x,Ae=L*D;k=f*X+d*Q+m*L-1;const Nt=-2*(f*rt*w+d*ne*B+m*Ae*C);v=k/Nt}while(Math.abs(k)>ef);return ae.scale([O,x,D]).to(n)}const gn=new p,ji=new p,yf=new p,_t=new p,Bf=new p,An=new p;class J{constructor(t=0,n=0,s=0){I(this,"radii",void 0),I(this,"radiiSquared",void 0),I(this,"radiiToTheFourth",void 0),I(this,"oneOverRadii",void 0),I(this,"oneOverRadiiSquared",void 0),I(this,"minimumRadius",void 0),I(this,"maximumRadius",void 0),I(this,"centerToleranceSquared",tf),I(this,"squaredXOverSquaredZ",void 0),j(t>=0),j(n>=0),j(s>=0),this.radii=new p(t,n,s),this.radiiSquared=new p(t*t,n*n,s*s),this.radiiToTheFourth=new p(t*t*t*t,n*n*n*n,s*s*s*s),this.oneOverRadii=new p(t===0?0:1/t,n===0?0:1/n,s===0?0:1/s),this.oneOverRadiiSquared=new p(t===0?0:1/(t*t),n===0?0:1/(n*n),s===0?0:1/(s*s)),this.minimumRadius=Math.min(t,n,s),this.maximumRadius=Math.max(t,n,s),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||!!(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,n=[0,0,0]){const s=ji,r=yf,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,s),r.copy(this.radiiSquared).scale(s);const o=Math.sqrt(s.dot(r));return r.scale(1/o),s.scale(i),r.add(s),r.to(n)}cartesianToCartographic(t,n=[0,0,0]){An.from(t);const s=this.scaleToGeodeticSurface(An,_t);if(!s)return;const r=this.geodeticSurfaceNormal(s,ji),i=Bf;i.copy(An).subtract(s);const o=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(ds(i,An))*wi(i);return uf([o,a,c],n)}eastNorthUpToFixedFrame(t,n=new V){return Vi(this,"east","north","up",t,n)}localFrameToFixedFrame(t,n,s,r,i=new V){return Vi(this,t,n,s,r,i)}geocentricSurfaceNormal(t,n=[0,0,0]){return gn.from(t).normalize().to(n)}geodeticSurfaceNormalCartographic(t,n=[0,0,0]){const s=cf(t),r=s[0],i=s[1],o=Math.cos(i);return gn.set(o*Math.cos(r),o*Math.sin(r),Math.sin(i)).normalize(),gn.to(n)}geodeticSurfaceNormal(t,n=[0,0,0]){return gn.from(t).scale(this.oneOverRadiiSquared).normalize().to(n)}scaleToGeodeticSurface(t,n){return pf(t,this,n)}scaleToGeocentricSurface(t,n=[0,0,0]){_t.from(t);const s=_t.x,r=_t.y,i=_t.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(s*s*o.x+r*r*o.y+i*i*o.z);return _t.multiplyScalar(a).to(n)}transformPositionToScaledSpace(t,n=[0,0,0]){return _t.from(t).scale(this.oneOverRadii).to(n)}transformPositionFromScaledSpace(t,n=[0,0,0]){return _t.from(t).scale(this.radii).to(n)}getSurfaceNormalIntersectionWithZAxis(t,n=0,s=[0,0,0]){j(Ht(this.radii.x,this.radii.y,Ui)),j(this.radii.z>0),_t.from(t);const r=_t.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-n))return _t.set(0,0,r).to(s)}}I(J,"WGS84",new J(sf,rf,of));class Cf{constructor(t,n,s){this.item=void 0,this.previous=void 0,this.next=void 0,this.item=t,this.previous=n,this.next=s}}class Ef{constructor(){this.head=null,this.tail=null,this._length=0}get length(){return this._length}add(t){const n=new Cf(t,this.tail,null);return this.tail?(this.tail.next=n,this.tail=n):(this.head=n,this.tail=n),++this._length,n}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,n){t!==n&&(this.remove(n),this._insert(t,n))}_insert(t,n){const s=t.next;t.next=n,this.tail===t?this.tail=n:s.previous=n,n.next=s,n.previous=t,++this._length}}class Tf{constructor(){this._list=void 0,this._sentinel=void 0,this._trimTiles=void 0,this._list=new Ef,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){const n=t._cacheNode;n&&this._list.splice(this._sentinel,n)}add(t,n,s){n._cacheNode||(n._cacheNode=this._list.add(n),s&&s(t,n))}unloadTile(t,n,s){const r=n._cacheNode;r&&(this._list.remove(r),n._cacheNode=null,s&&s(t,n))}unloadTiles(t,n){const s=this._trimTiles;this._trimTiles=!1;const r=this._list,i=t.maximumMemoryUsage*1024*1024,o=this._sentinel;let a=r.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>i||s);){const c=a.item;a=a.next,this.unloadTile(t,c,n)}}trim(){this._trimTiles=!0}}function bf(e,t){U(e),U(t);const{rtcCenter:n,gltfUpAxis:s}=t,{computedTransform:r,boundingVolume:{center:i}}=e;let o=new V(r);switch(n&&o.translate(n),s){case"Z":break;case"Y":const h=new V().rotateX(Math.PI/2);o=o.multiplyRight(h);break;case"X":const f=new V().rotateY(-Math.PI/2);o=o.multiplyRight(f);break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const a=new p(i);t.cartesianModelMatrix=o,t.cartesianOrigin=a;const c=J.WGS84.cartesianToCartographic(a,new p),u=J.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=u.multiplyRight(o),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}const ft={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new p,new p;const Ie=new p,ki=new p;class xe{constructor(t=[0,0,0],n=0){I(this,"center",void 0),I(this,"radius",void 0),this.radius=-0,this.center=new p,this.fromCenterRadius(t,n)}fromCenterRadius(t,n){return this.center.from(t),this.radius=n,this}fromCornerPoints(t,n){return n=Ie.from(n),this.center=new p().from(t).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new xe(this.center,this.radius)}union(t){const n=this.center,s=this.radius,r=t.center,i=t.radius,o=Ie.copy(r).subtract(n),a=o.magnitude();if(s>=a+i)return this.clone();if(i>=a+s)return t.clone();const c=(s+a+i)*.5;return ki.copy(o).scale((-s+c)/a).add(n),this.center.copy(ki),this.radius=c,this}expand(t){const s=Ie.from(t).subtract(this.center).magnitude();return s>this.radius&&(this.radius=s),this}transform(t){this.center.transform(t);const n=dh(Ie,t);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(t){const n=this.distanceTo(t);return n*n}distanceTo(t){const s=Ie.from(t).subtract(this.center);return Math.max(0,s.len()-this.radius)}intersectPlane(t){const n=this.center,s=this.radius,i=t.normal.dot(n)+t.distance;return i<-s?ft.OUTSIDE:i<s?ft.INTERSECTING:ft.INSIDE}}const _f=new p,wf=new p,pn=new p,yn=new p,Bn=new p,Rf=new p,Mf=new p,Lt={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class ve{constructor(t=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){I(this,"center",void 0),I(this,"halfAxes",void 0),this.center=new p().from(t),this.halfAxes=new z(n)}get halfSize(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2);return[new p(t).len(),new p(n).len(),new p(s).len()]}get quaternion(){const t=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),s=this.halfAxes.getColumn(2),r=new p(t).normalize(),i=new p(n).normalize(),o=new p(s).normalize();return new dn().fromMatrix3(new z([...r,...i,...o]))}fromCenterHalfSizeQuaternion(t,n,s){const r=new dn(s),i=new z().fromQuaternion(r);return i[0]=i[0]*n[0],i[1]=i[1]*n[0],i[2]=i[2]*n[0],i[3]=i[3]*n[1],i[4]=i[4]*n[1],i[5]=i[5]*n[1],i[6]=i[6]*n[2],i[7]=i[7]*n[2],i[8]=i[8]*n[2],this.center=new p().from(t),this.halfAxes=i,this}clone(){return new ve(this.center,this.halfAxes)}equals(t){return this===t||!!t&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new xe){const n=this.halfAxes,s=n.getColumn(0,pn),r=n.getColumn(1,yn),i=n.getColumn(2,Bn),o=_f.copy(s).add(r).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){const n=this.center,s=t.normal,r=this.halfAxes,i=s.x,o=s.y,a=s.z,c=Math.abs(i*r[Lt.COLUMN0ROW0]+o*r[Lt.COLUMN0ROW1]+a*r[Lt.COLUMN0ROW2])+Math.abs(i*r[Lt.COLUMN1ROW0]+o*r[Lt.COLUMN1ROW1]+a*r[Lt.COLUMN1ROW2])+Math.abs(i*r[Lt.COLUMN2ROW0]+o*r[Lt.COLUMN2ROW1]+a*r[Lt.COLUMN2ROW2]),l=s.dot(n)+t.distance;return l<=-c?ft.OUTSIDE:l>=c?ft.INSIDE:ft.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){const n=wf.from(t).subtract(this.center),s=this.halfAxes,r=s.getColumn(0,pn),i=s.getColumn(1,yn),o=s.getColumn(2,Bn),a=r.magnitude(),c=i.magnitude(),l=o.magnitude();r.normalize(),i.normalize(),o.normalize();let u=0,h;return h=Math.abs(n.dot(r))-a,h>0&&(u+=h*h),h=Math.abs(n.dot(i))-c,h>0&&(u+=h*h),h=Math.abs(n.dot(o))-l,h>0&&(u+=h*h),u}computePlaneDistances(t,n,s=[-0,-0]){let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,c=a.getColumn(0,pn),l=a.getColumn(1,yn),u=a.getColumn(2,Bn),h=Rf.copy(c).add(l).add(u).add(o),f=Mf.copy(h).subtract(t);let d=n.dot(f);return r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),h.copy(o).add(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).add(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).add(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),o.copy(h).subtract(c).subtract(l).subtract(u),f.copy(h).subtract(t),d=n.dot(f),r=Math.min(d,r),i=Math.max(d,i),s[0]=r,s[1]=i,s}transform(t){this.center.transformAsPoint(t);const n=this.halfAxes.getColumn(0,pn);n.transformAsPoint(t);const s=this.halfAxes.getColumn(1,yn);s.transformAsPoint(t);const r=this.halfAxes.getColumn(2,Bn);return r.transformAsPoint(t),this.halfAxes=new z([...n,...s,...r]),this}getTransform(){throw new Error("not implemented")}}const Ki=new p,zi=new p;class ${constructor(t=[0,0,1],n=0){I(this,"normal",void 0),I(this,"distance",void 0),this.normal=new p,this.distance=-0,this.fromNormalDistance(t,n)}fromNormalDistance(t,n){return j(Number.isFinite(n)),this.normal.from(t).normalize(),this.distance=n,this}fromPointNormal(t,n){t=Ki.from(t),this.normal.from(n).normalize();const s=-this.normal.dot(t);return this.distance=s,this}fromCoefficients(t,n,s,r){return this.normal.set(t,n,s),j(Ht(this.normal.len(),1)),this.distance=r,this}clone(){return new $(this.normal,this.distance)}equals(t){return Ht(this.distance,t.distance)&&Ht(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){const n=zi.copy(this.normal).transformAsVector(t).normalize(),s=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(s,n)}projectPointOntoPlane(t,n=[0,0,0]){const s=Ki.from(t),r=this.getPointDistance(s),i=zi.copy(this.normal).scale(r);return s.subtract(i).to(n)}}const Wi=[new p([1,0,0]),new p([0,1,0]),new p([0,0,1])],Xi=new p,Sf=new p;class ot{constructor(t=[]){I(this,"planes",void 0),this.planes=t}fromBoundingSphere(t){this.planes.length=2*Wi.length;const n=t.center,s=t.radius;let r=0;for(const i of Wi){let o=this.planes[r],a=this.planes[r+1];o||(o=this.planes[r]=new $),a||(a=this.planes[r+1]=new $);const c=Xi.copy(i).scale(-s).add(n);o.fromPointNormal(c,i);const l=Xi.copy(i).scale(s).add(n),u=Sf.copy(i).negate();a.fromPointNormal(l,u),r+=2}return this}computeVisibility(t){let n=ft.INSIDE;for(const s of this.planes)switch(t.intersectPlane(s)){case ft.OUTSIDE:return ft.OUTSIDE;case ft.INTERSECTING:n=ft.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(t,n){if(j(Number.isFinite(n),"parentPlaneMask is required."),n===ot.MASK_OUTSIDE||n===ot.MASK_INSIDE)return n;let s=ot.MASK_INSIDE;const r=this.planes;for(let i=0;i<this.planes.length;++i){const o=i<31?1<<i:0;if(i<31&&!(n&o))continue;const a=r[i],c=t.intersectPlane(a);if(c===ft.OUTSIDE)return ot.MASK_OUTSIDE;c===ft.INTERSECTING&&(s|=o)}return s}}I(ot,"MASK_OUTSIDE",4294967295),I(ot,"MASK_INSIDE",0),I(ot,"MASK_INDETERMINATE",2147483647);const If=new p,xf=new p,vf=new p,Of=new p,Ff=new p;class Cn{constructor(t={}){I(this,"left",void 0),I(this,"_left",void 0),I(this,"right",void 0),I(this,"_right",void 0),I(this,"top",void 0),I(this,"_top",void 0),I(this,"bottom",void 0),I(this,"_bottom",void 0),I(this,"near",void 0),I(this,"_near",void 0),I(this,"far",void 0),I(this,"_far",void 0),I(this,"_cullingVolume",new ot([new $,new $,new $,new $,new $,new $])),I(this,"_perspectiveMatrix",new V),I(this,"_infinitePerspective",new V);const{near:n=1,far:s=5e8}=t;this.left=t.left,this._left=void 0,this.right=t.right,this._right=void 0,this.top=t.top,this._top=void 0,this.bottom=t.bottom,this._bottom=void 0,this.near=n,this._near=n,this.far=s,this._far=s}clone(){return new Cn({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}equals(t){return t&&t instanceof Cn&&this.right===t.right&&this.left===t.left&&this.top===t.top&&this.bottom===t.bottom&&this.near===t.near&&this.far===t.far}get projectionMatrix(){return this._update(),this._perspectiveMatrix}get infiniteProjectionMatrix(){return this._update(),this._infinitePerspective}computeCullingVolume(t,n,s){j(t,"position is required."),j(n,"direction is required."),j(s,"up is required.");const r=this._cullingVolume.planes;s=If.copy(s).normalize();const i=xf.copy(n).cross(s).normalize(),o=vf.copy(n).multiplyByScalar(this.near).add(t),a=Of.copy(n).multiplyByScalar(this.far).add(t);let c=Ff;return c.copy(i).multiplyByScalar(this.left).add(o).subtract(t).cross(s),r[0].fromPointNormal(t,c),c.copy(i).multiplyByScalar(this.right).add(o).subtract(t).cross(s).negate(),r[1].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.bottom).add(o).subtract(t).cross(i).negate(),r[2].fromPointNormal(t,c),c.copy(s).multiplyByScalar(this.top).add(o).subtract(t).cross(i),r[3].fromPointNormal(t,c),c=new p().copy(n),r[4].fromPointNormal(o,c),c.negate(),r[5].fromPointNormal(a,c),this._cullingVolume}getPixelDimensions(t,n,s,r){this._update(),j(Number.isFinite(t)&&Number.isFinite(n)),j(t>0),j(n>0),j(s>0),j(r);const i=1/this.near;let o=this.top*i;const a=2*s*o/n;o=this.right*i;const c=2*s*o/t;return r.x=c,r.y=a,r}_update(){j(Number.isFinite(this.right)&&Number.isFinite(this.left)&&Number.isFinite(this.top)&&Number.isFinite(this.bottom)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const{top:t,bottom:n,right:s,left:r,near:i,far:o}=this;(t!==this._top||n!==this._bottom||r!==this._left||s!==this._right||i!==this._near||o!==this._far)&&(j(this.near>0&&this.near<this.far,"near must be greater than zero and less than far."),this._left=r,this._right=s,this._top=t,this._bottom=n,this._near=i,this._far=o,this._perspectiveMatrix=new V().frustum({left:r,right:s,bottom:n,top:t,near:i,far:o}),this._infinitePerspective=new V().frustum({left:r,right:s,bottom:n,top:t,near:i,far:1/0}))}}const Df=e=>e!==null&&typeof e<"u";class En{constructor(t={}){I(this,"_offCenterFrustum",new Cn),I(this,"fov",void 0),I(this,"_fov",void 0),I(this,"_fovy",void 0),I(this,"_sseDenominator",void 0),I(this,"aspectRatio",void 0),I(this,"_aspectRatio",void 0),I(this,"near",void 0),I(this,"_near",void 0),I(this,"far",void 0),I(this,"_far",void 0),I(this,"xOffset",void 0),I(this,"_xOffset",void 0),I(this,"yOffset",void 0),I(this,"_yOffset",void 0);const{fov:n,aspectRatio:s,near:r=1,far:i=5e8,xOffset:o=0,yOffset:a=0}=t;this.fov=n,this.aspectRatio=s,this.near=r,this.far=i,this.xOffset=o,this.yOffset=a}clone(){return new En({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}equals(t){return!Df(t)||!(t instanceof En)?!1:(this._update(),t._update(),this.fov===t.fov&&this.aspectRatio===t.aspectRatio&&this.near===t.near&&this.far===t.far&&this._offCenterFrustum.equals(t._offCenterFrustum))}get projectionMatrix(){return this._update(),this._offCenterFrustum.projectionMatrix}get infiniteProjectionMatrix(){return this._update(),this._offCenterFrustum.infiniteProjectionMatrix}get fovy(){return this._update(),this._fovy}get sseDenominator(){return this._update(),this._sseDenominator}computeCullingVolume(t,n,s){return this._update(),this._offCenterFrustum.computeCullingVolume(t,n,s)}getPixelDimensions(t,n,s,r){return this._update(),this._offCenterFrustum.getPixelDimensions(t,n,s,r||new sn)}_update(){j(Number.isFinite(this.fov)&&Number.isFinite(this.aspectRatio)&&Number.isFinite(this.near)&&Number.isFinite(this.far));const t=this._offCenterFrustum;(this.fov!==this._fov||this.aspectRatio!==this._aspectRatio||this.near!==this._near||this.far!==this._far||this.xOffset!==this._xOffset||this.yOffset!==this._yOffset)&&(j(this.fov>=0&&this.fov<Math.PI),j(this.aspectRatio>0),j(this.near>=0&&this.near<this.far),this._aspectRatio=this.aspectRatio,this._fov=this.fov,this._fovy=this.aspectRatio<=1?this.fov:Math.atan(Math.tan(this.fov*.5)/this.aspectRatio)*2,this._near=this.near,this._far=this.far,this._sseDenominator=2*Math.tan(.5*this._fovy),this._xOffset=this.xOffset,this._yOffset=this.yOffset,t.top=this.near*Math.tan(.5*this._fovy),t.bottom=-t.top,t.right=this.aspectRatio*t.top,t.left=-t.right,t.near=this.near,t.far=this.far,t.right+=this.xOffset,t.left+=this.xOffset,t.top+=this.yOffset,t.bottom+=this.yOffset)}}new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p,new p;const It=new z,Lf=new z,Pf=new z,Tn=new z,Qi=new z;function Gf(e,t={}){const n=nf,s=10;let r=0,i=0;const o=Lf,a=Pf;o.identity(),a.copy(e);const c=n*Nf(a);for(;i<s&&Uf(a)>c;)Hf(a,Tn),Qi.copy(Tn).transpose(),a.multiplyRight(Tn),a.multiplyLeft(Qi),o.multiplyRight(Tn),++r>2&&(++i,r=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function Nf(e){let t=0;for(let n=0;n<9;++n){const s=e[n];t+=s*s}return Math.sqrt(t)}const Ts=[1,0,0],bs=[2,2,1];function Uf(e){let t=0;for(let n=0;n<3;++n){const s=e[It.getElementIndex(bs[n],Ts[n])];t+=2*s*s}return Math.sqrt(t)}function Hf(e,t){const n=Ui;let s=0,r=1;for(let l=0;l<3;++l){const u=Math.abs(e[It.getElementIndex(bs[l],Ts[l])]);u>s&&(r=l,s=u)}const i=Ts[r],o=bs[r];let a=1,c=0;if(Math.abs(e[It.getElementIndex(o,i)])>n){const l=e[It.getElementIndex(o,o)],u=e[It.getElementIndex(i,i)],h=e[It.getElementIndex(o,i)],f=(l-u)/2/h;let d;f<0?d=-1/(-f+Math.sqrt(1+f*f)):d=1/(f+Math.sqrt(1+f*f)),a=1/Math.sqrt(1+d*d),c=d*a}return z.IDENTITY.to(t),t[It.getElementIndex(i,i)]=t[It.getElementIndex(o,o)]=a,t[It.getElementIndex(o,i)]=c,t[It.getElementIndex(i,o)]=-c,t}const Jt=new p,Jf=new p,Vf=new p,jf=new p,kf=new p,Kf=new z,zf={diagonal:new z,unitary:new z};function Wf(e,t=new ve){if(!e||e.length===0)return t.halfAxes=new z([0,0,0,0,0,0,0,0,0]),t.center=new p,t;const n=e.length,s=new p(0,0,0);for(const x of e)s.add(x);const r=1/n;s.multiplyByScalar(r);let i=0,o=0,a=0,c=0,l=0,u=0;for(const x of e){const D=Jt.copy(x).subtract(s);i+=D.x*D.x,o+=D.x*D.y,a+=D.x*D.z,c+=D.y*D.y,l+=D.y*D.z,u+=D.z*D.z}i*=r,o*=r,a*=r,c*=r,l*=r,u*=r;const h=Kf;h[0]=i,h[1]=o,h[2]=a,h[3]=o,h[4]=c,h[5]=l,h[6]=a,h[7]=l,h[8]=u;const{unitary:f}=Gf(h,zf),d=t.halfAxes.copy(f);let m=d.getColumn(0,Vf),A=d.getColumn(1,jf),y=d.getColumn(2,kf),E=-Number.MAX_VALUE,w=-Number.MAX_VALUE,B=-Number.MAX_VALUE,C=Number.MAX_VALUE,R=Number.MAX_VALUE,b=Number.MAX_VALUE;for(const x of e)Jt.copy(x),E=Math.max(Jt.dot(m),E),w=Math.max(Jt.dot(A),w),B=Math.max(Jt.dot(y),B),C=Math.min(Jt.dot(m),C),R=Math.min(Jt.dot(A),R),b=Math.min(Jt.dot(y),b);m=m.multiplyByScalar(.5*(C+E)),A=A.multiplyByScalar(.5*(R+w)),y=y.multiplyByScalar(.5*(b+B)),t.center.copy(m).add(A).add(y);const v=Jf.set(E-C,w-R,B-b).multiplyByScalar(.5),O=new z([v[0],0,0,0,v[1],0,0,0,v[2]]);return t.halfAxes.multiplyRight(O),t}const qi=new p,_s=new p,ws=new ot([new $,new $,new $,new $,new $,new $]);function Xf(e,t){const{cameraDirection:n,cameraUp:s,height:r}=e,{metersPerUnit:i}=e.distanceScales,o=bn(e,e.center),a=J.WGS84.eastNorthUpToFixedFrame(o),c=e.unprojectPosition(e.cameraPosition),l=J.WGS84.cartographicToCartesian(c,new p),u=new p(a.transformAsVector(new p(n).scale(i))).normalize(),h=new p(a.transformAsVector(new p(s).scale(i))).normalize();qf(e);const f=e.constructor,{longitude:d,latitude:m,width:A,bearing:y,zoom:E}=e,w=new f({longitude:d,latitude:m,height:r,width:A,bearing:y,zoom:E,pitch:0});return{camera:{position:l,direction:u,up:h},viewport:e,topDownViewport:w,height:r,cullingVolume:ws,frameNumber:t,sseDenominator:1.15}}function Qf(e,t,n){if(n===0||e.length<=n)return[e,[]];const s=[],{longitude:r,latitude:i}=t.viewport;for(const[l,u]of e.entries()){const[h,f]=u.header.mbs,d=Math.abs(r-h),m=Math.abs(i-f),A=Math.sqrt(m*m+d*d);s.push([l,A])}const o=s.sort((l,u)=>l[1]-u[1]),a=[];for(let l=0;l<n;l++)a.push(e[o[l][0]]);const c=[];for(let l=n;l<o.length;l++)c.push(e[o[l][0]]);return[a,c]}function qf(e){const t=e.getFrustumPlanes(),n=Yi(t.near,e.cameraPosition),s=bn(e,n),r=bn(e,e.cameraPosition,_s);let i=0;ws.planes[i++].fromPointNormal(s,qi.copy(s).subtract(r));for(const o in t){if(o==="near")continue;const a=t[o],c=Yi(a,n,_s),l=bn(e,c,_s);ws.planes[i++].fromPointNormal(l,qi.copy(s).subtract(l))}}function Yi(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=e.normal.dot(t);return n.copy(e.normal).scale(e.distance-s).add(t),n}function bn(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new p;const s=e.unprojectPosition(t);return J.WGS84.cartographicToCartesian(s,n)}const Yf=6378137,$f=6378137,Rs=6356752314245179e-9,ce=new p;function Zf(e,t){if(e instanceof ve){const{halfAxes:n}=e,s=ed(n);return Math.log2(Rs/(s+t[2]))}else if(e instanceof xe){const{radius:n}=e;return Math.log2(Rs/(n+t[2]))}else if(e.width&&e.height){const{width:n,height:s}=e,r=Math.log2(Yf/n),i=Math.log2($f/s);return(r+i)/2}return 1}function $i(e,t,n){J.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],ce);const s=Math.sqrt(Math.pow(ce[0]-n[0],2)+Math.pow(ce[1]-n[1],2)+Math.pow(ce[2]-n[2],2));return Math.log2(Rs/(s+t[2]))}function td(e,t,n){const[s,r,i,o]=e;return $i({xmin:s,xmax:i,ymin:r,ymax:o,zmin:0,zmax:0},t,n)}function ed(e){e.getColumn(0,ce);const t=e.getColumn(1),n=e.getColumn(2);return ce.add(t).add(n).len()}const at={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};let Pt=function(e){return e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE",e}({}),Qt=function(e){return e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh",e}({}),yt=function(e){return e.I3S="I3S",e.TILES3D="TILES3D",e}({}),_n=function(e){return e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold",e}({});const nd={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function Zi(e){return e!=null}const et=new p,wn=new p,sd=new p,rd=new p,qt=new p,to=new p,eo=new p,no=new p;function Ms(e,t,n){if(U(e,"3D Tile: boundingVolume must be defined"),e.box)return so(e.box,t,n);if(e.region)return ad(e.region);if(e.sphere)return od(e.sphere,t,n);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function id(e,t){if(e.box)return cd(t);if(e.region){const[n,s,r,i,o,a]=e.region;return[[Tt(n),Tt(s),o],[Tt(r),Tt(i),a]]}if(e.sphere)return ld(t);throw new Error("Unkown boundingVolume type")}function so(e,t,n){const s=new p(e[0],e[1],e[2]);t.transform(s,s);let r=[];if(e.length===10){const l=e.slice(3,6),u=new dn;u.fromArray(e,6);const h=new p([1,0,0]),f=new p([0,1,0]),d=new p([0,0,1]);h.transformByQuaternion(u),h.scale(l[0]),f.transformByQuaternion(u),f.scale(l[1]),d.transformByQuaternion(u),d.scale(l[2]),r=[...h.toArray(),...f.toArray(),...d.toArray()]}else r=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const i=t.transformAsVector(r.slice(0,3)),o=t.transformAsVector(r.slice(3,6)),a=t.transformAsVector(r.slice(6,9)),c=new z([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return Zi(n)?(n.center=s,n.halfAxes=c,n):new ve(s,c)}function od(e,t,n){const s=new p(e[0],e[1],e[2]);t.transform(s,s);const r=t.getScale(wn),i=Math.max(Math.max(r[0],r[1]),r[2]),o=e[3]*i;return Zi(n)?(n.center=s,n.radius=o,n):new xe(s,o)}function ad(e){const[t,n,s,r,i,o]=e,a=J.WGS84.cartographicToCartesian([Tt(t),Tt(r),i],sd),c=J.WGS84.cartographicToCartesian([Tt(s),Tt(n),o],rd),l=new p().addVectors(a,c).multiplyByScalar(.5);return J.WGS84.cartesianToCartographic(l,qt),J.WGS84.cartographicToCartesian([Tt(s),qt[1],qt[2]],to),J.WGS84.cartographicToCartesian([qt[0],Tt(r),qt[2]],eo),J.WGS84.cartographicToCartesian([qt[0],qt[1],o],no),so([...l,...to.subtract(l),...eo.subtract(l),...no.subtract(l)],new V)}function cd(e){const t=ro(),{halfAxes:n}=e,s=new p(n.getColumn(0)),r=new p(n.getColumn(1)),i=new p(n.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)et.copy(e.center),et.add(s),et.add(r),et.add(i),io(t,et),i.negate();r.negate()}s.negate()}return t}function ld(e){const t=ro(),{center:n,radius:s}=e,r=J.WGS84.scaleToGeodeticSurface(n,et);let i;r?i=J.WGS84.geodeticSurfaceNormal(r):i=new p(0,0,1);let o=new p(i[2],-i[1],0);o.len()>0?o.normalize():o=new p(0,1,0);const a=o.clone().cross(i);for(const c of[o,a,i]){wn.copy(c).scale(s);for(let l=0;l<2;l++)et.copy(n),et.add(wn),io(t,et),wn.negate()}return t}function ro(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function io(e,t){J.WGS84.cartesianToCartographic(t,et),e[0][0]=Math.min(e[0][0],et[0]),e[0][1]=Math.min(e[0][1],et[1]),e[0][2]=Math.min(e[0][2],et[2]),e[1][0]=Math.max(e[1][0],et[0]),e[1][1]=Math.max(e[1][1],et[1]),e[1][2]=Math.max(e[1][2],et[2])}new p,new p,new V,new p,new p,new p;function ud(e,t){const n=e*t;return 1-Math.exp(-(n*n))}function hd(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const n=e.dynamicScreenSpaceErrorComputedDensity,s=e.dynamicScreenSpaceErrorFactor;return ud(t,n)*s}return 0}function fd(e,t,n){const s=e.tileset,r=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=n?r:e.lodMetricValue;if(i===0)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:l}=s.options;let u=i*a*(l||1)/(o*c);return u-=hd(s,o),u}const Ss=new p,oo=new p,Vt=new p,ao=new p,dd=new p,Is=new V,co=new V;function md(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";const n=2*lo(e,t);return n<2?"OUT":!e.header.children||n<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function lo(e,t){const{topDownViewport:n}=t,s=e.header.mbs[1],r=e.header.mbs[0],i=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],c=n.unprojectPosition(n.cameraPosition);J.WGS84.cartographicToCartesian(c,Ss),oo.copy(Ss).subtract(a).normalize(),J.WGS84.eastNorthUpToFixedFrame(a,Is),co.copy(Is).invert(),Vt.copy(Ss).transform(co);const l=Math.sqrt(Vt[0]*Vt[0]+Vt[1]*Vt[1]),u=l*l/Vt[2];ao.copy([Vt[0],Vt[1],u]);const f=ao.transform(Is).subtract(a).normalize(),m=oo.cross(f).normalize().scale(o).add(a),A=J.WGS84.cartesianToCartographic(m),y=n.project([r,s,i]),E=n.project(A);return dd.copy(y).subtract(E).magnitude()}function gd(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}class uo{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;this._map=new Map,this._array=void 0,this._length=void 0,this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return U(t<this._array.length),this._array[t]}set(t,n){U(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=n,this._map.set(n,t)}delete(t){const n=this._map.get(t);n>=0&&(this._array.splice(n,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){const n=this.length++;this._array[n]=t,this._map.set(t,n)}}pop(){const t=this._array[--this.length];return this._map.delete(t),t}reserve(t){U(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){U(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}}const Ad={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class Rn{traversalFinished(t){return!0}constructor(t){this.options=void 0,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={},this.lastUpdate=new Date().getTime(),this.updateDebounceTime=1e3,this._traversalStack=new uo,this._emptyTraversalStack=new uo,this._frameNumber=null,this.options={...Ad,...t}}traverse(t,n,s){this.root=t,this.options={...this.options,...s},this.reset(),this.updateTile(t,n),this._frameNumber=n.frameNumber,this.executeTraversal(t,n)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,n){const s=this._traversalStack;for(t._selectionDepth=1,s.push(t);s.length>0;){const i=s.pop();let o=!1;this.canTraverse(i,n)&&(this.updateChildTiles(i,n),o=this.updateAndPushChildren(i,n,s,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));const a=i.parent,c=!!(!a||a._shouldRefine),l=!o;i.hasRenderContent?i.refine===Pt.ADD?(this.loadTile(i,n),this.selectTile(i,n)):i.refine===Pt.REPLACE&&(this.loadTile(i,n),l&&this.selectTile(i,n)):(this.emptyTiles[i.id]=i,this.loadTile(i,n),l&&this.selectTile(i,n)),this.touchTile(i,n),i._shouldRefine=o&&c}const r=new Date().getTime();(this.traversalFinished(n)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(n))}updateChildTiles(t,n){const s=t.children;for(const r of s)this.updateTile(r,n)}updateAndPushChildren(t,n,s,r){const{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));const c=t.refine===Pt.REPLACE&&t.hasRenderContent&&!o;let l=!1,u=!0;for(const h of a)if(h._selectionDepth=r,h.isVisibleAndInRequestVolume?(s.find(h)&&s.delete(h),s.push(h),l=!0):(c||i)&&(this.loadTile(h,n),this.touchTile(h,n)),c){let f;if(h._inRequestVolume?h.hasRenderContent?f=h.contentAvailable:f=this.executeEmptyTraversal(h,n):f=!1,u=u&&f,!u)return!1}return l||(u=!1),u}updateTile(t,n){this.updateTileVisibility(t,n)}selectTile(t,n){this.shouldSelectTile(t)&&(t._selectedFrame=n.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,n){this.shouldLoadTile(t)&&(t._requestedFrame=n.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,n){t.tileset._cache.touch(t),t._touchedFrame=n.frameNumber}canTraverse(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!r&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,n,s):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=t._screenSpaceError;return s&&(r=t.getScreenSpaceError(n,!0)),r>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,n){const s=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap)this.options.viewportTraversersMap[r]===n.viewport.id&&s.push(r);else s.push(n.viewport.id);t.updateVisibility(n,s)}compareDistanceToCamera(t,n){return t._distanceToCamera-n._distanceToCamera}anyChildrenVisible(t,n){let s=!1;for(const r of t.children)r.updateVisibility(n),s=s||r.isVisibleAndInRequestVolume;return s}executeEmptyTraversal(t,n){let s=!0;const r=this._emptyTraversalStack;for(r.push(t);r.length>0;){const i=r.pop(),o=!i.hasRenderContent&&this.canTraverse(i,n,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(s=!1),this.updateTile(i,n),i.isVisibleAndInRequestVolume||(this.loadTile(i,n),this.touchTile(i,n)),o){const c=i.children;for(const l of c)r.push(l)}}return s}}const ho=new p;function pd(e){return e!=null}class xs{constructor(t,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"";this.tileset=void 0,this.header=void 0,this.id=void 0,this.url=void 0,this.parent=void 0,this.refine=void 0,this.type=void 0,this.contentUrl=void 0,this.lodMetricType="geometricError",this.lodMetricValue=0,this.boundingVolume=null,this.content=null,this.contentState=at.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this.viewportIds=[],this.transform=new V,this.extensions=null,this.implicitTiling=null,this.userData={},this.computedTransform=void 0,this.hasEmptyContent=!1,this.hasTilesetContent=!1,this.traverser=new Rn({}),this._cacheNode=null,this._frameNumber=null,this._expireDate=null,this._expiredContent=null,this._boundingBox=void 0,this._distanceToCamera=0,this._screenSpaceError=0,this._visibilityPlaneMask=void 0,this._visible=void 0,this._contentBoundingVolume=void 0,this._viewerRequestVolume=void 0,this._initialTransform=new V,this._priority=0,this._selectedFrame=0,this._requestedFrame=0,this._selectionDepth=0,this._touchedFrame=0,this._centerZDepth=0,this._shouldRefine=!1,this._stackLength=0,this._visitedFrame=0,this._inRequestVolume=!1,this._lodJudge=null,this.header=n,this.tileset=t,this.id=r||n.id,this.url=n.url,this.parent=s,this.refine=this._getRefine(n.refine),this.type=n.type,this.contentUrl=n.contentUrl,this._initializeLodMetric(n),this._initializeTransforms(n),this._initializeBoundingVolumes(n),this._initializeContent(n),this._initializeRenderingState(n),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===at.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===at.UNLOADED}get contentExpired(){return this.contentState===at.EXPIRED}get contentFailed(){return this.contentState===at.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=id(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,n){switch(this.tileset.type){case yt.I3S:return lo(this,t);case yt.TILES3D:return fd(this,t,n);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const t=this.tileset._traverser,{skipLevelOfDetail:n}=t.options,s=this.refine===Pt.ADD||n;if(s&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===at.UNLOADED)return-1;const r=this.parent,o=r&&(!s||this._screenSpaceError===0||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=at.LOADING;const n=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!n)return this.contentState=at.UNLOADED,!1;try{const s=this.tileset.getTileUrl(this.contentUrl),r=this.tileset.loader,i={...this.tileset.loadOptions,[r.id]:{...this.tileset.loadOptions[r.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(r.id)}};return this.content=await oe(s,r,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=at.READY,this._onContentLoaded(),!0}catch(s){throw this.contentState=at.FAILED,s}finally{n.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=at.UNLOADED,!0}updateVisibility(t,n){if(this._frameNumber===t.frameNumber)return;const s=this.parent,r=s?s._visibilityPlaneMask:ot.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const i=s?s.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,r),this._visible=this._visibilityPlaneMask!==ot.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=n}visibility(t,n){const{cullingVolume:s}=t,{boundingVolume:r}=this;return s.computeVisibilityWithPlaneMask(r,n)}contentVisibility(){return!0}distanceToTile(t){const n=this.boundingVolume;return Math.sqrt(Math.max(n.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth(t){let{camera:n}=t;const s=this.boundingVolume;return ho.subVectors(s.center,n.position),n.direction.dot(ho)}insideViewerRequestVolume(t){const n=this._viewerRequestVolume;return!n||n.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(pd(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){const t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=at.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new V(t.transform):new V;const n=this.parent,s=this.tileset,r=n&&n.computedTransform?n.computedTransform.clone():s.modelMatrix.clone();this.computedTransform=new V(r).multiplyRight(this.transform);const i=n&&n._initialTransform?n._initialTransform.clone():new V;this._initialTransform=new V(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=at.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ot.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Pt.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=Ms(t.boundingVolume,this.computedTransform,this.boundingVolume);const n=t.content;n&&(n.boundingVolume&&(this._contentBoundingVolume=Ms(n.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Ms(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(){const n=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:new V).clone().multiplyRight(this.transform);n.equals(this.computedTransform)||(this.computedTransform=n,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return gd(this.tileset.tileset)}}}class yd extends Rn{compareDistanceToCamera(t,n){return n._distanceToCamera===0&&t._distanceToCamera===0?n._centerZDepth-t._centerZDepth:n._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,n){if(super.updateTileVisibility(t,n),!t.isVisibleAndInRequestVolume)return;const s=t.children.length>0;if(t.hasTilesetContent&&s){const o=t.children[0];this.updateTileVisibility(o,n),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,n)){t._visible=!1;return}const r=t.refine===Pt.REPLACE,i=t._optimChildrenWithinParent===nd.USE_OPTIMIZATION;if(r&&i&&s&&!this.anyChildrenVisible(t,n)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,n){const{parent:s}=t;return!s||s.hasTilesetContent||s.refine!==Pt.ADD?!1:!this.shouldRefine(t,n,!0)}}class Bd{constructor(){this.frameNumberMap=new Map}register(t,n){const s=this.frameNumberMap.get(t)||new Map,r=s.get(n)||0;s.set(n,r+1),this.frameNumberMap.set(t,s)}deregister(t,n){const s=this.frameNumberMap.get(t);if(!s)return;const r=s.get(n)||1;s.set(n,r-1)}isZero(t,n){var s;return(((s=this.frameNumberMap.get(t))===null||s===void 0?void 0:s.get(n))||0)===0}}const vs={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class Cd{constructor(){this._statusMap=void 0,this.pendingTilesRegister=new Bd,this._statusMap={}}add(t,n,s,r){if(!this._statusMap[n]){const{frameNumber:i,viewport:{id:o}}=r;this._statusMap[n]={request:t,callback:s,key:n,frameState:r,status:vs.REQUESTED},this.pendingTilesRegister.register(o,i),t().then(a=>{this._statusMap[n].status=vs.COMPLETED;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[n].callback(a,r)}).catch(a=>{this._statusMap[n].status=vs.ERROR;const{frameNumber:c,viewport:{id:l}}=this._statusMap[n].frameState;this.pendingTilesRegister.deregister(l,c),s(a)})}}update(t,n){if(this._statusMap[t]){const{frameNumber:s,viewport:{id:r}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(r,s);const{frameNumber:i,viewport:{id:o}}=n;this.pendingTilesRegister.register(o,i),this._statusMap[t].frameState=n}}find(t){return this._statusMap[t]}hasPendingTiles(t,n){return!this.pendingTilesRegister.isZero(t,n)}}class Ed extends Rn{constructor(t){super(t),this._tileManager=void 0,this._tileManager=new Cd}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,n){return t._lodJudge=md(t,n),t._lodJudge==="DIG"}updateChildTiles(t,n){const s=t.header.children||[],r=t.children,i=t.tileset;for(const o of s){const a=`${o.id}-${n.viewport.id}`,c=r&&r.find(l=>l.id===a);if(c)c&&this.updateTile(c,n);else{let l=()=>this._loadTile(o.id,i);this._tileManager.find(a)?this._tileManager.update(a,n):(i.tileset.nodePages&&(l=()=>i.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,h=>this._onTileLoad(h,t,a),n))}}return!1}async _loadTile(t,n){const{loader:s}=n,r=n.getTileUrl(`${n.url}/nodes/${t}`),i={...n.loadOptions,i3s:{...n.loadOptions.i3s,isTileHeader:!0}};return await oe(r,s,i)}_onTileLoad(t,n,s){const r=new xs(n.tileset,t,n,s);n.children.push(r);const i=this._tileManager.find(r.id).frameState;this.updateTile(r,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,i)}}const Td={description:"",ellipsoid:J.WGS84,modelMatrix:new V,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},Mn="Tiles In Tileset(s)",Os="Tiles In Memory",fo="Tiles In View",mo="Tiles To Render",go="Tiles Loaded",Fs="Tiles Loading",Ao="Tiles Unloaded",po="Failed Tile Loads",yo="Points/Vertices",Ds="Tile Memory Use",Bo="Maximum Screen Space Error";class bd{constructor(t,n){this.options=void 0,this.loadOptions=void 0,this.type=void 0,this.tileset=void 0,this.loader=void 0,this.url=void 0,this.basePath=void 0,this.modelMatrix=void 0,this.ellipsoid=void 0,this.lodMetricType=void 0,this.lodMetricValue=void 0,this.refine=void 0,this.root=null,this.roots={},this.asset={},this.description="",this.properties=void 0,this.extras=null,this.attributions={},this.credits={},this.stats=void 0,this.contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1},this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this.dynamicScreenSpaceErrorComputedDensity=0,this.maximumMemoryUsage=32,this.gpuMemoryUsageInBytes=0,this.memoryAdjustedScreenSpaceError=0,this._cacheBytes=0,this._cacheOverflowBytes=0,this._frameNumber=0,this._queryParams={},this._extensionsUsed=[],this._tiles={},this._pendingCount=0,this.selectedTiles=[],this.traverseCounter=0,this.geometricError=0,this.lastUpdatedVieports=null,this._requestedTiles=[],this._emptyTiles=[],this.frameStateData={},this._traverser=void 0,this._cache=new Tf,this._requestScheduler=void 0,this.updatePromise=null,this.tilesetInitializationPromise=void 0,this.options={...Td,...n},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||ns(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new nl({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Vr({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let s=t;return this.queryParams.length&&(s=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),s}hasExtension(t){return this._extensionsUsed.indexOf(t)>-1}update(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(n=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),n(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;const n=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=n.length;const s=[];for(const r of n){const i=r.id;this._needTraverse(i)?s.push(i):this.traverseCounter--}for(const r of n){const i=r.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!s.includes(i))continue;const o=Xf(r,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(t){let n=t;return this.options.viewportTraversersMap&&(n=this.options.viewportTraversersMap[t]),n===t}_onTraversalEnd(t){const n=t.viewport.id;this.frameStateData[n]||(this.frameStateData[n]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const s=this.frameStateData[n],r=Object.values(this._traverser.selectedTiles),[i,o]=Qf(r,t,this.options.maximumTilesSelected);s.selectedTiles=i;for(const a of o)a.unselect();s._requestedTiles=Object.values(this._traverser.requestedTiles),s._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const t in this.frameStateData){const n=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(n.selectedTiles),this._requestedTiles=this._requestedTiles.concat(n._requestedTiles),this._emptyTiles=this._emptyTiles.concat(n._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,n){if(t.length!==n.length)return!0;const s=new Set(t.map(o=>o.id)),r=new Set(n.map(o=>o.id));let i=t.filter(o=>!r.has(o.id)).length>0;return i=i||n.filter(o=>!s.has(o.id)).length>0,i}_loadTiles(){for(const t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,n)=>t._unloadTile(n))}_updateStats(){let t=0,n=0;for(const s of this.selectedTiles)s.contentAvailable&&s.content&&(t++,s.content.pointCount?n+=s.content.pointCount:n+=s.content.vertexCount);this.stats.get(fo).count=this.selectedTiles.length,this.stats.get(mo).count=t,this.stats.get(yo).count=n,this.stats.get(Bo).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===yt.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===yt.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===yt.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){var t;const n=this.tileset.fullExtent;if(n){const{xmin:r,xmax:i,ymin:o,ymax:a,zmin:c,zmax:l}=n;this.cartographicCenter=new p(r+(i-r)/2,o+(a-o)/2,c+(l-c)/2),this.cartesianCenter=new p,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=$i(n,this.cartographicCenter,this.cartesianCenter);return}const s=(t=this.tileset.store)===null||t===void 0?void 0:t.extent;if(s){const[r,i,o,a]=s;this.cartographicCenter=new p(r+(o-r)/2,i+(a-i)/2,0),this.cartesianCenter=new p,J.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=td(s,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new p,this.zoom=1}calculateViewPropsTiles3D(){const t=this.root,{center:n}=t.boundingVolume;if(!n){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new p,this.zoom=1;return}n[0]!==0||n[1]!==0||n[2]!==0?(this.cartographicCenter=new p,J.WGS84.cartesianToCartographic(n,this.cartographicCenter)):this.cartographicCenter=new p(0,0,-J.WGS84.radii[0]),this.cartesianCenter=n,this.zoom=Zf(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(Mn),this.stats.get(Fs),this.stats.get(Os),this.stats.get(fo),this.stats.get(mo),this.stats.get(go),this.stats.get(Ao),this.stats.get(po),this.stats.get(yo),this.stats.get(Ds,"memory"),this.stats.get(Bo)}_initializeTileHeaders(t,n){const s=new xs(this,t.root,n);if(n&&(n.children.push(s),s.depth=n.depth+1),this.type===yt.TILES3D){const i=[];for(i.push(s);i.length>0;){const o=i.pop();this.stats.get(Mn).incrementCount();const a=o.header.children||[];for(const c of a){var r;const l=new xs(this,c,o);if((r=l.contentUrl)!==null&&r!==void 0&&r.includes("?session=")){const h=new URL(l.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}o.children.push(l),l.depth=o.depth+1,i.push(l)}}}return s}_initializeTraverser(){let t;switch(this.type){case yt.TILES3D:t=yd;break;case yt.I3S:t=Ed;break;default:t=Rn}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let n;try{this._onStartTileLoading(),n=await t.loadContent()}catch(s){this._onTileLoadError(t,s instanceof Error?s:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,n)}}_onTileLoadError(t,n){this.stats.get(po).incrementCount();const s=n.message||n.toString(),r=t.url;console.error(`A 3D tile failed to load: ${t.url} ${s}`),this.options.onTileError(t,s,r)}_onTileLoad(t,n){if(n){if(this.type===yt.I3S){var s,r;const i=((s=this.tileset)===null||s===void 0||(r=s.nodePagesTile)===null||r===void 0?void 0:r.nodesInNodePages)||0;this.stats.get(Mn).reset(),this.stats.get(Mn).addCount(i)}t&&t.content&&bf(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===yt.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break}else if(this.type===yt.TILES3D){var n;const{extensionsRemoved:s=[]}=((n=t.content)===null||n===void 0?void 0:n.gltf)||{};s.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),s.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),s.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(Fs).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(Fs).decrementCount()}_addTileToCache(t){this._cache.add(this,t,n=>n._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(go).incrementCount(),this.stats.get(Os).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(Ds).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(Os).decrementCount(),this.stats.get(Ao).incrementCount(),this.stats.get(Ds).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){const t=[];for(this.root&&t.push(this.root);t.length>0;){const n=t.pop();for(const s of n.children)t.push(s);this._destroyTile(n)}this.root=null}_destroySubtree(t){const n=t,s=[];for(s.push(n);s.length>0;){t=s.pop();for(const r of t.children)s.push(r);t!==n&&this._destroyTile(t)}n.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){const n=new URLSearchParams(t.queryString),s=Object.fromEntries(n.entries());this._queryParams={...this._queryParams,...s}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}const Co="4.1.1",Oe={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function Eo(e,t,n){U(e instanceof ArrayBuffer);const s=new TextDecoder("utf8"),r=new Uint8Array(e,t,n);return s.decode(r)}function _d(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=new DataView(e);return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}const wd={name:"Draco",id:"draco",module:"draco",version:"4.1.1",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Rd(e,t,n){const s=bo(t.metadata),r=[],i=Md(t.attributes);for(const o in e){const a=e[o],c=To(o,a,i[o]);r.push(c)}if(n){const o=To("indices",n);r.push(o)}return{fields:r,metadata:s}}function Md(e){const t={};for(const n in e){const s=e[n];t[s.name||"undefined"]=s}return t}function To(e,t,n){const s=n?bo(n.metadata):void 0;return Tu(e,t,s)}function bo(e){Object.entries(e);const t={};for(const n in e)t[`${n}.string`]=JSON.stringify(e[n]);return t}const _o={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Sd={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Id=4;class xd{constructor(t){this.draco=void 0,this.decoder=void 0,this.metadataQuerier=void 0,this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(n);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const f=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(f)}const a=this._getDracoLoaderData(i,r,n),c=this._getMeshData(i,a,n),l=Eu(c.attributes),u=Rd(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:l},...c,schema:u}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,n,s){const r=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,s);return{geometry_type:n,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(t,n){const s={};for(let r=0;r<t.num_attributes();r++){const i=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const a=this._getQuantizationTransform(i,n);a&&(s[i.unique_id()].quantization_transform=a);const c=this._getOctahedronTransform(i,n);c&&(s[i.unique_id()].octahedron_transform=c)}return s}_getMeshData(t,n,s){const r=this._getMeshAttributes(n,t,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,n,s){const r={};for(const i of Object.values(t.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const{value:a,size:c}=this._getAttributeValues(n,i);r[o]={value:a,size:c,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}return r}_getTriangleListIndices(t){const s=t.num_faces()*3,r=s*Id,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){const n=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,n),Fd(n)}finally{this.draco.destroy(n)}}_getAttributeValues(t,n){const s=Sd[n.data_type],r=n.num_components,o=t.num_points()*r,a=o*s.BYTES_PER_ELEMENT,c=vd(this.draco,s);let l;const u=this.draco._malloc(a);try{const h=this.decoder.GetAttribute(t,n.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,h,c,a,u),l=new s(this.draco.HEAPF32.buffer,u,o).slice()}finally{this.draco._free(u)}return{value:l,size:r}}_deduceAttributeName(t,n){const s=t.unique_id;for(const[o,a]of Object.entries(n.extraAttributes||{}))if(a===s)return o;const r=t.attribute_type;for(const o in _o)if(this.draco[o]===r)return _o[o];const i=n.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(t){const n=this.decoder.GetMetadata(t);return this._getDracoMetadata(n)}_getAttributeMetadata(t,n){const s=this.decoder.GetAttributeMetadata(t,n);return this._getDracoMetadata(s)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const n={},s=this.metadataQuerier.NumEntries(t);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(t,r);n[i]=this._getDracoMetadataField(t,i)}return n}_getDracoMetadataField(t,n){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,n,s);const r=Od(s);return{int:this.metadataQuerier.GetIntEntry(t,n),string:this.metadataQuerier.GetStringEntry(t,n),double:this.metadataQuerier.GetDoubleEntry(t,n),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(t){const{quantizedAttributes:n=[],octahedronAttributes:s=[]}=t,r=[...n,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,n){const{quantizedAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,n){const{octahedronAttributes:s=[]}=n,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function vd(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function Od(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}function Fd(e){const t=e.size(),n=new Int32Array(t);for(let s=0;s<t;s++)n[s]=e.GetValue(s);return n}const Dd="1.5.6",Ld="1.4.1",Ls=`https://www.gstatic.com/draco/versioned/decoders/${Dd}`,ct={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},Ps={[ct.DECODER]:`${Ls}/${ct.DECODER}`,[ct.DECODER_WASM]:`${Ls}/${ct.DECODER_WASM}`,[ct.FALLBACK_DECODER]:`${Ls}/${ct.FALLBACK_DECODER}`,[ct.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Ld}/javascript/${ct.ENCODER}`};let Fe;async function Pd(e){const t=e.modules||{};return t.draco3d?Fe=Fe||t.draco3d.createDecoderModule({}).then(n=>({draco:n})):Fe=Fe||Gd(e),await Fe}async function Gd(e){let t,n;switch(e.draco&&e.draco.decoderType){case"js":t=await Kt(Ps[ct.FALLBACK_DECODER],"draco",e,ct.FALLBACK_DECODER);break;case"wasm":default:[t,n]=await Promise.all([await Kt(Ps[ct.DECODER],"draco",e,ct.DECODER),await Kt(Ps[ct.DECODER_WASM],"draco",e,ct.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Nd(t,n)}function Nd(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e({...n,onModuleLoaded:r=>s({draco:r})})})}const wo={...wd,parse:Ud};async function Ud(e,t){const{draco:n}=await Pd(t),s=new xd(n);try{return s.parseSync(e,t==null?void 0:t.draco)}finally{s.destroy()}}const Hd={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},W={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},P={...Hd,...W},Gs={[W.DOUBLE]:Float64Array,[W.FLOAT]:Float32Array,[W.UNSIGNED_SHORT]:Uint16Array,[W.UNSIGNED_INT]:Uint32Array,[W.UNSIGNED_BYTE]:Uint8Array,[W.BYTE]:Int8Array,[W.SHORT]:Int16Array,[W.INT]:Int32Array},Jd={DOUBLE:W.DOUBLE,FLOAT:W.FLOAT,UNSIGNED_SHORT:W.UNSIGNED_SHORT,UNSIGNED_INT:W.UNSIGNED_INT,UNSIGNED_BYTE:W.UNSIGNED_BYTE,BYTE:W.BYTE,SHORT:W.SHORT,INT:W.INT},Ns="Failed to convert GL type";class xt{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(const n in Gs)if(Gs[n]===t)return n;throw new Error(Ns)}static fromName(t){const n=Jd[t];if(!n)throw new Error(Ns);return n}static getArrayType(t){switch(t){case W.UNSIGNED_SHORT_5_6_5:case W.UNSIGNED_SHORT_4_4_4_4:case W.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const n=Gs[t];if(!n)throw new Error(Ns);return n}}static getByteSize(t){return xt.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return!!xt.getArrayType(t)}static createTypedArray(t,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0;r===void 0&&(r=(n.byteLength-s)/xt.getByteSize(t));const i=xt.getArrayType(t);return new i(n,s,r)}}function Vd(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function jd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0,0];const n=e>>11&31,s=e>>5&63,r=e&31;return t[0]=n<<3,t[1]=s<<2,t[2]=r<<3,t}new sn,new p,new sn,new sn;function Ro(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:255;return vu(e,0,t)/t*2-1}function Mo(e){return e<0?-1:1}function kd(e,t,n,s){if(Vd(s),e<0||e>n||t<0||t>n)throw new Error(`x and y must be unsigned normalized integers between 0 and ${n}`);if(s.x=Ro(e,n),s.y=Ro(t,n),s.z=1-(Math.abs(s.x)+Math.abs(s.y)),s.z<0){const r=s.x;s.x=(1-Math.abs(s.y))*Mo(r),s.y=(1-Math.abs(r))*Mo(s.y)}return s.normalize()}function Kd(e,t,n){return kd(e,t,255,n)}class Us{constructor(t,n){this.json=void 0,this.buffer=void 0,this.featuresLength=0,this._cachedTypedArrays={},this.json=t,this.buffer=n}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return!!this.json[t]}getGlobalProperty(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:P.UNSIGNED_INT,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(t,n,s,1,r.byteOffset):r}getPropertyArray(t,n,s){const r=this.json[t];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(n=xt.fromName(r.componentType)),this._getTypedArrayFromBinary(t,n,s,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(t,n,r)}getProperty(t,n,s,r,i){const o=this.json[t];if(!o)return o;const a=this.getPropertyArray(t,n,s);if(s===1)return a[r];for(let c=0;c<s;++c)i[c]=a[s*r+c];return i}_getTypedArrayFromBinary(t,n,s,r,i){const o=this._cachedTypedArrays;let a=o[t];return a||(a=xt.createTypedArray(n,this.buffer.buffer,this.buffer.byteOffset+i,r*s),o[t]=a),a}_getTypedArrayFromArray(t,n,s){const r=this._cachedTypedArrays;let i=r[t];return i||(i=xt.createTypedArray(n,s),r[t]=i),i}}const zd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wd={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Xd={SCALAR:(e,t,n)=>{t[n]=e},VEC2:(e,t,n)=>{t[2*n+0]=e[0],t[2*n+1]=e[1]},VEC3:(e,t,n)=>{t[3*n+0]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2]},VEC4:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT2:(e,t,n)=>{t[4*n+0]=e[0],t[4*n+1]=e[1],t[4*n+2]=e[2],t[4*n+3]=e[3]},MAT3:(e,t,n)=>{t[9*n+0]=e[0],t[9*n+1]=e[1],t[9*n+2]=e[2],t[9*n+3]=e[3],t[9*n+4]=e[4],t[9*n+5]=e[5],t[9*n+6]=e[6],t[9*n+7]=e[7],t[9*n+8]=e[8],t[9*n+9]=e[9]},MAT4:(e,t,n)=>{t[16*n+0]=e[0],t[16*n+1]=e[1],t[16*n+2]=e[2],t[16*n+3]=e[3],t[16*n+4]=e[4],t[16*n+5]=e[5],t[16*n+6]=e[6],t[16*n+7]=e[7],t[16*n+8]=e[8],t[16*n+9]=e[9],t[16*n+10]=e[10],t[16*n+11]=e[11],t[16*n+12]=e[12],t[16*n+13]=e[13],t[16*n+14]=e[14],t[16*n+15]=e[15]}};function Qd(e,t,n,s){const{componentType:r}=e;U(e.componentType);const i=typeof r=="string"?xt.fromName(r):r,o=zd[e.type],a=Wd[e.type],c=Xd[e.type];return n+=e.byteOffset,{values:xt.createTypedArray(i,t,n,o*s),type:i,size:o,unpacker:a,packer:c}}const vt=e=>e!==void 0;function qd(e,t,n){if(!t)return null;let s=e.getExtension("3DTILES_batch_table_hierarchy");const r=t.HIERARCHY;return r&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=r,s=r),s?Yd(s,n):null}function Yd(e,t){let n,s,r;const i=e.instancesLength,o=e.classes;let a=e.classIds,c=e.parentCounts,l=e.parentIds,u=i;vt(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,r=getBinaryAccessor(a),a=r.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,i));let h;if(vt(c))for(vt(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,r=getBinaryAccessor(c),c=r.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i)),h=new Uint16Array(i),u=0,n=0;n<i;++n)h[n]=u,u+=c[n];vt(l)&&vt(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,r=getBinaryAccessor(l),l=r.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,u));const f=o.length;for(n=0;n<f;++n){const y=o[n].length,E=o[n].instances,w=getBinaryProperties(y,E,t);o[n].instances=combine(w,E)}const d=new Array(f).fill(0),m=new Uint16Array(i);for(n=0;n<i;++n)s=a[n],m[n]=d[s],++d[s];const A={classes:o,classIds:a,classIndexes:m,parentCounts:c,parentIndexes:h,parentIds:l};return tm(A),A}function De(e,t,n){if(!e)return;const s=e.parentCounts;return e.parentIds?n(e,t):s>0?$d(e,t,n):Zd(e,t,n)}function $d(e,t,n){const s=e.classIds,r=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=s.length,c=scratchVisited;c.length=Math.max(c.length,a);const l=++marker,u=scratchStack;for(u.length=0,u.push(t);u.length>0;){if(t=u.pop(),c[t]===l)continue;c[t]=l;const h=n(e,t);if(vt(h))return h;const f=r[t],d=o[t];for(let m=0;m<f;++m){const A=i[d+m];A!==t&&u.push(A)}}return null}function Zd(e,t,n){let s=!0;for(;s;){const r=n(e,t);if(vt(r))return r;const i=e.parentIds[t];s=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}function tm(e){const n=e.classIds.length;for(let s=0;s<n;++s)So(e,s,stack)}function So(e,t,n){const s=e.parentCounts,r=e.parentIds,i=e.parentIndexes,a=e.classIds.length;if(!vt(r))return;assert(t<a,`Parent index ${t} exceeds the total number of instances: ${a}`),assert(n.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),n.push(t);const c=vt(s)?s[t]:1,l=vt(s)?i[t]:t;for(let u=0;u<c;++u){const h=r[l+u];h!==t&&So(e,h,n)}n.pop(t)}function lt(e){return e!=null}const Sn=(e,t)=>e,em={HIERARCHY:!0,extensions:!0,extras:!0};class Io{constructor(t,n,s){var r;let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};this.json=void 0,this.binary=void 0,this.featureCount=void 0,this._extensions=void 0,this._properties=void 0,this._binaryProperties=void 0,this._hierarchy=void 0,U(s>=0),this.json=t||{},this.binary=n,this.featureCount=s,this._extensions=((r=this.json)===null||r===void 0?void 0:r.extensions)||{},this._properties={};for(const o in this.json)em[o]||(this._properties[o]=this.json[o]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=qd(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,n){if(this._checkBatchId(t),U(typeof n=="string",n),this._hierarchy){const s=De(this._hierarchy,t,(r,i)=>{const o=r.classIds[i];return r.classes[o].name===n});return lt(s)}return!1}isExactClass(t,n){return U(typeof n=="string",n),this.getExactClassName(t)===n}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){const n=this._hierarchy.classIds[t];return this._hierarchy.classes[n].name}}hasProperty(t,n){return this._checkBatchId(t),U(typeof n=="string",n),lt(this._properties[n])||this._hasPropertyInHierarchy(t,n)}getPropertyNames(t,n){this._checkBatchId(t),n=lt(n)?n:[],n.length=0;const s=Object.keys(this._properties);return n.push(...s),this._hierarchy&&this._getPropertyNamesInHierarchy(t,n),n}getProperty(t,n){if(this._checkBatchId(t),U(typeof n=="string",n),this._binaryProperties){const r=this._binaryProperties[n];if(lt(r))return this._getBinaryProperty(r,t)}const s=this._properties[n];if(lt(s))return Sn(s[t]);if(this._hierarchy){const r=this._getHierarchyProperty(t,n);if(lt(r))return r}}setProperty(t,n,s){const r=this.featureCount;if(this._checkBatchId(t),U(typeof n=="string",n),this._binaryProperties){const o=this._binaryProperties[n];if(o){this._setBinaryProperty(o,t,s);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,n,s))return;let i=this._properties[n];lt(i)||(this._properties[n]=new Array(r),i=this._properties[n]),i[t]=Sn(s)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,n){return t.unpack(t.typedArray,n)}_setBinaryProperty(t,n,s){t.pack(s,t.typedArray,n)}_initializeBinaryProperties(){let t=null;for(const n in this._properties){const s=this._properties[n],r=this._initializeBinaryProperty(n,s);r&&(t=t||{},t[n]=r)}return t}_initializeBinaryProperty(t,n){if("byteOffset"in n){const s=n;U(this.binary,`Property ${t} requires a batch table binary.`),U(s.type,`Property ${t} requires a type.`);const r=Qd(s,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(t,n){if(!this._hierarchy)return!1;const s=De(this._hierarchy,t,(r,i)=>{const o=r.classIds[i],a=r.classes[o].instances;return lt(a[n])});return lt(s)}_getPropertyNamesInHierarchy(t,n){De(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i].instances;for(const a in o)o.hasOwnProperty(a)&&n.indexOf(a)===-1&&n.push(a)})}_getHierarchyProperty(t,n){return De(this._hierarchy,t,(s,r)=>{const i=s.classIds[r],o=s.classes[i],a=s.classIndexes[r],c=o.instances[n];return lt(c)?lt(c.typedArray)?this._getBinaryProperty(c,a):Sn(c[a]):null})}_setHierarchyProperty(t,n,s,r){const i=De(this._hierarchy,n,(o,a)=>{const c=o.classIds[a],l=o.classes[c],u=o.classIndexes[a],h=l.instances[s];return lt(h)?(U(a===n,`Inherited property "${s}" is read-only.`),lt(h.typedArray)?this._setBinaryProperty(h,u,r):h[u]=Sn(r),!0):!1});return lt(i)}}const Hs=4;function In(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t);if(e.magic=s.getUint32(n,!0),n+=Hs,e.version=s.getUint32(n,!0),n+=Hs,e.byteLength=s.getUint32(n,!0),n+=Hs,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return n}const le=4,xo="b3dm tile in legacy format.";function Js(e,t,n){const s=new DataView(t);let r;e.header=e.header||{};let i=s.getUint32(n,!0);n+=le;let o=s.getUint32(n,!0);n+=le;let a=s.getUint32(n,!0);n+=le;let c=s.getUint32(n,!0);return n+=le,a>=570425344?(n-=le*2,r=i,a=o,c=0,i=0,o=0,console.warn(xo)):c>=570425344&&(n-=le,r=a,a=i,c=o,i=0,o=0,console.warn(xo)),e.header.featureTableJsonByteLength=i,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=c,e.header.batchLength=r,n}function Vs(e,t,n,s){return n=nm(e,t,n),n=sm(e,t,n),n}function nm(e,t,n,s){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:i,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},r&&r>0){const a=Eo(t,n,r);e.featureTableJson=JSON.parse(a)}return n+=r||0,e.featureTableBinary=new Uint8Array(t,n,i),n+=i||0,n}function sm(e,t,n,s){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:i}=e.header||{};if(r&&r>0){const o=Eo(t,n,r);e.batchTableJson=JSON.parse(o),n+=r,i&&i>0&&(e.batchTableBinary=new Uint8Array(t,n,i),e.batchTableBinary=new Uint8Array(e.batchTableBinary),n+=i)}return n}function vo(e,t,n){if(!t&&(!e||!e.batchIds||!n))return null;const{batchIds:s,isRGB565:r,pointCount:i=0}=e;if(s&&n){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=s[a],u=n.getProperty(c,"dimensions").map(h=>h*255);o[a*3]=u[0],o[a*3+1]=u[1],o[a*3+2]=u[2]}return{type:P.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&r){const o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){const c=jd(t[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:P.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===i*3?{type:P.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:P.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}const Oo=new p;function rm(e,t){if(!t)return null;if(e.isOctEncoded16P){const n=new Float32Array((e.pointsLength||0)*3);for(let s=0;s<(e.pointsLength||0);s++)Kd(t[s*2],t[s*2+1],Oo),Oo.toArray(n,s*3);return{type:P.FLOAT,size:2,value:n}}return{type:P.FLOAT,size:2,value:t}}function im(e,t,n){return e.isQuantized?n["3d-tiles"]&&n["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,om(e,t)):{type:P.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function om(e,t){const n=new p,s=new Float32Array(e.pointCount*3);for(let r=0;r<e.pointCount;r++)n.set(t[r*3],t[r*3+1],t[r*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(s,r*3);return s}async function am(e,t,n,s,r){n=In(e,t,n),n=Js(e,t,n),n=Vs(e,t,n),cm(e);const{featureTable:i,batchTable:o}=lm(e);return await mm(e,i,o,s,r),um(e,i,s),hm(e,i,o),fm(e,i),n}function cm(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function lm(e){const t=new Us(e.featureTableJson,e.featureTableBinary),n=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(n))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=n,e.featuresLength=n,e.pointsLength=n,e.pointCount=n,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",P.FLOAT,3);const s=dm(e,t);return{featureTable:t,batchTable:s}}function um(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",P.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const s=t.getPropertyArray("POSITION_QUANTIZED",P.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",P.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",P.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=im(e,s,n)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function hm(e,t,n){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let s=null;t.hasProperty("RGBA")?(s=t.getPropertyArray("RGBA",P.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?s=t.getPropertyArray("RGB",P.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(s=t.getPropertyArray("RGB565",P.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=vo(e,s,n)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",P.UNSIGNED_BYTE,4))}function fm(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let n=null;t.hasProperty("NORMAL")?n=t.getPropertyArray("NORMAL",P.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(n=t.getPropertyArray("NORMAL_OCT16P",P.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=rm(e,n)}}function dm(e,t){let n=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",P.UNSIGNED_SHORT,1),e.batchIds)){const s=t.getGlobalProperty("BATCH_LENGTH");if(!s)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:r,batchTableBinary:i}=e;n=new Io(r,i,s)}return n}async function mm(e,t,n,s,r){let i,o,a;const c=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);const l=t.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;const h=l.byteOffset,f=l.byteLength;if(!o||!Number.isFinite(h)||!f)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(e.featureTableBinary||[]).slice(h,h+f),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;const u={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await gm(e,u,s,r)}async function gm(e,t,n,s){if(!s)return;const r={...n,draco:{...n==null?void 0:n.draco,extraAttributes:t.batchTableProperties||{}}};delete r["3d-tiles"];const i=await pe(t.buffer,wo,r,s),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,u=o&&i.attributes.POSITION.value.quantization,h=c&&i.attributes.NORMAL.value.quantization;if(u){const d=i.POSITION.data.quantization,m=d.range;e.quantizedVolumeScale=new p(m,m,m),e.quantizedVolumeOffset=new p(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0}h&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const f={};if(t.batchTableProperties)for(const d of Object.keys(t.batchTableProperties))i.attributes[d]&&i.attributes[d].value&&(f[d.toLowerCase()]=i.attributes[d].value);e.attributes={positions:o,colors:vo(e,a,void 0),normals:c,batchIds:l,...f}}const Am="4.1.1";var js;const pm=(js=globalThis.loaders)===null||js===void 0?void 0:js.parseImageNode,ks=typeof Image<"u",Ks=typeof ImageBitmap<"u",zs=qe?!0:!!pm;function ym(e){switch(e){case"auto":return Ks||ks||zs;case"imagebitmap":return Ks;case"image":return ks;case"data":return zs;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function Bm(){if(Ks)return"imagebitmap";if(ks)return"image";if(zs)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Cm(e){const t=Em(e);if(!t)throw new Error("Not an image");return t}function Fo(e){switch(Cm(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function Em(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}const Tm=/^data:image\/svg\+xml/,bm=/\.svg((\?|#).*)?$/;function Ws(e){return e&&(Tm.test(e)||bm.test(e))}function _m(e,t){if(Ws(t)){let s=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return Do(e,t)}function Do(e,t){if(Ws(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Lo(e,t,n){const s=_m(e,n),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await wm(i||s,t)}finally{i&&r.revokeObjectURL(i)}}async function wm(e,t){const n=new Image;return n.src=e,t.image&&t.image.decode&&n.decode?(await n.decode(),n):await new Promise((s,r)=>{try{n.onload=()=>s(n),n.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const Rm={};let Po=!0;async function Mm(e,t,n){let s;Ws(n)?s=await Lo(e,t,n):s=Do(e,n);const r=t&&t.imagebitmap;return await Sm(s,r)}async function Sm(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((Im(t)||!Po)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(n){console.warn(n),Po=!1}return await createImageBitmap(e)}function Im(e){for(const t in e||Rm)return!1;return!0}function xm(e){return!Dm(e,"ftyp",4)||!(e[8]&96)?null:vm(e)}function vm(e){switch(Om(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Om(e,t,n){return String.fromCharCode(...e.slice(t,n))}function Fm(e){return[...e].map(t=>t.charCodeAt(0))}function Dm(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=Fm(t);for(let r=0;r<s.length;++r)if(s[r]!==e[r+n])return!1;return!0}const Ot=!1,Le=!0;function Xs(e){const t=Pe(e);return Pm(t)||Um(t)||Gm(t)||Nm(t)||Lm(t)}function Lm(e){const t=new Uint8Array(e instanceof DataView?e.buffer:e),n=xm(t);return n?{mimeType:n.mimeType,width:0,height:0}:null}function Pm(e){const t=Pe(e);return t.byteLength>=24&&t.getUint32(0,Ot)===2303741511?{mimeType:"image/png",width:t.getUint32(16,Ot),height:t.getUint32(20,Ot)}:null}function Gm(e){const t=Pe(e);return t.byteLength>=10&&t.getUint32(0,Ot)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Le),height:t.getUint16(8,Le)}:null}function Nm(e){const t=Pe(e);return t.byteLength>=14&&t.getUint16(0,Ot)===16973&&t.getUint32(2,Le)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Le),height:t.getUint32(22,Le)}:null}function Um(e){const t=Pe(e);if(!(t.byteLength>=3&&t.getUint16(0,Ot)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=Hm();let i=2;for(;i+9<t.byteLength;){const o=t.getUint16(i,Ot);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,Ot),width:t.getUint16(i+7,Ot)};if(!s.has(o))return null;i+=2,i+=t.getUint16(i,Ot)}return null}function Hm(){const e=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)e.add(n);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Pe(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function Jm(e,t){var n;const{mimeType:s}=Xs(e)||{},r=(n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode;return U(r),await r(e,s)}async function Vm(e,t,n){t=t||{};const r=(t.image||{}).type||"auto",{url:i}=n||{},o=jm(r);let a;switch(o){case"imagebitmap":a=await Mm(e,t,i);break;case"image":a=await Lo(e,t,i);break;case"data":a=await Jm(e);break;default:U(!1)}return r==="data"&&(a=Fo(a)),a}function jm(e){switch(e){case"auto":case"data":return Bm();default:return ym(e),e}}const km={id:"image",module:"images",name:"Images",version:Am,mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:Vm,tests:[e=>!!Xs(new DataView(e))],options:{image:{type:"auto",decode:!0}}},Qs={};function Km(e){if(Qs[e]===void 0){const t=qe?Wm(e):zm(e);Qs[e]=t}return Qs[e]}function zm(e){var t,n;const s=["image/png","image/jpeg","image/gif"],r=((t=globalThis.loaders)===null||t===void 0?void 0:t.imageFormatsNode)||s;return!!((n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode)&&r.includes(e)}function Wm(e){switch(e){case"image/avif":case"image/webp":return Xm(e);default:return!0}}function Xm(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}function dt(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const Go={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},No={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Qm=1.33,Uo=["SCALAR","VEC2","VEC3","VEC4"],qm=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Ym=new Map(qm),$m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Zm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ho(e){return Uo[e-1]||Uo[0]}function qs(e){const t=Ym.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function Ys(e,t){const n=tg[e.componentType],s=$m[e.type],r=Zm[e.componentType],i=e.count*s,o=e.count*s*r;dt(o>=0&&o<=t.byteLength);const a=No[e.componentType],c=Go[e.type];return{ArrayType:n,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function Jo(e){let{images:t,bufferViews:n}=e;t=t||[],n=n||[];const s=t.map(o=>o.bufferView);n=n.filter(o=>!s.includes(o));const r=n.reduce((o,a)=>o+a.byteLength,0),i=t.reduce((o,a)=>{const{width:c,height:l}=a.image;return o+c*l},0);return r+Math.ceil(4*i*Qm)}function eg(e,t,n){const s=e.bufferViews[n];dt(s);const r=s.buffer,i=t[r];dt(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function ng(e,t,n){var s,r;const i=typeof n=="number"?(s=e.accessors)===null||s===void 0?void 0:s[n]:n;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(n)}`);const o=(r=e.bufferViews)===null||r===void 0?void 0:r[i.bufferView||0];if(!o)throw new Error(`No gltf buffer view for accessor ${o}`);const{arrayBuffer:a,byteOffset:c}=t[o.buffer],l=(c||0)+(i.byteOffset||0)+(o.byteOffset||0),{ArrayType:u,length:h,componentByteSize:f,numberOfComponentsInElement:d}=Ys(i,o),m=f*d,A=o.byteStride||m;if(typeof o.byteStride>"u"||o.byteStride===m)return new u(a,l,h);const y=new u(h);for(let E=0;E<i.count;E++){const w=new u(a,l+E*A,d);y.set(w,E*d)}return y}function sg(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class nt{constructor(t){this.gltf=void 0,this.sourceBuffers=void 0,this.byteLength=void 0,this.gltf={json:(t==null?void 0:t.json)||sg(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.getRequiredExtensions().find(r=>r===t);return typeof n=="string"||typeof s=="string"}getExtension(t){const n=this.getUsedExtensions().find(r=>r===t),s=this.json.extensions||{};return n?s[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(s=>s===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,n){return(t.extensions||{})[n]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,n){if(typeof n=="object")return n;const s=this.json[t]&&this.json[t][n];if(!s)throw new Error(`glTF file error: Could not find ${t}[${n}]`);return s}getTypedArrayForBufferView(t){t=this.getBufferView(t);const n=t.buffer,s=this.gltf.buffers[n];dt(s);const r=(t.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const n=this.getAccessor(t);return ng(this.gltf.json,this.gltf.buffers,n)}getTypedArrayForImageData(t){t=this.getAccessor(t);const n=this.getBufferView(t.bufferView),r=this.getBuffer(n.buffer).data,i=n.byteOffset||0;return new Uint8Array(r,i,n.byteLength)}addApplicationData(t,n){return this.json[t]=n,this}addExtraData(t,n){return this.json.extras=this.json.extras||{},this.json.extras[t]=n,this}addObjectExtension(t,n,s){return t.extensions=t.extensions||{},t.extensions[n]=s,this.registerUsedExtension(n),this}setObjectExtension(t,n,s){const r=t.extensions||{};r[n]=s}removeObjectExtension(t,n){const s=(t==null?void 0:t.extensions)||{};if(s[n]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(n)||r.push(n)}delete s[n]}addExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return dt(n),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=n,this.registerUsedExtension(t),n}addRequiredExtension(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return dt(n),this.addExtension(t,n),this.registerRequiredExtension(t),n}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(n=>n===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(n=>n===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var n;if((n=this.json.extensions)!==null&&n!==void 0&&n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:n}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:n}),this.json.scenes.length-1}addNode(t){const{meshIndex:n,matrix:s}=t;this.json.nodes=this.json.nodes||[];const r={mesh:n};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:n,indices:s,material:r,mode:i=4}=t,a={primitives:[{attributes:this._addAttributes(n),mode:i}]};if(s){const c=this._addIndices(s);a.primitives[0].indices=c}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){const s={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(t,n){const s=Xs(t),r=n||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.byteLength;const r=t.byteLength;dt(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:n,byteOffset:s,byteLength:r};return this.byteLength+=ye(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,n){const s={bufferView:t,type:Ho(n.size),componentType:n.componentType,count:n.count,max:n.max,min:n.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{size:3};const s=this.addBufferView(t);let r={min:n.min,max:n.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,n.size));const i={size:n.size,componentType:qs(t),count:Math.round(t.length/n.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,n))}addTexture(t){const{imageIndex:n}=t,s={source:n};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var t,n;this.gltf.buffers=[];const s=this.byteLength,r=new ArrayBuffer(s),i=new Uint8Array(r);let o=0;for(const a of this.sourceBuffers||[])o=Xc(a,i,o);(t=this.json)!==null&&t!==void 0&&(n=t.buffers)!==null&&n!==void 0&&n[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(t,n){let s=!0;for(;s;){const r=t.indexOf(n);r>-1?t.splice(r,1):s=!1}}_addAttributes(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={};for(const s in t){const r=t[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);n[i]=o}return n}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,n){const s={min:null,max:null};if(t.length<n)return s;s.min=[],s.max=[];const r=t.subarray(0,n);for(const i of r)s.min.push(i),s.max.push(i);for(let i=n;i<t.length;i+=n)for(let o=0;o<n;o++)s.min[0+o]=Math.min(s.min[0+o],t[i+o]),s.max[0+o]=Math.max(s.max[0+o],t[i+o]);return s}}function Vo(e){return(e%1+1)%1}const jo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},rg={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},ko={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function $s(e,t){return ko[t]*jo[e]}function xn(e,t,n,s){if(n!=="UINT8"&&n!=="UINT16"&&n!=="UINT32"&&n!=="UINT64")return null;const r=e.getTypedArrayForBufferView(t),i=vn(r,"SCALAR",n,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function vn(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=jo[t],i=rg[n],o=ko[n],a=s*r,c=a*o;let l=e.buffer,u=e.byteOffset;return u%o!==0&&(l=new Uint8Array(l).slice(u,u+c).buffer,u=0),new i(l,u,a)}function Zs(e,t,n){var s,r;const i=`TEXCOORD_${t.texCoord||0}`,o=n.attributes[i],a=e.getTypedArrayForAccessor(o),c=e.gltf.json,l=t.index,u=(s=c.textures)===null||s===void 0||(r=s[l])===null||r===void 0?void 0:r.source;if(typeof u<"u"){var h,f,d;const m=(h=c.images)===null||h===void 0||(f=h[u])===null||f===void 0?void 0:f.mimeType,A=(d=e.gltf.images)===null||d===void 0?void 0:d[u];if(A&&typeof A.width<"u"){const y=[];for(let E=0;E<a.length;E+=2){const w=ig(A,m,a,E,t.channels);y.push(w)}return y}}return[]}function Ko(e,t,n,s,r){if(!(n!=null&&n.length))return;const i=[];for(const u of n){let h=s.findIndex(f=>f===u);h===-1&&(h=s.push(u)-1),i.push(h)}const o=new Uint32Array(i),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=e.addBufferView(o,a,0),l=e.addAccessor(c,{size:1,componentType:qs(o),count:o.length});r.attributes[t]=l}function ig(e,t,n,s){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[0];const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=n[s],a=n[s+1];let c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);const l=og(o,a,e,c);let u=0;for(const h of r){const f=typeof h=="number"?Object.values(i)[h]:i[h],d=l+f.offset,m=Fo(e);if(m.data.length<=d)throw new Error(`${m.data.length} <= ${d}`);const A=m.data[d];u|=A<<f.shift}return u}function og(e,t,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;const r=n.width,i=Vo(e)*(r-1),o=Math.round(i),a=n.height,c=Vo(t)*(a-1),l=Math.round(c),u=n.components?n.components:s;return(l*r+o)*u}function zo(e,t,n,s,r){const i=[];for(let o=0;o<t;o++){const a=n[o],c=n[o+1]-n[o];if(c+a>s)break;const l=a/r,u=c/r;i.push(e.slice(l,l+u))}return i}function Wo(e,t,n){const s=[];for(let r=0;r<t;r++){const i=r*n;s.push(e.slice(i,i+n))}return s}function Xo(e,t,n,s){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let a=0;a<e;a++){const c=s[a+1]-s[a];if(c+o<=t.length){const l=t.subarray(o,c+o),u=i.decode(l);r.push(u),o+=c}}return r}return[]}const Qo="EXT_mesh_features",ag=Qo;async function cg(e,t){const n=new nt(e);lg(n,t)}function lg(e,t){const n=e.gltf.json;if(n.meshes)for(const s of n.meshes)for(const r of s.primitives)ug(e,r,t)}function ug(e,t,n){var s,r;if(!(n!=null&&(s=n.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=(r=t.extensions)===null||r===void 0?void 0:r[Qo],o=i==null?void 0:i.featureIds;if(o)for(const c of o){var a;let l;if(typeof c.attribute<"u"){const u=`_FEATURE_ID_${c.attribute}`,h=t.attributes[u];l=e.getTypedArrayForAccessor(h)}else typeof c.texture<"u"&&n!==null&&n!==void 0&&(a=n.gltf)!==null&&a!==void 0&&a.loadImages?l=Zs(e,c.texture,t):l=[];c.data=l}}const hg=Object.freeze(Object.defineProperty({__proto__:null,decode:cg,name:ag},Symbol.toStringTag,{value:"Module"})),tr="EXT_structural_metadata",fg=tr;async function dg(e,t){const n=new nt(e);mg(n,t)}function mg(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(tr);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&gg(e,r),Ag(e,r))}function gg(e,t){const n=t.propertyTextures,s=e.gltf.json;if(n&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)yg(e,n,i,t)}function Ag(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.propertyTables;if(s&&r)for(const i in s){const o=pg(r,i);o&&Cg(e,n,o)}}function pg(e,t){for(const n of e)if(n.class===t)return n;return null}function yg(e,t,n,s){var r;if(!t)return;const i=(r=n.extensions)===null||r===void 0?void 0:r[tr],o=i==null?void 0:i.propertyTextures;if(o)for(const a of o){const c=t[a];Bg(e,c,n,s)}}function Bg(e,t,n,s){if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const o in t.properties){var i;const a=`${r}_${o}`,c=(i=t.properties)===null||i===void 0?void 0:i[o];if(!c)continue;c.data||(c.data=[]);const l=c.data,u=Zs(e,c,n);u!==null&&(Ko(e,a,u,l,n),c.data=l,s.dataAttributeNames.push(a))}}function Cg(e,t,n){var s;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],l=(o=n.properties)===null||o===void 0?void 0:o[a];if(l){const u=Eg(e,t,c,i,l);l.data=u}}}function Eg(e,t,n,s,r){let i=[];const o=r.values,a=e.getTypedArrayForBufferView(o),c=Tg(e,n,r,s),l=bg(e,r,s);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=_g(n,s,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${n.type}`);case"STRING":{i=Xo(s,a,c,l);break}case"ENUM":{i=wg(t,n,s,a,c);break}default:throw new Error(`Unknown classProperty type ${n.type}`)}return i}function Tg(e,t,n,s){return t.array&&typeof t.count>"u"&&typeof n.arrayOffsets<"u"?xn(e,n.arrayOffsets,n.arrayOffsetType||"UINT32",s):null}function bg(e,t,n){return typeof t.stringOffsets<"u"?xn(e,t.stringOffsets,t.stringOffsetType||"UINT32",n):null}function _g(e,t,n,s){const r=e.array,i=e.count,o=$s(e.type,e.componentType),a=n.byteLength/o;let c;return e.componentType?c=vn(n,e.type,e.componentType,a):c=n,r?s?zo(c,t,s,n.length,o):i?Wo(c,t,i):[]:c}function wg(e,t,n,s,r){var i;const o=t.enumType;if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const a=(i=e.enums)===null||i===void 0?void 0:i[o];if(!a)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);const c=a.valueType||"UINT16",l=$s(t.type,c),u=s.byteLength/l;let h=vn(s,t.type,c,u);if(h||(h=s),t.array){if(r)return Rg({valuesData:h,numberOfElements:n,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:l,enumEntry:a});const f=t.count;return f?Mg(h,n,f,a):[]}return er(h,0,n,a)}function Rg(e){const{valuesData:t,numberOfElements:n,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=e,a=[];for(let c=0;c<n;c++){const l=s[c],u=s[c+1]-s[c];if(u+l>r)break;const h=l/i,f=u/i,d=er(t,h,f,o);a.push(d)}return a}function Mg(e,t,n,s){const r=[];for(let i=0;i<t;i++){const o=n*i,a=er(e,o,n,s);r.push(a)}return r}function er(e,t,n,s){const r=[];for(let i=0;i<n;i++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const o=e[t+i],a=Sg(s,o);a?r.push(a.name):r.push("")}return r}function Sg(e,t){for(const n of e.values)if(n.value===t)return n;return null}const Ig=Object.freeze(Object.defineProperty({__proto__:null,decode:dg,name:fg},Symbol.toStringTag,{value:"Module"})),qo="EXT_feature_metadata",xg=qo;async function vg(e,t){const n=new nt(e);Og(n,t)}function Og(e,t){var n,s;if(!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const r=e.getExtension(qo);r&&((s=t.gltf)!==null&&s!==void 0&&s.loadImages&&Fg(e,r),Dg(e,r))}function Fg(e,t){const n=t.schema;if(!n)return;const s=n.classes,{featureTextures:r}=t;if(s&&r)for(const i in s){const o=s[i],a=Pg(r,i);a&&Ng(e,a,o)}}function Dg(e,t){const n=t.schema;if(!n)return;const s=n.classes,r=t.featureTables;if(s&&r)for(const i in s){const o=Lg(r,i);o&&Gg(e,n,o)}}function Lg(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function Pg(e,t){for(const n in e){const s=e[n];if(s.class===t)return s}return null}function Gg(e,t,n){var s;if(!n.class)return;const r=(s=t.classes)===null||s===void 0?void 0:s[n.class];if(!r)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${n.class}`);const i=n.count;for(const a in r.properties){var o;const c=r.properties[a],l=(o=n.properties)===null||o===void 0?void 0:o[a];if(l){const u=Ug(e,t,c,i,l);l.data=u}}}function Ng(e,t,n){const s=t.class;for(const i in n.properties){var r;const o=t==null||(r=t.properties)===null||r===void 0?void 0:r[i];if(o){const a=kg(e,o,s);o.data=a}}}function Ug(e,t,n,s,r){let i=[];const o=r.bufferView,a=e.getTypedArrayForBufferView(o),c=Hg(e,n,r,s),l=Jg(e,n,r,s);return n.type==="STRING"||n.componentType==="STRING"?i=Xo(s,a,c,l):Vg(n)&&(i=jg(n,s,a,c)),i}function Hg(e,t,n,s){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof n.arrayOffsetBufferView<"u"?xn(e,n.arrayOffsetBufferView,n.offsetType||"UINT32",s):null}function Jg(e,t,n,s){return typeof n.stringOffsetBufferView<"u"?xn(e,n.stringOffsetBufferView,n.offsetType||"UINT32",s):null}function Vg(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function jg(e,t,n,s){const r=e.type==="ARRAY",i=e.componentCount,o="SCALAR",a=e.componentType||e.type,c=$s(o,a),l=n.byteLength/c,u=vn(n,o,a,l);return r?s?zo(u,t,s,n.length,c):i?Wo(u,t,i):[]:u}function kg(e,t,n){const s=e.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)Kg(e,n,t,r,o);return r}function Kg(e,t,n,s,r){const i={channels:n.channels,...n.texture},o=Zs(e,i,r);o&&Ko(e,t,o,s,r)}const zg=Object.freeze(Object.defineProperty({__proto__:null,decode:vg,name:xg},Symbol.toStringTag,{value:"Module"})),Wg="4.1.1",Xg="4.1.1",On={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let nr;async function Yo(e){const t=e.modules||{};return t.basis?t.basis:(nr=nr||Qg(e),await nr)}async function Qg(e){let t=null,n=null;return[t,n]=await Promise.all([await Kt(On.TRANSCODER,"textures",e),await Kt(On.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await qg(t,n)}function qg(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let sr;async function $o(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(sr=sr||Yg(e),await sr)}async function Yg(e){let t=null,n=null;return[t,n]=await Promise.all([await Kt(On.ENCODER,"textures",e),await Kt(On.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await $g(t,n)}function $g(e,t){const n={};return t&&(n.wasmBinary=t),new Promise(s=>{e(n).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=r;a(),s({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}const ue={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},Zg=["","WEBKIT_","MOZ_"],Zo={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let Fn=null;function t0(e){if(!Fn){e=e||e0()||void 0,Fn=new Set;for(const t of Zg)for(const n in Zo)if(e&&e.getExtension(`${t}${n}`)){const s=Zo[n];Fn.add(s)}}return Fn}function e0(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var ta,ea,na,sa,ra,ia,oa,aa;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(ta||(ta={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(ea||(ea={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(na||(na={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(sa||(sa={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(ra||(ra={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(ia||(ia={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(oa||(oa={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(aa||(aa={}));const mt=[171,75,84,88,32,50,48,187,13,10,26,10];function n0(e){const t=new Uint8Array(e);return!(t.byteLength<mt.length||t[0]!==mt[0]||t[1]!==mt[1]||t[2]!==mt[2]||t[3]!==mt[3]||t[4]!==mt[4]||t[5]!==mt[5]||t[6]!==mt[6]||t[7]!==mt[7]||t[8]!==mt[8]||t[9]!==mt[9]||t[10]!==mt[10]||t[11]!==mt[11])}const s0={etc1:{basisFormat:0,compressed:!0,format:ue.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ue.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ue.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ue.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ue.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ue.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function r0(e,t){if(t.basis.containerFormat==="auto"){if(n0(e)){const s=await $o(t);return ca(s.KTX2File,e,t)}const{BasisFile:n}=await Yo(t);return rr(n,e,t)}switch(t.basis.module){case"encoder":const n=await $o(t);switch(t.basis.containerFormat){case"ktx2":return ca(n.KTX2File,e,t);case"basis":default:return rr(n.BasisFile,e,t)}case"transcoder":default:const{BasisFile:s}=await Yo(t);return rr(s,e,t)}}function rr(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const a=s.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(i0(s,o,l,n));i.push(c)}return i}finally{s.close(),s.delete()}}function i0(e,t,n,s){const r=e.getImageWidth(t,n),i=e.getImageHeight(t,n),o=e.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=la(s,o),u=e.getImageTranscodedSizeInBytes(t,n,l),h=new Uint8Array(u);if(!e.transcodeImage(h,t,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:h,compressed:a,format:c,hasAlpha:o}}function ca(e,t,n){const s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++){i.push(o0(s,o,n));break}return[i]}finally{s.close(),s.delete()}}function o0(e,t,n){const{alphaFlag:s,height:r,width:i}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=la(n,s),l=e.getImageTranscodedSizeInBytes(t,0,0,c),u=new Uint8Array(l);if(!e.transcodeImage(u,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:u,compressed:o,levelSize:l,hasAlpha:s,format:a}}function la(e,t){let n=e&&e.basis&&e.basis.format;return n==="auto"&&(n=ua()),typeof n=="object"&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),s0[n]}function ua(){const e=t0();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const a0={...{name:"Basis",id:"basis",module:"textures",version:Xg,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:r0},he=!0,ha=1735152710,ir=12,Dn=8,c0=1313821514,l0=5130562,u0=0,h0=0,f0=1;function d0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function m0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=new DataView(e),{magic:r=ha}=n,i=s.getUint32(t,!1);return i===r||i===ha}function g0(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=new DataView(t),r=d0(s,n+0),i=s.getUint32(n+4,he),o=s.getUint32(n+8,he);switch(Object.assign(e,{header:{byteOffset:n,byteLength:o,hasBinChunk:!1},type:r,version:i,json:{},binChunks:[]}),n+=ir,e.version){case 1:return A0(e,s,n);case 2:return p0(e,s,n,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function A0(e,t,n){U(e.header.byteLength>ir+Dn);const s=t.getUint32(n+0,he),r=t.getUint32(n+4,he);return n+=Dn,U(r===u0),or(e,t,n,s),n+=s,n+=ar(e,t,n,e.header.byteLength),n}function p0(e,t,n,s){return U(e.header.byteLength>ir+Dn),y0(e,t,n,s),n+e.header.byteLength}function y0(e,t,n,s){for(;n+8<=e.header.byteLength;){const r=t.getUint32(n+0,he),i=t.getUint32(n+4,he);switch(n+=Dn,i){case c0:or(e,t,n,r);break;case l0:ar(e,t,n,r);break;case h0:s.strict||or(e,t,n,r);break;case f0:s.strict||ar(e,t,n,r);break}n+=ye(r,4)}return n}function or(e,t,n,s){const r=new Uint8Array(t.buffer,n,s),o=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(o),ye(s,4)}function ar(e,t,n,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:s,arrayBuffer:t.buffer}),ye(s,4)}function fa(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return s.substr(0,s.lastIndexOf("/")+1)+e}const B0="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",C0="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",E0=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),T0=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),b0={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},_0={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function w0(e,t,n,s,r){let i=arguments.length>5&&arguments[5]!==void 0?arguments[5]:"NONE";const o=await R0();I0(o,o.exports[_0[r]],e,t,n,s,o.exports[b0[i||"NONE"]])}let cr;async function R0(){return cr||(cr=M0()),cr}async function M0(){let e=B0;WebAssembly.validate(E0)&&(e=C0,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(S0(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function S0(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s){const r=e.charCodeAt(s);t[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let n=0;for(let s=0;s<e.length;++s)t[n++]=t[s]<60?T0[t[s]]:(t[s]-60)*64+t[++s];return t.buffer.slice(0,n)}function I0(e,t,n,s,r,i,o){const a=e.exports.sbrk,c=s+3&-4,l=a(c*r),u=a(i.length),h=new Uint8Array(e.exports.memory.buffer);h.set(i,u);const f=t(l,s,r,u,i.length);if(f===0&&o&&o(l,c,r),n.set(h.subarray(l,l+s*r)),a(l-a(0)),f!==0)throw new Error(`Malformed buffer data: ${f}`)}const Ln="EXT_meshopt_compression",x0=Ln;async function v0(e,t){var n,s;const r=new nt(e);if(!(t!=null&&(n=t.gltf)!==null&&n!==void 0&&n.decompressMeshes)||!((s=t.gltf)!==null&&s!==void 0&&s.loadBuffers))return;const i=[];for(const o of e.json.bufferViews||[])i.push(O0(r,o));await Promise.all(i),r.removeExtension(Ln)}async function O0(e,t){const n=e.getObjectExtension(t,Ln);if(n){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:l}=n,u=e.gltf.buffers[l],h=new Uint8Array(u.arrayBuffer,u.byteOffset+s,r),f=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await w0(f,o,i,h,a,c),e.removeObjectExtension(t,Ln)}}const F0=Object.freeze(Object.defineProperty({__proto__:null,decode:v0,name:x0},Symbol.toStringTag,{value:"Module"})),fe="EXT_texture_webp",D0=fe;function L0(e,t){const n=new nt(e);if(!Km("image/webp")){if(n.getRequiredExtensions().includes(fe))throw new Error(`gltf: Required extension ${fe} not supported by browser`);return}const{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,fe);i&&(r.source=i.source),n.removeObjectExtension(r,fe)}n.removeExtension(fe)}const P0=Object.freeze(Object.defineProperty({__proto__:null,name:D0,preprocess:L0},Symbol.toStringTag,{value:"Module"})),Pn="KHR_texture_basisu",G0=Pn;function N0(e,t){const n=new nt(e),{json:s}=n;for(const r of s.textures||[]){const i=n.getObjectExtension(r,Pn);i&&(r.source=i.source,n.removeObjectExtension(r,Pn))}n.removeExtension(Pn)}const U0=Object.freeze(Object.defineProperty({__proto__:null,name:G0,preprocess:N0},Symbol.toStringTag,{value:"Module"}));function H0(e){const t={};for(const n in e){const s=e[n];if(n!=="indices"){const r=da(s);t[n]=r}}return t}function da(e){const{buffer:t,size:n,count:s}=J0(e);return{value:t,size:n,byteOffset:0,count:s,type:Ho(n),componentType:qs(t)}}function J0(e){let t=e,n=1,s=0;return e&&e.value&&(t=e.value,n=e.size||1),t&&(ArrayBuffer.isView(t)||(t=V0(t,Float32Array)),s=t.length/n),{buffer:t,size:n,count:s}}function V0(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return e?Array.isArray(e)?new t(e):n&&!(e instanceof t)?new t(e):e:null}const jt="KHR_draco_mesh_compression",j0=jt;function k0(e,t,n){const s=new nt(e);for(const r of ma(s))s.getObjectExtension(r,jt)}async function K0(e,t,n){var s;if(!(t!=null&&(s=t.gltf)!==null&&s!==void 0&&s.decompressMeshes))return;const r=new nt(e),i=[];for(const o of ma(r))r.getObjectExtension(o,jt)&&i.push(W0(r,o,t,n));await Promise.all(i),r.removeExtension(jt)}function z0(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new nt(e);for(const s of n.json.meshes||[])X0(s,t),n.addRequiredExtension(jt)}async function W0(e,t,n,s){const r=e.getObjectExtension(t,jt);if(!r)return;const i=e.getTypedArrayForBufferView(r.bufferView),o=es(i.buffer,i.byteOffset),a={...n};delete a["3d-tiles"];const c=await pe(o,wo,a,s),l=H0(c.attributes);for(const[u,h]of Object.entries(l))if(u in t.attributes){const f=t.attributes[u],d=e.getAccessor(f);d!=null&&d.min&&d!==null&&d!==void 0&&d.max&&(h.min=d.min,h.max=d.max)}t.attributes=l,c.indices&&(t.indices=da(c.indices)),e.removeObjectExtension(t,jt),Q0(t)}function X0(e,t){var n;let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const o=r.DracoWriter.encodeSync({attributes:e}),a=i==null||(n=i.parseSync)===null||n===void 0?void 0:n.call(i,{attributes:e}),c=r._addFauxAttributes(a.attributes),l=r.addBufferView(o);return{primitives:[{attributes:c,mode:s,extensions:{[jt]:{bufferView:l,attributes:c}}}]}}function Q0(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*ma(e){for(const t of e.json.meshes||[])for(const n of t.primitives)yield n}const q0=Object.freeze(Object.defineProperty({__proto__:null,decode:K0,encode:z0,name:j0,preprocess:k0},Symbol.toStringTag,{value:"Module"})),lr="KHR_texture_transform",Y0=lr,Gn=new p,$0=new z,Z0=new z;async function tA(e,t){var n;if(!new nt(e).hasExtension(lr)||!((n=t.gltf)!==null&&n!==void 0&&n.loadBuffers))return;const i=e.json.materials||[];for(let o=0;o<i.length;o++)eA(o,e)}function eA(e,t){var n,s,r;const i=[],o=(n=t.json.materials)===null||n===void 0?void 0:n[e],a=o==null||(s=o.pbrMetallicRoughness)===null||s===void 0?void 0:s.baseColorTexture;a&&Ge(t,e,a,i);const c=o==null?void 0:o.emissiveTexture;c&&Ge(t,e,c,i);const l=o==null?void 0:o.normalTexture;l&&Ge(t,e,l,i);const u=o==null?void 0:o.occlusionTexture;u&&Ge(t,e,u,i);const h=o==null||(r=o.pbrMetallicRoughness)===null||r===void 0?void 0:r.metallicRoughnessTexture;h&&Ge(t,e,h,i)}function Ge(e,t,n,s){const r=nA(n,s);if(!r)return;const i=e.json.meshes||[];for(const o of i)for(const a of o.primitives){const c=a.material;Number.isFinite(c)&&t===c&&sA(e,a,r)}}function nA(e,t){var n;const s=(n=e.extensions)===null||n===void 0?void 0:n[lr],{texCoord:r=0}=e,{texCoord:i=r}=s;if(!(t.findIndex(a=>{let[c,l]=a;return c===r&&l===i})!==-1)){const a=oA(s);return r!==i&&(e.texCoord=i),t.push([r,i]),{originalTexCoord:r,texCoord:i,matrix:a}}return null}function sA(e,t,n){const{originalTexCoord:s,texCoord:r,matrix:i}=n,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){var a;const l=(a=e.json.accessors)===null||a===void 0?void 0:a[o];if(l&&l.bufferView){var c;const u=(c=e.json.bufferViews)===null||c===void 0?void 0:c[l.bufferView];if(u){const{arrayBuffer:h,byteOffset:f}=e.buffers[u.buffer],d=(f||0)+(l.byteOffset||0)+(u.byteOffset||0),{ArrayType:m,length:A}=Ys(l,u),y=No[l.componentType],E=Go[l.type],w=u.byteStride||y*E,B=new Float32Array(A);for(let C=0;C<l.count;C++){const R=new m(h,d+C*w,2);Gn.set(R[0],R[1],1),Gn.transformByMatrix3(i),B.set([Gn[0],Gn[1]],C*E)}s===r?rA(l,u,e.buffers,B):iA(r,l,t,e,B)}}}}function rA(e,t,n,s){e.componentType=5126,n.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=s.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function iA(e,t,n,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes[`TEXCOORD_${e}`]=o.length-1)}function oA(e){const{offset:t=[0,0],rotation:n=0,scale:s=[1,1]}=e,r=new z().set(1,0,0,0,1,0,t[0],t[1],1),i=$0.set(Math.cos(n),Math.sin(n),0,-Math.sin(n),Math.cos(n),0,0,0,1),o=Z0.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const aA=Object.freeze(Object.defineProperty({__proto__:null,decode:tA,name:Y0},Symbol.toStringTag,{value:"Module"})),Yt="KHR_lights_punctual",cA=Yt;async function lA(e){const t=new nt(e),{json:n}=t,s=t.getExtension(Yt);s&&(t.json.lights=s.lights,t.removeExtension(Yt));for(const r of n.nodes||[]){const i=t.getObjectExtension(r,Yt);i&&(r.light=i.light),t.removeObjectExtension(r,Yt)}}async function uA(e){const t=new nt(e),{json:n}=t;if(n.lights){const s=t.addExtension(Yt);dt(!s.lights),s.lights=n.lights,delete n.lights}if(t.json.lights){for(const s of t.json.lights){const r=s.node;t.addObjectExtension(r,Yt,s)}delete t.json.lights}}const hA=Object.freeze(Object.defineProperty({__proto__:null,decode:lA,encode:uA,name:cA},Symbol.toStringTag,{value:"Module"})),Ne="KHR_materials_unlit",fA=Ne;async function dA(e){const t=new nt(e),{json:n}=t;for(const s of n.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),t.removeObjectExtension(s,Ne);t.removeExtension(Ne)}function mA(e){const t=new nt(e),{json:n}=t;if(t.materials)for(const s of n.materials||[])s.unlit&&(delete s.unlit,t.addObjectExtension(s,Ne,{}),t.addExtension(Ne))}const gA=Object.freeze(Object.defineProperty({__proto__:null,decode:dA,encode:mA,name:fA},Symbol.toStringTag,{value:"Module"})),Ue="KHR_techniques_webgl",AA=Ue;async function pA(e){const t=new nt(e),{json:n}=t,s=t.getExtension(Ue);if(s){const r=BA(s,t);for(const i of n.materials||[]){const o=t.getObjectExtension(i,Ue);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=CA(i.technique,t)),t.removeObjectExtension(i,Ue)}t.removeExtension(Ue)}}async function yA(e,t){}function BA(e,t){const{programs:n=[],shaders:s=[],techniques:r=[]}=e,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),n.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=n[o.program]}),r}function CA(e,t){const n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(s=>{e.uniforms[s].value&&!(s in n)&&(n[s]=e.uniforms[s].value)}),Object.keys(n).forEach(s=>{typeof n[s]=="object"&&n[s].index!==void 0&&(n[s].texture=t.getTexture(n[s].index))}),n}const ga=[Ig,hg,F0,P0,U0,q0,hA,gA,Object.freeze(Object.defineProperty({__proto__:null,decode:pA,encode:yA,name:AA},Symbol.toStringTag,{value:"Module"})),aA,zg];function EA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=ga.filter(i=>Aa(i.name,t));for(const i of s){var r;(r=i.preprocess)===null||r===void 0||r.call(i,e,t,n)}}async function TA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=ga.filter(i=>Aa(i.name,t));for(const i of s){var r;await((r=i.decode)===null||r===void 0?void 0:r.call(i,e,t,n))}}function Aa(e,t){var n;const s=(t==null||(n=t.gltf)===null||n===void 0?void 0:n.excludeExtensions)||{};return!(e in s&&!s[e])}const ur="KHR_binary_glTF";function bA(e){const t=new nt(e),{json:n}=t;for(const s of n.images||[]){const r=t.getObjectExtension(s,ur);r&&Object.assign(s,r),t.removeObjectExtension(s,ur)}n.buffers&&n.buffers[0]&&delete n.buffers[0].uri,t.removeExtension(ur)}const pa={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},_A={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class wA{constructor(){this.idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}},this.json=void 0}normalize(t,n){this.json=t.json;const s=t.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!n.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),bA(t),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const n in pa)this._convertTopLevelObjectToArray(t,n)}_convertTopLevelObjectToArray(t,n){const s=t[n];if(!(!s||Array.isArray(s))){t[n]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=t[n].length;t[n].push(i),this.idToIndexMap[n][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const n in pa)this._convertIdsToIndices(t,n);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const n of t.textures)this._convertTextureIds(n);for(const n of t.meshes)this._convertMeshIds(n);for(const n of t.nodes)this._convertNodeIds(n);for(const n of t.scenes)this._convertSceneIds(n)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const n of t.primitives){const{attributes:s,indices:r,material:i}=n;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(n.indices=this._convertIdToIndex(r,"accessor")),i&&(n.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(n=>this._convertIdToIndex(n,"node"))),t.meshes&&(t.meshes=t.meshes.map(n=>this._convertIdToIndex(n,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(n=>this._convertIdToIndex(n,"node")))}_convertIdsToIndices(t,n){t[n]||(console.warn(`gltf v1: json doesn't contain attribute ${n}`),t[n]=[]);for(const s of t[n])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(t,n){const s=_A[n];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${n} with id ${t}`);return r}return t}_updateObjects(t){for(const n of this.json.buffers)delete n.type}_updateMaterial(t){for(const i of t.materials){var n,s,r;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((n=i.values)===null||n===void 0?void 0:n.tex)||((s=i.values)===null||s===void 0?void 0:s.texture2d_0)||((r=i.values)===null||r===void 0?void 0:r.diffuseTex),a=t.textures.findIndex(c=>c.id===o);a!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:a})}}}function RA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new wA().normalize(e,t)}async function MA(e,t){var n,s,r;let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return SA(e,t,i,o),RA(e,{normalize:o==null||(n=o.gltf)===null||n===void 0?void 0:n.normalize}),EA(e,o,a),o!=null&&(s=o.gltf)!==null&&s!==void 0&&s.loadBuffers&&e.json.buffers&&await IA(e,o,a),o!=null&&(r=o.gltf)!==null&&r!==void 0&&r.loadImages&&await xA(e,o,a),await TA(e,o,a),e}function SA(e,t,n,s){if(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!m0(t,n,s)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=kc(t);else if(t instanceof ArrayBuffer){const o={};n=g0(o,t,n,s.glb),dt(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else dt(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=e.json.images||[];e.images=new Array(i.length).fill({})}async function IA(e,t,n){const s=e.json.buffers||[];for(let o=0;o<s.length;++o){const a=s[o];if(a.uri){var r,i;const{fetch:c}=n;dt(c);const l=fa(a.uri,t),u=await(n==null||(r=n.fetch)===null||r===void 0?void 0:r.call(n,l)),h=await(u==null||(i=u.arrayBuffer)===null||i===void 0?void 0:i.call(u));e.buffers[o]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri}else e.buffers[o]===null&&(e.buffers[o]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}async function xA(e,t,n){const s=vA(e),r=e.json.images||[],i=[];for(const o of s)i.push(OA(e,r[o],o,t,n));return await Promise.all(i)}function vA(e){const t=new Set,n=e.json.textures||[];for(const s of n)s.source!==void 0&&t.add(s.source);return Array.from(t).sort()}async function OA(e,t,n,s,r){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){const a=fa(t.uri,s),{fetch:c}=r;i=await(await c(a)).arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){const a=eg(e.json,e.buffers,t.bufferView);i=es(a.buffer,a.byteOffset,a.byteLength)}dt(i,"glTF image has no data");let o=await pe(i,[km,a0],{...s,mimeType:t.mimeType,basis:s.basis||{format:ua()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[n]=o}const Nn={name:"glTF",id:"gltf",module:"gltf",version:Wg,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:FA,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function FA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;t={...Nn.options,...t},t.gltf={...Nn.options.gltf,...t.gltf};const{byteOffset:s=0}=t;return await MA({},e,s,t,n)}const DA={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},LA={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Bt={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},PA={magFilter:Bt.TEXTURE_MAG_FILTER,minFilter:Bt.TEXTURE_MIN_FILTER,wrapS:Bt.TEXTURE_WRAP_S,wrapT:Bt.TEXTURE_WRAP_T},GA={[Bt.TEXTURE_MAG_FILTER]:Bt.LINEAR,[Bt.TEXTURE_MIN_FILTER]:Bt.NEAREST_MIPMAP_LINEAR,[Bt.TEXTURE_WRAP_S]:Bt.REPEAT,[Bt.TEXTURE_WRAP_T]:Bt.REPEAT};function NA(){return{id:"default-sampler",parameters:GA}}function UA(e){return LA[e]}function HA(e){return DA[e]}class JA{constructor(){this.baseUri="",this.jsonUnprocessed=void 0,this.json=void 0,this.buffers=[],this.images=[]}postProcess(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{json:s,buffers:r=[],images:i=[]}=t,{baseUri:o=""}=t;return dt(s),this.baseUri=o,this.buffers=r,this.images=i,this.jsonUnprocessed=s,this.json=this._resolveTree(t.json,n),this.json}_resolveTree(t){const n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((s,r)=>this._resolveBufferView(s,r))),t.images&&(n.images=t.images.map((s,r)=>this._resolveImage(s,r))),t.samplers&&(n.samplers=t.samplers.map((s,r)=>this._resolveSampler(s,r))),t.textures&&(n.textures=t.textures.map((s,r)=>this._resolveTexture(s,r))),t.accessors&&(n.accessors=t.accessors.map((s,r)=>this._resolveAccessor(s,r))),t.materials&&(n.materials=t.materials.map((s,r)=>this._resolveMaterial(s,r))),t.meshes&&(n.meshes=t.meshes.map((s,r)=>this._resolveMesh(s,r))),t.nodes&&(n.nodes=t.nodes.map((s,r)=>this._resolveNode(s,r)),n.nodes=n.nodes.map((s,r)=>this._resolveNodeChildren(s))),t.skins&&(n.skins=t.skins.map((s,r)=>this._resolveSkin(s,r))),t.scenes&&(n.scenes=t.scenes.map((s,r)=>this._resolveScene(s,r))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,n){if(typeof n=="object")return n;const s=t&&t[n];return s||console.warn(`glTF file error: Could not find ${t}[${n}]`),s}_resolveScene(t,n){return{...t,id:t.id||`scene-${n}`,nodes:(t.nodes||[]).map(s=>this.getNode(s))}}_resolveNode(t,n){const s={...t,id:(t==null?void 0:t.id)||`node-${n}`};return t.mesh!==void 0&&(s.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(s.camera=this.getCamera(t.camera)),t.skin!==void 0&&(s.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(s.mesh=t.meshes.reduce((r,i)=>{const o=this.getMesh(i);return r.id=o.id,r.primitives=r.primitives.concat(o.primitives),r},{primitives:[]})),s}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(n=>this.getNode(n))),t}_resolveSkin(t,n){const s=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${n}`,inverseBindMatrices:s}}_resolveMesh(t,n){const s={...t,id:t.id||`mesh-${n}`,primitives:[]};return t.primitives&&(s.primitives=t.primitives.map(r=>{const i={...r,attributes:{},indices:void 0,material:void 0},o=r.attributes;for(const a in o)i.attributes[a]=this.getAccessor(o[a]);return r.indices!==void 0&&(i.indices=this.getAccessor(r.indices)),r.material!==void 0&&(i.material=this.getMaterial(r.material)),i})),s}_resolveMaterial(t,n){const s={...t,id:t.id||`material-${n}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const r=s.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture={...r.baseColorTexture},r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture={...r.metallicRoughnessTexture},r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return s}_resolveAccessor(t,n){const s=UA(t.componentType),r=HA(t.type),i=s*r,o={...t,id:t.id||`accessor-${n}`,bytesPerComponent:s,components:r,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){const a=o.bufferView.buffer,{ArrayType:c,byteLength:l}=Ys(o,o.bufferView),u=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset;let h=a.arrayBuffer.slice(u,u+l);o.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(a,u,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(h)}return o}_getValueFromInterleavedBuffer(t,n,s,r,i){const o=new Uint8Array(i*r);for(let a=0;a<i;a++){const c=n+a*s;o.set(new Uint8Array(t.arrayBuffer.slice(c,c+r)),a*r)}return o.buffer}_resolveTexture(t,n){return{...t,id:t.id||`texture-${n}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):NA(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,n){const s={id:t.id||`sampler-${n}`,...t,parameters:{}};for(const r in s){const i=this._enumSamplerParameter(r);i!==void 0&&(s.parameters[i]=s[r])}return s}_enumSamplerParameter(t){return PA[t]}_resolveImage(t,n){const s={...t,id:t.id||`image-${n}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},r=this.images[n];return r&&(s.image=r),s}_resolveBufferView(t,n){const s=t.buffer,r=this.buffers[s].arrayBuffer;let i=this.buffers[s].byteOffset||0;return t.byteOffset&&(i+=t.byteOffset),{id:`bufferView-${n}`,...t,buffer:this.buffers[s],data:new Uint8Array(r,i,t.byteLength)}}_resolveCamera(t,n){const s={...t,id:t.id||`camera-${n}`};return s.perspective,s.orthographic,s}}function ya(e,t){return new JA().postProcess(e,t)}const hr={URI:0,EMBEDDED:1};function Ba(e,t,n,s){e.rotateYtoZ=!0;const r=(e.byteOffset||0)+(e.byteLength||0)-n;if(r===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=s!=null&&s["3d-tiles"]&&s["3d-tiles"].assetGltfUpAxis?s["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=es(t,n,r),e.gltfByteOffset=0,e.gltfByteLength=r,n%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function Ca(e,t,n,s){const r=(n==null?void 0:n["3d-tiles"])||{};if(VA(e,t),r.loadGLTF){if(!s)return;if(e.gltfUrl){const{fetch:i}=s,o=await i(e.gltfUrl,n);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const i=await pe(e.gltfArrayBuffer,Nn,n,s);e.gltf=ya(i),e.gpuMemoryUsageInBytes=Jo(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function VA(e,t,n){switch(t){case hr.URI:if(e.gltfArrayBuffer){const s=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=new TextDecoder().decode(s);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case hr.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function jA(e,t,n,s,r){var i;n=kA(e,t,n,s),await Ca(e,hr.EMBEDDED,s,r);const o=e==null||(i=e.gltf)===null||i===void 0?void 0:i.extensions;return o&&o.CESIUM_RTC&&(e.rtcCenter=o.CESIUM_RTC.center),n}function kA(e,t,n,s,r){n=In(e,t,n),n=Js(e,t,n),n=Vs(e,t,n),n=Ba(e,t,n,s);const i=new Us(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",P.FLOAT,3),n}async function KA(e,t,n,s,r){return n=zA(e,t,n,s),await Ca(e,e.gltfFormat||0,s,r),n}function zA(e,t,n,s,r){var i;if(n=In(e,t,n),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);n=Js(e,t,n);const o=new DataView(t);if(e.gltfFormat=o.getUint32(n,!0),n+=4,n=Vs(e,t,n),n=Ba(e,t,n,s),!(e!=null&&(i=e.header)!==null&&i!==void 0&&i.featureTableJsonByteLength)||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const a=new Us(e.featureTableJson,e.featureTableBinary),c=a.getGlobalProperty("INSTANCES_LENGTH");if(a.featuresLength=c,!Number.isFinite(c))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=a.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=a.getGlobalProperty("RTC_CENTER",P.FLOAT,3);const l=new Io(e.batchTableJson,e.batchTableBinary,c);return WA(e,a,l,c),n}function WA(e,t,n,s){const r=new Array(s),i=new p;new p,new p,new p;const o=new z,a=new dn,c=new p,l={},u=new V,h=[],f=[],d=[],m=[];for(let A=0;A<s;A++){let y;if(t.hasProperty("POSITION"))y=t.getProperty("POSITION",P.FLOAT,3,A,i);else if(t.hasProperty("POSITION_QUANTIZED")){y=t.getProperty("POSITION_QUANTIZED",P.UNSIGNED_SHORT,3,A,i);const b=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",P.FLOAT,3);if(!b)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const v=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",P.FLOAT,3);if(!v)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const O=65535;for(let x=0;x<3;x++)y[x]=y[x]/O*v[x]+b[x]}if(!y)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(i.copy(y),l.translation=i,e.normalUp=t.getProperty("NORMAL_UP",P.FLOAT,3,A,h),e.normalRight=t.getProperty("NORMAL_RIGHT",P.FLOAT,3,A,f),e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",P.UNSIGNED_SHORT,2,A,h),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",P.UNSIGNED_SHORT,2,A,f),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(J.WGS84.eastNorthUpToFixedFrame(i,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),l.rotation=a,c.set(1,1,1);const E=t.getProperty("SCALE",P.FLOAT,1,A,d);Number.isFinite(E)&&c.multiplyByScalar(E);const w=t.getProperty("SCALE_NON_UNIFORM",P.FLOAT,3,A,h);w&&c.scale(w),l.scale=c;let B=t.getProperty("BATCH_ID",P.UNSIGNED_SHORT,1,A,m);B===void 0&&(B=A);const C=new V().fromQuaternion(l.rotation);u.identity(),u.translate(l.translation),u.multiplyRight(C),u.scale(l.scale);const R=u.clone();r[A]={modelMatrix:R,batchId:B}}e.instances=r}async function XA(e,t,n,s,r,i){n=In(e,t,n);const o=new DataView(t);for(e.tilesLength=o.getUint32(n,!0),n+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-n>12;){const a={shape:"tile3d"};e.tiles.push(a),n=await i(t,n,s,r,a)}return n}async function QA(e,t,n,s){var r,i;if(e.rotateYtoZ=!0,e.gltfUpAxis=n!=null&&(r=n["3d-tiles"])!==null&&r!==void 0&&r.assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",n!=null&&(i=n["3d-tiles"])!==null&&i!==void 0&&i.loadGLTF){if(!s)return t.byteLength;const o=await pe(t,Nn,n,s);e.gltf=ya(o),e.gpuMemoryUsageInBytes=Jo(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function Ea(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{shape:"tile3d"};switch(r.byteOffset=t,r.type=_d(e,t),r.type){case Oe.COMPOSITE:return await XA(r,e,t,n,s,Ea);case Oe.BATCHED_3D_MODEL:return await jA(r,e,t,n,s);case Oe.GLTF:return await QA(r,e,n,s);case Oe.INSTANCED_3D_MODEL:return await KA(r,e,t,n,s);case Oe.POINT_CLOUD:return await am(r,e,t,n,s);default:throw new Error(`3DTileLoader: unknown type ${r.type}`)}}const qA=1952609651,YA=1;async function $A(e,t,n){if(new Uint32Array(e.slice(0,4))[0]!==qA)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==YA)throw new Error("Wrong subtree file verson, must be 1");const i=Ta(e.slice(8,16)),o=new Uint8Array(e,24,i),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),u=Ta(e.slice(16,24));let h=new ArrayBuffer(0);if(u&&(h=e.slice(24+i)),await Un(l,l.tileAvailability,h,n),Array.isArray(l.contentAvailability))for(const f of l.contentAvailability)await Un(l,f,h,n);else await Un(l,l.contentAvailability,h,n);return await Un(l,l.childSubtreeAvailability,h,n),l}async function Un(e,t,n,s){const r=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof r!="number")return;const i=e.bufferViews[r],o=e.buffers[i.buffer];if(!(s!=null&&s.baseUrl))throw new Error("Url is not provided");if(!s.fetch)throw new Error("fetch is not provided");if(o.uri){const c=`${(s==null?void 0:s.baseUrl)||""}/${o.uri}`,u=await(await s.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(u,i.byteOffset,i.byteLength);return}const a=e.buffers.slice(0,i.buffer).reduce((c,l)=>c+l.byteLength,0);t.explicitBitstream=new Uint8Array(n.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function Ta(e){const t=new DataView(e),n=t.getUint32(0,!0),s=t.getUint32(4,!0);return n+2**32*s}const ba={id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Co,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:$A,options:{}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Ct=null;try{Ct=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function H(e,t,n){this.low=e|0,this.high=t|0,this.unsigned=!!n}H.prototype.__isLong__,Object.defineProperty(H.prototype,"__isLong__",{value:!0});function st(e){return(e&&e.__isLong__)===!0}function _a(e){var t=Math.clz32(e&-e);return e?31-t:t}H.isLong=st;var wa={},Ra={};function $t(e,t){var n,s,r;return t?(e>>>=0,(r=0<=e&&e<256)&&(s=Ra[e],s)?s:(n=G(e,0,!0),r&&(Ra[e]=n),n)):(e|=0,(r=-128<=e&&e<128)&&(s=wa[e],s)?s:(n=G(e,e<0?-1:0,!1),r&&(wa[e]=n),n))}H.fromInt=$t;function Et(e,t){if(isNaN(e))return t?Gt:Rt;if(t){if(e<0)return Gt;if(e>=Sa)return Fa}else{if(e<=-Ia)return ut;if(e+1>=Ia)return Oa}return e<0?Et(-e,t).neg():G(e%de|0,e/de|0,t)}H.fromNumber=Et;function G(e,t,n){return new H(e,t,n)}H.fromBits=G;var Hn=Math.pow;function fr(e,t,n){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(n=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?Gt:Rt;if(n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=e.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return fr(e.substring(1),t,n).neg();for(var r=Et(Hn(n,8)),i=Rt,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),n);if(a<8){var l=Et(Hn(n,a));i=i.mul(l).add(Et(c))}else i=i.mul(r),i=i.add(Et(c))}return i.unsigned=t,i}H.fromString=fr;function wt(e,t){return typeof e=="number"?Et(e,t):typeof e=="string"?fr(e,t):G(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}H.fromValue=wt;var Ma=65536,ZA=1<<24,de=Ma*Ma,Sa=de*de,Ia=Sa/2,xa=$t(ZA),Rt=$t(0);H.ZERO=Rt;var Gt=$t(0,!0);H.UZERO=Gt;var me=$t(1);H.ONE=me;var va=$t(1,!0);H.UONE=va;var dr=$t(-1);H.NEG_ONE=dr;var Oa=G(-1,2147483647,!1);H.MAX_VALUE=Oa;var Fa=G(-1,-1,!0);H.MAX_UNSIGNED_VALUE=Fa;var ut=G(0,-2147483648,!1);H.MIN_VALUE=ut;var _=H.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*de+(this.low>>>0):this.high*de+(this.low>>>0)},_.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ut)){var n=Et(t),s=this.div(n),r=s.mul(n).sub(this);return s.toString(t)+r.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Et(Hn(t,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,u=l.toString(t);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ut)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,n=31;n>0&&!(t&1<<n);n--);return this.high!=0?n+33:n+1},_.isZero=function(){return this.high===0&&this.low===0},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(this.low&1)===1},_.isEven=function(){return(this.low&1)===0},_.equals=function(t){return st(t)||(t=wt(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low},_.eq=_.equals,_.notEquals=function(t){return!this.eq(t)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(t){return this.comp(t)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(t){return this.comp(t)<=0},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(t){return this.comp(t)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(t){return this.comp(t)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(t){if(st(t)||(t=wt(t)),this.eq(t))return 0;var n=this.isNegative(),s=t.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(ut)?ut:this.not().add(me)},_.neg=_.negate,_.add=function(t){st(t)||(t=wt(t));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,l=t.low&65535,u=0,h=0,f=0,d=0;return d+=i+l,f+=d>>>16,d&=65535,f+=r+c,h+=f>>>16,f&=65535,h+=s+a,u+=h>>>16,h&=65535,u+=n+o,u&=65535,G(f<<16|d,u<<16|h,this.unsigned)},_.subtract=function(t){return st(t)||(t=wt(t)),this.add(t.neg())},_.sub=_.subtract,_.multiply=function(t){if(this.isZero())return this;if(st(t)||(t=wt(t)),Ct){var n=Ct.mul(this.low,this.high,t.low,t.high);return G(n,Ct.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Gt:Rt;if(this.eq(ut))return t.isOdd()?ut:Rt;if(t.eq(ut))return this.isOdd()?ut:Rt;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(xa)&&t.lt(xa))return Et(this.toNumber()*t.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,l=t.low>>>16,u=t.low&65535,h=0,f=0,d=0,m=0;return m+=o*u,d+=m>>>16,m&=65535,d+=i*u,f+=d>>>16,d&=65535,d+=o*l,f+=d>>>16,d&=65535,f+=r*u,h+=f>>>16,f&=65535,f+=i*l,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=s*u+r*l+i*c+o*a,h&=65535,G(d<<16|m,h<<16|f,this.unsigned)},_.mul=_.multiply,_.divide=function(t){if(st(t)||(t=wt(t)),t.isZero())throw Error("division by zero");if(Ct){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var n=(this.unsigned?Ct.div_u:Ct.div_s)(this.low,this.high,t.low,t.high);return G(n,Ct.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Gt:Rt;var s,r,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Gt;if(t.gt(this.shru(1)))return va;i=Gt}else{if(this.eq(ut)){if(t.eq(me)||t.eq(dr))return ut;if(t.eq(ut))return me;var o=this.shr(1);return s=o.div(t).shl(1),s.eq(Rt)?t.isNegative()?me:dr:(r=this.sub(t.mul(s)),i=s.add(r.div(t)),i)}else if(t.eq(ut))return this.unsigned?Gt:Rt;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Rt}for(r=this;r.gte(t);){s=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),c=a<=48?1:Hn(2,a-48),l=Et(s),u=l.mul(t);u.isNegative()||u.gt(r);)s-=c,l=Et(s,this.unsigned),u=l.mul(t);l.isZero()&&(l=me),i=i.add(l),r=r.sub(u)}return i},_.div=_.divide,_.modulo=function(t){if(st(t)||(t=wt(t)),Ct){var n=(this.unsigned?Ct.rem_u:Ct.rem_s)(this.low,this.high,t.low,t.high);return G(n,Ct.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return G(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?_a(this.low):_a(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(t){return st(t)||(t=wt(t)),G(this.low&t.low,this.high&t.high,this.unsigned)},_.or=function(t){return st(t)||(t=wt(t)),G(this.low|t.low,this.high|t.high,this.unsigned)},_.xor=function(t){return st(t)||(t=wt(t)),G(this.low^t.low,this.high^t.high,this.unsigned)},_.shiftLeft=function(t){return st(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?G(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):G(0,this.low<<t-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(t){return st(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?G(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):G(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(t){return st(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?G(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?G(this.high,0,this.unsigned):G(this.high>>>t-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(t){var n;return st(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?G(this.high,this.low,this.unsigned):t<32?(n=32-t,G(this.low<<t|this.high>>>n,this.high<<t|this.low>>>n,this.unsigned)):(t-=32,n=32-t,G(this.high<<t|this.low>>>n,this.low<<t|this.high>>>n,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(t){var n;return st(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?G(this.high,this.low,this.unsigned):t<32?(n=32-t,G(this.high<<n|this.low>>>t,this.low<<n|this.high>>>t,this.unsigned)):(t-=32,n=32-t,G(this.low<<n|this.high>>>t,this.high<<n|this.low>>>t,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?G(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:G(this.low,this.high,!0)},_.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var t=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]},_.toBytesBE=function(){var t=this.high,n=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,n>>>24,n>>>16&255,n>>>8&255,n&255]},H.fromBytes=function(t,n,s){return s?H.fromBytesLE(t,n):H.fromBytesBE(t,n)},H.fromBytesLE=function(t,n){return new H(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,n)},H.fromBytesBE=function(t,n){return new H(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],n)};const tp=16;function Da(e){e==="X"&&(e="");const t=e.padEnd(tp,"0");return H.fromString(t,!0,16)}function ep(e){if(e.isZero())return"X";let t=e.countTrailingZeros();const n=t%4;t=(t-n)/4;const s=t;t*=4;const i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-s-i.length).join("0")+i}function np(e,t){const n=sp(e).shiftRightUnsigned(2);return e.add(H.fromNumber(2*t+1-4).multiply(n))}function sp(e){return e.and(e.not().add(1))}const rp=3,ip=2*30+1,La=180/Math.PI;function op(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),n=parseInt(t[0],10),s=t[1],r=s.length;let i=0;const o=[0,0];for(let a=r-1;a>=0;a--){i=r-a;const c=s[a];let l=0,u=0;c==="1"?u=1:c==="2"?(l=1,u=1):c==="3"&&(l=1);const h=Math.pow(2,i-1);cp(h,o,l,u),o[0]+=h*l,o[1]+=h*u}if(n%2===1){const a=o[0];o[0]=o[1],o[1]=a}return{face:n,ij:o,level:i}}function ap(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<rp+ip;)t="0"+t;const n=t.lastIndexOf("1"),s=t.substring(0,3),r=t.substring(3,n),i=r.length/2,o=H.fromString(s,!0,2).toString(10);let a="";if(i!==0)for(a=H.fromString(r,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function Pa(e,t,n){const s=1<<t;return[(e[0]+n[0])/s,(e[1]+n[1])/s]}function Ga(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Na(e){return[Ga(e[0]),Ga(e[1])]}function Ua(e,t){let[n,s]=t;switch(e){case 0:return[1,n,s];case 1:return[-n,1,s];case 2:return[-n,-s,1];case 3:return[-1,-s,-n];case 4:return[s,-1,-n];case 5:return[s,n,-1];default:throw new Error("Invalid face")}}function Ha(e){let[t,n,s]=e;const r=Math.atan2(s,Math.sqrt(t*t+n*n));return[Math.atan2(n,t)*La,r*La]}function cp(e,t,n,s){if(s===0){n===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function lp(e){const t=Pa(e.ij,e.level,[.5,.5]),n=Na(t),s=Ua(e.face,n);return Ha(s)}const up=100;function Ja(e){const{face:t,ij:n,level:s}=e,r=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(up*Math.pow(2,-s))),o=new Float64Array(4*i*2+2);let a=0,c=0;for(let l=0;l<4;l++){const u=r[l].slice(0),h=r[l+1],f=(h[0]-u[0])/i,d=(h[1]-u[1])/i;for(let m=0;m<i;m++){u[0]+=f,u[1]+=d;const A=Pa(n,s,u),y=Na(A),E=Ua(t,y),w=Ha(E);Math.abs(w[1])>89.999&&(w[0]=c);const B=w[0]-c;w[0]+=B>180?-360:B<-180?360:0,o[a++]=w[0],o[a++]=w[1],c=w[0]}}return o[a++]=o[0],o[a++]=o[1],o}function mr(e){const t=hp(e);return op(t)}function hp(e){if(e.indexOf("/")>0)return e;const t=Da(e);return ap(t)}function fp(e){const t=mr(e);return lp(t)}function dp(e){let t;if(e.face===2||e.face===5){let n=null,s=0;for(let r=0;r<4;r++){const i=`${e.face}/${r}`,o=mr(i),a=Ja(o);(typeof n>"u"||n===null)&&(n=new Float64Array(4*a.length)),n.set(a,s),s+=a.length}t=Va(n)}else{const n=Ja(e);t=Va(n)}return t}function Va(e){if(e.length%2!==0)throw new Error("Invalid corners");const t=[],n=[];for(let s=0;s<e.length;s+=2)t.push(e[s]),n.push(e[s+1]);return t.sort((s,r)=>s-r),n.sort((s,r)=>s-r),{west:t[0],east:t[t.length-1],north:n[n.length-1],south:n[0]}}function mp(e,t){const n=(t==null?void 0:t.minimumHeight)||0,s=(t==null?void 0:t.maximumHeight)||0,r=mr(e),i=dp(r),o=i.west,a=i.south,c=i.east,l=i.north,u=[];return u.push(new p(o,l,n)),u.push(new p(c,l,n)),u.push(new p(c,a,n)),u.push(new p(o,a,n)),u.push(new p(o,l,s)),u.push(new p(c,l,s)),u.push(new p(c,a,s)),u.push(new p(o,a,s)),u}function ja(e){const t=e.token,n={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},s=mp(t,n),r=fp(t),i=r[0],o=r[1],a=J.WGS84.cartographicToCartesian([i,o,n.maximumHeight]),c=new p(a[0],a[1],a[2]);s.push(c);const l=Wf(s);return[...l.center,...l.halfAxes]}const gp={QUADTREE:4,OCTREE:8};function Ap(e,t,n){if(e!=null&&e.box){const s=Da(e.s2VolumeInfo.token),r=np(s,t),i=ep(r),o={...e.s2VolumeInfo};switch(o.token=i,n){case"OCTREE":const l=e.s2VolumeInfo,u=l.maximumHeight-l.minimumHeight,h=u/2,f=l.minimumHeight+u/2;l.minimumHeight=f-h,l.maximumHeight=f+h;break}return{box:ja(o),s2VolumeInfo:o}}}async function ka(e){const{implicitOptions:t,parentData:n={mortonIndex:0,x:0,y:0,z:0},childIndex:s=0,s2VolumeBox:r,loaderOptions:i}=e;let{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=e;const{subdivisionScheme:l,subtreeLevels:u,maximumLevel:h,contentUrlTemplate:f,subtreesUriTemplate:d,basePath:m}=t,A={children:[],lodMetricValue:0,contentUrl:""};if(!h)return si.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${f} won't be loaded...`),A;const y=a+c.level;if(y>h)return A;const E=gp[l],w=Math.log2(E),B=s&1,C=s>>1&1,R=s>>2&1,b=(E**a-1)/(E-1);let v=Zt(n.mortonIndex,s,w),O=b+v,x=Zt(n.x,B,1),D=Zt(n.y,C,1),k=Zt(n.z,R,1),X=!1;a>=u&&(X=gr(o.childSubtreeAvailability,v));const Q=Zt(c.x,x,a),L=Zt(c.y,D,a),rt=Zt(c.z,k,a);if(X){const Z=`${m}/${d}`,Ut=Ar(Z,y,Q,L,rt);o=await oe(Ut,ba,i),c={mortonIndex:v,x,y:D,z:k,level:a},v=0,O=0,x=0,D=0,k=0,a=0}if(!gr(o.tileAvailability,O))return A;gr(o.contentAvailability,O)&&(A.contentUrl=Ar(f,y,Q,L,rt));const Xe=a+1,Nt={mortonIndex:v,x,y:D,z:k};for(let Z=0;Z<E;Z++){const Ut=Ap(r,Z,l),se=await ka({subtree:o,implicitOptions:t,loaderOptions:i,parentData:Nt,childIndex:Z,level:Xe,globalData:{...c},s2VolumeBox:Ut});if(se.contentUrl||se.children.length){const Qe=y+1,Ir=pp(se,Qe,{childTileX:x,childTileY:D,childTileZ:k},t,r);A.children.push(Ir)}}return A}function gr(e,t){let n;return Array.isArray(e)?(n=e[0],e.length>1&&si.once('Not supported extension "3DTILES_multiple_contents" has been detected')):n=e,"constant"in n?!!n.constant:n.explicitBitstream?Cp(t,n.explicitBitstream):!1}function pp(e,t,n,s,r){const{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:u,rootBoundingVolume:h}=s,f=e.contentUrl&&e.contentUrl.replace(`${i}/`,""),d=u/2**t,m=r!=null&&r.box?{box:r.box}:h,A=yp(t,m,n);return{children:e.children,contentUrl:e.contentUrl,content:{uri:f},id:e.contentUrl,refine:a(o),type:l(e),lodMetricType:c,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:A}}function yp(e,t,n){if(t.region){const{childTileX:s,childTileY:r,childTileZ:i}=n,[o,a,c,l,u,h]=t.region,f=2**e,d=(c-o)/f,m=(l-a)/f,A=(h-u)/f,[y,E]=[o+d*s,o+d*(s+1)],[w,B]=[a+m*r,a+m*(r+1)],[C,R]=[u+A*i,u+A*(i+1)];return{region:[y,w,E,B,C,R]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${t}`)}function Zt(e,t,n){return(e<<n)+t}function Ar(e,t,n,s,r){const i=Bp({level:t,x:n,y:s,z:r});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function Bp(e){const t={};for(const n in e)t[`{${n}}`]=e[n];return t}function Cp(e,t){const n=Math.floor(e/8),s=e%8;return(t[n]>>s&1)===1}function pr(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!t)return Qt.EMPTY;const s=t.split("?")[0].split(".").pop();switch(s){case"pnts":return Qt.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Qt.SCENEGRAPH;default:return s||Qt.EMPTY}}function yr(e){switch(e){case"REPLACE":case"replace":return Pt.REPLACE;case"ADD":case"add":return Pt.ADD;default:return e}}function Br(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const s=new URL(e,`${t}/`);return decodeURI(s.toString())}else if(e.startsWith("/"))return e;return al(t,e)}function Ka(e,t){if(!e)return null;let n;if(e.content){var s;const i=e.content.uri||((s=e.content)===null||s===void 0?void 0:s.url);typeof i<"u"&&(n=Br(i,t))}return{...e,id:n,contentUrl:n,lodMetricType:_n.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:pr(e,n),refine:yr(e.refine)}}async function Ep(e,t,n){let s=null;const r=Wa(e.root);r&&e.root?s=await za(e.root,e,t,r,n):s=Ka(e.root,t);const i=[];for(i.push(s);i.length>0;){const o=i.pop()||{},a=o.children||[],c=[];for(const l of a){const u=Wa(l);let h;u?h=await za(l,e,t,u,n):h=Ka(l,t),h&&(c.push(h),i.push(h))}o.children=c}return s}async function za(e,t,n,s,r){var i,o,a;const{subdivisionScheme:c,maximumLevel:l,availableLevels:u,subtreeLevels:h,subtrees:{uri:f}}=s,d=Ar(f,0,0,0,0),m=Br(d,n),A=await oe(m,ba,r),y=(i=e.content)===null||i===void 0?void 0:i.uri,E=y?Br(y,n):"",w=t==null||(o=t.root)===null||o===void 0?void 0:o.refine,B=e.geometricError,C=(a=e.boundingVolume.extensions)===null||a===void 0?void 0:a["3DTILES_bounding_volume_S2"];if(C){const O={box:ja(C),s2VolumeInfo:C};e.boundingVolume=O}const R=e.boundingVolume,b={contentUrlTemplate:E,subtreesUriTemplate:f,subdivisionScheme:c,subtreeLevels:h,maximumLevel:Number.isFinite(u)?u-1:l,refine:w,basePath:n,lodMetricType:_n.GEOMETRIC_ERROR,rootLodMetricValue:B,rootBoundingVolume:R,getTileType:pr,getRefine:yr};return await Tp(e,n,A,b,r)}async function Tp(e,t,n,s,r){if(!e)return null;const{children:i,contentUrl:o}=await ka({subtree:n,implicitOptions:s,loaderOptions:r});let a,c=null;return o&&(a=o,c={uri:o.replace(`${t}/`,"")}),{...e,id:a,contentUrl:a,lodMetricType:_n.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:pr(e,a),refine:yr(e.refine),content:c||e.content,children:i}}function Wa(e){var t;return(e==null||(t=e.extensions)===null||t===void 0?void 0:t["3DTILES_implicit_tiling"])||(e==null?void 0:e.implicitTiling)}const He={id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Co,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:bp,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function bp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const s=t["3d-tiles"]||{};let r;return s.isTileset==="auto"?r=(n==null?void 0:n.url)&&n.url.indexOf(".json")!==-1:r=s.isTileset,r?_p(e,t,n):wp(e,t,n)}async function _p(e,t,n){var s;const r=JSON.parse(new TextDecoder().decode(e)),i=(n==null?void 0:n.url)||"",o=Rp(i),a=await Ep(r,o,t||{});return{...r,shape:"tileset3d",loader:He,url:i,queryString:(n==null?void 0:n.queryString)||"",basePath:o,root:a||r.root,type:yt.TILES3D,lodMetricType:_n.GEOMETRIC_ERROR,lodMetricValue:((s=r.root)===null||s===void 0?void 0:s.geometricError)||0}}async function wp(e,t,n){const s={content:{shape:"tile3d",featureIds:null}};return await Ea(e,0,t,n,s.content),s.content}function Rp(e){return ns(e)}const Xa="https://api.cesium.com/v1/assets";async function Mp(e,t){if(!t){const i=await Sp(e);for(const o of i.items)o.type==="3DTILES"&&(t=o.id)}const n=await Ip(e,t),{type:s,url:r}=n;return U(s==="3DTILES"&&r),n.headers={Authorization:`Bearer ${n.accessToken}`},n}async function Sp(e){U(e);const t=Xa,n={Authorization:`Bearer ${e}`},s=await Te(t,{headers:n});if(!s.ok)throw new Error(s.statusText);return await s.json()}async function Ip(e,t){U(e,t);const n={Authorization:`Bearer ${e}`},s=`${Xa}/${t}`;let r=await Te(`${s}`,{headers:n});if(!r.ok)throw new Error(r.statusText);let i=await r.json();if(r=await Te(`${s}/endpoint`,{headers:n}),!r.ok)throw new Error(r.statusText);const o=await r.json();return i={...i,...o},i}async function xp(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t=t["cesium-ion"]||{};const{accessToken:n}=t;let s=t.assetId;if(!Number.isFinite(s)){const r=e.match(/\/([0-9]+)\/tileset.json/);s=r&&r[1]}return Mp(n,s)}const Qa={...He,id:"cesium-ion",name:"Cesium Ion",preload:xp,parse:async(e,t,n)=>(t={...t},t["3d-tiles"]=t["cesium-ion"],t.loader=Qa,He.parse(e,t,n)),options:{"cesium-ion":{...He.options["3d-tiles"],accessToken:null}}},qa=100;class vp{constructor(t,n){if(this.schema=void 0,this.options=void 0,this.shape=void 0,this.length=0,this.rows=null,this.cursor=0,this._headers=[],this.options=n,this.schema=t,!Array.isArray(t)){this._headers=[];for(const s in t)this._headers[t[s].index]=t[s].name}}rowCount(){return this.length}addArrayRow(t,n){Number.isFinite(n)&&(this.cursor=n),this.shape="array-row-table",this.rows=this.rows||new Array(qa),this.rows[this.length]=t,this.length++}addObjectRow(t,n){Number.isFinite(n)&&(this.cursor=n),this.shape="object-row-table",this.rows=this.rows||new Array(qa),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function Op(e,t){if(!e)throw new Error("null row");const n={};if(t)for(let s=0;s<t.length;s++)n[t[s]]=e[s];else for(let s=0;s<e.length;s++){const r=`column-${s}`;n[r]=e[s]}return n}function Fp(e,t){if(!e)throw new Error("null row");if(t){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=e[t[s]];return n}return Object.values(e)}function Dp(e){const t=[];for(let n=0;n<e.length;n++){const s=`column-${n}`;t.push(s)}return t}function Lp(e){return Object.keys(e)}const Ya=100;class Pp{constructor(t,n){if(this.schema=void 0,this.options=void 0,this.length=0,this.objectRows=null,this.arrayRows=null,this.cursor=0,this._headers=null,this.options=n,this.schema=t,t){this._headers=[];for(const s in t)this._headers[t[s].index]=t[s].name}}rowCount(){return this.length}addArrayRow(t,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=Dp(t)),this.options.shape){case"object-row-table":const s=Op(t,this._headers);this.addObjectRow(s,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(Ya),this.arrayRows[this.length]=t,this.length++;break}}addObjectRow(t,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=Lp(t)),this.options.shape){case"array-row-table":const s=Fp(t,this._headers);this.addArrayRow(s,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(Ya),this.objectRows[this.length]=t,this.length++;break}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const Gp=100;class Np{constructor(t,n){this.schema=void 0,this.length=0,this.allocated=0,this.columns={},this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let n=0;for(const s in this.columns)this.columns[s][this.length]=t[n++];this.length++}addObjectRow(t){this._reallocateColumns();for(const n in t)this.columns[n][this.length]=t[n];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const s in this.schema){const r=this.schema[s];t[r.name]=this.columns[r.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:Gp,this.columns={};for(const t in this.schema){const n=this.schema[t],s=n.type||Float32Array,r=this.columns[n.index];if(r&&ArrayBuffer.isView(r)){const i=new s(this.allocated);i.set(r),this.columns[n.index]=i}else r?(r.length=this.allocated,this.columns[n.index]=r):this.columns[n.index]=new s(this.allocated)}}}_pruneColumns(){for(const[t,n]of Object.entries(this.columns))this.columns[t]=n.slice(0,this.length)}}const Up={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},Hp="TableBatchBuilder";class Je{constructor(t,n){this.schema=void 0,this.options=void 0,this.aggregator=null,this.batchCount=0,this.bytesUsed=0,this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),this.totalLength=0,this.totalBytes=0,this.rowBytes=0,this.schema=t,this.options={...Up,...n}}limitReached(){var t,n;return!!(!((t=this.options)===null||t===void 0)&&t.limit&&this.totalLength>=this.options.limit||!((n=this.options)===null||n===void 0)&&n._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),typeof t=="string"&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?t.length*8:Object.keys(t).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;t!=null&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,t),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return Pp;case"columnar-table":return Np;case"arrow-table":if(!Je.ArrowBatch)throw new Error(Hp);return Je.ArrowBatch;default:return vp}}}Je.ArrowBatch=void 0;function Jp(e){try{let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return async function*(){const n=new TextDecoder(void 0,t);for await(const s of e)yield typeof s=="string"?s:n.decode(s,{stream:!0})}()}catch(t){return Promise.reject(t)}}const Cr=Number.MAX_SAFE_INTEGER;var M=function(e){return e[e.BEGIN=0]="BEGIN",e[e.VALUE=1]="VALUE",e[e.OPEN_OBJECT=2]="OPEN_OBJECT",e[e.CLOSE_OBJECT=3]="CLOSE_OBJECT",e[e.OPEN_ARRAY=4]="OPEN_ARRAY",e[e.CLOSE_ARRAY=5]="CLOSE_ARRAY",e[e.TEXT_ESCAPE=6]="TEXT_ESCAPE",e[e.STRING=7]="STRING",e[e.BACKSLASH=8]="BACKSLASH",e[e.END=9]="END",e[e.OPEN_KEY=10]="OPEN_KEY",e[e.CLOSE_KEY=11]="CLOSE_KEY",e[e.TRUE=12]="TRUE",e[e.TRUE2=13]="TRUE2",e[e.TRUE3=14]="TRUE3",e[e.FALSE=15]="FALSE",e[e.FALSE2=16]="FALSE2",e[e.FALSE3=17]="FALSE3",e[e.FALSE4=18]="FALSE4",e[e.NULL=19]="NULL",e[e.NULL2=20]="NULL2",e[e.NULL3=21]="NULL3",e[e.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",e[e.NUMBER_DIGIT=23]="NUMBER_DIGIT",e}(M||{});const S={tab:9,lineFeed:10,carriageReturn:13,space:32,doubleQuote:34,plus:43,comma:44,minus:45,period:46,_0:48,_9:57,colon:58,E:69,openBracket:91,backslash:92,closeBracket:93,a:97,b:98,e:101,f:102,l:108,n:110,r:114,s:115,t:116,u:117,openBrace:123,closeBrace:125},$a=/[\\"\n]/g,Za={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class Vp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.options=Za,this.bufferCheckPosition=Cr,this.q="",this.c="",this.p="",this.closed=!1,this.closedRoot=!1,this.sawRoot=!1,this.error=null,this.state=M.BEGIN,this.stack=[],this.position=0,this.column=0,this.line=1,this.slashed=!1,this.unicodeI=0,this.unicodeS=null,this.depth=0,this.textNode=void 0,this.numberNode=void 0,this.options={...Za,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return(this.state!==M.VALUE||this.depth!==0)&&this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,n){var s,r;(s=(r=this.options)[t])===null||s===void 0||s.call(r,n,this)}emitNode(t,n){this._closeValue(),this.emit(t,n)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(t===null)return this.end();let n=0,s=t.charCodeAt(0),r=this.p;for(;s&&(r=s,this.c=s=t.charCodeAt(n++),r!==s?this.p=r:r=this.p,!!s);)switch(this.position++,s===S.lineFeed?(this.line++,this.column=0):this.column++,this.state){case M.BEGIN:s===S.openBrace?this.state=M.OPEN_OBJECT:s===S.openBracket?this.state=M.OPEN_ARRAY:Ve(s)||this._error("Non-whitespace before {[.");continue;case M.OPEN_KEY:case M.OPEN_OBJECT:if(Ve(s))continue;if(this.state===M.OPEN_KEY)this.stack.push(M.CLOSE_KEY);else if(s===S.closeBrace){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||M.VALUE;continue}else this.stack.push(M.CLOSE_OBJECT);s===S.doubleQuote?this.state=M.STRING:this._error('Malformed object key should start with "');continue;case M.CLOSE_KEY:case M.CLOSE_OBJECT:if(Ve(s))continue;s===S.colon?(this.state===M.CLOSE_OBJECT?(this.stack.push(M.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=M.VALUE):s===S.closeBrace?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||M.VALUE):s===S.comma?(this.state===M.CLOSE_OBJECT&&this.stack.push(M.CLOSE_OBJECT),this._closeValue(),this.state=M.OPEN_KEY):this._error("Bad object");continue;case M.OPEN_ARRAY:case M.VALUE:if(Ve(s))continue;if(this.state===M.OPEN_ARRAY)if(this.emit("onopenarray"),this.depth++,this.state=M.VALUE,s===S.closeBracket){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||M.VALUE;continue}else this.stack.push(M.CLOSE_ARRAY);s===S.doubleQuote?this.state=M.STRING:s===S.openBrace?this.state=M.OPEN_OBJECT:s===S.openBracket?this.state=M.OPEN_ARRAY:s===S.t?this.state=M.TRUE:s===S.f?this.state=M.FALSE:s===S.n?this.state=M.NULL:s===S.minus?this.numberNode+="-":S._0<=s&&s<=S._9?(this.numberNode+=String.fromCharCode(s),this.state=M.NUMBER_DIGIT):this._error("Bad value");continue;case M.CLOSE_ARRAY:if(s===S.comma)this.stack.push(M.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=M.VALUE;else if(s===S.closeBracket)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||M.VALUE;else{if(Ve(s))continue;this._error("Bad array")}continue;case M.STRING:this.textNode===void 0&&(this.textNode="");let i=n-1,o=this.slashed,a=this.unicodeI;t:for(;;){for(;a>0;)if(this.unicodeS+=String.fromCharCode(s),s=t.charCodeAt(n++),this.position++,a===4?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),a=0,i=n-1):a++,!s)break t;if(s===S.doubleQuote&&!o){this.state=this.stack.pop()||M.VALUE,this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}if(s===S.backslash&&!o&&(o=!0,this.textNode+=t.substring(i,n-1),this.position+=n-1-i,s=t.charCodeAt(n++),this.position++,!s))break;if(o){if(o=!1,s===S.n?this.textNode+=`
`:s===S.r?this.textNode+="\r":s===S.t?this.textNode+="	":s===S.f?this.textNode+="\f":s===S.b?this.textNode+="\b":s===S.u?(a=1,this.unicodeS=""):this.textNode+=String.fromCharCode(s),s=t.charCodeAt(n++),this.position++,i=n-1,s)continue;break}$a.lastIndex=n;const c=$a.exec(t);if(c===null){n=t.length+1,this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}if(n=c.index+1,s=t.charCodeAt(c.index),!s){this.textNode+=t.substring(i,n-1),this.position+=n-1-i;break}}this.slashed=o,this.unicodeI=a;continue;case M.TRUE:s===S.r?this.state=M.TRUE2:this._error(`Invalid true started with t${s}`);continue;case M.TRUE2:s===S.u?this.state=M.TRUE3:this._error(`Invalid true started with tr${s}`);continue;case M.TRUE3:s===S.e?(this.emit("onvalue",!0),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid true started with tru${s}`);continue;case M.FALSE:s===S.a?this.state=M.FALSE2:this._error(`Invalid false started with f${s}`);continue;case M.FALSE2:s===S.l?this.state=M.FALSE3:this._error(`Invalid false started with fa${s}`);continue;case M.FALSE3:s===S.s?this.state=M.FALSE4:this._error(`Invalid false started with fal${s}`);continue;case M.FALSE4:s===S.e?(this.emit("onvalue",!1),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid false started with fals${s}`);continue;case M.NULL:s===S.u?this.state=M.NULL2:this._error(`Invalid null started with n${s}`);continue;case M.NULL2:s===S.l?this.state=M.NULL3:this._error(`Invalid null started with nu${s}`);continue;case M.NULL3:s===S.l?(this.emit("onvalue",null),this.state=this.stack.pop()||M.VALUE):this._error(`Invalid null started with nul${s}`);continue;case M.NUMBER_DECIMAL_POINT:s===S.period?(this.numberNode+=".",this.state=M.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case M.NUMBER_DIGIT:S._0<=s&&s<=S._9?this.numberNode+=String.fromCharCode(s):s===S.period?(this.numberNode.indexOf(".")!==-1&&this._error("Invalid number has two dots"),this.numberNode+="."):s===S.e||s===S.E?((this.numberNode.indexOf("e")!==-1||this.numberNode.indexOf("E")!==-1)&&this._error("Invalid number has two exponential"),this.numberNode+="e"):s===S.plus||s===S.minus?(r===S.e||r===S.E||this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(s)):(this._closeNumber(),n--,this.state=this.stack.pop()||M.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&jp(this),this.emit("onchunkparsed"),this}_closeValue(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"onvalue";this.textNode!==void 0&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this._closeValue(),t+=`
Line: ${this.line}
Column: ${this.column}
Char: ${this.c}`;const n=new Error(t);this.error=n,this.emit("onerror",n)}}function Ve(e){return e===S.carriageReturn||e===S.lineFeed||e===S.space||e===S.tab}function jp(e){const t=Math.max(Cr,10);let n=0;for(const s of["textNode","numberNode"]){const r=e[s]===void 0?0:e[s].length;if(r>t)switch(s){case"text":break;default:e._error(`Max buffer length exceeded: ${s}`)}n=Math.max(n,r)}e.bufferCheckPosition=Cr-n+e.position}class te{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;if(this.path=void 0,this.path=["$"],t instanceof te){this.path=[...t.path];return}if(Array.isArray(t)){this.path.push(...t);return}if(typeof t=="string"&&(this.path=t.split("."),this.path[0]!=="$"))throw new Error("JSONPaths must start with $")}clone(){return new te(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let n=0;n<this.path.length;++n)if(this.path[n]!==t.path[n])return!1;return!0}setFieldAtPath(t,n){const s=[...this.path];s.shift();const r=s.pop();for(const i of s)t=t[i];t[r]=n}getFieldAtPath(t){const n=[...this.path];n.shift();const s=n.pop();for(const r of n)t=t[r];return t[s]}}class kp{constructor(t){this.parser=void 0,this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new te,this.reset(),this.parser=new Vp({onready:()=>{this.jsonpath=new te,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:n=>{this._openObject({}),typeof n<"u"&&this.parser.emit("onkey",n)},onkey:n=>{this.jsonpath.set(n),this.currentState.key=n},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:n=>{this._pushOrSet(n)},onerror:n=>{throw n},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new te}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:n,key:s}=this.currentState;s!==null?(n[s]=t,this.currentState.key=null):n.push(t)}_openArray(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}class Kp extends kp{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath()){this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],this._openArray(this.streamingArray);return}this._openArray()},onopenobject:s=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),typeof s<"u"&&this.parser.emit("onkey",s)}}),this.jsonPaths=void 0,this.streamingJsonPath=null,this.streamingArray=null,this.topLevelObject=null;const n=t.jsonpaths||[];this.jsonPaths=n.map(s=>new te(s))}write(t){super.write(t);let n=[];return this.streamingArray&&(n=[...this.streamingArray],this.streamingArray.length=0),n}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(this.jsonPaths.length===0)return!0;for(const n of this.jsonPaths)if(n.equals(t))return!0;return!1}}async function*zp(e,t){const n=Jp(e),{metadata:s}=t,{jsonpaths:r}=t.json||{};let i=!0;const o=null,a=new Je(o,t),c=new Kp({jsonpaths:r});for await(const f of n){const d=c.write(f),m=d.length>0&&c.getStreamingJsonPathAsString();if(d.length>0&&i){if(s){var l;yield{shape:(t==null||(l=t.json)===null||l===void 0?void 0:l.shape)||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:c.getPartialResult(),jsonpath:m}}i=!1}for(const y of d){a.addRow(y);const E=a.getFullBatch({jsonpath:m});E&&(yield E)}a.chunkComplete(f);const A=a.getFullBatch({jsonpath:m});A&&(yield A)}const u=c.getStreamingJsonPathAsString(),h=a.getFinalBatch({jsonpath:u});h&&(yield h),s&&(yield{shape:"json",batchType:"final-result",container:c.getPartialResult(),jsonpath:c.getStreamingJsonPathAsString(),data:[],length:0})}const Jn={x:0,y:1,z:2};function tc(e,t={}){const{start:n=0,end:s=e.length,plane:r="xy"}=t,i=t.size||2;let o=0;const a=Jn[r[0]],c=Jn[r[1]];for(let l=n,u=s-i;l<s;l+=i)o+=(e[l+a]-e[u+a])*(e[l+c]+e[u+c]),u=l;return o/2}function Wp(e,t,n=2,s,r="xy"){const i=t&&t.length,o=i?t[0]*n:e.length;let a=ec(e,0,o,n,!0,s&&s[0],r);const c=[];if(!a||a.next===a.prev)return c;let l,u,h,f,d,m,A;if(i&&(a=$p(e,t,a,n,s,r)),e.length>80*n){f=u=e[0],d=h=e[1];for(let y=n;y<o;y+=n)m=e[y],A=e[y+1],m<f&&(f=m),A<d&&(d=A),m>u&&(u=m),A>h&&(h=A);l=Math.max(u-f,h-d),l=l!==0?32767/l:0}return je(a,c,n,f,d,l,0),c}function ec(e,t,n,s,r,i,o){let a,c;i===void 0&&(i=tc(e,{start:t,end:n,size:s,plane:o}));let l=Jn[o[0]],u=Jn[o[1]];if(r===i<0)for(a=t;a<n;a+=s)c=rc(a,e[a+l],e[a+u],c);else for(a=n-s;a>=t;a-=s)c=rc(a,e[a+l],e[a+u],c);return c&&Vn(c,c.next)&&(Ke(c),c=c.next),c}function ee(e,t){if(!e)return e;t||(t=e);let n=e,s;do if(s=!1,!n.steiner&&(Vn(n,n.next)||K(n.prev,n,n.next)===0)){if(Ke(n),n=t=n.prev,n===n.next)break;s=!0}else n=n.next;while(s||n!==t);return t}function je(e,t,n,s,r,i,o){if(!e)return;!o&&i&&sy(e,s,r,i);let a=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,i?Qp(e,s,r,i):Xp(e)){t.push(c.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Ke(e),e=l.next,a=l.next;continue}if(e=l,e===a){o?o===1?(e=qp(ee(e),t,n),je(e,t,n,s,r,i,2)):o===2&&Yp(e,t,n,s,r,i):je(ee(e),t,n,s,r,i,1);break}}}function Xp(e){const t=e.prev,n=e,s=e.next;if(K(t,n,s)>=0)return!1;const r=t.x,i=n.x,o=s.x,a=t.y,c=n.y,l=s.y,u=r<i?r<o?r:o:i<o?i:o,h=a<c?a<l?a:l:c<l?c:l,f=r>i?r>o?r:o:i>o?i:o,d=a>c?a>l?a:l:c>l?c:l;let m=s.next;for(;m!==t;){if(m.x>=u&&m.x<=f&&m.y>=h&&m.y<=d&&ge(r,a,i,c,o,l,m.x,m.y)&&K(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Qp(e,t,n,s){const r=e.prev,i=e,o=e.next;if(K(r,i,o)>=0)return!1;const a=r.x,c=i.x,l=o.x,u=r.y,h=i.y,f=o.y,d=a<c?a<l?a:l:c<l?c:l,m=u<h?u<f?u:f:h<f?h:f,A=a>c?a>l?a:l:c>l?c:l,y=u>h?u>f?u:f:h>f?h:f,E=Er(d,m,t,n,s),w=Er(A,y,t,n,s);let B=e.prevZ,C=e.nextZ;for(;B&&B.z>=E&&C&&C.z<=w;){if(B.x>=d&&B.x<=A&&B.y>=m&&B.y<=y&&B!==r&&B!==o&&ge(a,u,c,h,l,f,B.x,B.y)&&K(B.prev,B,B.next)>=0||(B=B.prevZ,C.x>=d&&C.x<=A&&C.y>=m&&C.y<=y&&C!==r&&C!==o&&ge(a,u,c,h,l,f,C.x,C.y)&&K(C.prev,C,C.next)>=0))return!1;C=C.nextZ}for(;B&&B.z>=E;){if(B.x>=d&&B.x<=A&&B.y>=m&&B.y<=y&&B!==r&&B!==o&&ge(a,u,c,h,l,f,B.x,B.y)&&K(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;C&&C.z<=w;){if(C.x>=d&&C.x<=A&&C.y>=m&&C.y<=y&&C!==r&&C!==o&&ge(a,u,c,h,l,f,C.x,C.y)&&K(C.prev,C,C.next)>=0)return!1;C=C.nextZ}return!0}function qp(e,t,n){let s=e;do{const r=s.prev,i=s.next.next;!Vn(r,i)&&nc(r,s,s.next,i)&&ke(r,i)&&ke(i,r)&&(t.push(r.i/n|0),t.push(s.i/n|0),t.push(i.i/n|0),Ke(s),Ke(s.next),s=e=i),s=s.next}while(s!==e);return ee(s)}function Yp(e,t,n,s,r,i){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&oy(o,a)){let c=sc(o,a);o=ee(o,o.next),c=ee(c,c.next),je(o,t,n,s,r,i,0),je(c,t,n,s,r,i,0);return}a=a.next}o=o.next}while(o!==e)}function $p(e,t,n,s,r,i){const o=[];let a,c,l,u,h;for(a=0,c=t.length;a<c;a++)l=t[a]*s,u=a<c-1?t[a+1]*s:e.length,h=ec(e,l,u,s,!1,r&&r[a+1],i),h===h.next&&(h.steiner=!0),o.push(iy(h));for(o.sort(Zp),a=0;a<o.length;a++)n=ty(o[a],n);return n}function Zp(e,t){return e.x-t.x}function ty(e,t){const n=ey(e,t);if(!n)return t;const s=sc(n,e);return ee(s,s.next),ee(n,n.next)}function ey(e,t){let n=t;const s=e.x,r=e.y;let i=-1/0,o;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const f=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=s&&f>i&&(i=f,o=n.x<n.next.x?n:n.next,f===s))return o}n=n.next}while(n!==t);if(!o)return null;const a=o,c=o.x,l=o.y;let u=1/0,h;n=o;do s>=n.x&&n.x>=c&&s!==n.x&&ge(r<l?s:i,r,c,l,r<l?i:s,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(s-n.x),ke(n,e)&&(h<u||h===u&&(n.x>o.x||n.x===o.x&&ny(o,n)))&&(o=n,u=h)),n=n.next;while(n!==a);return o}function ny(e,t){return K(e.prev,e,t.prev)<0&&K(t.next,e,e.next)<0}function sy(e,t,n,s){let r=e;do r.z===0&&(r.z=Er(r.x,r.y,t,n,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,ry(r)}function ry(e){let t,n,s=1,r,i,o,a,c,l;do{for(i=e,e=null,l=null,r=0;i;){for(r++,a=i,o=0,n=0;n<s&&(o++,a=a.nextZ,!!a);n++);for(c=s;o>0||c>0&&a;)o!==0&&(c===0||!a||i.z<=a.z)?(t=i,i=i.nextZ,o--):(t=a,a=a.nextZ,c--),l?l.nextZ=t:e=t,t.prevZ=l,l=t;i=a}l.nextZ=null,s*=2}while(r>1);return e}function Er(e,t,n,s,r){return e=(e-n)*r|0,t=(t-s)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function iy(e){let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n}function ge(e,t,n,s,r,i,o,a){return(r-o)*(t-a)>=(e-o)*(i-a)&&(e-o)*(s-a)>=(n-o)*(t-a)&&(n-o)*(i-a)>=(r-o)*(s-a)}function oy(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!ay(e,t)&&(ke(e,t)&&ke(t,e)&&cy(e,t)&&(K(e.prev,e,t.prev)||K(e,t.prev,t))||Vn(e,t)&&K(e.prev,e,e.next)>0&&K(t.prev,t,t.next)>0)}function K(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Vn(e,t){return e.x===t.x&&e.y===t.y}function nc(e,t,n,s){const r=kn(K(e,t,n)),i=kn(K(e,t,s)),o=kn(K(n,s,e)),a=kn(K(n,s,t));return!!(r!==i&&o!==a||r===0&&jn(e,n,t)||i===0&&jn(e,s,t)||o===0&&jn(n,e,s)||a===0&&jn(n,t,s))}function jn(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function kn(e){return e>0?1:e<0?-1:0}function ay(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&nc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}function ke(e,t){return K(e.prev,e,e.next)<0?K(e,t,e.next)>=0&&K(e,e.prev,t)>=0:K(e,t,e.prev)<0||K(e,e.next,t)<0}function cy(e,t){let n=e,s=!1;const r=(e.x+t.x)/2,i=(e.y+t.y)/2;do n.y>i!=n.next.y>i&&n.next.y!==n.y&&r<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(s=!s),n=n.next;while(n!==e);return s}function sc(e,t){const n=new Tr(e.i,e.x,e.y),s=new Tr(t.i,t.x,t.y),r=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,s.next=n,n.prev=s,i.next=s,s.prev=i,s}function rc(e,t,n,s){const r=new Tr(e,t,n);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function Ke(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}class Tr{constructor(t,n,s){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=n,this.y=s}}function ly(e,t,n){const s=uy(e),r=Object.keys(s).filter(i=>s[i]!==Array);return hy(e,{propArrayTypes:s,...t},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:n?n.triangulate:!0})}function uy(e){const t={};for(const n of e)if(n.properties)for(const s in n.properties){const r=n.properties[s];t[s]=py(r,t[s])}return t}function hy(e,t,n){const{pointPositionsCount:s,pointFeaturesCount:r,linePositionsCount:i,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:l,polygonRingsCount:u,polygonFeaturesCount:h,propArrayTypes:f,coordLength:d}=t,{numericPropKeys:m=[],PositionDataType:A=Float32Array,triangulate:y=!0}=n,E=e[0]&&"id"in e[0],w=e.length>65535?Uint32Array:Uint16Array,B={type:"Point",positions:new A(s*d),globalFeatureIds:new w(s),featureIds:r>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},C={type:"LineString",pathIndices:i>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new A(i*d),globalFeatureIds:new w(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},R={type:"Polygon",polygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),primitivePolygonIndices:c>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new A(c*d),globalFeatureIds:new w(c),featureIds:h>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[],fields:[]};y&&(R.triangles=[]);for(const v of[B,C,R])for(const O of m){const x=f[O];v.numericProps[O]=new x(v.positions.length/d)}C.pathIndices[o]=i,R.polygonIndices[l]=c,R.primitivePolygonIndices[u]=c;const b={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const v of e){const O=v.geometry,x=v.properties||{};switch(O.type){case"Point":fy(O,B,b,d,x),B.properties.push(wr(x,m)),E&&B.fields.push({id:v.id}),b.pointFeature++;break;case"LineString":dy(O,C,b,d,x),C.properties.push(wr(x,m)),E&&C.fields.push({id:v.id}),b.lineFeature++;break;case"Polygon":my(O,R,b,d,x),R.properties.push(wr(x,m)),E&&R.fields.push({id:v.id}),b.polygonFeature++;break;default:throw new Error("Invalid geometry type")}b.feature++}return Ay(B,C,R,d)}function fy(e,t,n,s,r){t.positions.set(e.data,n.pointPosition*s);const i=e.data.length/s;_r(t,r,n.pointPosition,i),t.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+i),t.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+i),n.pointPosition+=i}function dy(e,t,n,s,r){t.positions.set(e.data,n.linePosition*s);const i=e.data.length/s;_r(t,r,n.linePosition,i),t.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+i),t.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+i);for(let o=0,a=e.indices.length;o<a;++o){const c=e.indices[o],l=o===a-1?e.data.length:e.indices[o+1];t.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(l-c)/s}}function my(e,t,n,s,r){t.positions.set(e.data,n.polygonPosition*s);const i=e.data.length/s;_r(t,r,n.polygonPosition,i),t.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+i),t.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+i);for(let o=0,a=e.indices.length;o<a;++o){const c=n.polygonPosition;t.polygonIndices[n.polygonObject++]=c;const l=e.areas[o],u=e.indices[o],h=e.indices[o+1];for(let d=0,m=u.length;d<m;++d){const A=u[d],y=d===m-1?h===void 0?e.data.length:h[0]:u[d+1];t.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(y-A)/s}const f=n.polygonPosition;gy(t,l,u,{startPosition:c,endPosition:f,coordLength:s})}}function gy(e,t,n,s){let{startPosition:r,endPosition:i,coordLength:o}=s;if(!e.triangles)return;const a=r*o,c=i*o,l=e.positions.subarray(a,c),u=n[0],h=n.slice(1).map(d=>(d-u)/o),f=Wp(l,h,o,t);for(let d=0,m=f.length;d<m;++d)e.triangles.push(r+f[d])}function br(e,t){const n={};for(const s in e)n[s]={value:e[s],size:t};return n}function Ay(e,t,n,s){const r={shape:"binary-feature-collection",points:{...e,positions:{value:e.positions,size:s},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:br(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:s},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:br(t.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:s},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:br(n.numericProps,1)}};return r.polygons&&n.triangles&&(r.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),r}function _r(e,t,n,s){for(const r in e.numericProps)if(r in t){const i=t[r];e.numericProps[r].fill(i,n,n+s)}}function wr(e,t){const n={};for(const s in e)t.includes(s)||(n[s]=e[s]);return n}function py(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function yy(e){let t=0,n=0,s=0,r=0,i=0,o=0,a=0,c=0,l=0;const u=new Set;for(const h of e){const f=h.geometry;switch(f.type){case"Point":n++,t++,u.add(f.coordinates.length);break;case"MultiPoint":n++,t+=f.coordinates.length;for(const m of f.coordinates)u.add(m.length);break;case"LineString":i++,s+=f.coordinates.length,r++;for(const m of f.coordinates)u.add(m.length);break;case"MultiLineString":i++;for(const m of f.coordinates){s+=m.length,r++;for(const A of m)u.add(A.length)}break;case"Polygon":l++,a++,c+=f.coordinates.length;const d=f.coordinates.flat();o+=d.length;for(const m of d)u.add(m.length);break;case"MultiPolygon":l++;for(const m of f.coordinates){a++,c+=m.length;const A=m.flat();o+=A.length;for(const y of A)u.add(y.length)}break;default:throw new Error(`Unsupported geometry type: ${f.type}`)}}return{coordLength:u.size>0?Math.max(...u):2,pointPositionsCount:t,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:r,lineFeaturesCount:i,polygonPositionsCount:o,polygonObjectsCount:a,polygonRingsCount:c,polygonFeaturesCount:l}}function By(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{coordLength:2,fixRingWinding:!0};return e.map(n=>Cy(n,t))}function ic(e,t,n,s){n.push(t.length),t.push(...e);for(let r=e.length;r<s.coordLength;r++)t.push(0)}function Rr(e,t,n,s){n.push(t.length);for(const r of e){t.push(...r);for(let i=r.length;i<s.coordLength;i++)t.push(0)}}function oc(e,t,n,s,r){let i=0;const o=[],a=[];for(const c of e){const l=c.map(f=>f.slice(0,2));let u=tc(l.flat());const h=u<0;r.fixRingWinding&&(i===0&&!h||i>0&&h)&&(c.reverse(),u=-u),o.push(u),Rr(c,t,a,r),i++}i>0&&(s.push(o),n.push(a))}function Cy(e,t){const{geometry:n}=e;if(n.type==="GeometryCollection")throw new Error("GeometryCollection type not supported");const s=[],r=[];let i,o;switch(n.type){case"Point":o="Point",ic(n.coordinates,s,r,t);break;case"MultiPoint":o="Point",n.coordinates.map(a=>ic(a,s,r,t));break;case"LineString":o="LineString",Rr(n.coordinates,s,r,t);break;case"MultiLineString":o="LineString",n.coordinates.map(a=>Rr(a,s,r,t));break;case"Polygon":o="Polygon",i=[],oc(n.coordinates,s,r,i,t);break;case"MultiPolygon":o="Polygon",i=[],n.coordinates.map(a=>oc(a,s,r,i,t));break;default:throw new Error(`Unknown type: ${o}`)}return{...e,geometry:{type:o,indices:r,data:s,areas:i}}}function ac(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{fixRingWinding:!0,triangulate:!0};const n=yy(e),s=n.coordLength,{fixRingWinding:r}=t,i=By(e,{coordLength:s,fixRingWinding:r});return ly(i,n,{numericPropKeys:t.numericPropKeys,PositionDataType:t.PositionDataType||Float32Array,triangulate:t.triangulate})}const ze={...{name:"GeoJSON",id:"geojson",module:"geojson",version:"4.1.4",worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"object-row-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}}},parse:Ey,parseTextSync:cc,parseInBatches:Ty};async function Ey(e,t){return cc(new TextDecoder().decode(e),t)}function cc(e,t){var n;t={...ze.options,...t},t.geojson={...ze.options.geojson,...t.geojson},t.gis=t.gis||{};let s;try{s=JSON.parse(e)}catch{s={}}const r={shape:"geojson-table",type:"FeatureCollection",features:((n=s)===null||n===void 0?void 0:n.features)||[]};switch(t.gis.format){case"binary":return ac(r.features);default:return r}}function Ty(e,t){t={...ze.options,...t},t.json={...ze.options.geojson,...t.geojson};const n=zp(e,t);switch(t.gis.format){case"binary":return by(n);default:return n}}async function*by(e){for await(const t of e)t.data=ac(t.data),yield t}function _y(e){let t=0;for(const s in e.attributes){const r=e.getAttribute(s);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}const n=e.getIndex();return t+=n?n.count*n.itemSize*n.array.BYTES_PER_ELEMENT:0,t}function lc(e){const n=document.createElement("canvas");n.width=64,n.height=64;const s=n.getContext("2d");s.rect(0,0,64,64);const r=s.createLinearGradient(0,0,64,64);for(let o=0;o<e.length;o++){const a=e[o];r.addColorStop(a[0],"#"+a[1].getHexString())}s.fillStyle=r,s.fill();const i=new g.CanvasTexture(n);return i.needsUpdate=!0,i.minFilter=g.LinearFilter,i.wrapS=g.RepeatWrapping,i.wrapT=g.RepeatWrapping,i.repeat.set(2,2),i}function uc(e){e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.copy(e.matrixWorld).invert();const t=new g.Frustum;return t.setFromProjectionMatrix(new g.Matrix4().multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)),t}function wy(e){const t=new g.Group,n=new g.PlaneGeometry(10,5),s=new g.Vector3(...e.projectPointOntoPlane([0,0,0])),r=new g.Vector3(e.normal.x,e.normal.y,e.normal.z),i=new g.Vector3().copy(s).add(r);n.lookAt(i),n.translate(s.x,s.y,s.z);const o=new g.MeshBasicMaterial({color:65535,side:g.DoubleSide}),a=new g.Mesh(n,o),c=new g.ArrowHelper(r,s,5,16776960);return t.add(c),t.add(a),t}function hc(e){const{boundingVolume:t}=e;let n=0;e.content&&(n=Math.min(e.content.byteLength/5e5,1));const s=new g.Color(n,1,0),r=new g.BoxGeometry(1,1,1),i=new g.Matrix4;t.halfAxes?i.copy(fc(t.halfAxes)):t.radius&&r.scale(t.radius*2,t.radius*2,t.radius*2),r.applyMatrix4(i);const o=new g.EdgesGeometry(r),a=new g.LineSegments(o,new g.LineBasicMaterial({color:s}));return a.position.copy(new g.Vector3(...t.center)),a}function fc(e){const t=e;return new g.Matrix4().fromArray([t[0]*2,t[1]*2,t[2]*2,0,t[3]*2,t[4]*2,t[5]*2,0,t[6]*2,t[7]*2,t[8]*2,0,0,0,0,1])}function Ry(e,t){const r=2*Math.PI*6378137/2,i=t*r/180;let o=Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180);return o=o*r/180,new g.Vector2(i,o)}function My(e){let t=0;if((e==null?void 0:e.userData.mimeType)=="image/ktx2"&&e.mipmaps){for(let n=0;n<e.mipmaps.length;n++)t+=e.mipmaps[n].data.byteLength;return t}else if(e.image){const{image:n}=e,s=4;let r=[n.width,n.height];for(;r[0]>1||r[1]>1;)t+=r[0]*r[1]*s,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return t+=1*1*s,t}else return}function dc(e){return _y(e)}let ht=null,Mt=null,Kn=null,zn=null;const mc={minHeight:0,maxHeight:300,samples:4,sampleStep:4,opacity:.5,blendingType:g.NormalBlending};function Sy(e,t,n,s=mc){ht&&ht.dispose(),Mt||(Mt=n);const r={...mc,...s};ht=new g.WebGLRenderTarget(e.width*e.devicePixelRatio,e.height*e.devicePixelRatio),ht.texture.minFilter=g.NearestFilter,ht.texture.magFilter=g.NearestFilter,ht.stencilBuffer=!1,ht.texture.format=g.RGBAFormat,ht.texture.type=g.FloatType,Mt.setPixelRatio(devicePixelRatio),Mt.setSize(e.width,e.height),Mt.setRenderTarget(ht),Kn=new g.Scene,Kn.overrideMaterial=vy,zn=t,kt.uniforms.tPosition.value=ht.texture,kt.uniforms.minHeight.value=r.minHeight,kt.uniforms.maxHeight.value=r.maxHeight,kt.uniforms.samples.value=r.samples,kt.uniforms.sampleStep.value=r.sampleStep,kt.uniforms.opacity.value=r.opacity,kt.blending=r.blendingType}function Iy(e){ht.setSize(e.width*e.devicePixelRatio,e.height*e.devicePixelRatio),Mt.setPixelRatio(devicePixelRatio),Mt.setSize(e.width,e.height)}function xy(e){if(Mt){const t=zn.parent;Kn.add(zn),Mt.setRenderTarget(ht),Mt.render(Kn,e),t&&t.add(zn),Mt.setRenderTarget(null)}}const Wn=e=>e.toString(),vy=new g.ShaderMaterial({vertexShader:Wn`
        varying vec3 vPosition;
        void main() {
            vPosition =  (modelMatrix * vec4(position, 1.0)).xyz;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    `,fragmentShader:Wn`
        varying vec3 vPosition;
        void main() {
            gl_FragColor = vec4(vPosition, 1.0);
        }
    `,side:g.DoubleSide}),Oy=Wn`
    #include <packing>

    varying vec2 vUv;
    varying vec3 vColor;
    uniform sampler2D tPosition;
    uniform float minHeight;
    uniform float maxHeight;
    uniform int samples;
    uniform float sampleStep;

    mat4 MVP;

    // Convert to normalized screen coordinates
    vec4 toNSC(const in vec4 v) {
        return vec4(0.5 * (v.xyz / v.w) + 0.5, v.w);
    }
    vec4 vertexDraping(
        const in sampler2D positionTex, // Position G-Buffer
        const in vec4 Vin // Vertex to drape
    ) {
        float texSize = float(textureSize(positionTex, 0).x);
        float pixelSize = 1.0 / texSize;
        vec2 stepSize = vec2(sampleStep/texSize);
        vec4 VinWorld = modelMatrix * Vin;

        vec4 lineStart = projectionMatrix * viewMatrix * vec4(VinWorld.x, minHeight, VinWorld.z, 1.0);
        vec4 lineEnd = projectionMatrix * viewMatrix * vec4(VinWorld.x, maxHeight, VinWorld.z, 1.0);

        vec4 Vout = VinWorld;

        // Binary search for line-terrain intersection
        float first = 0.0, last = 1.0;
        while(first <= last) {
            // Compute mid-point
            float mid = first + (last-first) / 2.0;
            // Compute texture coordinates along line
            vec4 texCoords = toNSC(mix(lineStart, lineEnd, mid));
            vec4 texSample = vec4(0.0); // Sample terrain
            for(int s = -samples; s < samples; s++) {
                for(int t = -samples; t < samples; t++) {
                    texSample += texture(positionTex,
                    texCoords.st + vec2(s,t) * stepSize);
                }
            }
            // Smooth samples obtain from G-Buffer
            texSample = texSample / (float(samples) * float(samples) * 4.0);
            float terrainHeight = texSample.y;
            Vout.y = terrainHeight;
           
            if((last-first) < pixelSize) { // Termination criteria
                return Vout;
            }
            // Perform intersection test
            float depthScene = toNSC(projectionMatrix * viewMatrix * Vout).y;
            if(depthScene >= texCoords.y) {
                first = mid;
            }
            else
                last = mid;
        }
        return Vout;
    }

    void main() {
        vColor = color;
        vUv = uv;
        MVP = projectionMatrix * modelViewMatrix;
        vec4 inputVertex = vec4(position, 1.0);
        vec4 outputVertex = vertexDraping(tPosition, inputVertex);
        vec4 finalPosition = projectionMatrix * viewMatrix * outputVertex;
        gl_Position = finalPosition;
    }
`,Fy=Wn`
    varying vec3 vColor;
    uniform float opacity;

    void main() {
        gl_FragColor = vec4(vColor, opacity);
    }
`,kt=new g.ShaderMaterial({vertexShader:Oy,fragmentShader:Fy,uniforms:{tPosition:{value:null},minHeight:{value:0},maxHeight:{value:300},opacity:{value:.5},samples:{value:4},sampleStep:{value:4}},vertexColors:!0,transparent:!0,depthTest:!1,blending:g.NormalBlending}),gc={SPECTRAL:[[0,new g.Color(.3686,.3098,.6353)],[.1,new g.Color(.1961,.5333,.7412)],[.2,new g.Color(.4,.7608,.6471)],[.3,new g.Color(.6706,.8667,.6431)],[.4,new g.Color(.902,.9608,.5961)],[.5,new g.Color(1,1,.749)],[.6,new g.Color(.9961,.8784,.5451)],[.7,new g.Color(.9922,.6824,.3804)],[.8,new g.Color(.9569,.4275,.2627)],[.9,new g.Color(.8353,.2431,.3098)],[1,new g.Color(.6196,.0039,.2588)]],PLASMA:[[0,new g.Color(.241,.015,.61)],[.1,new g.Color(.387,.001,.654)],[.2,new g.Color(.524,.025,.653)],[.3,new g.Color(.651,.125,.596)],[.4,new g.Color(.752,.227,.513)],[.5,new g.Color(.837,.329,.431)],[.6,new g.Color(.907,.435,.353)],[.7,new g.Color(.963,.554,.272)],[.8,new g.Color(.992,.681,.195)],[.9,new g.Color(.987,.822,.144)],[1,new g.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new g.Color(.1647,.2824,.3451)],[.1,new g.Color(.1338,.3555,.4227)],[.2,new g.Color(.061,.4319,.4864)],[.3,new g.Color(0,.5099,.5319)],[.4,new g.Color(0,.5881,.5569)],[.5,new g.Color(.137,.665,.5614)],[.6,new g.Color(.2906,.7395,.5477)],[.7,new g.Color(.4453,.8099,.5201)],[.8,new g.Color(.6102,.8748,.485)],[.9,new g.Color(.7883,.9323,.4514)],[1,new g.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new g.Color(.267,.005,.329)],[.1,new g.Color(.283,.141,.458)],[.2,new g.Color(.254,.265,.53)],[.3,new g.Color(.207,.372,.553)],[.4,new g.Color(.164,.471,.558)],[.5,new g.Color(.128,.567,.551)],[.6,new g.Color(.135,.659,.518)],[.7,new g.Color(.267,.749,.441)],[.8,new g.Color(.478,.821,.318)],[.9,new g.Color(.741,.873,.15)],[1,new g.Color(.993,.906,.144)]],INFERNO:[[0,new g.Color(.077,.042,.206)],[.1,new g.Color(.225,.036,.388)],[.2,new g.Color(.373,.074,.432)],[.3,new g.Color(.522,.128,.42)],[.4,new g.Color(.665,.182,.37)],[.5,new g.Color(.797,.255,.287)],[.6,new g.Color(.902,.364,.184)],[.7,new g.Color(.969,.516,.063)],[.8,new g.Color(.988,.683,.072)],[.9,new g.Color(.961,.859,.298)],[1,new g.Color(.988,.998,.645)]],GRAYSCALE:[[0,new g.Color(0,0,0)],[1,new g.Color(1,1,1)]],TURBO:[[0,new g.Color(.18995,.07176,.23217)],[.07,new g.Color(.25107,.25237,.63374)],[.13,new g.Color(.27628,.42118,.89123)],[.2,new g.Color(.25862,.57958,.99876)],[.27,new g.Color(.15844,.73551,.92305)],[.33,new g.Color(.09267,.86554,.7623)],[.4,new g.Color(.19659,.94901,.59466)],[.47,new g.Color(.42778,.99419,.38575)],[.53,new g.Color(.64362,.98999,.23356)],[.6,new g.Color(.80473,.92452,.20459)],[.67,new g.Color(.93301,.81236,.22667)],[.73,new g.Color(.99314,.67408,.20348)],[.8,new g.Color(.9836,.49291,.12849)],[.87,new g.Color(.92105,.31489,.05475)],[.93,new g.Color(.81608,.18462,.01809)],[1,new g.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new g.Color(.278,0,.714)],[1/6,new g.Color(0,0,1)],[2/6,new g.Color(0,1,1)],[3/6,new g.Color(0,1,0)],[4/6,new g.Color(1,1,0)],[5/6,new g.Color(1,.64,0)],[1,new g.Color(1,0,0)]],CONTOUR:[[0,new g.Color(0,0,0)],[.03,new g.Color(0,0,0)],[.04,new g.Color(1,1,1)],[1,new g.Color(1,1,1)]]},Dy=`
  varying vec3 vColor;
  uniform float alpha;

  void main() {
    if (vColor == vec3(0.0, 0.0, 0.0)) {
      discard;
    } else {
      gl_FragColor = vec4( vColor, alpha);
    }
  }
`,Ly=`
  varying vec3 vColor;
  uniform sampler2D gradient;
  uniform sampler2D grayscale;
  attribute float intensity;
  attribute float classification;
  uniform vec3 rootCenter;
  uniform vec3 rootNormal;
  uniform vec2 elevationRange;
  uniform int coloring;
  uniform bool hideGround;
  uniform float maxIntensity;
  uniform float intensityContrast;
  uniform float pointSize;

  #ifdef USE_COLOR
  vec3 getRGB() {
      vec3 rgb = color;
      return rgb;
  }
  #endif

  vec3 getElevation(){
    vec4 world = modelMatrix * vec4( position, 1.0 );
    float diff = abs(dot(rootNormal, (vec3(world) - rootCenter)));
    float w = max(diff - elevationRange.x,0.0) / max(elevationRange.y - elevationRange.x,1.0);
    vec3 cElevation = texture2D(gradient, vec2(w,1.0-w)).rgb;

    return cElevation;
  }

  vec3 getIntensity(){
    // TODO: real contrast enhancement. Check https://github.com/yuki-koyama/enhancer/blob/master/shaders/enhancer.fs
    float intmod = pow(intensity, intensityContrast);
    vec3 cIntensity = texture2D(grayscale, vec2(intmod / maxIntensity ,1.0-(intmod / maxIntensity))).rgb;
    return cIntensity;
  }

  vec3 getClassification(){
    float classNormalized = classification / 255.0;
    vec3 cClassification = texture2D(gradient, vec2(classNormalized * 5.0,1.0-classNormalized * 5.0)).rgb;
    return cClassification;
  }

  vec3 getColor(){
      vec3 color;
      if (hideGround && classification == 2.0) {
         return vec3(0.0, 0.0, 0.0);               
      }

      if (coloring == 1) {
        color = getIntensity();
      }
      else if (coloring == 2) {
        color = getClassification();
      } else if (coloring == 3) {
        color = getElevation();
      } 
      #ifdef USE_COLOR
      else if (coloring == 4) {
        color = getRGB();
      }
      #endif
      else {
        color = vec3(1.0, 1.0, 1.0);
      }
      return color;
  }

  void main() {
      vColor = getColor();

      gl_PointSize = pointSize;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
`;var Mr=(e=>(e[e.Intensity=1]="Intensity",e[e.Classification=2]="Classification",e[e.Elevation=3]="Elevation",e[e.RGB=4]="RGB",e[e.White=5]="White",e))(Mr||{}),We=(e=>(e[e.FlatTexture=1]="FlatTexture",e[e.ShadedTexture=2]="ShadedTexture",e[e.ShadedNoTexture=3]="ShadedNoTexture",e))(We||{});const Py=gc.RAINBOW,Gy=typeof document<"u"?lc(Py):null,Ny=gc.GRAYSCALE,Uy=typeof document<"u"?lc(Ny):null,Hy={throttleRequests:!0,maxRequests:64,updateInterval:.1,maxConcurrency:1,maximumScreenSpaceError:16,memoryAdjustedScreenSpaceError:!0,maximumMemoryUsage:400,memoryCacheOverflow:128,viewDistanceScale:1,skipLevelOfDetail:!1,resetTransform:!1,updateTransforms:!0,shading:We.FlatTexture,transparent:!1,pointCloudColoring:Mr.White,pointSize:1,worker:!0,wireframe:!1,debug:!1,gltfLoader:null,basisTranscoderPath:null,dracoDecoderPath:null,material:null,contentPostProcess:void 0,preloadTilesCount:null,collectAttributions:!1};class Jy{static async load(t){const n={...Hy,...t.options},{url:s,renderer:r}=t;let{viewport:i}=t;const o=n.updateInterval,a=5,c={};if(n.cesiumIONToken){c["cesium-ion"]={accessToken:n.cesiumIONToken};const T=await Qa.preload(s,c);c.fetch={headers:T.headers}}n.googleApiKey&&(c.fetch={headers:{"X-GOOG-API-KEY":n.googleApiKey}},t.options.hasOwnProperty("collectAttributions")||(n.collectAttributions=!0)),t.loadingManager&&t.loadingManager.itemStart(s);const l=await oe(s,He,{...c}),u={},h={},f=[],d=new g.Group,m=new g.Group;n.debug||(m.visible=!1);const A={pointSize:{type:"f",value:n.pointSize},gradient:{type:"t",value:Gy},grayscale:{type:"t",value:Uy},rootCenter:{type:"vec3",value:new g.Vector3},rootNormal:{type:"vec3",value:new g.Vector3},coloring:{type:"i",value:n.pointCloudColoring},hideGround:{type:"b",value:!0},elevationRange:{type:"vec2",value:new g.Vector2(0,400)},maxIntensity:{type:"f",value:1},intensityContrast:{type:"f",value:1},alpha:{type:"f",value:1}},y=new g.ShaderMaterial({uniforms:A,vertexShader:Ly,fragmentShader:Dy,transparent:n.transparent,vertexColors:!0});let E,w,B;n.gltfLoader?E=n.gltfLoader:(E=new Bc.GLTFLoader,n.basisTranscoderPath&&(w=new Ec.KTX2Loader,w.detectSupport(r??new g.WebGLRenderer),w.setTranscoderPath(n.basisTranscoderPath+"/"),w.setWorkerLimit(1),E.setKTX2Loader(w)),n.dracoDecoderPath&&(B=new Cc.DRACOLoader,B.setDecoderPath(n.dracoDecoderPath+"/"),B.setWorkerLimit(n.maxConcurrency),E.setDRACOLoader(B)));const C=new g.MeshBasicMaterial({transparent:n.transparent}),R={maximumMemoryUsage:n.maximumMemoryUsage,maximumScreenSpaceError:n.maximumScreenSpaceError,memoryAdjustedScreenSpaceError:n.memoryAdjustedScreenSpaceError,memoryCacheOverflow:n.memoryCacheOverflow,viewDistanceScale:n.viewDistanceScale,skipLevelOfDetail:n.skipLevelOfDetail,updateTransforms:n.updateTransforms,throttleRequests:n.throttleRequests,maxRequests:n.maxRequests,contentLoader:async T=>{let F=null;switch(T.type){case Qt.POINTCLOUD:{F=jy(T,y,n,Ut);break}case Qt.SCENEGRAPH:case Qt.MESH:{F=await Vy(E,T,C,n,Ut);break}}if(F&&(F.visible=!1,u[T.id]=F,d.add(u[T.id]),n.debug)){const tt=hc(T);m.add(tt),h[T.id]=tt}},onTileLoad:async T=>{b&&(n.resetTransform&&!D&&(T==null?void 0:T.depth)<=a&&se(T),ne=!0)},onTileUnload:T=>{f.push(T)},onTileError:(T,F)=>{console.warn("Tile error",T.id,F)},onTraversalComplete(T){return n.collectAttributions&&(k=Ky(T)),T}},b=new bd(l,{...R,loadOptions:{...c,maxConcurrency:n.maxConcurrency,worker:n.worker,gltf:{loadImages:!1},"3d-tiles":{loadGLTF:!1}}}),v=new g.Matrix4,O=new g.Matrix4,x=new g.Vector3;let D=!1,k="";if(b.root.boundingVolume?(b.root.header.boundingVolume.region&&console.warn("Cannot apply a model matrix to bounding volumes of type region. Tileset stays in original geo-coordinates."),O.setPosition(b.root.boundingVolume.center[0],b.root.boundingVolume.center[1],b.root.boundingVolume.center[2])):console.warn("Bounding volume not found, no transformations applied"),n.debug){const T=hc(b.root);m.add(T),h[b.root.id]=T}let X=!1,Q=!1;A.rootCenter.value.copy(x),A.rootNormal.value.copy(new g.Vector3(0,0,1).normalize()),b.stats.get("Loader concurrency").count=n.maxConcurrency,b.stats.get("Maximum mem usage").count=n.maximumMemoryUsage;let L=0,rt=null,ne=!0,Ae=null;const Xe=new g.Vector3(1/0,1/0,1/0);let Nt=null;d.updateMatrixWorld(!0);const Z=new g.Matrix4().copy(d.matrixWorld),Ut=new g.Matrix4().copy(Z).invert();n.resetTransform&&se(b.root),n.debug&&(h[b.root.id].applyMatrix4(v),m.matrixWorld.copy(d.matrixWorld));function se(T){if(!T.boundingVolume.halfAxes)return;const F=T.boundingVolume.halfAxes,tt=new g.Matrix4().extractRotation(fc(F)).premultiply(new g.Matrix4().extractRotation(Ut));if(!new g.Euler().setFromRotationMatrix(tt).equals(new g.Euler)){D=!0;const St=new g.Vector3(O.elements[12],O.elements[13],O.elements[14]);O.extractRotation(tt),O.setPosition(St)}Qe()}function Qe(){v.copy(Z),n.resetTransform&&v.multiply(new g.Matrix4().copy(O).invert()),b.modelMatrix=new V(v.toArray())}function Xn(T,F,tt,it){if(X||!it)return;Nt||(Nt=new En({fov:it.fov/180*Math.PI,aspectRatio:it.aspect,near:it.near,far:it.far}).sseDenominator,n.debug&&console.log("Updated sse denonimator:",Nt));const xr=uc(it).planes.map(q=>new $(q.normal.toArray(),q.constant)),zy=new ot(xr),pc={camera:{position:Xe.toArray()},height:tt.height*tt.devicePixelRatio,frameNumber:T._frameNumber,sseDenominator:Nt,cullingVolume:zy,viewport:{id:0}};T._cache.reset(),T._traverser.traverse(T.root,pc,T.options);for(const q of T.tiles)q.selected?F[q.id]?F[q.id].visible=!0:console.error("TILE SELECTED BUT NOT LOADED!!",q.id):F[q.id]&&(F[q.id].visible=!1);for(;f.length>0;){const q=f.pop();F[q.id]&&q.contentState==at.UNLOADED&&(d.remove(F[q.id]),Sr(F[q.id]),delete F[q.id]),h[q.id]&&(Sr(h[q.id]),m.remove(h[q.id]),delete h[q.id])}const vr=T.stats.get("Tiles Loaded").count,yc=T.stats.get("Tiles Loading").count;return t.onProgress&&t.onProgress(vr,vr+yc),t.loadingManager&&!Q&&yc==0&&(n.preloadTilesCount==null||vr>=n.preloadTilesCount)&&(Q=!0,t.loadingManager.itemEnd(t.url)),pc}function Ir(T){const F=new g.Vector3,tt=new g.Quaternion,it=new g.Vector3;T.decompose(F,tt,it),d.position.copy(F),d.quaternion.copy(tt),d.scale.copy(it),d.updateMatrix(),d.updateMatrixWorld(!0),Z.copy(d.matrixWorld),Ut.copy(Z).invert(),Qe()}return{model:d,runtime:{getTileset:()=>b,getStats:()=>b.stats,getDataAttributions:()=>k,showTiles:T=>{m.visible=T},setWireframe:T=>{n.wireframe=T,d.traverse(F=>{F instanceof g.Mesh&&(F.material.wireframe=T)})},setDebug:T=>{n.debug=T,m.visible=T},setShading:T=>{n.shading=T},getTileBoxes:()=>m,setViewDistanceScale:T=>{b.options.viewDistanceScale=T,b._frameNumber++,Xn(b,u,i,Ae)},setMaximumScreenSpaceError:T=>{b.options.maximumScreenSpaceError=T,b._frameNumber++,Xn(b,u,i,Ae)},setHideGround:T=>{A.hideGround.value=T},setPointCloudColoring:T=>{A.coloring.value=T},setElevationRange:T=>{A.elevationRange.value.set(T[0],T[1])},setMaxIntensity:T=>{A.maxIntensity.value=T},setIntensityContrast:T=>{A.intensityContrast.value=T},setPointAlpha:T=>{A.alpha.value=T},getLatLongHeightFromPosition:T=>{const F=b.ellipsoid.cartesianToCartographic(new g.Vector3().copy(T).applyMatrix4(new g.Matrix4().copy(v).invert()).toArray());return{lat:F[1],long:F[0],height:F[2]}},getPositionFromLatLongHeight:T=>{const F=b.ellipsoid.cartographicToCartesian([T.long,T.lat,T.height]);return new g.Vector3(...F).applyMatrix4(v)},orientToGeocoord:T=>{const F=[T.long,T.lat,T.height],tt=b.ellipsoid.cartographicToCartesian(F),it=new g.Matrix4().fromArray(b.ellipsoid.eastNorthUpToFixedFrame(tt)),St=new g.Matrix4().makeRotationFromEuler(new g.Euler(Math.PI/2,Math.PI/2,0)),xr=new g.Matrix4().copy(it).multiply(St).invert();Ir(xr)},getWebMercatorCoord:T=>Ry(T.lat,T.long),getCameraFrustum:T=>{const tt=uc(T).planes.map(St=>new $(St.normal.toArray(),St.constant)).map(St=>wy(St)),it=new g.Group;for(const St of tt)it.add(St);return it},overlayGeoJSON:(T,F)=>{if(T.applyMatrix4(v),T.updateMatrixWorld(),!r)throw new Error("GeoJSON draping requires a rendere reference via LoaderProps");return Sy(i,d,r,F),T.material.dispose(),T.material=kt,T},setViewport:T=>{i=T,Nt=null,ne=!0,ht&&Iy(i)},update:function(T,F){if(Ae=F,L+=T,ht&&xy(F),b&&L>=o){if(!Z.equals(d.matrixWorld)){L=0,Z.copy(d.matrixWorld),n.updateTransforms&&Qe();const tt=new g.Vector3().setFromMatrixPosition(Z);A.rootCenter.value.copy(tt),A.rootNormal.value.copy(new g.Vector3(0,0,1).applyMatrix4(Z).normalize()),Ut.copy(Z).invert(),n.debug&&(h[b.root.id].matrixWorld.copy(v),h[b.root.id].applyMatrix4(Z))}rt==null?rt=new g.Matrix4().copy(F.matrixWorld):(ne||ky(F,rt))&&(L=0,ne=!1,b._frameNumber++,F.getWorldPosition(Xe),rt.copy(F.matrixWorld),Xn(b,u,i,F))}},dispose:function(){for(X=!0,b._destroy();d.children.length>0;){const T=d.children[0];Sr(T),d.remove(T)}for(;m.children.length>0;){const T=m.children[0];m.remove(T),T.geometry.dispose(),T.material.dispose()}w&&w.dispose(),B&&B.dispose()}}}}static async loadGeoJSON(t){const{url:n,height:s,featureToColor:r}=t;return oe(n,ze,{worker:!1,gis:{format:"binary"}}).then(i=>{const o=i,a=new g.BufferGeometry,c=o.polygons.positions.value.reduce((h,f,d,m)=>{if(d%2==0){const A=[f,m[d+1],s??0],y=J.WGS84.cartographicToCartesian(A);h.push(...y)}return h},[]);if(a.setAttribute("position",new g.Float32BufferAttribute(c,3)),r){const h=o.polygons.numericProps[r.feature].value.reduce((f,d,m,A)=>{const y=r.colorMap(d);return f[m*3]=y.r,f[m*3+1]=y.g,f[m*3+2]=y.b,f},[]);a.setAttribute("color",new g.Float32BufferAttribute(h,3))}a.setIndex(new g.BufferAttribute(o.polygons.triangles.value,1));const l=new g.MeshBasicMaterial({transparent:!0,vertexColors:!0,opacity:.5,blending:g.NormalBlending});return new g.Mesh(a,l)})}}async function Vy(e,t,n,s,r){return new Promise((i,o)=>{const a=new g.Matrix4().makeRotationAxis(new g.Vector3(1,0,0),Math.PI/2),c=t.content.gltfUpAxis!=="Z",l=new g.Matrix4().fromArray(t.computedTransform).premultiply(r);c&&l.multiply(a),t.content.byteLength||(t.content.byteLength=t.content.gltfArrayBuffer.byteLength),e.parse(t.content.gltfArrayBuffer,t.contentUrl?t.contentUrl.substr(0,t.contentUrl.lastIndexOf("/")+1):null,u=>{t.userData.asset=u.asset;const h=u.scenes[0];h.applyMatrix4(l),t.content.texturesByteLength=0,t.content.geometriesByteLength=0,h.traverse(f=>{if(f.type=="Mesh"){const d=f;t.content.geometriesByteLength+=dc(d.geometry);const m=d.material,A=m.map;if(A){const y=My(A);y&&(t.content.texturesByteLength+=y)}s.material?(d.material=s.material.clone(),m.dispose()):s.shading==We.FlatTexture&&d.material.type!=="MeshBasicMaterial"&&(d.material=n.clone(),m.dispose()),s.shading!=We.ShadedNoTexture?d.material.type=="ShaderMaterial"?d.material.uniforms.map={value:A}:d.material.map=A:(A&&A.dispose(),d.material.map=null),d.material.wireframe=s.wireframe,s.contentPostProcess&&s.contentPostProcess(d)}}),t.content.gpuMemoryUsageInBytes=t.content.texturesByteLength+t.content.geometriesByteLength,i(h)},u=>{o(new Error(`error parsing gltf in tile ${t.id}: ${u}`))})})}function jy(e,t,n,s){const r={rtc_center:e.content.rtcCenter,points:e.content.attributes.positions,intensities:e.content.attributes.intensity,classifications:e.content.attributes.classification,rgb:null,rgba:null},{colors:i}=e.content.attributes;i&&i.size===3&&(r.rgb=i.value),i&&i.size===4&&(r.rgba=i.value);const o=new g.BufferGeometry;o.setAttribute("position",new g.Float32BufferAttribute(r.points,3));const a=new g.Matrix4().fromArray(e.computedTransform).premultiply(s);r.rgba?o.setAttribute("color",new g.Float32BufferAttribute(r.rgba,4)):r.rgb&&o.setAttribute("color",new g.Uint8BufferAttribute(r.rgb,3,!0)),r.intensities&&o.setAttribute("intensity",new g.BufferAttribute(r.intensities,1,!0)),r.classifications&&o.setAttribute("classification",new g.Uint8BufferAttribute(r.classifications,1,!1)),e.content.geometriesByteLength=dc(o),e.content.gpuMemoryUsageInBytes=e.content.geometriesByteLength;const c=new g.Points(o,n.material||t);if(r.rtc_center){const l=r.rtc_center;a.multiply(new g.Matrix4().makeTranslation(l[0],l[1],l[2]))}return c.applyMatrix4(a),n.contentPostProcess&&n.contentPostProcess(c),c}function Ac(e){var t,n,s,r;(t=e==null?void 0:e.uniforms)!=null&&t.map?(s=(n=e==null?void 0:e.uniforms)==null?void 0:n.map.value)==null||s.dispose():e.map&&((r=e.map)==null||r.dispose()),e.dispose()}function Sr(e){e.traverse(t=>{if(t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)Ac(t.material);else for(const n of t.material)Ac(n)});for(let t=e.children.length-1;t>=0;t--){const n=e.children[t];e.remove(n)}}function ky(e,t){return!e.matrixWorld.equals(t)}function Ky(e){const t=new Map;return e.forEach(r=>{var o,a;const i=(a=(o=r==null?void 0:r.userData)==null?void 0:o.asset)==null?void 0:a.copyright;i&&i.split(/;/g).map(l=>l.trim()).forEach(l=>{l&&t.set(l,(t.get(l)||0)+1)})}),Array.from(t).sort((r,i)=>i[1]-r[1]).map(([r])=>r).join("; ")}gt.Loader3DTiles=Jy,gt.PointCloudColoring=Mr,gt.Shading=We,Object.defineProperty(gt,Symbol.toStringTag,{value:"Module"})});
