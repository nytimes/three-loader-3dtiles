import{O,S as D,a as M}from"./stats-widget-Jvz1JHcD.js";import{M as u,T as f,S as W,P as j,W as B,L as S,a as K,b as d,N as G,A as R,c as _,d as k,C as q}from"./three-loader-3diles-lsJcE5pf.js";import{g as I}from"./lil-gui.module.min-eVeCAemg.js";class J extends O{constructor(l,s){super(l,s),this.screenSpacePanning=!1,this.mouseButtons={LEFT:u.PAN,MIDDLE:u.DOLLY,RIGHT:u.ROTATE},this.touches={ONE:f.PAN,TWO:f.DOLLY_ROTATE}}}const o=document.querySelector("#canvas-parent"),v=document.querySelector("#stats-widget"),h=new W,r=new j(45,1,10,1e5),m=new B,Y=new q,b=new J(r,o);b.listenToKeyEvents(window);o.appendChild(m.domElement);const c=new D;c.domElement.style.position="absolute";c.domElement.style.top="10px";c.domElement.style.left="10px";o.appendChild(c.domElement);const n=new URLSearchParams(document.location.search),z=document.getElementById("copyright");F();const P=n.get("lat")??50.089,T=n.get("long")??14.42,E=n.get("height")??0,e={lat:P,long:T,height:E,googleApiKey:n.get("googleApiKey")??"",reload:()=>{U(),window.location.reload()},enableDraping:!0,minHeight:0,maxHeight:300,samples:4,sampleStep:4,opacity:.7,blendingType:"Normal"},A={Normal:G,Additive:R,Subtractive:_,Multiply:k};function U(){n.set("googleApiKey",e.googleApiKey),n.set("lat",e.lat),n.set("long",e.long),n.set("height",e.height),window.history.replaceState({},"","?"+n.toString())}let i,w,a,x,C;async function F(){const p=await S.load({url:"https://tile.googleapis.com/v1/3dtiles/root.json",renderer:m,viewport:L(),options:{googleApiKey:n.get("googleApiKey")??"",dracoDecoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/draco",basisTranscoderPath:"https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/basis",pointCloudColoring:K.RGB,maximumScreenSpaceError:n.get("sse")??24}}),{model:l,runtime:s}=p;i=s,y(),h.add(l),w=new M(s.getStats(),{container:v}),v.style.visibility="visible",s.orientToGeocoord({lat:Number(P),long:Number(T),height:Number(E)}),r.translateY(1e3),b.update(),a=await S.loadGeoJSON({url:"https://raw.githubusercontent.com/visgl/deck.gl-data/1126e3041884597d2d3777446d1c292efc26a671/examples/google-3d-tiles/buildings.geojson",height:270,featureToColor:{feature:"distance_to_nearest_tree",colorMap:g=>g<50?new d("rgb(254, 235, 226)"):g<100?new d("rgb(251, 180, 185)"):g<200?new d("rgb(247, 104, 161)"):g<300?new d("rgb(197, 27, 138)"):new d("rgb(122, 1, 119)")}}),C=a.material,s.overlayGeoJSON(a),x=a.material,a.updateMatrixWorld(!0),N(),h.add(a)}function H(p){const l=Y.getDelta();b.update(),i&&i.update(l,r),w&&w.update(),m.render(h,r),c.update(),z.innerHTML=(i==null?void 0:i.getDataAttributions())??"",window.requestAnimationFrame(H)}y();function y(){m.setSize(o.clientWidth,o.clientHeight),i==null||i.setViewport(L()),r.aspect=o.clientWidth/o.clientHeight,r.updateProjectionMatrix()}window.addEventListener("resize",y);function L(){return{width:o.clientWidth,height:o.clientHeight,devicePixelRatio:window.devicePixelRatio}}function N(){a&&(a.material=e.enableDraping?x:C,e.enableDraping&&(a.material.uniforms.minHeight.value=e.minHeight,a.material.uniforms.maxHeight.value=e.maxHeight,a.material.uniforms.samples.value=e.samples,a.material.uniforms.sampleStep.value=e.sampleStep,a.material.uniforms.opacity.value=e.opacity,a.material.blending=A[e.blendingType]))}const t=new I().title("Params");t.width=300;t.add(e,"lat");t.add(e,"long");t.add(e,"height");t.add(e,"googleApiKey");t.add(e,"enableDraping");t.add(e,"minHeight",0,1e3);t.add(e,"maxHeight",0,1e3);t.add(e,"samples",1,10);t.add(e,"sampleStep",.1,10);t.add(e,"opacity",0,1);t.add(e,"blendingType",Object.keys(A));t.add(e,"reload");t.onChange(N);t.open();H();
